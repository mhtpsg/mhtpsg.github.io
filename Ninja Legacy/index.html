<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="assets/css/main.css">
    <title>ü•∑ Ninja Legacy</title>
</head>
<body>
    <!-- Main Menu Screen -->
    <div id="mainScreen" class="screen active">
<h1 class="main-title">‚öîÔ∏è Ninja Legacy</h1>
        <div class="button-group">
            <button class="menu-button" id="newGameBtn">üéÆ New Game</button>
            <button class="menu-button" id="loadGameBtn">üìÇ Load Game</button>
            <button class="menu-button" id="eventsBtn">üéâ Events</button>
            <button class="menu-button" id="aboutBtn">üìù Patch Notes</button>
        </div>
    </div>

    <!-- Character Selection Screen -->
    <div id="characterScreen" class="screen">
        <h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8em;">Choose Your Ninja</h2>
        <div id="characterGrid" class="character-grid"></div>
        <div style="text-align: center; margin-top: 30px;">
            <button class="menu-button" id="startGameBtn">Start Adventure</button>
            <button class="menu-button" id="backToMainBtn" style="background: linear-gradient(135deg, #95a5a6, #7f8c8d); margin-top: 10px;">Back</button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="screen">
        <div class="game-header">
            <div class="player-info-grid">
                <div>
                    <h3 id="playerNameHeader" style="margin-bottom: 10px;">Player</h3>
                    <div class="stat-bar">
                        <span class="stat-label">HP</span>
                        <div class="bar-container">
                            <div id="playerHPBar" class="bar-fill hp-bar"></div>
                        </div>
                        <span class="stat-value" id="playerHPText">100/100</span>
                    </div>
                    <div class="stat-bar">
                        <span class="stat-label">MP</span>
                        <div class="bar-container">
                            <div id="playerChakraBar" class="bar-fill chakra-bar"></div>
                        </div>
                        <span class="stat-value" id="playerChakraText">50/50</span>
                    </div>
                    <div class="stat-bar">
                        <span class="stat-label">EXP</span>
                        <div class="bar-container">
                            <div id="playerExpBar" class="bar-fill exp-bar"></div>
                        </div>
                        <span class="stat-value" id="playerExpText">0/100</span>
                    </div>
                </div>
                <div class="player-avatar">
                    <div id="playerSprite" class="player-sprite">ü•∑</div>
                    <div style="font-weight: bold;">Lv.<span id="playerLevel">1</span></div>
                    <div style="color: #f39c12; margin-top: 5px;">üí∞ <span id="goldAmount">0</span></div>
                </div>
            </div>
        </div>

        <div id="battleArena" class="battle-arena">
            <div class="fighters">
                <div id="playerFighter" class="fighter">
                    <div id="playerSpriteArena" class="fighter-sprite">ü•∑</div>
                    <div id="playerNameBattle" class="fighter-name">Player</div>
                </div>
                <div class="vs-indicator">‚öîÔ∏è</div>
                <div id="enemyFighter" class="fighter">
                    <div id="enemySprite" class="fighter-sprite">üëπ</div>
                    <div id="enemyName" class="fighter-name">Enemy</div>
                    <div class="stat-bar" style="margin-top: 10px;">
                        <div class="bar-container">
                            <div id="enemyHPBar" class="bar-fill hp-bar"></div>
                        </div>
                        <span class="stat-value" id="enemyHPText">100/100</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="actionButtons" class="action-grid"></div>

        <div id="battleLog" class="battle-log">
            <div class="log-entry">‚öîÔ∏è Welcome to battle!</div>
        </div>
    </div>
    
    <!-- Dragon Slayer Intro Screen -->
<div id="dragonIntroScreen" class="screen">
    <div class="dragon-intro-container">
        <div class="dragon-dialogue-box">
            <div class="dragon-speaker">üêâ</div>
            <div id="dialogueText" class="dialogue-text">How dare humans enter this place!</div>
        </div>
        <div class="tap-indicator">Tap to continue...</div>
    </div>
</div>

<!-- Dragon Slayer Main Screen -->
<div id="dragonSlayerScreen" class="screen">
    <div class="dragon-background">
        <h1 class="main-title">üêâ Dragon Slayer Event</h1>
        <div class="button-group">
            <button class="menu-button" onclick="showDragonBattle()">üêâ Battle</button>
            <button class="menu-button" onclick="showMilestone()">üì¶ Milestone</button>
            <button class="menu-button" onclick="showMaterialMarket()">üé™ Material Market</button>
        </div>
    </div>
</div>

<!-- Dragon Battle Screen -->
<div id="dragonBattleScreen" class="screen">
    <div class="game-header">
        <div class="battle-turn-info">
            <div class="turn-counter">Turn: <span id="currentTurn">1</span>/7</div>
            <div class="damage-counter">Total Damage: <span id="totalDamage">0</span></div>
        </div>
    </div>

    <div class="battle-arena dragon-arena">
        <div class="fighters">
            <div class="fighter">
                <div class="fighter-sprite player-fighter">ü•∑</div>
                <div class="fighter-name">Player</div>
                <div class="fighter-stats">
                    <div class="stat-bar">
                        <span class="stat-label">HP</span>
                        <div class="bar-container">
                            <div class="bar-fill hp-bar" id="playerHpBar" style="width: 100%"></div>
                        </div>
                        <span class="stat-value"><span id="playerHp">100</span>/100</span>
                    </div>
                    <div class="stat-bar">
                        <span class="stat-label">MP</span>
                        <div class="bar-container">
                            <div class="bar-fill chakra-bar" id="playerMpBar" style="width: 100%"></div>
                        </div>
                        <span class="stat-value"><span id="playerMp">100</span>/100</span>
                    </div>
                </div>
            </div>
            
            <div class="vs-indicator">VS</div>
            
            <div class="fighter">
                <div class="fighter-sprite dragon-fighter">üêâ</div>
                <div class="fighter-name">Ancient Dragon</div>
                <div class="fighter-stats">
                    <div class="stat-bar">
                        <span class="stat-label">HP</span>
                        <div class="bar-container">
                            <div class="bar-fill hp-bar" id="dragonHpBar" style="width: 100%"></div>
                        </div>
                        <span class="stat-value"><span id="dragonHp">2000</span>/2000</span>
                    </div>
                    <div class="stat-bar">
                        <span class="stat-label">MP</span>
                        <div class="bar-container">
                            <div class="bar-fill chakra-bar" id="dragonMpBar" style="width: 100%"></div>
                        </div>
                        <span class="stat-value"><span id="dragonMp">1000</span>/1000</span>
                    </div>
                </div>
            </div>
        </div>
        <div id="battleEffects" class="battle-effects"></div>
    </div>

    <div class="action-grid dragon-actions">
        <button class="action-btn heal-btn" id="healHpBtn" onclick="healPlayer('hp')">
            <div class="btn-icon">‚ù§Ô∏è</div>
            <div class="btn-name">Heal HP</div>
            <div class="cooldown-overlay" id="healHpCooldown"></div>
        </button>
        <button class="action-btn heal-btn" id="healMpBtn" onclick="healPlayer('mp')">
            <div class="btn-icon">üíô</div>
            <div class="btn-name">Heal MP</div>
            <div class="cooldown-overlay" id="healMpCooldown"></div>
        </button>
        <button class="action-btn skill-btn" id="knifeBtn" onclick="useSkill('knife')">
            <div class="btn-icon">üó°Ô∏è</div>
            <div class="btn-name">Knife Slash</div>
            <div class="btn-cost">20</div>
        </button>
        <button class="action-btn skill-btn" id="rageBtn" onclick="useSkill('rage')">
            <div class="btn-icon">üò°</div>
            <div class="btn-name">Rage Wrath</div>
            <div class="btn-cost">40</div>
            <div class="cooldown-overlay" id="rageCooldown"></div>
        </button>
        <button class="action-btn skill-btn" id="windBtn" onclick="useSkill('wind')">
            <div class="btn-icon">üí®</div>
            <div class="btn-name">Wind Step</div>
            <div class="btn-cost">25</div>
            <div class="cooldown-overlay" id="windCooldown"></div>
        </button>
        <button class="action-btn skill-btn" id="dragonWaveBtn" onclick="useSkill('dragon')">
            <div class="btn-icon">üêâ‚É§</div>
            <div class="btn-name">Dragon Wave</div>
            <div class="btn-cost">45</div>
            <div class="skill-lock">‚ùå</div>
        </button>
    </div>

    <div class="battle-log" id="dragonBattleLog">
        <div class="log-entry">Battle started! You have 6 turns before dragon attacks!</div>
    </div>

    <button class="menu-button" onclick="backToDragonMain()">üîô Back to Dragon Slayer</button>
</div>

<!-- Milestone Screen -->
<div id="milestoneScreen" class="screen">
    <h2 class="main-title">üì¶ Battle Milestones</h2>
    <div style="margin-bottom: 20px;">
        <div style="font-size: 1.2em; font-weight: bold; text-align: center; color: #fff; padding: 15px; line-height: 1.6;">
            Battles Completed: <span id="battleCount" style="color: #f39c12; font-size: 1.3em; margin-left: 5px;">0</span>
        </div>
    </div>
    <div class="milestone-list">
        <div class="milestone-card" id="milestone25">
            <div class="milestone-icon">üéØ</div>
            <div class="milestone-info">
                <h3>25 Battles</h3>
                <p>Reward: 1x üê≤ Dragon Head</p>
                <div class="milestone-status">‚ùå Locked (0/25)</div>
                <button class="claim-btn" id="claim25" onclick="claimMilestone(25)" style="display: none;">üéÅ Claim Reward</button>
            </div>
        </div>
        <div class="milestone-card" id="milestone50">
            <div class="milestone-icon">üéØ</div>
            <div class="milestone-info">
                <h3>50 Battles</h3>
                <p>Reward: 1x üê¶‚Äçüî• The Phoenix</p>
                <div class="milestone-status">‚ùå Locked (0/50)</div>
                <button class="claim-btn" id="claim50" onclick="claimMilestone(50)" style="display: none;">üéÅ Claim Reward</button>
            </div>
        </div>
        <div class="milestone-card" id="milestone150">
            <div class="milestone-icon">üéØ</div>
            <div class="milestone-info">
                <h3>150 Battles</h3>
                <p>Reward: 2x üê≤ Dragon Head, 1x ‚õ©Ô∏è The Gate</p>
                <div class="milestone-status">‚ùå Locked (0/150)</div>
                <button class="claim-btn" id="claim150" onclick="claimMilestone(150)" style="display: none;">üéÅ Claim Reward</button>
            </div>
        </div>
        <div class="milestone-card" id="milestone300">
            <div class="milestone-icon">üéØ</div>
            <div class="milestone-info">
                <h3>300 Battles</h3>
                <p>Reward: 3x üê≤ Dragon Head, 3x üê¶‚Äçüî• The Phoenix, 3x ‚õ©Ô∏è The Gate</p>
                <div class="milestone-status">‚ùå Locked (0/300)</div>
                <button class="claim-btn" id="claim300" onclick="claimMilestone(300)" style="display: none;">üéÅ Claim Reward</button>
            </div>
        </div>
    </div>
    <button class="menu-button" onclick="backToDragonMain()">üîô Back to Dragon Slayer</button>
</div>

<!-- Material Market Screen -->
<div id="materialMarketScreen" class="screen">
    <h2 class="main-title">üé™ Material Market</h2>
    <div class="inventory-display">
        <h3>Your Materials:</h3>
        <div class="material-inventory">
            <div class="material-item">üê≤ Dragon Head: <span id="dragonHeadCount">0</span></div>
            <div class="material-item">üê¶‚Äçüî• The Phoenix: <span id="phoenixCount">0</span></div>
            <div class="material-item">‚õ©Ô∏è The Gate: <span id="gateCount">0</span></div>
        </div>
    </div>
    
    <div class="shop-section">
        <div class="shop-item">
            <div class="item-icon">üêâ‚É§</div>
            <div class="item-info">
                <h3>Dragon Wave Dance</h3>
                <p>Damage: 1500 + 30% Bleeding</p>
                <div class="item-cost">
                    Cost: 20x üê≤ + 25x üê¶‚Äçüî• + 16x ‚õ©Ô∏è
                </div>
                <button class="shop-btn" id="buyDragonWave" onclick="buyDragonWave()">Purchase</button>
            </div>
        </div>
    </div>
    <button class="menu-button" onclick="backToDragonMain()">üîô Back to Dragon Slayer</button>
</div>

<style>
/* Dragon Slayer Styles */
.dragon-background {
    background: url('https://img.freepik.com/free-photo/modern-futuristic-sci-fi-background_35913-2224.jpg?semt=ais_incoming&w=740&q=80') center/cover;
    min-height: 100vh;
    padding: 40px 20px;
    position: relative;
}

.dragon-background::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 1;
}

.dragon-background > * {
    position: relative;
    z-index: 2;
}

.dragon-intro-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    text-align: center;
}

.dragon-dialogue-box {
    background: rgba(0,0,0,0.9);
    border: 3px solid var(--primary-color);
    border-radius: 20px;
    padding: 30px;
    max-width: 400px;
    margin-bottom: 20px;
    animation: dialoguePulse 2s ease-in-out infinite;
}

@keyframes dialoguePulse {
    0%, 100% { box-shadow: 0 0 20px rgba(233, 69, 96, 0.3); }
    50% { box-shadow: 0 0 40px rgba(233, 69, 96, 0.6); }
}

.dragon-speaker {
    font-size: 4em;
    margin-bottom: 15px;
}

.dialogue-text {
    font-size: 1.2em;
    line-height: 1.6;
    color: #fff;
}

.tap-indicator {
    opacity: 0.7;
    animation: blink 1.5s ease-in-out infinite;
}

@keyframes blink {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 0.3; }
}

.battle-turn-info {
    display: flex;
    justify-content: space-between;
    font-weight: bold;
    font-size: 1.1em;
}

.dragon-arena {
    background: linear-gradient(135deg, rgba(139, 69, 19, 0.3), rgba(0, 0, 0, 0.5));
    border: 2px solid var(--halloween-orange);
}

.dragon-actions {
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}

.dragon-actions .action-btn {
    min-height: 80px;
    position: relative;
}

.skill-lock {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2em;
    z-index: 5;
    display: block;
}

.action-btn:disabled .skill-lock {
    display: block;
}

.action-btn:not(:disabled) .skill-lock {
    display: none;
}

.cooldown-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    border-radius: 12px;
    display: none;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 1.2em;
    z-index: 10;
}

.cooldown-overlay.active {
    display: flex;
}

.battle-effects {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 3em;
    z-index: 10;
    pointer-events: none;
}

.damage-effect {
    animation: damageFloat 1s ease-out forwards;
}

@keyframes damageFloat {
    0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -150%) scale(1.5); }
}

.milestone-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin: 20px 0;
}

.milestone-card {
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    border-left: 4px solid #666;
}

.milestone-card.ready {
    border-left-color: #f39c12;
    background: rgba(243, 156, 18, 0.1);
}

.milestone-card.completed {
    border-left-color: #2ecc71;
    background: rgba(46, 204, 113, 0.1);
}

.milestone-icon {
    font-size: 2.5em;
    flex-shrink: 0;
}

.milestone-info {
    flex: 1;
    min-width: 0;
}

.milestone-info h3 {
    margin-bottom: 8px;
    color: var(--secondary-color);
}

.milestone-status {
    margin-top: 8px;
    font-weight: bold;
    word-wrap: break-word;
}

.claim-btn {
    background: linear-gradient(135deg, #f39c12, #e67e22);
    border: none;
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 10px;
    transition: transform 0.2s ease;
}

.claim-btn:active {
    transform: scale(0.95);
}

.inventory-display {
    background: rgba(0,0,0,0.4);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
}

.material-inventory {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    margin-top: 15px;
}

.material-item {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    font-weight: bold;
}

.shop-section {
    background: rgba(0,0,0,0.4);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
}

.shop-item {
    display: flex;
    align-items: center;
    gap: 20px;
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    padding: 20px;
    border: 2px solid var(--primary-color);
}

.item-icon {
    font-size: 3em;
}

.item-info {
    flex: 1;
}

.item-info h3 {
    color: var(--secondary-color);
    margin-bottom: 8px;
}

.item-cost {
    margin: 10px 0;
    color: #ffd700;
    font-weight: bold;
}

.shop-btn {
    background: linear-gradient(135deg, var(--primary-color), #f2709c);
    border: none;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: transform 0.2s ease;
}

.shop-btn:active {
    transform: scale(0.95);
}

.shop-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #666;
}
</style>

<script>
// Dragon Slayer Game Variables
let dragonGameState = {
    currentTurn: 1,
    totalDamage: 0,
    playerHp: 100,
    playerMp: 100,
    dragonHp: 2000,
    dragonMp: 1000,
    battleCount: 0,
    materials: {
        dragonHead: 0,
        phoenix: 0,
        gate: 0
    },
    buffs: {
        rageActive: false,
        bleedingActive: false
    },
    cooldowns: {
        healHp: 0,
        healMp: 0,
        rage: 0,
        wind: 0
    },
    dragonWaveUnlocked: false,
    currentDialogue: 0,
    milestonesClaimed: {
        25: false,
        50: false,
        150: false,
        300: false
    }
};

// ========== LOCALSTORAGE FUNCTIONS ==========

function saveProgress() {
    const saveData = {
        battleCount: dragonGameState.battleCount,
        materials: dragonGameState.materials,
        dragonWaveUnlocked: dragonGameState.dragonWaveUnlocked,
        milestonesClaimed: dragonGameState.milestonesClaimed
    };
    
    localStorage.setItem('dragonSlayerProgress', JSON.stringify(saveData));
    console.log('Progress saved!', saveData);
}

function loadProgress() {
    const savedData = localStorage.getItem('dragonSlayerProgress');
    
    if (savedData) {
        try {
            const parsedData = JSON.parse(savedData);
            
            dragonGameState.battleCount = parsedData.battleCount || 0;
            dragonGameState.materials = parsedData.materials || { dragonHead: 0, phoenix: 0, gate: 0 };
            dragonGameState.dragonWaveUnlocked = parsedData.dragonWaveUnlocked || false;
            dragonGameState.milestonesClaimed = parsedData.milestonesClaimed || { 25: false, 50: false, 150: false, 300: false };
            
            console.log('Progress loaded!', parsedData);
            return true;
        } catch (e) {
            console.error('Error loading progress:', e);
            return false;
        }
    }
    return false;
}

// Dragon Intro Dialogue System
const dragonDialogues = [
    "How dare humans enter this place!",
    "But let it be, welcome humans to the Dragon Slayer Event!",
    "That's the introduction! Challenge me if you can..."
];

// Cooldown system
function startCooldown(type, duration) {
    dragonGameState.cooldowns[type] = duration;
    const cooldownElement = document.getElementById(`${type}Cooldown`);
    if (cooldownElement) {
        cooldownElement.classList.add('active');
        
        const interval = setInterval(() => {
            dragonGameState.cooldowns[type]--;
            cooldownElement.textContent = dragonGameState.cooldowns[type];
            
            if (dragonGameState.cooldowns[type] <= 0) {
                clearInterval(interval);
                cooldownElement.classList.remove('active');
            }
        }, 1000);
    }
}

// Navigation to Dragon Slayer
function showDragonSlayer() {
    document.getElementById('dragonIntroScreen').classList.add('active');
    document.querySelectorAll('.screen').forEach(s => s !== document.getElementById('dragonIntroScreen') ? s.classList.remove('active') : null);
    startDragonIntro();
}

function startDragonIntro() {
    dragonGameState.currentDialogue = 0;
    updateDialogue();
    
    document.getElementById('dragonIntroScreen').onclick = function() {
        dragonGameState.currentDialogue++;
        if (dragonGameState.currentDialogue >= dragonDialogues.length) {
            showDragonMain();
        } else {
            updateDialogue();
        }
    };
}

function updateDialogue() {
    document.getElementById('dialogueText').textContent = dragonDialogues[dragonGameState.currentDialogue];
}

function showDragonMain() {
    document.getElementById('dragonSlayerScreen').classList.add('active');
    document.getElementById('dragonIntroScreen').classList.remove('active');
}

// Dragon Battle System
function showDragonBattle() {
    resetBattle();
    document.getElementById('dragonBattleScreen').classList.add('active');
    document.getElementById('dragonSlayerScreen').classList.remove('active');
    addBattleLog("Battle started! You have 6 turns before dragon attacks!");
}

function resetBattle() {
    dragonGameState.currentTurn = 1;
    dragonGameState.totalDamage = 0;
    dragonGameState.playerHp = 100;
    dragonGameState.playerMp = 100;
    dragonGameState.buffs = { rageActive: false, bleedingActive: false };
    dragonGameState.cooldowns = { healHp: 0, healMp: 0, rage: 0, wind: 0 };
    updateBattleUI();
    document.getElementById('dragonBattleLog').innerHTML = '';
}

function healPlayer(type) {
    if (dragonGameState.cooldowns[`heal${type.charAt(0).toUpperCase() + type.slice(1)}`] > 0) {
        addBattleLog("Heal is on cooldown!");
        return;
    }
    
    if (type === 'hp' && dragonGameState.playerHp < 100) {
        dragonGameState.playerHp = Math.min(100, dragonGameState.playerHp + 25);
        addBattleLog("Healed 25 HP!");
        startCooldown('healHp', 3);
        nextTurn();
    } else if (type === 'mp' && dragonGameState.playerMp < 100) {
        dragonGameState.playerMp = Math.min(100, dragonGameState.playerMp + 25);
        addBattleLog("Restored 25 MP!");
        startCooldown('healMp', 3);
        nextTurn();
    }
    updateBattleUI();
}

function useSkill(skillType) {
    let mpCost = 0;
    let damage = 0;
    let effectIcon = '';
    
    switch(skillType) {
        case 'knife':
            mpCost = 20;
            effectIcon = 'üó°Ô∏è';
            if (dragonGameState.playerMp >= mpCost) {
                damage = Math.floor(Math.random() * (9000 - 2000 + 1)) + 2000;
                
                // Apply buffs and reset them with cooldown
                if (dragonGameState.buffs.rageActive) {
                    damage = Math.floor(damage * 1.1);
                    addBattleLog("Rage Wrath bonus applied! +10% damage");
                    dragonGameState.buffs.rageActive = false;
                    startCooldown('rage', 2);
                }
                
                if (dragonGameState.buffs.bleedingActive) {
                    let bleedDamage = Math.floor(damage * 0.04);
                    damage += bleedDamage;
                    addBattleLog("Wind Step bleeding applied! +" + bleedDamage + " bleeding damage");
                    dragonGameState.buffs.bleedingActive = false;
                    startCooldown('wind', 2);
                }
                
                dragonGameState.playerMp -= mpCost;
                dragonGameState.totalDamage += damage;
                showBattleEffect(effectIcon);
                addBattleLog(`Knife Slash deals ${damage} damage!`);
                nextTurn();
            } else {
                addBattleLog("Not enough MP!");
            }
            break;
            
        case 'rage':
            if (dragonGameState.cooldowns.rage > 0) {
                addBattleLog("Rage Wrath is on cooldown!");
                return;
            }
            mpCost = 40;
            effectIcon = 'üò°';
            if (dragonGameState.playerMp >= mpCost) {
                dragonGameState.playerMp -= mpCost;
                dragonGameState.buffs.rageActive = true;
                showBattleEffect(effectIcon);
                addBattleLog("Rage Wrath activated! Next attacks deal +10% damage");
                nextTurn();
            } else {
                addBattleLog("Not enough MP!");
            }
            break;
            
        case 'wind':
            if (dragonGameState.cooldowns.wind > 0) {
                addBattleLog("Wind Step is on cooldown!");
                return;
            }
            mpCost = 25;
            effectIcon = 'üí®';
            if (dragonGameState.playerMp >= mpCost) {
                dragonGameState.playerMp -= mpCost;
                dragonGameState.buffs.bleedingActive = true;
                showBattleEffect(effectIcon);
                addBattleLog("Wind Step activated! Next attacks apply 4% bleeding");
                nextTurn();
            } else {
                addBattleLog("Not enough MP!");
            }
            break;
            
        case 'dragon':
            if (!dragonGameState.dragonWaveUnlocked) {
                addBattleLog("Dragon Wave Dance is not unlocked!");
                return;
            }
            mpCost = 45;
            effectIcon = 'üêâ‚É§';
            if (dragonGameState.playerMp >= mpCost) {
                damage = 1500;
                let bleedDamage = Math.floor(damage * 0.3);
                damage += bleedDamage;
                
                dragonGameState.playerMp -= mpCost;
                dragonGameState.totalDamage += damage;
                showBattleEffect(effectIcon);
                addBattleLog(`Dragon Wave Dance deals ${damage} damage (including 30% bleeding)!`);
                nextTurn();
            } else {
                addBattleLog("Not enough MP!");
            }
            break;
    }
    
    updateBattleUI();
}

function showBattleEffect(icon) {
    const effectDiv = document.getElementById('battleEffects');
    effectDiv.innerHTML = `<div class="damage-effect">${icon}</div>`;
    setTimeout(() => effectDiv.innerHTML = '', 1000);
}

function nextTurn() {
    dragonGameState.currentTurn++;
    
    if (dragonGameState.currentTurn === 8 || dragonGameState.playerHp <= 0) {
        endBattle();
        return;
    }
    
    if (dragonGameState.currentTurn === 7) {
        // Dragon attacks
        dragonAttack();
        setTimeout(() => {
            if (dragonGameState.playerHp <= 0) {
                addBattleLog("You have been defeated!");
                setTimeout(() => endBattle(), 2000);
            } else {
                endBattle();
            }
        }, 1000);
    }
    
    updateBattleUI();
}

function dragonAttack() {
    if (dragonGameState.dragonMp >= 50) {
        const damage = 1000;
        dragonGameState.dragonMp -= 50;
        dragonGameState.playerHp = Math.max(0, dragonGameState.playerHp - damage);
        showBattleEffect('üí•');
        addBattleLog(`Dragon uses Wrath Blame! Deals ${damage} damage to you!`);
    }
}

function endBattle() {
    dragonGameState.battleCount++;
    
    // Check damage rewards
    if (dragonGameState.totalDamage >= 12000) {
        dragonGameState.materials.gate++;
        addBattleLog("üéâ Excellent! You earned 1x ‚õ©Ô∏è The Gate!");
    } else if (dragonGameState.totalDamage >= 8000) {
        dragonGameState.materials.phoenix++;
        addBattleLog("üéâ Great! You earned 1x üê¶‚Äçüî• The Phoenix!");
    } else if (dragonGameState.totalDamage >= 4000) {
        dragonGameState.materials.dragonHead++;
        addBattleLog("üéâ Good! You earned 1x üê≤ Dragon Head!");
    }
    
    addBattleLog(`Battle completed! Total damage: ${dragonGameState.totalDamage}`);
    
    // SAVE PROGRESS AFTER EACH BATTLE
    saveProgress();
    
    updateAllDisplays();
    
    setTimeout(() => {
        backToDragonMain();
    }, 1);
}

function claimMilestone(milestone) {
    if (dragonGameState.battleCount >= milestone && !dragonGameState.milestonesClaimed[milestone]) {
        dragonGameState.milestonesClaimed[milestone] = true;
        
        // Award milestone rewards
        switch(milestone) {
            case 25:
                dragonGameState.materials.dragonHead++;
                alert("üéâ Milestone claimed: 1x üê≤ Dragon Head!");
                break;
            case 50:
                dragonGameState.materials.phoenix++;
                alert("üéâ Milestone claimed: 1x üê¶‚Äçüî• The Phoenix!");
                break;
            case 150:
                dragonGameState.materials.dragonHead += 2;
                dragonGameState.materials.gate++;
                alert("üéâ Milestone claimed: 2x üê≤ Dragon Head, 1x ‚õ©Ô∏è The Gate!");
                break;
            case 300:
                dragonGameState.materials.dragonHead += 3;
                dragonGameState.materials.phoenix += 3;
                dragonGameState.materials.gate += 3;
                alert("üéâ Ultimate milestone claimed: 3x üê≤ Dragon Head, 3x üê¶‚Äçüî• The Phoenix, 3x ‚õ©Ô∏è The Gate!");
                break;
        }
        
        // SAVE PROGRESS AFTER CLAIMING MILESTONE
        saveProgress();
        
        updateAllDisplays();
    }
}

function showMilestone() {
    document.getElementById('milestoneScreen').classList.add('active');
    document.getElementById('dragonSlayerScreen').classList.remove('active');
    updateMilestoneDisplay();
}

function showMaterialMarket() {
    document.getElementById('materialMarketScreen').classList.add('active');
    document.getElementById('dragonSlayerScreen').classList.remove('active');
    updateMarketDisplay();
}

function buyDragonWave() {
    const cost = { dragonHead: 20, phoenix: 25, gate: 16 };
    
    if (dragonGameState.materials.dragonHead >= cost.dragonHead && 
        dragonGameState.materials.phoenix >= cost.phoenix && 
        dragonGameState.materials.gate >= cost.gate) {
        
        dragonGameState.materials.dragonHead -= cost.dragonHead;
        dragonGameState.materials.phoenix -= cost.phoenix;
        dragonGameState.materials.gate -= cost.gate;
        dragonGameState.dragonWaveUnlocked = true;
        
        // SAVE PROGRESS AFTER PURCHASE
        saveProgress();
        
        updateMarketDisplay();
        updateDragonWaveButton();
        
        alert("üéâ Dragon Wave Dance unlocked!");
    } else {
        alert("‚ùå Insufficient materials! Need: 20x üê≤ Dragon Head, 25x üê¶‚Äçüî• The Phoenix, 16x ‚õ©Ô∏è The Gate");
    }
}

function updateBattleUI() {
    document.getElementById('currentTurn').textContent = dragonGameState.currentTurn;
    document.getElementById('totalDamage').textContent = dragonGameState.totalDamage;
    document.getElementById('playerHp').textContent = dragonGameState.playerHp;
    document.getElementById('playerMp').textContent = dragonGameState.playerMp;
    
    // Update bars
    document.getElementById('playerHpBar').style.width = (dragonGameState.playerHp / 100 * 100) + '%';
    document.getElementById('playerMpBar').style.width = (dragonGameState.playerMp / 100 * 100) + '%';
}

function updateMilestoneDisplay() {
    document.getElementById('battleCount').textContent = dragonGameState.battleCount;
    
    // Update milestone status and show/hide claim buttons
    [25, 50, 150, 300].forEach(milestone => {
        const card = document.getElementById(`milestone${milestone}`);
        const claimBtn = document.getElementById(`claim${milestone}`);
        const statusElement = card.querySelector('.milestone-status');
        
        if (dragonGameState.milestonesClaimed[milestone]) {
            card.className = 'milestone-card completed';
            statusElement.textContent = '‚úÖ Claimed';
            statusElement.style.color = '#2ecc71';
            claimBtn.style.display = 'none';
        } else if (dragonGameState.battleCount >= milestone) {
            card.className = 'milestone-card ready';
            statusElement.textContent = `üéÅ Ready to claim (${dragonGameState.battleCount}/${milestone})`;
            statusElement.style.color = '#f39c12';
            claimBtn.style.display = 'block';
        } else {
            card.className = 'milestone-card';
            statusElement.textContent = `‚ùå Locked (${dragonGameState.battleCount}/${milestone})`;
            statusElement.style.color = '#666';
            claimBtn.style.display = 'none';
        }
    });
}

function updateMarketDisplay() {
    document.getElementById('dragonHeadCount').textContent = dragonGameState.materials.dragonHead;
    document.getElementById('phoenixCount').textContent = dragonGameState.materials.phoenix;
    document.getElementById('gateCount').textContent = dragonGameState.materials.gate;
    
    const buyBtn = document.getElementById('buyDragonWave');
    if (dragonGameState.dragonWaveUnlocked) {
        buyBtn.textContent = 'Purchased ‚úÖ';
        buyBtn.disabled = true;
    } else {
        buyBtn.textContent = 'Purchase';
        buyBtn.disabled = false;
    }
}

function updateDragonWaveButton() {
    const dragonBtn = document.getElementById('dragonWaveBtn');
    if (dragonGameState.dragonWaveUnlocked) {
        dragonBtn.disabled = false;
        dragonBtn.querySelector('.skill-lock').style.display = 'none';
    } else {
        dragonBtn.disabled = true;
        dragonBtn.querySelector('.skill-lock').style.display = 'block';
    }
}

function updateAllDisplays() {
    updateBattleUI();
    updateMilestoneDisplay();
    updateMarketDisplay();
    updateDragonWaveButton();
}

function backToDragonMain() {
    document.getElementById('dragonSlayerScreen').classList.add('active');
    document.querySelectorAll('.screen').forEach(screen => {
        if (screen.id !== 'dragonSlayerScreen') {
            screen.classList.remove('active');
        }
    });
}

function addBattleLog(message) {
    const log = document.getElementById('dragonBattleLog');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.textContent = message;
    log.appendChild(entry);
    log.scrollTop = log.scrollHeight;
}

// Initialize Dragon Wave button state and LOAD PROGRESS
document.addEventListener('DOMContentLoaded', function() {
    // Load saved progress on page load
    loadProgress();
    updateAllDisplays();
});
</script>

<style>
.gift-container {
    max-width: 400px;
    margin: 40px auto;
    text-align: center;
}

.gift-box {
    background: linear-gradient(135deg, #ff6b35 0%, #6a0572 50%, #ff8800 100%);
    border-radius: 20px;
    padding: 40px 30px;
    margin: 30px 0;
    box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
    animation: giftGlow 3s ease-in-out infinite;
    position: relative;
    overflow: hidden;
}

.gift-box::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
    animation: shine 4s linear infinite;
}

@keyframes giftGlow {
    0%, 100% { transform: scale(1); box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3); }
    50% { transform: scale(1.02); box-shadow: 0 15px 40px rgba(255, 107, 53, 0.5); }
}

@keyframes shine {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.gift-icon {
    font-size: 5em;
    margin-bottom: 20px;
    animation: bounce 2s ease-in-out infinite;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

.gift-rewards {
    background: rgba(0,0,0,0.3);
    border-radius: 15px;
    padding: 25px;
    margin: 20px 0;
    backdrop-filter: blur(10px);
}

.reward-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    font-size: 1.1em;
}

.reward-item:last-child {
    border-bottom: none;
}

.reward-icon {
    font-size: 1.5em;
    margin-right: 15px;
}

.reward-value {
    font-weight: bold;
    color: #4ecdc4;
}

.claim-btn {
    background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
    border: none;
    color: white;
    padding: 18px 40px;
    font-size: 1.2em;
    font-weight: bold;
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 5px 20px rgba(46, 204, 113, 0.4);
    position: relative;
    overflow: hidden;
    width: 100%;
}

.claim-btn:disabled {
    cursor: not-allowed;
    opacity: 0.8;
    box-shadow: none;
}

.claim-btn.claimed {
    background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
    border: 2px solid #2ecc71;
    color: white;
    box-shadow: 0 5px 20px rgba(46, 204, 113, 0.6);
    cursor: default;
}

.claim-btn.cooldown {
    background: linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%);
    border: 2px solid #95a5a6;
    color: #fff;
}

.claim-btn:active:not(:disabled):not(.claimed):not(.cooldown) {
    transform: scale(0.95);
}

.cooldown-timer {
    color: #f39c12;
    font-size: 1.1em;
    margin: 20px 0;
    padding: 15px;
    background: rgba(243, 156, 18, 0.1);
    border-radius: 10px;
    border: 1px solid rgba(243, 156, 18, 0.3);
    font-weight: bold;
}

.cooldown-timer .time {
    font-size: 1.3em;
    color: #e67e22;
    display: block;
    margin-top: 5px;
}

.claimed-message {
    color: #2ecc71;
    font-size: 1.1em;
    margin: 20px 0;
    padding: 15px;
    background: rgba(46, 204, 113, 0.1);
    border-radius: 10px;
    border: 1px solid rgba(46, 204, 113, 0.3);
    animation: fadeInPulse 0.5s ease-out;
}

@keyframes fadeInPulse {
    0% { opacity: 0; transform: scale(0.9); }
    50% { opacity: 1; transform: scale(1.05); }
    100% { opacity: 1; transform: scale(1); }
}

.device-info {
    font-size: 0.8em;
    color: #888;
    margin-top: 20px;
    padding: 10px;
    background: rgba(0,0,0,0.2);
    border-radius: 8px;
}

.last-claim-info {
    margin-top: 10px;
    padding: 10px;
    background: rgba(78, 205, 196, 0.1);
    border-radius: 8px;
    font-size: 0.85em;
}
</style>

<div id="giftScreen" class="screen">
    <h2 class="main-title">üéÅ Daily Gift</h2>
    
    <div class="gift-container">
        <div class="gift-box">
            <div class="gift-icon">üéÅ</div>
            <h3 style="margin: 0; font-size: 1.5em;">Daily Gift!</h3>
            <p style="margin: 10px 0; opacity: 0.9;">Daily rewards for ninjas</p>
        </div>

        <div class="gift-rewards">
            <div class="reward-item">
                <div>
                    <span class="reward-icon">üí∞</span>
                    Gold
                </div>
                <div class="reward-value">+100</div>
            </div>
            <div class="reward-item">
                <div>
                    <span class="reward-icon">‚≠ê</span>
                    Experience
                </div>
                <div class="reward-value">+100</div>
            </div>
            <div class="reward-item">
                <div>
                    <span class="reward-icon">üîÆ</span>
                    Skill Points
                </div>
                <div class="reward-value">+2</div>
            </div>
        </div>

        <button class="claim-btn" id="claimGiftBtn" onclick="claimDailyGift()">
            üéÅ Claim Daily Rewards
        </button>

        <div id="cooldownTimer" class="cooldown-timer" style="display: none;">
            ‚è∞ Next claim available in:
            <span class="time" id="countdownDisplay">--:--:--</span>
        </div>

        <div id="claimedMessage" class="claimed-message" style="display: none;">
            ‚úÖ Daily gift claimed successfully!
        </div>

        <div class="device-info">
            <div id="lastClaimInfo" class="last-claim-info" style="display: none;">
                <div>üìÖ Last Claim: <span id="lastClaimDate">-</span></div>
                <div>üéØ Next Available: <span id="nextClaimDate">-</span></div>
            </div>
            
            <div style="margin-top: 15px; font-size: 0.75em; color: #666; text-align: center;">
                ‚ùóAfter Claimed please relog!
            </div>
        </div>
    </div>
</div>

<script>
// Daily Gift System
let dailyGiftData = JSON.parse(localStorage.getItem('dailyGiftData') || '{}');
let countdownInterval = null;

// Check if gift can be claimed
function canClaimDailyGift() {
    if (!dailyGiftData.lastClaimTime) {
        return true; // Belum pernah claim
    }
    
    const now = Date.now();
    const timeSinceLastClaim = now - dailyGiftData.lastClaimTime;
    const twentyFourHours = 24 * 60 * 60 * 1000; // 24 jam dalam milliseconds
    
    return timeSinceLastClaim >= twentyFourHours;
}

// Get remaining time until next claim
function getRemainingTime() {
    if (!dailyGiftData.lastClaimTime) {
        return 0;
    }
    
    const now = Date.now();
    const twentyFourHours = 24 * 60 * 60 * 1000;
    const nextClaimTime = dailyGiftData.lastClaimTime + twentyFourHours;
    const remaining = nextClaimTime - now;
    
    return remaining > 0 ? remaining : 0;
}

// Format time for display
function formatTime(milliseconds) {
    const totalSeconds = Math.floor(milliseconds / 1000);
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    
    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
}

// Format date for display
function formatDate(timestamp) {
    const date = new Date(timestamp);
    return date.toLocaleString('id-ID', {
        day: '2-digit',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

// Start countdown timer
function startCountdown() {
    // Clear existing interval
    if (countdownInterval) {
        clearInterval(countdownInterval);
    }
    
    function updateCountdown() {
        const remaining = getRemainingTime();
        
        if (remaining <= 0) {
            clearInterval(countdownInterval);
            updateDailyGiftUI();
            return;
        }
        
        const countdownDisplay = document.getElementById('countdownDisplay');
        if (countdownDisplay) {
            countdownDisplay.textContent = formatTime(remaining);
        }
    }
    
    updateCountdown();
    countdownInterval = setInterval(updateCountdown, 1000);
}

// Claim daily gift
function claimDailyGift() {
    const claimBtn = document.getElementById('claimGiftBtn');
    
    if (!canClaimDailyGift()) {
        return;
    }

    // Immediate visual feedback - show processing state
    claimBtn.innerHTML = '‚úÖ Claimed';
    claimBtn.disabled = true;
    claimBtn.style.background = 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)';

    // Simulate processing delay for better UX
    setTimeout(() => {
        // Add rewards
        gameState.gold += 100;
        if (gameState.player) {
            gameState.player.exp += 100;
            gameState.player.skillPoints += 2;
            
            // Check for level up
            const expNeeded = gameState.player.level * 100;
            while (gameState.player.exp >= expNeeded) {
                gameState.player.exp -= expNeeded;
                gameState.player.level++;
                gameState.player.maxHP += 20;
                gameState.player.maxChakra += 15;
                gameState.player.hp = gameState.player.maxHP;
                gameState.player.chakra = gameState.player.maxChakra;
            }
        }

        // Update claim data
        dailyGiftData = {
            lastClaimTime: Date.now(),
            totalClaims: (dailyGiftData.totalClaims || 0) + 1
        };
        
        localStorage.setItem('dailyGiftData', JSON.stringify(dailyGiftData));
        
        // Save game state
        saveGame();
        
        // Show immediate success feedback on button
        claimBtn.innerHTML = '‚úÖ Already Claimed';
        claimBtn.classList.add('claimed');
        claimBtn.disabled = true;
        
        // Show success message
        const claimedMsg = document.getElementById('claimedMessage');
        claimedMsg.style.display = 'block';
        claimedMsg.innerHTML = `
            ‚úÖ Daily gift claimed successfully!<br>
            <small>üí∞ +100 Gold | ‚≠ê +100 EXP | üîÆ +2 Skill Points</small><br>
            <small>Total claims: ${dailyGiftData.totalClaims}</small>
        `;
        
        // Update UI
        updateDailyGiftUI();
        
        // Hide success message after 4 seconds
        setTimeout(() => {
            claimedMsg.style.display = 'none';
        }, 4000);
        
    }, 800); // 800ms delay for processing effect
}

// Update daily gift UI
function updateDailyGiftUI() {
    const canClaim = canClaimDailyGift();
    const claimBtn = document.getElementById('claimGiftBtn');
    const cooldownTimer = document.getElementById('cooldownTimer');
    const lastClaimInfo = document.getElementById('lastClaimInfo');
    const lastClaimDate = document.getElementById('lastClaimDate');
    const nextClaimDate = document.getElementById('nextClaimDate');
    
    // Reset button classes
    claimBtn.classList.remove('claimed', 'cooldown');
    
    if (canClaim) {
        // Can claim
        claimBtn.disabled = false;
        claimBtn.innerHTML = 'üéÅ Claim Daily Rewards';
        claimBtn.style.background = 'linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)';
        cooldownTimer.style.display = 'none';
        
        // Stop countdown
        if (countdownInterval) {
            clearInterval(countdownInterval);
        }
    } else {
        // Cannot claim - on cooldown
        claimBtn.disabled = true;
        claimBtn.innerHTML = '‚úÖ Already Claimed';
        claimBtn.classList.add('cooldown');
        cooldownTimer.style.display = 'block';
        
        // Check if just claimed (within 10 seconds)
        const timeSinceLastClaim = Date.now() - dailyGiftData.lastClaimTime;
        if (timeSinceLastClaim < 10000) { // 10 seconds
            claimBtn.classList.remove('cooldown');
            claimBtn.classList.add('claimed');
            claimBtn.innerHTML = '‚úÖ Already Claimed';
        } else {
            claimBtn.innerHTML = '‚è∞ Come Back Tomorrow';
        }
        
        // Start countdown
        startCountdown();
    }
    
    // Show last claim info if available
    if (dailyGiftData.lastClaimTime) {
        lastClaimInfo.style.display = 'block';
        lastClaimDate.textContent = formatDate(dailyGiftData.lastClaimTime);
        
        const nextClaim = dailyGiftData.lastClaimTime + (24 * 60 * 60 * 1000);
        nextClaimDate.textContent = formatDate(nextClaim);
    } else {
        lastClaimInfo.style.display = 'none';
    }
}

// Initialize daily gift on screen show
function initDailyGift() {
    updateDailyGiftUI();
}

// Hook to navigation
const originalNavigation = document.querySelectorAll('.nav-btn');
document.addEventListener('DOMContentLoaded', function() {
    // Update UI when gift screen is shown
    const giftNavBtn = Array.from(document.querySelectorAll('.nav-btn')).find(btn => 
        btn.textContent.includes('Gift')
    );
    
    if (giftNavBtn) {
        giftNavBtn.addEventListener('click', function() {
            setTimeout(() => {
                initDailyGift();
            }, 100);
        });
    }
    
    // Initialize if already on gift screen
    const giftScreen = document.getElementById('giftScreen');
    if (giftScreen && giftScreen.classList.contains('active')) {
        initDailyGift();
    }
});

// Cleanup interval on page unload
window.addEventListener('beforeunload', function() {
    if (countdownInterval) {
        clearInterval(countdownInterval);
    }
});
</script>

<!-- Tambahkan CSS khusus untuk Demon Hunter -->
<style>
    .demon-hunter-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 20px 0;
        padding: 15px;
        background: rgba(0,0,0,0.4);
        border-radius: 15px;
    }

    .demon-stage-indicator {
        text-align: center;
        flex: 1;
    }

    .demon-sprite {
        font-size: 4em;
        margin: 10px 0;
        filter: drop-shadow(0 0 20px rgba(255, 0, 0, 0.5));
    }

    .demon-name {
        font-size: 1.2em;
        font-weight: bold;
        margin: 10px 0;
    }

    .demon-stats {
        font-size: 0.9em;
        color: #bbb;
    }

    .demon-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin: 20px 0;
    }

    .demon-action-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 20px 30px;
        border-radius: 15px;
        cursor: pointer;
        font-size: 2em;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .demon-action-btn:active {
        transform: scale(0.95);
    }

    .demon-action-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }

    .nav-arrow {
        background: rgba(78, 205, 196, 0.2);
        border: 2px solid var(--secondary-color);
        color: var(--secondary-color);
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 1.5em;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .nav-arrow:active {
        transform: scale(0.9);
    }

    .nav-arrow:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }

    .milestone-list {
        background: rgba(0,0,0,0.4);
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        max-height: 60vh;
        overflow-y: auto;
    }

    .milestone-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        margin: 8px 0;
        background: rgba(255,255,255,0.05);
        border-radius: 10px;
        border-left: 4px solid #888;
    }

    .milestone-item.completed {
        border-left-color: #2ecc71;
        background: rgba(46, 204, 113, 0.1);
    }

    .milestone-item.current {
        border-left-color: #f39c12;
        background: rgba(243, 156, 18, 0.1);
    }

    .milestone-item.locked {
        border-left-color: #555;
        background: rgba(100, 100, 100, 0.1);
        opacity: 0.6;
    }

    .demon-battle-container {
        background: rgba(0,0,0,0.5);
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
    }

    .demon-battle-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
    }

    .battle-participant {
        text-align: center;
        padding: 15px;
        background: rgba(255,255,255,0.05);
        border-radius: 12px;
    }

    .demon-skills-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin: 20px 0;
    }

    .demon-skill-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 15px 10px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        font-size: 0.85em;
        min-height: 80px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
    }

    .demon-skill-btn:active {
        transform: scale(0.95);
    }

    .demon-skill-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
        filter: grayscale(1);
    }

    .demon-skill-btn.empty {
        background: rgba(255,255,255,0.1);
        border: 2px dashed rgba(255,255,255,0.3);
    }

    /* Heal buttons styling */
    .heal-buttons {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin: 15px 0;
    }

    .heal-btn {
        background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        border: none;
        color: white;
        padding: 15px 10px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 0.85em;
        min-height: 70px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: 0 3px 10px rgba(46, 204, 113, 0.3);
    }

    .heal-btn:active {
        transform: scale(0.95);
    }

    .heal-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
        filter: grayscale(1);
    }

    .heal-btn.cooldown {
        background: linear-gradient(135deg, #95a5a6 0%, #bdc3c7 100%);
        cursor: not-allowed;
    }

    .skill-unlock-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #2ecc71;
        color: white;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8em;
    }

    .demon-stage-locked {
        opacity: 0.5;
        filter: grayscale(1);
        pointer-events: none;
    }

    .stage-lock-icon {
        font-size: 3em;
        margin: 10px 0;
    }

    /* Battle Screen Styles */
    .battle-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
        z-index: 1000;
        display: none;
        overflow-y: auto;
        padding: 20px;
    }

    .battle-screen.active {
        display: block;
    }

    .battle-header {
        text-align: center;
        margin-bottom: 20px;
    }

    .battle-header h2 {
        color: white;
        font-size: 1.8em;
        margin: 10px 0;
        text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    }

    .battle-exit-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(231, 76, 60, 0.8);
        border: none;
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 1.5em;
        cursor: pointer;
        z-index: 1001;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .battle-exit-btn:active {
        transform: scale(0.9);
    }

    .milestone-progress {
        font-size: 0.85em;
        color: #4ecdc4;
        margin-top: 3px;
    }

    .milestone-reward-detail {
        font-size: 0.85em;
        color: #aaa;
        margin-top: 3px;
    }

    /* Scrollbar styling untuk milestone list */
    .milestone-list::-webkit-scrollbar {
        width: 8px;
    }

    .milestone-list::-webkit-scrollbar-track {
        background: rgba(0,0,0,0.2);
        border-radius: 10px;
    }

    .milestone-list::-webkit-scrollbar-thumb {
        background: rgba(78, 205, 196, 0.5);
        border-radius: 10px;
    }

    .milestone-list::-webkit-scrollbar-thumb:hover {
        background: rgba(78, 205, 196, 0.7);
    }
</style>

<!-- Screen Demon Hunter -->
<div id="demonHunterScreen" class="screen">
    <h1 class="main-title">üëπ Demon Hunter</h1>
    
    <div class="demon-hunter-nav">
        <button class="nav-arrow" id="prevDemon" onclick="changeDemonStage(-1)">‚óÄ</button>
        
        <div class="demon-stage-indicator" id="demonStageDisplay">
            <!-- Konten demon akan dimuat di sini -->
        </div>
        
        <button class="nav-arrow" id="nextDemon" onclick="changeDemonStage(1)">‚ñ∂</button>
    </div>

    <div class="demon-actions">
        <button class="demon-action-btn" id="battleDemonBtn" onclick="startDemonBattle()">‚öîÔ∏è</button>
        <button class="demon-action-btn" onclick="showDemonMilestones()">üì¶</button>
    </div>
</div>

<!-- Battle Screen (Full Screen) -->
<div id="battleScreen" class="battle-screen">
    <button class="battle-exit-btn" onclick="endDemonBattle()">‚úï</button>
    
    <div class="battle-header">
        <h2>‚öîÔ∏è Battle Arena ‚öîÔ∏è</h2>
    </div>

    <div class="demon-battle-container">
        <div class="demon-battle-stats">
            <div class="battle-participant">
                <div style="font-size: 2em;">ü•∑</div>
                <div style="font-weight: bold; margin: 10px 0;">You</div>
                <div class="stat-bar">
                    <span class="stat-label">HP</span>
                    <div class="bar-container">
                        <div class="bar-fill hp-bar" id="playerDemonHP" style="width: 100%"></div>
                    </div>
                    <span class="stat-value" id="playerDemonHPText">100/100</span>
                </div>
                <div class="stat-bar">
                    <span class="stat-label">MP</span>
                    <div class="bar-container">
                        <div class="bar-fill chakra-bar" id="playerDemonMP" style="width: 100%"></div>
                    </div>
                    <span class="stat-value" id="playerDemonMPText">100/100</span>
                </div>
            </div>

            <div class="battle-participant">
                <div style="font-size: 2em;" id="currentDemonSprite">üòà</div>
                <div style="font-weight: bold; margin: 10px 0;" id="currentDemonName">Demon</div>
                <div class="stat-bar">
                    <span class="stat-label">HP</span>
                    <div class="bar-container">
                        <div class="bar-fill hp-bar" id="enemyDemonHP" style="width: 100%"></div>
                    </div>
                    <span class="stat-value" id="enemyDemonHPText">150/150</span>
                </div>
                <div class="stat-bar">
                    <span class="stat-label">MP</span>
                    <div class="bar-container">
                        <div class="bar-fill chakra-bar" id="enemyDemonMP" style="width: 100%"></div>
                    </div>
                    <span class="stat-value" id="enemyDemonMPText">150/150</span>
                </div>
            </div>
        </div>

        <div class="demon-skills-grid" id="playerSkillsGrid">
            <!-- Skills akan dimuat di sini -->
        </div>

        <div class="heal-buttons">
            <button class="heal-btn" id="healHPBtn" onclick="useHealHP()">
                <div style="font-weight: bold;">üíö Heal HP</div>
                <div style="font-size: 0.8em;">+30 HP</div>
                <div class="btn-cost">Free</div>
            </button>
            <button class="heal-btn" id="healMPBtn" onclick="useHealMP()">
                <div style="font-weight: bold;">üíô Heal MP</div>
                <div style="font-size: 0.8em;">+20 MP</div>
                <div class="btn-cost">Free</div>
            </button>
        </div>

        <div class="battle-log" id="demonBattleLog">
            <div class="log-entry">‚öîÔ∏è Battle started!</div>
        </div>
    </div>
</div>

<!-- Modal Milestones -->
<div id="demonMilestonesModal" class="modal">
    <div class="modal-content">
        <h2 id="milestoneTitle">üì¶ Milestones</h2>
        <div id="milestonesList" class="milestone-list">
            <!-- Milestones akan dimuat di sini -->
        </div>
        <button class="menu-button" onclick="closeDemonMilestones()">Close</button>
    </div>
</div>

<!-- JavaScript untuk Demon Hunter -->
<script>
const demonHunterData = {
    currentStage: 0,
    playerHP: 100,
    playerMaxHP: 100,
    playerMP: 100,
    playerMaxMP: 100,
    healHPCooldown: 0,
    healMPCooldown: 0,
    stunTurns: 0,
    enemyStunTurns: 0,
    burningTurns: 0,
    burningDamage: 0,
    enemyBurningTurns: 0,
    enemyBurningDamage: 0,
    blockTurns: 0,
    inBattle: false,
    
    demons: [
        {
            name: "Demon",
            sprite: "üòà",
            hp: 150,
            maxHP: 150,
            mp: 150,
            maxMP: 150,
            unlocked: true,
            battles: 0,
            skills: [
                { name: "Hell Curse", damage: 15, cost: 30 }
            ],
            playerSkills: [
                { name: "Chain of Judgement", damage: 20, cost: 20, unlocked: true },
                { name: "Heavenly Buster", damage: 25, cost: 35, unlocked: true },
                { name: "Empty Slot 1", empty: true, unlocked: false },
                { name: "Empty Slot 2", empty: true, unlocked: false }
            ],
            milestones: [
                { battles: 25, reward: "20 Gold", type: "gold", amount: 20, completed: false },
                { battles: 50, reward: "40 EXP", type: "exp", amount: 40, completed: false },
                { battles: 150, reward: "2 Skill Points", type: "skillPoints", amount: 2, completed: false },
                { battles: 300, reward: "Skill: Rage Embodiment", type: "skill", skill: { name: "Rage Embodiment", damage: 20, cost: 25 }, slotIndex: 2, completed: false },
                { battles: 500, reward: "Skill: Blade Art", type: "skill", skill: { name: "Blade Art", damage: 40, cost: 30 }, slotIndex: 3, completed: false }
            ]
        },
        {
            name: "Oni",
            sprite: "üëπ",
            hp: 200,
            maxHP: 200,
            mp: 200,
            maxMP: 200,
            unlocked: false,
            battles: 0,
            skills: [
                { name: "Hollow Strike", damage: 20, cost: 40 }
            ],
            playerSkills: [
                { name: "Punishment", damage: 25, cost: 32, unlocked: true },
                { name: "Earth Strike", damage: 30, cost: 40, unlocked: true },
                { name: "Empty Slot 1", empty: true, unlocked: false },
                { name: "Empty Slot 2", empty: true, unlocked: false }
            ],
            milestones: [
                { battles: 25, reward: "20 Gold", type: "gold", amount: 20, completed: false },
                { battles: 50, reward: "40 EXP", type: "exp", amount: 40, completed: false },
                { battles: 150, reward: "2 Skill Points", type: "skillPoints", amount: 2, completed: false },
                { battles: 300, reward: "Skill: Killing Intent", type: "skill", skill: { name: "Killing Intent", damage: 30, cost: 35 }, slotIndex: 2, completed: false },
                { battles: 500, reward: "Skill: Shadow Hawk", type: "skill", skill: { name: "Shadow Hawk", damage: 50, cost: 40 }, slotIndex: 3, completed: false }
            ]
        },
        {
            name: "Winged Demon",
            sprite: "ìÜ©üòàìÜ™",
            hp: 250,
            maxHP: 250,
            mp: 250,
            maxMP: 250,
            unlocked: false,
            battles: 0,
            skills: [
                { name: "Rapid Chaotic Wings Strike", damage: 25, cost: 40 }
            ],
            playerSkills: [
                { name: "Gravity", damage: 40, cost: 50, unlocked: true },
                { name: "Black Hole Press", damage: 15, cost: 25, stun: 3, unlocked: true },
                { name: "Empty Slot 1", empty: true, unlocked: false },
                { name: "Empty Slot 2", empty: true, unlocked: false }
            ],
            milestones: [
                { battles: 25, reward: "20 Gold", type: "gold", amount: 20, completed: false },
                { battles: 50, reward: "40 EXP", type: "exp", amount: 40, completed: false },
                { battles: 150, reward: "2 Skill Points", type: "skillPoints", amount: 2, completed: false },
                { battles: 300, reward: "Skill: Air Sky Kick", type: "skill", skill: { name: "Air Sky Kick", damage: 35, cost: 25 }, slotIndex: 2, completed: false },
                { battles: 500, reward: "Skill: Mark Curse", type: "skill", skill: { name: "Mark Curse", burning: 30, cost: 20 }, slotIndex: 3, completed: false }
            ]
        },
        {
            name: "Tengu",
            sprite: "üë∫",
            hp: 300,
            maxHP: 300,
            mp: 300,
            maxMP: 300,
            unlocked: false,
            battles: 0,
            skills: [
                { name: "Hell Blade", damage: 30, cost: 40 }
            ],
            playerSkills: [
                { name: "Super Heal", heal: 50, cost: 20, unlocked: true },
                { name: "Holy Blaster", damage: 30, cost: 25, unlocked: true },
                { name: "Empty Slot 1", empty: true, unlocked: false },
                { name: "Empty Slot 2", empty: true, unlocked: false }
            ],
            milestones: [
                { battles: 25, reward: "20 Gold", type: "gold", amount: 20, completed: false },
                { battles: 50, reward: "40 EXP", type: "exp", amount: 40, completed: false },
                { battles: 150, reward: "2 Skill Points", type: "skillPoints", amount: 2, completed: false },
                { battles: 300, reward: "Skill: Super Sense", type: "skill", skill: { name: "Super Sense", block: 5, cost: 25 }, slotIndex: 2, completed: false },
                { battles: 500, reward: "Skill: Heavenly Hammer Throw", type: "skill", skill: { name: "Heavenly Hammer Throw", damage: 30, cost: 15 }, slotIndex: 3, completed: false }
            ]
        },
        {
            name: "Nazar",
            sprite: "ü™¨",
            hp: 450,
            maxHP: 450,
            mp: 450,
            maxMP: 450,
            unlocked: false,
            battles: 0,
            skills: [
                { name: "Manifest of Cursed Hand", damage: 15, burning: 10, cost: 20 }
            ],
            playerSkills: [
                { name: "Purify Bless", heal: 100, cost: 40, unlocked: true },
                { name: "God Smash", damage: 35, cost: 45, unlocked: true },
                { name: "Empty Slot 1", empty: true, unlocked: false },
                { name: "Empty Slot 2", empty: true, unlocked: false }
            ],
            milestones: [
                { battles: 25, reward: "20 Gold", type: "gold", amount: 20, completed: false },
                { battles: 50, reward: "40 EXP", type: "exp", amount: 40, completed: false },
                { battles: 150, reward: "2 Skill Points", type: "skillPoints", amount: 2, completed: false },
                { battles: 300, reward: "Skill: Asura Wrath", type: "skill", skill: { name: "Asura Wrath", damage: 50, cost: 45 }, slotIndex: 2, completed: false },
                { battles: 500, reward: "Skill: Asura Blade", type: "skill", skill: { name: "Asura Blade", damage: 60, cost: 40 }, slotIndex: 3, completed: false }
            ]
        }
    ]
};

function updateDemonStageDisplay() {
    const demon = demonHunterData.demons[demonHunterData.currentStage];
    const display = document.getElementById('demonStageDisplay');
    
    if (!demon.unlocked) {
        const prevDemon = demonHunterData.demons[demonHunterData.currentStage - 1];
        display.innerHTML = `
            <div class="demon-stage-locked">
                <div class="stage-lock-icon">üîí</div>
                <div class="demon-name">Stage Locked</div>
                <div class="demon-stats">To Unlock this, Complete fight "${prevDemon ? prevDemon.name : 'previous demon'}"  for 25 times</div>
            </div>
        `;
        document.getElementById('battleDemonBtn').disabled = true;
    } else {
        display.innerHTML = `
            <div class="demon-sprite">${demon.sprite}</div>
            <div class="demon-name">${demon.name}</div>
            <div class="demon-stats">
                HP: ${demon.maxHP} | MP: ${demon.maxMP}<br>
                Battles: ${demon.battles}
            </div>
        `;
        document.getElementById('battleDemonBtn').disabled = false;
    }
    
    // Update navigation arrows
    document.getElementById('prevDemon').disabled = demonHunterData.currentStage === 0;
    document.getElementById('nextDemon').disabled = demonHunterData.currentStage === demonHunterData.demons.length - 1;
}

function changeDemonStage(direction) {
    demonHunterData.currentStage += direction;
    if (demonHunterData.currentStage < 0) demonHunterData.currentStage = 0;
    if (demonHunterData.currentStage >= demonHunterData.demons.length) {
        demonHunterData.currentStage = demonHunterData.demons.length - 1;
    }
    updateDemonStageDisplay();
    saveDemonHunterData();
}

function startDemonBattle() {
    const demon = demonHunterData.demons[demonHunterData.currentStage];
    if (!demon.unlocked) return;
    
    demonHunterData.inBattle = true;
    demonHunterData.playerHP = demonHunterData.playerMaxHP;
    demonHunterData.playerMP = demonHunterData.playerMaxMP;
    demonHunterData.healHPCooldown = 0;
    demonHunterData.healMPCooldown = 0;
    demonHunterData.stunTurns = 0;
    demonHunterData.enemyStunTurns = 0;
    demonHunterData.burningTurns = 0;
    demonHunterData.enemyBurningTurns = 0;
    demonHunterData.blockTurns = 0;
    demon.hp = demon.maxHP;
    demon.mp = demon.maxMP;
    
    // Tampilkan battle screen
    document.getElementById('battleScreen').classList.add('active');
    document.getElementById('currentDemonSprite').textContent = demon.sprite;
    document.getElementById('currentDemonName').textContent = demon.name;
    
    updateDemonBattleUI();
    renderPlayerSkills();
    updateHealButtons();
    
    // Clear battle log
    document.getElementById('demonBattleLog').innerHTML = '';
    addDemonLog(`‚öîÔ∏è Battle started against ${demon.name}!`);
}

function renderPlayerSkills() {
    const demon = demonHunterData.demons[demonHunterData.currentStage];
    const grid = document.getElementById('playerSkillsGrid');
    grid.innerHTML = '';
    
    demon.playerSkills.forEach((skill, index) => {
        const btn = document.createElement('button');
        btn.className = 'demon-skill-btn';
        
        if (skill.empty) {
            btn.classList.add('empty');
            btn.innerHTML = `<div>üîí</div><div style="font-size: 0.8em; margin-top: 5px;">${skill.name}</div>`;
            btn.disabled = true;
        } else if (skill.unlocked) {
            let skillInfo = '';
            if (skill.damage) skillInfo = `üí• ${skill.damage}`;
            if (skill.heal) skillInfo = `üíö ${skill.heal}`;
            if (skill.stun) skillInfo += ` üòµ ${skill.stun}t`;
            if (skill.burning) skillInfo += ` üî• ${skill.burning}`;
            if (skill.block) skillInfo += ` üõ°Ô∏è ${skill.block}s`;
            
            btn.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">${skill.name}</div>
                <div style="font-size: 0.85em;">${skillInfo}</div>
                <div class="btn-cost">${skill.cost} MP</div>
            `;
            btn.onclick = () => usePlayerSkill(index);
        }
        
        grid.appendChild(btn);
    });
}

function usePlayerSkill(skillIndex) {
    if (demonHunterData.stunTurns > 0) {
        addDemonLog('üòµ You are stunned!');
        return;
    }
    
    const demon = demonHunterData.demons[demonHunterData.currentStage];
    const skill = demon.playerSkills[skillIndex];
    
    if (demonHunterData.playerMP < skill.cost) {
        addDemonLog('‚ùå Not enough MP!');
        return;
    }
    
    demonHunterData.playerMP -= skill.cost;
    
    // Player action
    if (skill.damage) {
        demon.hp -= skill.damage;
        addDemonLog(`‚öîÔ∏è You used ${skill.name}! Dealt ${skill.damage} damage!`);
    }
    if (skill.heal) {
        demonHunterData.playerHP = Math.min(demonHunterData.playerMaxHP, demonHunterData.playerHP + skill.heal);
        addDemonLog(`üíö You used ${skill.name}! Healed ${skill.heal} HP!`);
    }
    if (skill.stun) {
        demonHunterData.enemyStunTurns = skill.stun;
        addDemonLog(`üòµ ${demon.name} is stunned for ${skill.stun} turns!`);
    }
    if (skill.burning) {
        demonHunterData.enemyBurningTurns = 3;
        demonHunterData.enemyBurningDamage = skill.burning / 3;
        addDemonLog(`üî• ${demon.name} is burning!`);
    }
    if (skill.block) {
        demonHunterData.blockTurns = skill.block;
        addDemonLog(`üõ°Ô∏è You activated shield for ${skill.block} seconds!`);
        setTimeout(() => {
            demonHunterData.blockTurns = 0;
            addDemonLog('üõ°Ô∏è Shield expired!');
        }, skill.block * 1000);
    }
    
    updateDemonBattleUI();
    
    // Check if demon is defeated
    if (demon.hp <= 0) {
        demonVictory();
        return;
    }
    
    // Enemy turn
    setTimeout(() => {
        enemyDemonAttack();
    }, 1000);
}

function useHealHP() {
    if (demonHunterData.healHPCooldown > 0) {
        addDemonLog('‚ùå HP heal is on cooldown!');
        return;
    }
    
    if (demonHunterData.playerHP >= demonHunterData.playerMaxHP) {
        addDemonLog('‚ùå HP is already full!');
        return;
    }
    
    demonHunterData.playerHP = Math.min(demonHunterData.playerMaxHP, demonHunterData.playerHP + 30);
    demonHunterData.healHPCooldown = 5; // 5 second cooldown
    
    addDemonLog('üíö Healed 30 HP!');
    updateDemonBattleUI();
    updateHealButtons();
    
    // Start cooldown
    const interval = setInterval(() => {
        demonHunterData.healHPCooldown--;
        updateHealButtons();
        
        if (demonHunterData.healHPCooldown <= 0) {
            clearInterval(interval);
        }
    }, 1000);
    
    // Enemy turn
    setTimeout(() => {
        enemyDemonAttack();
    }, 1000);
}

function useHealMP() {
    if (demonHunterData.healMPCooldown > 0) {
        addDemonLog('‚ùå MP heal is on cooldown!');
        return;
    }
    
    if (demonHunterData.playerMP >= demonHunterData.playerMaxMP) {
        addDemonLog('‚ùå MP is already full!');
        return;
    }
    
    demonHunterData.playerMP = Math.min(demonHunterData.playerMaxMP, demonHunterData.playerMP + 20);
    demonHunterData.healMPCooldown = 3; // 3 second cooldown
    
    addDemonLog('üíô Healed 20 MP!');
    updateDemonBattleUI();
    updateHealButtons();
    
    // Start cooldown
    const interval = setInterval(() => {
        demonHunterData.healMPCooldown--;
        updateHealButtons();
        
        if (demonHunterData.healMPCooldown <= 0) {
            clearInterval(interval);
        }
    }, 1000);
    
    // Enemy turn
    setTimeout(() => {
        enemyDemonAttack();
    }, 1000);
}

function updateHealButtons() {
    const healHPBtn = document.getElementById('healHPBtn');
    const healMPBtn = document.getElementById('healMPBtn');
    
    // HP Heal Button
    if (demonHunterData.healHPCooldown > 0) {
        healHPBtn.disabled = true;
        healHPBtn.classList.add('cooldown');
        healHPBtn.innerHTML = `
            <div style="font-weight: bold;">üíö Heal HP</div>
            <div style="font-size: 0.8em;">Cooldown: ${demonHunterData.healHPCooldown}s</div>
        `;
    } else {
        healHPBtn.disabled = false;
        healHPBtn.classList.remove('cooldown');
        healHPBtn.innerHTML = `
            <div style="font-weight: bold;">üíö Heal HP</div>
            <div style="font-size: 0.8em;">+30 HP</div>
            <div class="btn-cost">Free</div>
        `;
    }
    
    // MP Heal Button
    if (demonHunterData.healMPCooldown > 0) {
        healMPBtn.disabled = true;
        healMPBtn.classList.add('cooldown');
        healMPBtn.innerHTML = `
            <div style="font-weight: bold;">üíô Heal MP</div>
            <div style="font-size: 0.8em;">Cooldown: ${demonHunterData.healMPCooldown}s</div>
        `;
    } else {
        healMPBtn.disabled = false;
        healMPBtn.classList.remove('cooldown');
        healMPBtn.innerHTML = `
            <div style="font-weight: bold;">üíô Heal MP</div>
            <div style="font-size: 0.8em;">+20 MP</div>
            <div class="btn-cost">Free</div>
        `;
    }
}

function enemyDemonAttack() {
    if (demonHunterData.enemyStunTurns > 0) {
        demonHunterData.enemyStunTurns--;
        addDemonLog(`üòµ ${demonHunterData.demons[demonHunterData.currentStage].name} is stunned!`);
        applyBurningEffects();
        updateDemonBattleUI();
        return;
    }
    
    const demon = demonHunterData.demons[demonHunterData.currentStage];
    const enemySkill = demon.skills[Math.floor(Math.random() * demon.skills.length)];
    
    if (demon.mp >= enemySkill.cost) {
        demon.mp -= enemySkill.cost;
        
        let damage = enemySkill.damage || 0;
        
        if (demonHunterData.blockTurns > 0) {
            addDemonLog(`üõ°Ô∏è ${demon.name} used ${enemySkill.name} but you blocked it!`);
        } else {
            demonHunterData.playerHP -= damage;
            addDemonLog(`üí• ${demon.name} used ${enemySkill.name}! Dealt ${damage} damage!`);
            
            if (enemySkill.burning) {
                demonHunterData.burningTurns = 3;
                demonHunterData.burningDamage = enemySkill.burning / 3;
                addDemonLog(`üî• You are burning!`);
            }
        }
    } else {
        addDemonLog(`${demon.name} has no MP to attack!`);
    }
    
    applyBurningEffects();
    updateDemonBattleUI();
    
    // Check if player is defeated
    if (demonHunterData.playerHP <= 0) {
        demonDefeat();
    }
}

function applyBurningEffects() {
    const demon = demonHunterData.demons[demonHunterData.currentStage];
    
    // Player burning
    if (demonHunterData.burningTurns > 0) {
        demonHunterData.playerHP -= demonHunterData.burningDamage;
        demonHunterData.burningTurns--;
        addDemonLog(`üî• You took ${Math.round(demonHunterData.burningDamage)} burning damage!`);
    }
    
    // Enemy burning
    if (demonHunterData.enemyBurningTurns > 0) {
        demon.hp -= demonHunterData.enemyBurningDamage;
        demonHunterData.enemyBurningTurns--;
        addDemonLog(`üî• ${demon.name} took ${Math.round(demonHunterData.enemyBurningDamage)} burning damage!`);
    }
}

function updateDemonBattleUI() {
    const demon = demonHunterData.demons[demonHunterData.currentStage];
    
    // Player stats
    const playerHPPercent = (demonHunterData.playerHP / demonHunterData.playerMaxHP) * 100;
    const playerMPPercent = (demonHunterData.playerMP / demonHunterData.playerMaxMP) * 100;
    document.getElementById('playerDemonHP').style.width = Math.max(0, playerHPPercent) + '%';
    document.getElementById('playerDemonMP').style.width = Math.max(0, playerMPPercent) + '%';
    document.getElementById('playerDemonHPText').textContent = `${Math.max(0, Math.round(demonHunterData.playerHP))}/${demonHunterData.playerMaxHP}`;
    document.getElementById('playerDemonMPText').textContent = `${Math.max(0, Math.round(demonHunterData.playerMP))}/${demonHunterData.playerMaxMP}`;
    
    // Enemy stats
    const enemyHPPercent = (demon.hp / demon.maxHP) * 100;
    const enemyMPPercent = (demon.mp / demon.maxMP) * 100;
    document.getElementById('enemyDemonHP').style.width = Math.max(0, enemyHPPercent) + '%';
    document.getElementById('enemyDemonMP').style.width = Math.max(0, enemyMPPercent) + '%';
    document.getElementById('enemyDemonHPText').textContent = `${Math.max(0, Math.round(demon.hp))}/${demon.maxHP}`;
    document.getElementById('enemyDemonMPText').textContent = `${Math.max(0, Math.round(demon.mp))}/${demon.maxMP}`;
}

function demonVictory() {
    const demon = demonHunterData.demons[demonHunterData.currentStage];
    const oldBattles = demon.battles;
    demon.battles++;
    
    addDemonLog(`üéâ Victory! Defeated ${demon.name}!`);
    addDemonLog(`üèÜ Total battles: ${demon.battles}`);
    
    // Check milestones first
    checkDemonMilestones();
    
    // Check if this is the 25th battle to unlock next demon
    if (demon.battles === 25 && demonHunterData.currentStage < demonHunterData.demons.length - 1) {
        // Give unlock rewards
        if (typeof gameState !== 'undefined') {
            gameState.player.gold += 20;
            gameState.player.exp += 20;
            gameState.player.skillPoints += 1;
        }
        
        addDemonLog(`üîì Next demon unlocked!`);
        addDemonLog(`üéÅ Unlock Reward: +20 Gold, +20 EXP, +1 Skill Points`);
        
        demonHunterData.demons[demonHunterData.currentStage + 1].unlocked = true;
    }
    
    saveDemonHunterData();
    updateDemonStageDisplay();
    
    setTimeout(() => {
        endDemonBattle();
    }, 3000);
}

function demonDefeat() {
    addDemonLog('üíÄ You have been defeated...');
    setTimeout(() => {
        endDemonBattle();
    }, 2000);
}

function endDemonBattle() {
    demonHunterData.inBattle = false;
    document.getElementById('battleScreen').classList.remove('active');
    document.getElementById('demonBattleLog').innerHTML = '';
    updateDemonStageDisplay();
}

function checkDemonMilestones() {
    const demon = demonHunterData.demons[demonHunterData.currentStage];
    
    demon.milestones.forEach((milestone, index) => {
        if (!milestone.completed && demon.battles >= milestone.battles) {
            milestone.completed = true;
            
            switch(milestone.type) {
                case 'gold':
                    if (typeof gameState !== 'undefined') {
                        gameState.player.gold += milestone.amount;
                    }
                    addDemonLog(`üéÅ Milestone! +${milestone.amount} Gold`);
                    break;
                case 'exp':
                    if (typeof gameState !== 'undefined') {
                        gameState.player.exp += milestone.amount;
                    }
                    addDemonLog(`üéÅ Milestone! +${milestone.amount} EXP`);
                    break;
                case 'skillPoints':
                    if (typeof gameState !== 'undefined') {
                        gameState.player.skillPoints += milestone.amount;
                    }
                    addDemonLog(`üéÅ Milestone! +${milestone.amount} Skill Points`);
                    break;
                case 'skill':
                    demon.playerSkills[milestone.slotIndex] = {
                        ...milestone.skill,
                        unlocked: true
                    };
                    addDemonLog(`üéÅ Milestone! Unlocked ${milestone.skill.name}!`);
                    renderPlayerSkills();
                    break;
            }
        }
    });
}

function showDemonMilestones() {
    const demon = demonHunterData.demons[demonHunterData.currentStage];
    
    document.getElementById('milestoneTitle').textContent = `üì¶ ${demon.name} Milestones`;
    
    const list = document.getElementById('milestonesList');
    list.innerHTML = '';
    
    demon.milestones.forEach((milestone, index) => {
        const item = document.createElement('div');
        item.className = 'milestone-item';
        
        let statusIcon = 'üîí';
        let statusClass = 'locked';
        
        if (milestone.completed) {
            statusIcon = '‚úÖ';
            statusClass = 'completed';
        } else if (demon.battles >= milestone.battles) {
            statusIcon = 'üéÅ';
            statusClass = 'current';
        }
        
        item.classList.add(statusClass);
        
        item.innerHTML = `
            <div>
                <div style="font-weight: bold;">${statusIcon} ${milestone.battles} Battles</div>
                <div class="milestone-reward-detail">${milestone.reward}</div>
                <div class="milestone-progress">${demon.battles}/${milestone.battles} completed</div>
            </div>
            <div style="font-size: 1.2em;">
                ${statusIcon}
            </div>
        `;
        
        list.appendChild(item);
    });
    
    document.getElementById('demonMilestonesModal').classList.add('active');
}

function closeDemonMilestones() {
    document.getElementById('demonMilestonesModal').classList.remove('active');
}

function addDemonLog(message) {
    const log = document.getElementById('demonBattleLog');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.textContent = message;
    log.appendChild(entry);
    log.scrollTop = log.scrollHeight;
}

function saveDemonHunterData() {
    localStorage.setItem('demonHunterData', JSON.stringify(demonHunterData));
}

function loadDemonHunterData() {
    const saved = localStorage.getItem('demonHunterData');
    if (saved) {
        const parsed = JSON.parse(saved);
        // Merge saved data with default structure
        demonHunterData.currentStage = parsed.currentStage || 0;
        parsed.demons.forEach((savedDemon, index) => {
            if (demonHunterData.demons[index]) {
                demonHunterData.demons[index].unlocked = savedDemon.unlocked;
                demonHunterData.demons[index].battles = savedDemon.battles;
                demonHunterData.demons[index].milestones = savedDemon.milestones;
                demonHunterData.demons[index].playerSkills = savedDemon.playerSkills;
            }
        });
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
    loadDemonHunterData();
    updateDemonStageDisplay();
});
</script>

<style>
/* Fisher Lake Styles */
.lake-container {
    position: relative;
    background: linear-gradient(180deg, #1a3a4a 0%, #0d2133 50%, #0a1628 100%);
    border-radius: 20px;
    padding: 20px;
    min-height: 300px;
    overflow: hidden;
    border: 2px solid rgba(78, 205, 196, 0.3);
    margin: 20px 0;
}

.water-surface {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(ellipse at 30% 20%, rgba(78, 205, 196, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 60%, rgba(52, 152, 219, 0.1) 0%, transparent 50%),
        linear-gradient(180deg, rgba(52, 152, 219, 0.2) 0%, rgba(41, 128, 185, 0.3) 100%);
    animation: waterRipple 4s ease-in-out infinite;
}

@keyframes waterRipple {
    0%, 100% { transform: scale(1); opacity: 0.8; }
    50% { transform: scale(1.02); opacity: 1; }
}

.fish-hook-btn {
    position: relative;
    z-index: 10;
    font-size: 4em;
    background: none;
    border: none;
    cursor: pointer;
    animation: bobbing 2s ease-in-out infinite;
    filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.5));
    transition: transform 0.3s;
}

.fish-hook-btn:active {
    transform: scale(1.2);
}

@keyframes bobbing {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.fishing-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin: 20px 0;
}

.fish-stat-card {
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    border-radius: 12px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.fish-stat-icon {
    font-size: 2em;
    margin-bottom: 5px;
}

.fish-stat-value {
    font-size: 1.2em;
    font-weight: bold;
    color: var(--secondary-color);
}

.fishing-actions {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin: 20px 0;
}

.fish-action-btn {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    border: none;
    color: white;
    padding: 15px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.9em;
}

.fish-action-btn:active {
    transform: scale(0.95);
}

.fish-action-btn .action-icon {
    font-size: 1.8em;
    margin-bottom: 5px;
}

/* Event Banners */
.event-banner {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    border: 2px solid rgba(231, 76, 60, 0.5);
    border-radius: 15px;
    padding: 15px;
    margin: 15px 0;
    position: relative;
    overflow: hidden;
    animation: eventGlow 2s infinite;
    cursor: pointer;
}

.event-banner.dewfall {
    background: linear-gradient(135deg, #3498db, #2980b9);
    border-color: rgba(52, 152, 219, 0.5);
}

.event-banner.sunset {
    background: linear-gradient(135deg, #f39c12, #e67e22);
    border-color: rgba(243, 156, 18, 0.5);
}

.event-banner.midnight {
    background: linear-gradient(135deg, #9b59b6, #8e44ad);
    border-color: rgba(155, 89, 182, 0.5);
}

.event-banner.weekend {
    background: linear-gradient(135deg, #1abc9c, #16a085);
    border-color: rgba(26, 188, 156, 0.5);
}

@keyframes eventGlow {
    0%, 100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.3); }
    50% { box-shadow: 0 0 30px rgba(255, 255, 255, 0.6); }
}

.event-banner-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.event-info h3 {
    margin: 0 0 5px 0;
    font-size: 1.2em;
}

.event-info p {
    margin: 0;
    font-size: 0.9em;
    opacity: 0.9;
}

.event-toggle {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
}

.event-details {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    display: none;
}

.event-details.active {
    display: block;
}

/* Reel Mini Game */
.reel-game-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    flex-direction: column;
}

.reel-game-overlay.active {
    display: flex;
}

.reel-bar-container {
    width: 80%;
    max-width: 400px;
    height: 60px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 30px;
    position: relative;
    overflow: hidden;
    border: 3px solid rgba(78, 205, 196, 0.5);
}

.fish-zone {
    position: absolute;
    height: 100%;
    background: linear-gradient(90deg, #e74c3c, #c0392b);
    border-radius: 30px;
    transition: left 0.3s ease-out; // Smooth zone movement
}

.reel-cursor {
    position: absolute;
    width: 20px;
    height: 100%;
    background: linear-gradient(180deg, #2ecc71, #27ae60);
    border-radius: 10px;
    left: 50%;
    transform: translateX(-50%);
    box-shadow: 0 0 20px rgba(46, 204, 113, 0.8);
    transition: none; // PENTING: Hapus transition untuk smooth animation
}

.reel-timer {
    font-size: 4em;
    color: #f39c12;
    margin-bottom: 30px;
    font-weight: bold;
    text-shadow: 0 0 20px rgba(243, 156, 18, 0.5);
}

.reel-instructions {
    color: #bbb;
    margin-top: 20px;
    font-size: 1.1em;
}

.tap-btn {
    background: linear-gradient(135deg, #3498db, #2980b9);
    border: none;
    color: white;
    padding: 30px 80px;
    font-size: 1.8em;
    border-radius: 50px;
    margin-top: 30px;
    cursor: pointer;
    box-shadow: 0 0 30px rgba(52, 152, 219, 0.5);
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

.tap-btn:active {
    transform: scale(0.95);
    background: linear-gradient(135deg, #2980b9, #1f6dad);
}

/* Fish Inventory */
.fish-inventory-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 10px;
    max-height: 400px;
    overflow-y: auto;
    padding: 10px;
}

.fish-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 10px;
    text-align: center;
    border: 2px solid rgba(255, 255, 255, 0.1);
}

.fish-item.common { border-color: #95a5a6; }
.fish-item.rare { border-color: #3498db; }
.fish-item.epic { border-color: #9b59b6; }
.fish-item.legendary { border-color: #e74c3c; }
.fish-item.mythic { border-color: #f39c12; animation: mythicGlow 2s infinite; }
.fish-item.secret { border-color: #1abc9c; animation: secretGlow 1.5s infinite; }

@keyframes mythicGlow {
    0%, 100% { box-shadow: 0 0 10px rgba(243, 156, 18, 0.5); }
    50% { box-shadow: 0 0 25px rgba(243, 156, 18, 0.8); }
}

@keyframes secretGlow {
    0%, 100% { box-shadow: 0 0 15px rgba(26, 188, 156, 0.6); }
    50% { box-shadow: 0 0 30px rgba(26, 188, 156, 1); }
}

.fish-emoji {
    font-size: 2.5em;
    margin-bottom: 5px;
}

.fish-weight {
    font-size: 0.8em;
    color: #bbb;
}

.fish-rarity {
    font-size: 0.7em;
    text-transform: uppercase;
    font-weight: bold;
    margin-top: 5px;
}

/* Rod Shop */
.rod-shop-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    max-height: 400px;
    overflow-y: auto;
}

.rod-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 2px solid rgba(255, 255, 255, 0.1);
}

.rod-info {
    text-align: left;
}

.rod-name {
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 5px;
}

.rod-stats {
    font-size: 0.85em;
    color: #bbb;
}

.buy-rod-btn {
    background: linear-gradient(135deg, #f39c12, #e67e22);
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
}

.buy-rod-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.buy-rod-btn:active {
    transform: scale(0.95);
}

.lake-closed-message {
    text-align: center;
    padding: 40px 20px;
    background: rgba(231, 76, 60, 0.1);
    border-radius: 15px;
    border: 2px solid rgba(231, 76, 60, 0.3);
}

.lake-closed-message h3 {
    color: #e74c3c;
    margin-bottom: 15px;
}

.current-rod-display {
    background: rgba(243, 156, 18, 0.1);
    border: 2px solid rgba(243, 156, 18, 0.3);
    border-radius: 12px;
    padding: 15px;
    margin: 15px 0;
    text-align: center;
}

.equipped-badge {
    background: #f39c12;
    color: #000;
    padding: 3px 8px;
    border-radius: 5px;
    font-size: 0.7em;
    font-weight: bold;
    margin-left: 5px;
}

/* Milestone Styles */
.milestone-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    max-height: 500px;
    overflow-y: auto;
}

.milestone-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 15px;
    border: 2px solid rgba(255, 255, 255, 0.1);
    position: relative;
}

.milestone-item.completed {
    border-color: #2ecc71;
    background: rgba(46, 204, 113, 0.1);
}

.milestone-item.claimable {
    border-color: #f39c12;
    background: rgba(243, 156, 18, 0.1);
    animation: claimableGlow 2s infinite;
}

@keyframes claimableGlow {
    0%, 100% { box-shadow: 0 0 15px rgba(243, 156, 18, 0.5); }
    50% { box-shadow: 0 0 25px rgba(243, 156, 18, 0.8); }
}

.milestone-progress {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    margin: 10px 0;
    overflow: hidden;
}

.milestone-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #3498db, #2980b9);
    transition: width 0.3s;
}

.milestone-reward {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
    padding: 8px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}
/* Milestone Modal Fix */
.modal {
    pointer-events: auto !important;
}

.modal.active {
    pointer-events: auto !important;
}

.modal-content {
    pointer-events: auto !important;
    position: relative;
    z-index: 2001;
}

.claim-milestone-btn {
    pointer-events: auto !important;
    touch-action: manipulation !important;
    -webkit-tap-highlight-color: rgba(243, 156, 18, 0.3);
}

.claim-milestone-btn:active {
    transform: scale(0.95) !important;
    background: linear-gradient(135deg, #e67e22, #d35400) !important;
}
/* Bloodmoon Event Styles - FULL SCREEN RED OVERLAY */

/* Red filter overlay untuk seluruh body */
body.bloodmoon-active::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(139, 0, 0, 0.4);
    pointer-events: none;
    z-index: 9999;
    animation: bloodmoonScreenPulse 2s infinite;
}

@keyframes bloodmoonScreenPulse {
    0%, 100% { 
        background: rgba(139, 0, 0, 0.35);
    }
    50% { 
        background: rgba(180, 0, 0, 0.45);
    }
}

/* Lake container background merah gelap */
.lake-container.bloodmoon-active {
    background: linear-gradient(180deg, #2d0000 0%, #1a0000 50%, #0d0000 100%) !important;
    animation: bloodmoonPulse 2s infinite !important;
}

@keyframes bloodmoonPulse {
    0%, 100% { 
        filter: brightness(0.7) saturate(1.3);
        box-shadow: 0 0 80px rgba(139, 0, 0, 0.8);
    }
    50% { 
        filter: brightness(0.9) saturate(1.5);
        box-shadow: 0 0 120px rgba(200, 0, 0, 1);
    }
}

/* Event banner merah menyala */
.event-banner.bloodmoon {
    background: linear-gradient(135deg, #cc0000, #8b0000, #660000) !important;
    border: 2px solid rgba(255, 0, 0, 0.9) !important;
    animation: bloodmoonGlow 1.5s infinite;
    box-shadow: 0 0 40px rgba(255, 0, 0, 0.8);
}

@keyframes bloodmoonGlow {
    0%, 100% { 
        box-shadow: 0 0 40px rgba(200, 0, 0, 0.8), inset 0 0 30px rgba(255, 0, 0, 0.3);
        border-color: rgba(255, 0, 0, 0.8);
    }
    50% { 
        box-shadow: 0 0 70px rgba(255, 0, 0, 1), inset 0 0 50px rgba(255, 0, 0, 0.5);
        border-color: rgba(255, 100, 100, 1);
    }
}

/* Countdown timer */
.bloodmoon-countdown {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, rgba(200, 0, 0, 0.95), rgba(139, 0, 0, 0.95));
    border: 3px solid #ff0000;
    padding: 15px 25px;
    border-radius: 15px;
    z-index: 10000;
    font-size: 1.2em;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 0 10px rgba(255, 0, 0, 0.8), 0 2px 4px rgba(0, 0, 0, 0.8);
    box-shadow: 0 0 40px rgba(255, 0, 0, 0.9), inset 0 0 20px rgba(255, 0, 0, 0.3);
    animation: bloodmoonCountdownPulse 1s infinite;
}

@keyframes bloodmoonCountdownPulse {
    0%, 100% { 
        transform: scale(1);
        box-shadow: 0 0 40px rgba(255, 0, 0, 0.9), inset 0 0 20px rgba(255, 0, 0, 0.3);
    }
    50% { 
        transform: scale(1.05);
        box-shadow: 0 0 60px rgba(255, 0, 0, 1), inset 0 0 30px rgba(255, 0, 0, 0.5);
    }
}

/* Semua text jadi merah saat bloodmoon */
.bloodmoon-active * {
    color: rgba(255, 100, 100, 0.9) !important;
}

/* Kecuali text putih yang penting tetap terlihat */
.bloodmoon-active .btn,
.bloodmoon-active button,
.bloodmoon-active h1,
.bloodmoon-active h2,
.bloodmoon-active h3 {
    color: #fff !important;
    text-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
}
/* Spooky Night Event Styles */
.event-banner.spooky {
    background: linear-gradient(135deg, #2d1f3d, #1a1225, #0d0a12) !important;
    border: 2px solid rgba(138, 43, 226, 0.8) !important;
    animation: spookyGlow 2s infinite;
}

@keyframes spookyGlow {
    0%, 100% { 
        box-shadow: 0 0 30px rgba(138, 43, 226, 0.6), inset 0 0 20px rgba(75, 0, 130, 0.3);
    }
    50% { 
        box-shadow: 0 0 50px rgba(138, 43, 226, 0.9), inset 0 0 30px rgba(75, 0, 130, 0.5);
    }
}

body.spooky-active::before {
    content: '';
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(45, 31, 61, 0.3);
    pointer-events: none;
    z-index: 9999;
    animation: spookyScreenPulse 3s infinite;
}

@keyframes spookyScreenPulse {
    0%, 100% { background: rgba(45, 31, 61, 0.25); }
    50% { background: rgba(75, 0, 130, 0.35); }
}

.lake-container.spooky-active {
    background: linear-gradient(180deg, #2d1f3d 0%, #1a1225 50%, #0d0a12 100%) !important;
    animation: spookyLakePulse 3s infinite !important;
}

@keyframes spookyLakePulse {
    0%, 100% { filter: brightness(0.8) hue-rotate(-10deg); }
    50% { filter: brightness(0.9) hue-rotate(10deg); }
}

.spooky-countdown {
    position: fixed;
    top: 20px; right: 20px;
    background: linear-gradient(135deg, rgba(138, 43, 226, 0.95), rgba(75, 0, 130, 0.95));
    border: 3px solid #8a2be2;
    padding: 15px 25px;
    border-radius: 15px;
    z-index: 10000;
    font-size: 1.2em;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 0 10px rgba(138, 43, 226, 0.8);
    box-shadow: 0 0 40px rgba(138, 43, 226, 0.9);
    animation: spookyCountdownPulse 1.5s infinite;
}

@keyframes spookyCountdownPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.03); }
}

/* Starfall Event Styles */
.event-banner.starfall {
    background: linear-gradient(135deg, #0a1628, #1a3a5c, #2d5a87) !important;
    border: 2px solid rgba(255, 215, 0, 0.8) !important;
    animation: starfallGlow 2s infinite;
}

@keyframes starfallGlow {
    0%, 100% { 
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.5), 0 0 60px rgba(255, 255, 255, 0.2);
    }
    50% { 
        box-shadow: 0 0 50px rgba(255, 215, 0, 0.8), 0 0 80px rgba(255, 255, 255, 0.4);
    }
}

body.starfall-active::before {
    content: '';
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(180deg, rgba(10, 22, 40, 0.3), rgba(45, 90, 135, 0.2));
    pointer-events: none;
    z-index: 9998;
}

body.starfall-active::after {
    content: '‚ú®‚≠êüí´';
    position: fixed;
    top: 10%; left: 50%;
    font-size: 3em;
    animation: starsFalling 4s infinite;
    pointer-events: none;
    z-index: 9999;
}

@keyframes starsFalling {
    0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
}

.lake-container.starfall-active {
    background: linear-gradient(180deg, #0a1628 0%, #1a3a5c 50%, #2d5a87 100%) !important;
}

.starfall-countdown {
    position: fixed;
    top: 20px; right: 20px;
    background: linear-gradient(135deg, rgba(10, 22, 40, 0.95), rgba(45, 90, 135, 0.95));
    border: 3px solid #ffd700;
    padding: 15px 25px;
    border-radius: 15px;
    z-index: 10000;
    font-size: 1.2em;
    font-weight: bold;
    color: #ffd700;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
    box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
    animation: starfallCountdownPulse 1.5s infinite;
}

@keyframes starfallCountdownPulse {
    0%, 100% { transform: scale(1); box-shadow: 0 0 40px rgba(255, 215, 0, 0.6); }
    50% { transform: scale(1.03); box-shadow: 0 0 60px rgba(255, 215, 0, 0.9); }
}

/* Consumable Styles */
.consumable-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 15px;
    padding: 10px;
}

.consumable-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    border: 2px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s;
}

.consumable-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

.consumable-item.luck { border-color: #2ecc71; }
.consumable-item.gold { border-color: #f39c12; }
.consumable-item.weight { border-color: #3498db; }

.consumable-emoji { font-size: 2.5em; margin-bottom: 8px; }
.consumable-name { font-weight: bold; margin-bottom: 5px; }
.consumable-desc { font-size: 0.8em; color: #bbb; margin-bottom: 10px; }
.consumable-price { color: #f39c12; font-weight: bold; margin-bottom: 10px; }
.consumable-owned { font-size: 0.85em; color: #2ecc71; margin-bottom: 8px; }

.buy-consumable-btn, .use-consumable-btn {
    padding: 8px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
    margin: 3px;
}

.buy-consumable-btn {
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white;
}

.use-consumable-btn {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
}

.buy-consumable-btn:disabled, .use-consumable-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.active-effects {
    background: rgba(46, 204, 113, 0.1);
    border: 2px solid rgba(46, 204, 113, 0.3);
    border-radius: 12px;
    padding: 15px;
    margin: 15px 0;
}

.effect-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    margin: 5px 0;
}

.effect-timer {
    color: #e74c3c;
    font-weight: bold;
}
/* Logs Styles */
.logs-container {
    max-height: 500px;
    overflow-y: auto;
    padding: 10px;
}

.log-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px;
    margin-bottom: 8px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    border-left: 4px solid #3498db;
    transition: all 0.2s;
}

.log-item:hover {
    background: rgba(255, 255, 255, 0.08);
}

.log-item.catch { border-left-color: #2ecc71; }
.log-item.sell { border-left-color: #f39c12; }
.log-item.buy-rod { border-left-color: #9b59b6; }
.log-item.buy-consumable { border-left-color: #e74c3c; }
.log-item.use-consumable { border-left-color: #1abc9c; }
.log-item.milestone { border-left-color: #f1c40f; }

.log-icon {
    font-size: 1.8em;
    min-width: 40px;
    text-align: center;
}

.log-content {
    flex: 1;
}

.log-title {
    font-weight: bold;
    margin-bottom: 4px;
    color: #fff;
}

.log-detail {
    font-size: 0.85em;
    color: #bbb;
}

.log-time {
    font-size: 0.75em;
    color: #888;
    margin-top: 5px;
}

.logs-filter {
    display: flex;
    gap: 8px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 8px 15px;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-size: 0.85em;
    background: rgba(255, 255, 255, 0.1);
    color: #bbb;
    transition: all 0.2s;
}

.filter-btn.active {
    background: var(--secondary-color);
    color: #000;
    font-weight: bold;
}

.filter-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.logs-empty {
    text-align: center;
    padding: 40px;
    color: #888;
}

.clear-logs-btn {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 15px;
}

.logs-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-bottom: 20px;
}

.log-stat-card {
    background: rgba(255, 255, 255, 0.05);
    padding: 12px;
    border-radius: 10px;
    text-align: center;
}

.log-stat-value {
    font-size: 1.3em;
    font-weight: bold;
    color: var(--secondary-color);
}

.log-stat-label {
    font-size: 0.8em;
    color: #888;
}
.free-rod-card {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(39, 174, 96, 0.2));
    border: 2px solid #2ecc71;
    border-radius: 15px;
    padding: 20px;
    margin: 15px 0;
    position: relative;
    overflow: hidden;
}

.free-rod-card.locked {
    border-color: #95a5a6;
    background: linear-gradient(135deg, rgba(149, 165, 166, 0.1), rgba(127, 140, 141, 0.2));
}

.free-rod-card.claimed {
    border-color: #3498db;
    background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.2));
}

.free-rod-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 15px;
}

.free-rod-title { font-size: 1.3em; font-weight: bold; }

.free-rod-badge {
    padding: 5px 12px; border-radius: 20px;
    font-size: 0.8em; font-weight: bold;
}

.free-rod-badge.available { background: #2ecc71; color: #000; }
.free-rod-badge.locked { background: #95a5a6; color: #fff; }
.free-rod-badge.claimed { background: #3498db; color: #fff; }

.free-rod-stats {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 10px; margin: 15px 0;
}

.free-rod-stat {
    background: rgba(255,255,255,0.05);
    padding: 10px; border-radius: 8px; text-align: center;
}

.free-rod-requirements {
    background: rgba(0,0,0,0.2);
    padding: 12px; border-radius: 8px; margin: 15px 0;
}

.req-item {
    display: flex; justify-content: space-between;
    padding: 5px 0; font-size: 0.9em;
}

.req-item.met { color: #2ecc71; }
.req-item.not-met { color: #e74c3c; }

.claim-free-rod-btn {
    width: 100%; padding: 15px;
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    border: none; color: white;
    font-size: 1.1em; font-weight: bold;
    border-radius: 10px; cursor: pointer;
    transition: all 0.3s;
}

.claim-free-rod-btn:disabled {
    background: #95a5a6; cursor: not-allowed;
}

.claim-free-rod-btn:not(:disabled):active {
    transform: scale(0.98);
}

/* Elite Merchant Styles */
.elite-rod-grid {
    display: grid; gap: 15px;
    max-height: 450px; overflow-y: auto;
}

.elite-rod-item {
    background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.2));
    border: 2px solid #9b59b6;
    border-radius: 15px; padding: 20px;
    position: relative; overflow: hidden;
}

.elite-rod-item.omega { border-color: #e74c3c; background: linear-gradient(135deg, rgba(231, 76, 60, 0.15), rgba(192, 57, 43, 0.25)); }
.elite-rod-item.cosmic { border-color: #3498db; background: linear-gradient(135deg, rgba(52, 152, 219, 0.15), rgba(41, 128, 185, 0.25)); }
.elite-rod-item.divine { border-color: #f1c40f; background: linear-gradient(135deg, rgba(241, 196, 15, 0.15), rgba(243, 156, 18, 0.25)); animation: divineGlow 2s infinite; }

@keyframes divineGlow {
    0%, 100% { box-shadow: 0 0 20px rgba(241, 196, 15, 0.4); }
    50% { box-shadow: 0 0 40px rgba(241, 196, 15, 0.7); }
}

.elite-rod-icon { font-size: 3em; text-align: center; margin-bottom: 10px; }
.elite-rod-name { font-size: 1.2em; font-weight: bold; text-align: center; margin-bottom: 10px; }

.elite-rod-stats {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 8px; margin: 15px 0;
}

.elite-stat {
    background: rgba(255,255,255,0.08);
    padding: 8px; border-radius: 6px; text-align: center;
    font-size: 0.9em;
}

.elite-stat-value { font-weight: bold; color: var(--secondary-color); }

.elite-price {
    text-align: center; font-size: 1.3em;
    color: #f39c12; font-weight: bold; margin: 10px 0;
}

.buy-elite-btn {
    width: 100%; padding: 12px;
    background: linear-gradient(135deg, #9b59b6, #8e44ad);
    border: none; color: white;
    font-weight: bold; border-radius: 8px;
    cursor: pointer; transition: all 0.2s;
}

.buy-elite-btn.omega { background: linear-gradient(135deg, #e74c3c, #c0392b); }
.buy-elite-btn.cosmic { background: linear-gradient(135deg, #3498db, #2980b9); }
.buy-elite-btn.divine { background: linear-gradient(135deg, #f1c40f, #f39c12); color: #000; }

.buy-elite-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.buy-elite-btn:not(:disabled):active { transform: scale(0.97); }
</style>

<!-- Fisher Lake Screen -->
<div id="fisherLakeScreen" class="screen">
    <h1 class="main-title">üé£ Fisherman Lake</h1>
    
    <div id="lakeAccessCheck">
        <!-- Content akan di-generate oleh JavaScript -->
    </div>
</div>

<!-- Reel Mini Game Overlay -->
<div id="reelGameOverlay" class="reel-game-overlay">
    <div class="reel-timer" id="reelTimer">6</div>  <!-- GANTI 10 JADI 6 -->
    <div class="reel-bar-container">
        <div class="fish-zone" id="fishZone"></div>
        <div class="reel-cursor" id="reelCursor"></div>
    </div>
    <div class="reel-instructions">TAP untuk menggerakkan reel ke zona ikan! üêü</div>
    <button class="tap-btn" id="tapReelBtn">TAP</button>
</div>

<div id="logsModal" class="modal">
    <div class="modal-content">
        <h2>üìú Activity Logs</h2>
        <div id="logsContent"></div>
        <button class="menu-button" onclick="closeLogs()">Close</button>
    </div>
</div>

<!-- ========== MODAL HTML ========== -->
<div id="freeRodsModal" class="modal">
    <div class="modal-content">
        <h2>üéÅ FREE RODS</h2>
        <div id="freeRodsContent"></div>
        <button class="menu-button" onclick="closeFreeRods()">Close</button>
    </div>
</div>

<div id="eliteMerchantModal" class="modal">
    <div class="modal-content">
        <h2>üëë ROD MERCHANT</h2>
        <p style="color:#bbb;text-align:center;margin-bottom:15px;">Ultra Powerful Rods for True Masters</p>
        <div id="eliteMerchantContent"></div>
        <button class="menu-button" onclick="closeEliteMerchant()">Close</button>
    </div>
</div>

<!-- Fish Inventory Modal -->
<div id="fishInventoryModal" class="modal">
    <div class="modal-content">
        <h2>üêü Fish Inventory</h2>
        <div id="fishInventoryContent"></div>
        <button class="menu-button" onclick="closeFishInventory()">Close</button>
    </div>
</div>

<div id="consumableModal" class="modal">
    <div class="modal-content">
        <h2>üß™ Consumables</h2>
        <div id="consumableContent"></div>
        <button class="menu-button" onclick="closeConsumable()">Close</button>
    </div>
</div>

<!-- Sell Fish Modal -->
<div id="sellFishModal" class="modal">
    <div class="modal-content">
        <h2>üí∞ Sell Fish</h2>
        <div id="sellFishContent"></div>
        <button class="menu-button" onclick="closeSellFish()">Close</button>
    </div>
</div>

<!-- Gear Modal -->
<div id="fishGearModal" class="modal">
    <div class="modal-content">
        <h2>üé£ Fishing Gear</h2>
        <div id="fishGearContent"></div>
        <button class="menu-button" onclick="closeFishGear()">Close</button>
    </div>
</div>

<!-- Fisherman Merchant Modal -->
<div id="fishermanMerchantModal" class="modal">
    <div class="modal-content">
        <h2>üè™ Fisherman Rod</h2>
        <div id="merchantContent"></div>
        <button class="menu-button" onclick="closeMerchant()">Close</button>
    </div>
</div>

<!-- Milestone Modal -->
<div id="milestoneModal" class="modal">
    <div class="modal-content">
        <h2>üèÜ Fishing Milestones</h2>
        <div id="milestoneContent"></div>
        <button class="menu-button" onclick="closeMilestone()">Close</button>
    </div>
</div>

<script>

// ===== FREE RODS DATA =====
const FreeRodsData = {
    advanced_basic_rod: {
        id: 'advanced_basic_rod',
        name: 'Advanced Basic Fishing Rod',
        icon: 'üé£‚ú®',
        luck: 30, 
        weight: 170,
        requirements: {
            rod: 'basic_rod',
            gold: 5000
        },
        replaces: 'basic_rod'
    }
};

// ===== ELITE RODS DATA =====
const EliteRodsData = {
    titan_rod: {
        id: 'titan_rod', name: 'Titan Rod', icon: 'üóø',
        luck: 320, weight: 3200, price: 500000, tier: 'omega'
    },
    nebula_rod: {
        id: 'nebula_rod', name: 'Nebula Rod', icon: 'üåÄ',
        luck: 380, weight: 3800, price: 850000, tier: 'cosmic'
    },
    apotheosis_rod: {
        id: 'apotheosis_rod', name: 'Apotheosis Rod', icon: 'üåü',
        luck: 450, weight: 4500, price: 1500000, tier: 'divine'
    }
};

// ===== FREE RODS FUNCTIONS =====
function openFreeRods() {
    const modal = document.getElementById('freeRodsModal');
    const content = document.getElementById('freeRodsContent');
    
    let html = '';
    
    Object.values(FreeRodsData).forEach(rod => {
        const hasRod = FishingData.ownedRods.includes(rod.requirements.rod);
        const hasGold = gameState.player.gold >= rod.requirements.gold;
        const alreadyClaimed = FishingData.ownedRods.includes(rod.id);
        const canClaim = hasRod && hasGold && !alreadyClaimed;
        
        let status = 'locked';
        let badgeText = 'üîí LOCKED';
        if (alreadyClaimed) { status = 'claimed'; badgeText = '‚úÖ CLAIMED'; }
        else if (canClaim) { status = 'available'; badgeText = 'üéÅ AVAILABLE'; }
        
        const reqRod = FishingData.rods[rod.requirements.rod];
        
        html += `
            <div class="free-rod-card ${status}">
                <div class="free-rod-header">
                    <div class="free-rod-title">${rod.icon} ${rod.name}</div>
                    <span class="free-rod-badge ${status}">${badgeText}</span>
                </div>
                
                <div class="free-rod-stats">
                    <div class="free-rod-stat">
                        <div style="color:#2ecc71;font-size:1.5em;">üçÄ ${rod.luck}%</div>
                        <div style="font-size:0.8em;color:#bbb;">Luck</div>
                    </div>
                    <div class="free-rod-stat">
                        <div style="color:#3498db;font-size:1.5em;">‚öñÔ∏è ${rod.weight}kg</div>
                        <div style="font-size:0.8em;color:#bbb;">Weight</div>
                    </div>
                </div>
                
                <div class="free-rod-requirements">
                    <div style="font-weight:bold;margin-bottom:8px;">üìã Requirements:</div>
                    <div class="req-item ${hasRod ? 'met' : 'not-met'}">
                        <span>${reqRod.icon} ${reqRod.name}</span>
                        <span>${hasRod ? '‚úÖ' : '‚ùå'}</span>
                    </div>
                    <div class="req-item ${hasGold ? 'met' : 'not-met'}">
                        <span>üí∞ ${rod.requirements.gold.toLocaleString()} Gold</span>
                        <span>${hasGold ? '‚úÖ' : '‚ùå'} (${gameState.player.gold.toLocaleString()})</span>
                    </div>
                </div>
                
                <div style="background:rgba(231,76,60,0.1);padding:10px;border-radius:8px;margin-bottom:15px;font-size:0.85em;color:#e74c3c;">
                    ‚ö†Ô∏è ${reqRod.name} & ${rod.requirements.gold.toLocaleString()} Gold akan digunakan saat claim
                </div>
                
                <button class="claim-free-rod-btn" onclick="claimFreeRod('${rod.id}')" ${!canClaim ? 'disabled' : ''}>
                    ${alreadyClaimed ? '‚úÖ Already Claimed' : canClaim ? 'üéÅ CLAIM FREE ROD' : 'üîí Requirements Not Met'}
                </button>
            </div>
        `;
    });
    
    content.innerHTML = html;
    modal.classList.add('active');
}

function claimFreeRod(rodId) {
    const rod = FreeRodsData[rodId];
    if (!rod) return;
    
    const hasRod = FishingData.ownedRods.includes(rod.requirements.rod);
    const hasGold = gameState.player.gold >= rod.requirements.gold;
    const alreadyClaimed = FishingData.ownedRods.includes(rod.id);
    
    if (alreadyClaimed) { alert('‚ùå Already claimed!'); return; }
    if (!hasRod) { alert('‚ùå You need ' + FishingData.rods[rod.requirements.rod].name + '!'); return; }
    if (!hasGold) { alert('‚ùå Need ' + rod.requirements.gold + ' Gold!'); return; }
    
    if (!confirm(`üéÅ Claim ${rod.name}?\n\n‚ö†Ô∏è This will consume:\n‚Ä¢ ${FishingData.rods[rod.requirements.rod].name}\n‚Ä¢ ${rod.requirements.gold.toLocaleString()} Gold\n\nProceed?`)) return;
    
    // Consume requirements
    gameState.player.gold -= rod.requirements.gold;
    FishingData.ownedRods = FishingData.ownedRods.filter(r => r !== rod.requirements.rod);
    
    // Add new rod
    FishingData.ownedRods.push(rod.id);
    
    // Auto-equip if was using basic
    if (FishingData.currentRod === rod.requirements.rod) {
        FishingData.currentRod = rod.id;
    }
    
    saveFishingData();
    if (typeof saveGameState === 'function') saveGameState();
    
    alert(`üéâ SUCCESS!\n\n${rod.icon} ${rod.name} claimed!\n\nüçÄ Luck: ${rod.luck}%\n‚öñÔ∏è Weight: ${rod.weight}kg`);
    
    addLog('buy-rod', `Claimed ${rod.name}`, `${rod.icon} FREE | Luck: ${rod.luck}% | Weight: ${rod.weight}kg`, rod.icon);
    
    openFreeRods();
    initFisherLake();
}

function closeFreeRods() {
    document.getElementById('freeRodsModal').classList.remove('active');
}

// ===== ELITE MERCHANT FUNCTIONS =====
function openEliteMerchant() {
    const modal = document.getElementById('eliteMerchantModal');
    const content = document.getElementById('eliteMerchantContent');
    
    let html = '<div class="elite-rod-grid">';
    
    Object.values(EliteRodsData).forEach(rod => {
        const owned = FishingData.ownedRods.includes(rod.id);
        const canAfford = gameState.player.gold >= rod.price;
        
        html += `
            <div class="elite-rod-item ${rod.tier}">
                <div class="elite-rod-icon">${rod.icon}</div>
                <div class="elite-rod-name">${rod.name}</div>
                
                <div class="elite-rod-stats">
                    <div class="elite-stat">
                        <div>üçÄ Luck</div>
                        <div class="elite-stat-value">${rod.luck}%</div>
                    </div>
                    <div class="elite-stat">
                        <div>‚öñÔ∏è Weight</div>
                        <div class="elite-stat-value">${rod.weight}kg</div>
                    </div>
                </div>
                
                <div class="elite-price">üí∞ ${rod.price.toLocaleString()} Gold</div>
                
                <button class="buy-elite-btn ${rod.tier}" onclick="buyEliteRod('${rod.id}')" ${owned || !canAfford ? 'disabled' : ''}>
                    ${owned ? '‚úÖ OWNED' : canAfford ? 'üëë PURCHASE' : '‚ùå NOT ENOUGH'}
                </button>
            </div>
        `;
    });
    
    html += '</div>';
    html += `<div style="text-align:center;margin-top:15px;color:#888;font-size:0.85em;">üí∞ Your Gold: ${gameState.player.gold.toLocaleString()}</div>`;
    
    content.innerHTML = html;
    modal.classList.add('active');
}

function buyEliteRod(rodId) {
    const rod = EliteRodsData[rodId];
    if (!rod) return;
    
    if (FishingData.ownedRods.includes(rod.id)) { alert('‚ùå Already owned!'); return; }
    if (gameState.player.gold < rod.price) { alert('‚ùå Not enough Gold!'); return; }
    
    if (!confirm(`üëë Buy ${rod.name}?\n\nüí∞ Price: ${rod.price.toLocaleString()} Gold\nüçÄ Luck: ${rod.luck}%\n‚öñÔ∏è Weight: ${rod.weight}kg`)) return;
    
    gameState.player.gold -= rod.price;
    FishingData.ownedRods.push(rod.id);
    
    saveFishingData();
    if (typeof saveGameState === 'function') saveGameState();
    
    alert(`üëë PURCHASED!\n\n${rod.icon} ${rod.name}\n\nCheck your gear to equip!`);
    
    addLog('buy-rod', `Bought ${rod.name}`, `${rod.icon} üí∞ -${rod.price.toLocaleString()} Gold | Luck: ${rod.luck}%`, rod.icon);
    
    openEliteMerchant();
}

function closeEliteMerchant() {
    document.getElementById('eliteMerchantModal').classList.remove('active');
}

console.log('üéÅ Free Rods & Elite Merchant Loaded!');
</script>

<script>
// ========== FISHER LAKE SYSTEM (COMPLETE & UPDATED) ==========

// Fishing Data
const FishingData = {
    currentRod: 'basic_rod',
    caughtFish: [],
    ownedRods: ['basic_rod'],
    milestones: {},
    stats: {                    
        totalGoldEarned: 0,
        totalWeight: 0
    },
    
    rods: {
        basic_rod: { name: 'Basic Fishing Rod', luck: 5, weight: 10, price: 0, icon: 'üé£' },
        wooden_rod: { name: 'Wooden Rod', luck: 8, weight: 15, price: 150, icon: 'ü™µ' },
        bamboo_rod: { name: 'Bamboo Rod', luck: 12, weight: 25, price: 350, icon: 'üéã' },
        copper_rod: { name: 'Copper Rod', luck: 15, weight: 30, price: 500, icon: 'üî∂' },
        steel_rod: { name: 'Steel Rod', luck: 18, weight: 40, price: 700, icon: '‚öôÔ∏è' },
        silver_rod: { name: 'Silver Rod', luck: 22, weight: 50, price: 1000, icon: '‚ö™' },
        carbon_rod: { name: 'Carbon Fiber Rod', luck: 25, weight: 60, price: 1200, icon: 'üîß' },
        platinum_rod: { name: 'Platinum Rod', luck: 30, weight: 80, price: 1800, icon: 'üíé' },
        titanium_rod: { name: 'Titanium Rod', luck: 35, weight: 100, price: 2500, icon: 'üî©' },
        crystal_rod: { name: 'Crystal Rod', luck: 40, weight: 120, price: 3500, icon: 'üí†' },
        enchanted_rod: { name: 'Enchanted Rod', luck: 45, weight: 150, price: 5000, icon: '‚ú®' },
        mystic_rod: { name: 'Mystic Rod', luck: 50, weight: 180, price: 7500, icon: 'üîÆ' },
        golden_rod: { name: 'Golden Rod', luck: 55, weight: 250, price: 10000, icon: 'üåü' },
        rainbow_rod: { name: 'Rainbow Rod', luck: 60, weight: 300, price: 15000, icon: 'üåà' },
        diamond_rod: { name: 'Diamond Rod', luck: 65, weight: 350, price: 20000, icon: 'üíç' },
        mythical_rod: { name: 'Mythical Rod', luck: 70, weight: 380, price: 25000, icon: 'ü¶Ñ' },
        celestial_rod: { name: 'Celestial Rod', luck: 75, weight: 400, price: 35000, icon: '‚≠ê' },
        legendary_rod: { name: 'Legendary Rod', luck: 85, weight: 420, price: 50000, icon: 'üëë' },
        ultimate_rod: { name: 'Ultimate Rod', luck: 75, weight: 450, price: 75000, icon: 'üèÜ' },
        god_rod: { name: 'God Rod', luck: 90, weight: 480, price: 100000, icon: '‚ö°' },
        
         // Milestone Reward Rods
    aurora_rod: { name: 'Aurora Rod', luck: 100, weight: 200, price: 0, icon: 'üåå' },
    void_rod: { name: 'Void Rod', luck: 120, weight: 400, price: 0, icon: 'üï≥Ô∏è' },
    stellar_rod: { name: 'Stellar Rod', luck: 130, weight: 500, price: 0, icon: 'üå†' },
    
    // NEW MILESTONE RODS
    phoenix_rod: { name: 'Phoenix Rod', luck: 150, weight: 750, price: 0, icon: 'üî•' },
    dragon_rod: { name: 'Dragon Rod', luck: 160, weight: 800, price: 0, icon: 'üêâ' },
    cosmic_rod: { name: 'Cosmic Rod', luck: 170, weight: 850, price: 0, icon: 'üåÄ' },
    eternal_rod: { name: 'Eternal Rod', luck: 180, weight: 950, price: 0, icon: '‚ôæÔ∏è' },
    divine_rod: { name: 'Divine Rod', luck: 200, weight: 1100, price: 0, icon: 'üëº' },
    omega_rod: { name: 'Omega Rod', luck: 230, weight: 1200, price: 0, icon: 'Œ©' },
    infinity_rod: { name: 'Infinity Rod', luck: 250, weight: 1500, price: 0, icon: '‚àû' },
    supreme_rod: { name: 'Supreme Rod', luck: 300, weight: 3000, price: 0, icon: 'üëë' },
    advanced_basic_rod: { name: 'Advanced Basic Fishing Rod', luck: 30, weight: 170, price: 0, icon: 'üé£‚ú®' },
    titan_rod: { name: 'Titan Rod', luck: 320, weight: 3200, price: 0, icon: 'üóø' },
    nebula_rod: { name: 'Nebula Rod', luck: 380, weight: 3800, price: 0, icon: 'üåÄ' },
    apotheosis_rod: { name: 'Apotheosis Rod', luck: 450, weight: 4500, price: 0, icon: 'üåü' }
},
    
    fishTypes: [
        // Regular fish
        { emoji: 'üêü', name: 'Common Fish', rarity: 'common', minWeight: 1, maxWeight: 5 },
        { emoji: 'ìÜü', name: 'River Fish', rarity: 'common', minWeight: 2, maxWeight: 8 },
        { emoji: 'üê†', name: 'Tropical Fish', rarity: 'common', minWeight: 1, maxWeight: 6 },
        { emoji: 'ü¶ê', name: 'Shrimp', rarity: 'common', minWeight: 0.5, maxWeight: 2 },
        { emoji: 'ü¶Ä', name: 'Crab', rarity: 'rare', minWeight: 3, maxWeight: 15 },
        { emoji: 'ü¶û', name: 'Lobster', rarity: 'rare', minWeight: 5, maxWeight: 20 },
        { emoji: 'üêö', name: 'Giant Shell', rarity: 'rare', minWeight: 8, maxWeight: 25 },
        { emoji: 'ü™º', name: 'Jellyfish', rarity: 'rare', minWeight: 2, maxWeight: 12 },
        { emoji: 'üê°', name: 'Pufferfish', rarity: 'epic', minWeight: 10, maxWeight: 40 },
        { emoji: 'üêô', name: 'Octopus', rarity: 'epic', minWeight: 15, maxWeight: 60 },
        { emoji: 'ü¶ë', name: 'Giant Squid', rarity: 'epic', minWeight: 25, maxWeight: 100 },
        { emoji: 'ìáº', name: 'Starfish King', rarity: 'epic', minWeight: 5, maxWeight: 30 },
        { emoji: 'ü¶à', name: 'Shark', rarity: 'legendary', minWeight: 50, maxWeight: 200 },
        { emoji: 'ìÜâ', name: 'Sea Turtle', rarity: 'legendary', minWeight: 40, maxWeight: 150 },
        { emoji: 'üê¨', name: 'Dolphin', rarity: 'legendary', minWeight: 60, maxWeight: 250 },
        { emoji: 'ü™∏', name: 'Living Coral', rarity: 'legendary', minWeight: 30, maxWeight: 120 },
        { emoji: 'üêã', name: 'Whale', rarity: 'mythic', minWeight: 200, maxWeight: 450 },
        { emoji: 'ìÉó', name: 'Ancient Fish', rarity: 'mythic', minWeight: 100, maxWeight: 350 },
        { emoji: 'íÖå', name: 'Abyssal Creature', rarity: 'mythic', minWeight: 150, maxWeight: 400 },
        { emoji: 'ü¶ï', name: 'Sea Dinosaur', rarity: 'secret', minWeight: 300, maxWeight: 500 },
        { emoji: 'üç•', name: 'Naruto Fish', rarity: 'secret', minWeight: 250, maxWeight: 500 },
        
        // Dewfall Event Fish
        { emoji: 'üíß', name: 'Dewfall Common Fish', rarity: 'common', minWeight: 1, maxWeight: 5, event: 'dewfall' },
        { emoji: 'üåä', name: 'Dewfall River Fish', rarity: 'common', minWeight: 2, maxWeight: 8, event: 'dewfall' },
        { emoji: 'üíé', name: 'Dewfall Crystal Fish', rarity: 'rare', minWeight: 8, maxWeight: 25, event: 'dewfall' },
        { emoji: '‚ùÑÔ∏è', name: 'Dewfall Ice Fish', rarity: 'epic', minWeight: 15, maxWeight: 60, event: 'dewfall' },
        { emoji: 'üîÆ', name: 'Dewfall Mystic Fish', rarity: 'legendary', minWeight: 50, maxWeight: 200, event: 'dewfall' },
        { emoji: 'üåå', name: 'Dewfall Cosmic Fish', rarity: 'mythic', minWeight: 200, maxWeight: 450, event: 'dewfall' },
        { emoji: '‚≠ê', name: 'Dewfall Star Fish', rarity: 'secret', minWeight: 300, maxWeight: 500, event: 'dewfall' },
        
        // Midnight Event Fish
        { emoji: 'üåô', name: 'Midnight Shadow Fish', rarity: 'common', minWeight: 1, maxWeight: 5, event: 'midnight' },
        { emoji: 'ü¶á', name: 'Midnight Bat Fish', rarity: 'rare', minWeight: 8, maxWeight: 25, event: 'midnight' },
        { emoji: 'üëª', name: 'Midnight Ghost Fish', rarity: 'epic', minWeight: 15, maxWeight: 60, event: 'midnight' },
        { emoji: 'üï∑Ô∏è', name: 'Midnight Spider Fish', rarity: 'legendary', minWeight: 50, maxWeight: 200, event: 'midnight' },
        { emoji: 'üî•', name: 'Midnight Flame Fish', rarity: 'mythic', minWeight: 200, maxWeight: 450, event: 'midnight' },
        { emoji: 'üíÄ', name: 'Midnight Skull Fish', rarity: 'secret', minWeight: 300, maxWeight: 500, event: 'midnight' },
        
        // Tambahkan ikan Bloodmoon di array fishTypes
// Bloodmoon Secret Whale
{ emoji: 'üåëüêã', name: 'Bloodmoon Whale', rarity: 'secret', minWeight: 400, maxWeight: 600, event: 'bloodmoon', special: 'ultra_rare' },

// Bloodmoon Regular Fish (dengan prefix "Bloodmoon")
{ emoji: 'üî¥üêü', name: 'Bloodmoon Common Fish', rarity: 'common', minWeight: 1, maxWeight: 5, event: 'bloodmoon', bloodmoonFish: true },
{ emoji: 'üî¥ìÜü', name: 'Bloodmoon River Fish', rarity: 'common', minWeight: 2, maxWeight: 8, event: 'bloodmoon', bloodmoonFish: true },
{ emoji: 'üî¥üê†', name: 'Bloodmoon Tropical Fish', rarity: 'rare', minWeight: 3, maxWeight: 12, event: 'bloodmoon', bloodmoonFish: true },
{ emoji: 'üî¥ü¶à', name: 'Bloodmoon Shark', rarity: 'epic', minWeight: 20, maxWeight: 80, event: 'bloodmoon', bloodmoonFish: true },
{ emoji: 'üî¥üêô', name: 'Bloodmoon Octopus', rarity: 'legendary', minWeight: 30, maxWeight: 120, event: 'bloodmoon', bloodmoonFish: true },

// Spooky Night Fish
{ emoji: 'üßüü¶à', name: 'Zombie Megalodon', rarity: 'secret', minWeight: 450, maxWeight: 650, event: 'spooky', special: 'ultra_rare' },
{ emoji: 'üëªüêü', name: 'Spooky Fish', rarity: 'legendary', minWeight: 80, maxWeight: 180, event: 'spooky' },
{ emoji: 'üèÆ', name: 'Lantern Fish', rarity: 'legendary', minWeight: 50, maxWeight: 120, event: 'spooky' },

// Starfall Fish
{ emoji: 'ü¶Ö‚ú®', name: 'Hawk Fish', rarity: 'secret', minWeight: 500, maxWeight: 700, event: 'starfall', special: 'ultra_rare' },
        
        // Milestone reward fish
        { emoji: 'üèÜ', name: 'Champion Fish', rarity: 'secret', minWeight: 400, maxWeight: 600, milestone: true },
        { emoji: 'üëë', name: 'Royal Fish', rarity: 'secret', minWeight: 350, maxWeight: 550, milestone: true },
        { emoji: 'üí´', name: 'Cosmic Guardian', rarity: 'mythic', minWeight: 250, maxWeight: 400, milestone: true },
        { emoji: 'üéØ', name: 'Target Fish', rarity: 'mythic', minWeight: 200, maxWeight: 350, milestone: true }
    ],
    
    rarityPrices: {
        common: { gold: 20, exp: 20 },
        rare: { gold: 35, exp: 35 },
        epic: { gold: 60, exp: 55 },
        legendary: { gold: 100, exp: 90 },
        mythic: { gold: 180, exp: 150 },
        secret: { gold: 300, exp: 250 }
    },
    
    milestoneList: [
    // ========== TOTAL CATCH MILESTONES (10) ==========
    { id: 'catch_25', name: 'First Steps', desc: 'Catch 25 fish', target: 25, type: 'total', reward: { type: 'gold', amount: 1000 }, claimed: false },
    { id: 'catch_50', name: 'Getting Started', desc: 'Catch 50 fish', target: 50, type: 'total', reward: { type: 'rod', item: 'aurora_rod' }, claimed: false },
    { id: 'catch_100', name: 'Fisher Pro', desc: 'Catch 100 fish', target: 100, type: 'total', reward: { type: 'rod', item: 'void_rod' }, claimed: false },
    { id: 'catch_200', name: 'Master Fisher', desc: 'Catch 200 fish', target: 200, type: 'total', reward: { type: 'rod', item: 'stellar_rod' }, claimed: false },
    { id: 'catch_350', name: 'Expert Angler', desc: 'Catch 350 fish', target: 350, type: 'total', reward: { type: 'rod', item: 'phoenix_rod' }, claimed: false },
    { id: 'catch_500', name: 'Fishing Addict', desc: 'Catch 500 fish', target: 500, type: 'total', reward: { type: 'rod', item: 'dragon_rod' }, claimed: false },
    { id: 'catch_750', name: 'Ocean Dominator', desc: 'Catch 750 fish', target: 750, type: 'total', reward: { type: 'rod', item: 'cosmic_rod' }, claimed: false },
    { id: 'catch_1000', name: 'Fishing Legend', desc: 'Catch 1000 fish', target: 1000, type: 'total', reward: { type: 'rod', item: 'eternal_rod' }, claimed: false },
    { id: 'catch_1500', name: 'Fishing Deity', desc: 'Catch 1500 fish', target: 1500, type: 'total', reward: { type: 'rod', item: 'divine_rod' }, claimed: false },
    { id: 'catch_2000', name: 'Fishing God', desc: 'Catch 2000 fish', target: 2000, type: 'total', reward: { type: 'rod', item: 'omega_rod' }, claimed: false },
    
    // ========== RARITY MILESTONES - RARE (2) ==========
    { id: 'rare_10', name: 'Rare Hunter', desc: 'Catch 10 rare fish', target: 10, type: 'rare', reward: { type: 'gold', amount: 800 }, claimed: false },
    { id: 'rare_50', name: 'Rare Collector', desc: 'Catch 50 rare fish', target: 50, type: 'rare', reward: { type: 'gold', amount: 3000 }, claimed: false },
    
    // ========== RARITY MILESTONES - EPIC (3) ==========
    { id: 'epic_5', name: 'Epic Starter', desc: 'Catch 5 epic fish', target: 5, type: 'epic', reward: { type: 'exp', amount: 500 }, claimed: false },
    { id: 'epic_25', name: 'Epic Hunter', desc: 'Catch 25 epic fish', target: 25, type: 'epic', reward: { type: 'gold', amount: 5000 }, claimed: false },
    { id: 'epic_50', name: 'Epic Master', desc: 'Catch 50 epic fish', target: 50, type: 'epic', reward: { type: 'skillPoints', amount: 15 }, claimed: false },
    
    // ========== RARITY MILESTONES - LEGENDARY (3) ==========
    { id: 'legendary_3', name: 'Legend Seeker', desc: 'Catch 3 legendary fish', target: 3, type: 'legendary', reward: { type: 'fish', item: 'royal_fish' }, claimed: false },
    { id: 'legendary_15', name: 'Legend Hunter', desc: 'Catch 15 legendary fish', target: 15, type: 'legendary', reward: { type: 'gold', amount: 10000 }, claimed: false },
    { id: 'legendary_30', name: 'Legend Master', desc: 'Catch 30 legendary fish', target: 30, type: 'legendary', reward: { type: 'skillPoints', amount: 20 }, claimed: false },
    
    // ========== RARITY MILESTONES - MYTHIC (3) ==========
    { id: 'mythic_2', name: 'Myth Breaker', desc: 'Catch 2 mythic fish', target: 2, type: 'mythic', reward: { type: 'fish', item: 'cosmic_guardian' }, claimed: false },
    { id: 'mythic_10', name: 'Myth Collector', desc: 'Catch 10 mythic fish', target: 10, type: 'mythic', reward: { type: 'gold', amount: 20000 }, claimed: false },
    { id: 'mythic_25', name: 'Myth Conqueror', desc: 'Catch 25 mythic fish', target: 25, type: 'mythic', reward: { type: 'rod', item: 'infinity_rod' }, claimed: false },
    
    // ========== RARITY MILESTONES - SECRET (3) ==========
    { id: 'secret_1', name: 'Secret Finder', desc: 'Catch 1 secret fish', target: 1, type: 'secret', reward: { type: 'fish', item: 'target_fish' }, claimed: false },
    { id: 'secret_5', name: 'Secret Hunter', desc: 'Catch 5 secret fish', target: 5, type: 'secret', reward: { type: 'gold', amount: 30000 }, claimed: false },
    { id: 'secret_15', name: 'Secret Master', desc: 'Catch 15 secret fish', target: 15, type: 'secret', reward: { type: 'rod', item: 'supreme_rod' }, claimed: false },
    
    // ========== GOLD EARNED MILESTONES (3) ==========
    { id: 'gold_10000', name: 'Rich Fisher', desc: 'Earn 10,000 gold from selling', target: 10000, type: 'gold_earned', reward: { type: 'exp', amount: 2000 }, claimed: false },
    { id: 'gold_50000', name: 'Wealthy Angler', desc: 'Earn 50,000 gold from selling', target: 50000, type: 'gold_earned', reward: { type: 'skillPoints', amount: 25 }, claimed: false },
    { id: 'gold_150000', name: 'Fishing Tycoon', desc: 'Earn 150,000 gold from selling', target: 150000, type: 'gold_earned', reward: { type: 'gold', amount: 50000 }, claimed: false },
    
    // ========== WEIGHT MILESTONES (3) ==========
    { id: 'weight_500', name: 'Heavy Lifter', desc: 'Catch total weight 500kg', target: 500, type: 'total_weight', reward: { type: 'gold', amount: 5000 }, claimed: false },
    { id: 'weight_2000', name: 'Weight Champion', desc: 'Catch total weight 2000kg', target: 2000, type: 'total_weight', reward: { type: 'exp', amount: 3000 }, claimed: false },
    { id: 'weight_5000', name: 'Tonnage King', desc: 'Catch total weight 5000kg', target: 5000, type: 'total_weight', reward: { type: 'fish', item: 'champion_fish' }, claimed: false }
]
};

// ========== EVENT SYSTEM ==========

// Check if weekend
function isWeekend() {
    const day = new Date().getDay();
    return day === 0 || day === 6; // Sunday = 0, Saturday = 6
}

// ========== BLOODMOON EVENT SYSTEM ==========

// Bloodmoon event state
const BloodmoonState = {
    lastEventDate: null,
    eventStartHour: null,
    isActive: false,
    endTime: null
};

// Load Bloodmoon state from localStorage
function loadBloodmoonState() {
    try {
        const saved = localStorage.getItem('bloodmoonState');
        if (saved) {
            const data = JSON.parse(saved);
            BloodmoonState.lastEventDate = data.lastEventDate;
            BloodmoonState.eventStartHour = data.eventStartHour;
        }
    } catch (error) {
        console.error('Error loading Bloodmoon state:', error);
    }
}

// Save Bloodmoon state
function saveBloodmoonState() {
    try {
        localStorage.setItem('bloodmoonState', JSON.stringify({
            lastEventDate: BloodmoonState.lastEventDate,
            eventStartHour: BloodmoonState.eventStartHour
        }));
    } catch (error) {
        console.error('Error saving Bloodmoon state:', error);
    }
}

// Generate random Bloodmoon hour for the day
function generateBloodmoonHour() {
    const possibleHours = [13, 14, 15, 19, 20, 22, 23]; // 1PM, 2PM, 3PM, 7PM, 8PM, 10PM, 11PM
    return possibleHours[Math.floor(Math.random() * possibleHours.length)];
}

// Check if Bloodmoon event should be active
function checkBloodmoonEvent() {
    const now = new Date();
    const day = now.getDay(); // 0 = Sunday, 1 = Monday, ..., 5 = Friday, 6 = Saturday
    const today = now.toDateString();
    const currentHour = now.getHours();
    const currentMinute = now.getMinutes();
    
    // Only on weekdays (Monday-Friday)
    if (day === 0 || day === 6) {
        BloodmoonState.isActive = false;
        return false;
    }
    
    // Check if we need to generate new event time for today
    if (BloodmoonState.lastEventDate !== today) {
        BloodmoonState.lastEventDate = today;
        BloodmoonState.eventStartHour = generateBloodmoonHour();
        BloodmoonState.isActive = false;
        saveBloodmoonState();
    }
    
    // Check if current time matches event time (1 minute duration)
    if (currentHour === BloodmoonState.eventStartHour && currentMinute === 0) {
        if (!BloodmoonState.isActive) {
            BloodmoonState.isActive = true;
            BloodmoonState.endTime = new Date(now.getTime() + 60000); // +1 minute
            
            // Apply bloodmoon effect
            applyBloodmoonEffect();
            
            // Alert player
            alert('üåë BLOODMOON EVENT STARTED! üåë\n\n‚è∞ Duration: 1 MINUTE!\nüî¥ All fish gold +100!\nüåëüêã Bloodmoon Whale available (1:6M)\nüî¥ Bloodmoon fish +200 gold (1:500K)');
        }
        return true;
    }
    
    // Event ended
    if (BloodmoonState.isActive && now >= BloodmoonState.endTime) {
        BloodmoonState.isActive = false;
        removeBloodmoonEffect();
        alert('üåë Bloodmoon Event Ended!\n\nWait until tomorrow for the next Bloodmoon...');
    }
    
    return BloodmoonState.isActive;
}

// Apply bloodmoon visual effect (UPDATED)
function applyBloodmoonEffect() {
    // Add to body for full screen effect
    document.body.classList.add('bloodmoon-active');
    
    const lakeContainer = document.querySelector('.lake-container');
    if (lakeContainer) {
        lakeContainer.classList.add('bloodmoon-active');
    }
    
    // Add countdown timer
    showBloodmoonCountdown();
}

// Remove bloodmoon effect (UPDATED)
function removeBloodmoonEffect() {
    // Remove from body
    document.body.classList.remove('bloodmoon-active');
    
    const lakeContainer = document.querySelector('.lake-container');
    if (lakeContainer) {
        lakeContainer.classList.remove('bloodmoon-active');
    }
    
    // Remove countdown
    const countdown = document.getElementById('bloodmoonCountdown');
    if (countdown) countdown.remove();
}

// Show bloodmoon countdown
function showBloodmoonCountdown() {
    // Remove existing countdown if any
    const existing = document.getElementById('bloodmoonCountdown');
    if (existing) existing.remove();
    
    const countdown = document.createElement('div');
    countdown.id = 'bloodmoonCountdown';
    countdown.className = 'bloodmoon-countdown';
    document.body.appendChild(countdown);
    
    updateBloodmoonCountdown();
}

// Update countdown timer
function updateBloodmoonCountdown() {
    const countdown = document.getElementById('bloodmoonCountdown');
    if (!countdown || !BloodmoonState.isActive) return;
    
    const now = new Date();
    const remaining = Math.max(0, Math.floor((BloodmoonState.endTime - now) / 1000));
    
    countdown.innerHTML = `
        üåë BLOODMOON<br>
        ‚è∞ ${remaining}s
    `;
    
    if (remaining > 0) {
        setTimeout(updateBloodmoonCountdown, 1000);
    }
}

// Update getCurrentEvents function
function getCurrentEvents() {
    const now = new Date();
    const hour = now.getHours();
    const events = [];
    
    // Check Bloodmoon
    if (checkBloodmoonEvent()) {
        events.push({
            type: 'bloodmoon',
            name: 'Bloodmoon Event',
            desc: 'üåë ULTRA RARE! All fish +100 Gold!',
            icon: 'üåë',
            active: true
        });
    }
    
    // Check Spooky Night
    if (checkSpookyEvent()) {
        events.push({
            type: 'spooky',
            name: 'Spooky Night Event',
            desc: 'üëª Spooky fish available! All fish +40 Gold!',
            icon: 'üëª',
            active: true
        });
    }
    
    // Check Starfall (Friday only)
    if (checkStarfallEvent()) {
        events.push({
            type: 'starfall',
            name: 'Starfall Event',
            desc: '‚≠ê Hawk Fish available! +10 Luck boost!',
            icon: '‚≠ê',
            active: true
        });
    }
    
    // Weekend Event
    if (isWeekend()) {
        events.push({
            type: 'weekend',
            name: 'Weekend Event',
            desc: 'All fish prices +5 Gold & +8 Luck boost!',
            icon: 'üéâ',
            active: true
        });
    }
    
    // Dewfall Event (12 PM - 1 PM)
    if (hour >= 12 && hour < 13) {
        events.push({
            type: 'dewfall',
            name: 'Dewfall Event',
            desc: 'Special Dewfall fish available!',
            icon: 'üíß',
            active: true
        });
    }
    
    // Sunset Event (6 PM - 7 PM)
    if (hour >= 18 && hour < 19) {
        events.push({
            type: 'sunset',
            name: 'Sunset Event',
            desc: '+15 Luck boost!',
            icon: 'üåÖ',
            active: true
        });
    }
    
    // Midnight Event (9 PM - 10 PM)
    if (hour >= 21 && hour < 22) {
        events.push({
            type: 'midnight',
            name: 'Midnight Event',
            desc: 'Special Midnight fish available!',
            icon: 'üåô',
            active: true
        });
    }
    
    return events;
}

// Calculate total luck with events
function getTotalLuck() {
    const baseLuck = FishingData.rods[FishingData.currentRod].luck;
    let totalLuck = baseLuck;
    
    const events = getCurrentEvents();
    events.forEach(event => {
        if (event.type === 'weekend') totalLuck += 8;
        if (event.type === 'sunset') totalLuck += 15;
        if (event.type === 'starfall') totalLuck += 10; // Starfall +10 luck
    });
    
    // Add consumable luck bonus
    totalLuck += getConsumableBonus('luck');
    
    return totalLuck;
}

// ========== LOCALSTORAGE FUNCTIONS ==========

// Load Fishing Data from localStorage
function loadFishingData() {
    try {
        const saved = localStorage.getItem('fisherLakeData');
        if (saved) {
            const data = JSON.parse(saved);
            FishingData.currentRod = data.currentRod || 'basic_rod';
            FishingData.caughtFish = data.caughtFish || [];
            FishingData.ownedRods = data.ownedRods || ['basic_rod'];
            FishingData.milestones = data.milestones || {};
            FishingData.stats = data.stats || { totalGoldEarned: 0, totalWeight: 0 };
            console.log('‚úÖ Fisher Lake data loaded! Total Weight:', FishingData.stats.totalWeight);
        }
        
        // Initialize stats if not exists
        if (!FishingData.stats) {
            FishingData.stats = { totalGoldEarned: 0, totalWeight: 0 };
        }
        
        // Initialize milestones if not exists
        FishingData.milestoneList.forEach(milestone => {
            if (!FishingData.milestones[milestone.id]) {
                FishingData.milestones[milestone.id] = {
                    progress: 0,
                    claimed: false
                };
            }
        });
        
    } catch (error) {
        console.error('‚ùå Error loading Fisher Lake data:', error);
    }
}

// Save Fishing Data to localStorage
function saveFishingData() {
    try {
        const dataToSave = {
            currentRod: FishingData.currentRod,
            caughtFish: FishingData.caughtFish,
            ownedRods: FishingData.ownedRods,
            milestones: FishingData.milestones,
            stats: FishingData.stats || { totalGoldEarned: 0, totalWeight: 0 }
        };
        localStorage.setItem('fisherLakeData', JSON.stringify(dataToSave));
        console.log('üíæ Fisher Lake data saved! Total Weight:', FishingData.stats?.totalWeight || 0);
    } catch (error) {
        console.error('‚ùå Error saving Fisher Lake data:', error);
    }
}

// Auto-save every 10 seconds
setInterval(saveFishingData, 10000);

// Add to window load event
window.addEventListener('load', () => {
    loadFishingData();
    loadBloodmoonState();
    loadConsumableData();
    loadLogs();
    
    // Check events every 10 seconds
    setInterval(() => {
        if (document.getElementById('fisherLakeScreen').classList.contains('active')) {
            checkBloodmoonEvent();
            checkSpookyEvent();
            checkStarfallEvent();
        }
    }, 10000);
});

// Save before page unload
window.addEventListener('beforeunload', saveFishingData);

// ========== MILESTONE SYSTEM (SUPER SIMPLE VERSION) ==========

// Update milestone progress
function updateMilestoneProgress(fish) {
    FishingData.milestoneList.forEach(milestone => {
        const milestoneData = FishingData.milestones[milestone.id];
        if (!milestoneData || milestoneData.claimed) return;
        
        // Total fish caught
        if (milestone.type === 'total') {
            milestoneData.progress = FishingData.caughtFish.length;
        }
        // Rarity-based milestones (rare, epic, legendary, mythic, secret)
        else if (['rare', 'epic', 'legendary', 'mythic', 'secret'].includes(milestone.type)) {
            if (milestone.type === fish.rarity) {
                const rarityCount = FishingData.caughtFish.filter(f => f.rarity === milestone.type).length;
                milestoneData.progress = rarityCount;
            }
        }
    });
    
    saveFishingData();
}

// Check for completed milestones
function checkCompletedMilestones() {
    const completed = [];
    FishingData.milestoneList.forEach(milestone => {
        const milestoneData = FishingData.milestones[milestone.id];
        if (milestoneData && milestoneData.progress >= milestone.target && !milestoneData.claimed) {
            completed.push(milestone);
        }
    });
    return completed;
}

// GLOBAL FUNCTION - Claim milestone
window.claimMilestoneReward = function(milestoneId) {
    console.log('üéÅ CLAIM FUNCTION CALLED:', milestoneId);
    alert('üéÅ Claim function called for: ' + milestoneId);
    
    const milestone = FishingData.milestoneList.find(m => m.id === milestoneId);
    const milestoneData = FishingData.milestones[milestoneId];
    
    console.log('Milestone:', milestone);
    console.log('Milestone Data:', milestoneData);
    
    if (!milestone) {
        alert('‚ùå ERROR: Milestone not found!\nID: ' + milestoneId);
        return;
    }
    
    if (!milestoneData) {
        alert('‚ùå ERROR: Milestone data not found!\nID: ' + milestoneId);
        return;
    }
    
    if (milestoneData.claimed) {
        alert('‚ö†Ô∏è Already Claimed!\n\nYou already received this reward.');
        return;
    }
    
    if (milestoneData.progress < milestone.target) {
        alert(`‚ö†Ô∏è Not Ready Yet!\n\nProgress: ${milestoneData.progress}/${milestone.target}\n\nKeep fishing!`);
        return;
    }
    
    // GIVE REWARD
    const reward = milestone.reward;
    let rewardMsg = '';
    
    try {
        if (reward.type === 'gold') {
            gameState.player.gold = (gameState.player.gold || 0) + reward.amount;
            rewardMsg = `üí∞ +${reward.amount} Gold`;
            console.log('‚úÖ Added gold:', reward.amount);
            
        } else if (reward.type === 'exp') {
            gameState.player.exp = (gameState.player.exp || 0) + reward.amount;
            rewardMsg = `‚≠ê +${reward.amount} EXP`;
            console.log('‚úÖ Added EXP:', reward.amount);
            if (typeof checkLevelUp === 'function') checkLevelUp();
            
        } else if (reward.type === 'skillPoints') {
            gameState.player.skillPoints = (gameState.player.skillPoints || 0) + reward.amount;
            rewardMsg = `üéØ +${reward.amount} Skill Points`;
            console.log('‚úÖ Added Skill Points:', reward.amount);
            
        } else if (reward.type === 'rod') {
            if (!FishingData.ownedRods.includes(reward.item)) {
                FishingData.ownedRods.push(reward.item);
                const rodName = FishingData.rods[reward.item] ? FishingData.rods[reward.item].name : reward.item;
                rewardMsg = `üé£ Unlocked ${rodName}!`;
                console.log('‚úÖ Unlocked rod:', reward.item);
            } else {
                gameState.player.gold = (gameState.player.gold || 0) + 1000;
                rewardMsg = `üé£ Rod already owned\nüí∞ +1000 Gold instead`;
                console.log('‚úÖ Rod owned, gave gold');
            }
            
        } else if (reward.type === 'fish') {
            const fishName = reward.item.replace('_', ' ').toLowerCase();
            const specialFish = FishingData.fishTypes.find(f => 
                f.name.toLowerCase().includes(fishName)
            );
            
            if (specialFish) {
                const weight = (Math.random() * (specialFish.maxWeight - specialFish.minWeight) + specialFish.minWeight).toFixed(1);
                FishingData.caughtFish.push({
                    ...specialFish,
                    weight: parseFloat(weight)
                });
                rewardMsg = `üêü Received ${specialFish.emoji} ${specialFish.name}!`;
                console.log('‚úÖ Added fish:', specialFish.name);
            } else {
                gameState.player.gold = (gameState.player.gold || 0) + 500;
                rewardMsg = `üêü Fish unavailable\nüí∞ +500 Gold instead`;
                console.log('‚úÖ Fish not found, gave gold');
            }
        }
        
        // MARK AS CLAIMED
        milestoneData.claimed = true;
        
        // SAVE
        saveFishingData();
        if (typeof saveGameState === 'function') saveGameState();
        
        console.log('‚úÖ CLAIM SUCCESS!');
        
        addLog(
        LOG_TYPES.MILESTONE,
        `Milestone: ${milestone.name}`,
        `üèÜ Reward: ${rewardMsg}`,
        'üèÜ'
    );
        
        // SHOW SUCCESS
        alert(`üèÜ MILESTONE COMPLETED! üèÜ\n\n${milestone.name}\n\n${rewardMsg}`);
        
        // REFRESH
        openMilestone();
        if (typeof initFisherLake === 'function') initFisherLake();
        
    } catch (error) {
        console.error('‚ùå CLAIM ERROR:', error);
        alert('‚ùå Error claiming reward!\n\n' + error.message);
    }
}

// Open Milestone Modal
function openMilestone() {
    const modal = document.getElementById('milestoneModal');
    const content = document.getElementById('milestoneContent');
    
    if (!modal || !content) {
        alert('‚ùå Modal not found!');
        return;
    }
    
    let html = '<div class="milestone-grid">';
    
    FishingData.milestoneList.forEach(milestone => {
        const data = FishingData.milestones[milestone.id];
        const progress = data ? data.progress : 0;
        const claimed = data ? data.claimed : false;
        const complete = progress >= milestone.target;
        const canClaim = complete && !claimed;
        
        let status = '';
        let statusColor = '#bbb';
        let button = '';
        
        if (claimed) {
            status = '‚úÖ COMPLETED';
            statusColor = '#2ecc71';
        } else if (canClaim) {
            status = 'üéÅ READY';
            statusColor = '#f39c12';
            button = `
                <button 
                    onclick="window.claimMilestoneReward('${milestone.id}')"
                    style="
                        background: linear-gradient(135deg, #f39c12, #e67e22);
                        border: 2px solid #f39c12;
                        color: white;
                        padding: 14px 28px;
                        border-radius: 12px;
                        cursor: pointer;
                        margin-top: 15px;
                        font-weight: bold;
                        font-size: 16px;
                        width: 100%;
                        box-shadow: 0 6px 16px rgba(243, 156, 18, 0.5);
                        transition: all 0.2s;
                        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
                    "
                    onmousedown="this.style.transform='scale(0.95)'"
                    onmouseup="this.style.transform='scale(1)'"
                    ontouchstart="this.style.transform='scale(0.95)'"
                    ontouchend="this.style.transform='scale(1)'"
                >
                    üéÅ CLAIM REWARD
                </button>
            `;
        } else {
            status = 'üìã IN PROGRESS';
        }
        
        const percent = Math.min(100, (progress / milestone.target) * 100);
        
        let rewardTxt = '';
        const r = milestone.reward;
        if (r.type === 'gold') rewardTxt = `üí∞ ${r.amount} Gold`;
        else if (r.type === 'exp') rewardTxt = `‚≠ê ${r.amount} EXP`;
        else if (r.type === 'skillPoints') rewardTxt = `üéØ ${r.amount} Skill Points`;
        else if (r.type === 'rod') {
            const rName = FishingData.rods[r.item] ? FishingData.rods[r.item].name : r.item;
            rewardTxt = `üé£ ${rName}`;
        }
        else if (r.type === 'fish') rewardTxt = `üêü Special Fish`;
        
        html += `
            <div class="milestone-item ${claimed ? 'completed' : canClaim ? 'claimable' : ''}">
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <h4 style="margin: 0;">${milestone.name}</h4>
                    <span style="font-size: 0.8em; color: ${statusColor}; font-weight: bold;">${status}</span>
                </div>
                <p style="margin: 8px 0; color: #bbb; font-size: 0.9em;">${milestone.desc}</p>
                <div style="margin: 10px 0; color: ${complete ? '#2ecc71' : '#bbb'};">
                    Progress: <strong>${progress}/${milestone.target}</strong>
                </div>
                <div class="milestone-progress">
                    <div class="milestone-progress-bar" style="width: ${percent}%"></div>
                </div>
                <div class="milestone-reward" style="margin-top: 10px;">
                    <span style="color: var(--secondary-color);">üéÅ Reward:</span>
                    <span style="color: white; font-weight: bold;"> ${rewardTxt}</span>
                </div>
                ${button}
            </div>
        `;
    });
    
    html += '</div>';
    content.innerHTML = html;
    modal.classList.add('active');
    
    console.log('‚úÖ Milestone modal opened');
}

// Close Milestone
function closeMilestone() {
    const modal = document.getElementById('milestoneModal');
    if (modal) modal.classList.remove('active');
}


// ========== GAME FUNCTIONS ==========

// Check Lake Access Time (Updated - FIXED)
function checkLakeAccess() {
    const now = new Date();
    const hour = now.getHours();
    const day = now.getDay(); // 0 = Minggu, 6 = Sabtu
    
    // Sabtu (6) atau Minggu (0): buka 24 jam penuh (00:00 - 23:59)
    if (day === 0 || day === 6) {
        return true; // Selalu buka di hari Sabtu dan Minggu
    }
    
    // Hari biasa (Senin-Jumat): 12:00-14:59 (tutup jam 15:00) atau 18:00-23:59
    return (hour >= 12 && hour < 15) || (hour >= 18 && hour <= 23);
}

// Initialize Fisher Lake Screen
function initFisherLake() {
    loadFishingData();
    
    const container = document.getElementById('lakeAccessCheck');
    
    if (!checkLakeAccess()) {
        const now = new Date();
        
        container.innerHTML = `
            <div class="lake-closed-message">
                <h3>üåô Fisherman Lake is Closed</h3>
                <p>Only accessible during:</p>
                <p><strong>Weekdays: 12:00 PM - 2:59 PM & 6:00 PM - 11:59 PM</strong></p>
                <p><strong>üéâ Weekend (Sat-Sun): Open 24 Hours!</strong></p>
                <p style="margin-top: 15px; color: #bbb;">Current time: ${now.toLocaleTimeString()}</p>
                <p style="margin-top: 5px; color: #bbb;">Day: ${now.toLocaleDateString('en-US', { weekday: 'long' })}</p>
                <p style="color: var(--secondary-color); margin-top: 10px;">Come back during open hours! üé£</p>
            </div>
        `;
        return;
    }
    
    const currentRod = FishingData.rods[FishingData.currentRod];
    const totalLuck = getTotalLuck();
    const events = getCurrentEvents();
    
    // Get consumable bonuses
    const weightBonus = getConsumableBonus('weight');
    const luckBonus = getConsumableBonus('luck');
    const goldBonus = getConsumableBonus('gold');
    
    let eventBannersHtml = '';
    events.forEach(event => {
        eventBannersHtml += `
            <div class="event-banner ${event.type}" onclick="toggleEventDetails('${event.type}')">
                <div class="event-banner-content">
                    <div class="event-info">
                        <h3>${event.icon} ${event.name}</h3>
                        <p>${event.desc}</p>
                    </div>
                    <button class="event-toggle">Details</button>
                </div>
                <div class="event-details" id="eventDetails_${event.type}">
                    ${getEventDetails(event)}
                </div>
            </div>
        `;
    });
    
    container.innerHTML = `
        ${eventBannersHtml}
        
        <div class="current-rod-display">
            <div style="font-size: 1.2em; margin-bottom: 10px;">
                ${currentRod.icon} <strong>${currentRod.name}</strong>
            </div>
            <div style="color: #bbb; font-size: 0.9em;">
                üçÄ Luck: ${currentRod.luck}${luckBonus > 0 ? ` <span style="color: #2ecc71;">(+${luckBonus})</span>` : ''}% | 
                Total: <span style="color: var(--secondary-color);">${totalLuck}%</span> | 
                ‚öñÔ∏è Weight: ${currentRod.weight}${weightBonus > 0 ? ` <span style="color: #3498db;">(+${weightBonus})</span>` : ''}kg
            </div>
            ${goldBonus > 0 ? `<div style="color: #f39c12; font-size: 0.85em; margin-top: 5px;">üí∞ Gold Potion Active: +${goldBonus} per fish</div>` : ''}
        </div>
        </div>
        
        <div class="lake-container">
            <div class="water-surface"></div>
            <div style="position: relative; z-index: 10; text-align: center; padding-top: 80px;">
                <button class="fish-hook-btn" onclick="startFishing()">üé£</button>
                <div style="margin-top: 20px; color: #bbb;">Tap to start fishing!</div>
            </div>
        </div>
        
        <div class="fishing-stats">
            <div class="fish-stat-card">
                <div class="fish-stat-icon">üêü</div>
                <div class="fish-stat-value">${FishingData.caughtFish.length}</div>
                <div style="font-size: 0.8em; color: #bbb;">Fish Caught</div>
            </div>
            <div class="fish-stat-card">
                <div class="fish-stat-icon">üí∞</div>
                <div class="fish-stat-value">${gameState.player.gold}</div>
                <div style="font-size: 0.8em; color: #bbb;">Gold</div>
            </div>
        </div>
        
        <div class="fishing-actions">
            <button class="fish-action-btn" onclick="openFishInventory()">
                <div class="action-icon">üéí</div>
                <div>Inventory</div>
            </button>
            <button class="fish-action-btn" onclick="openSellFish()">
                <div class="action-icon">üí∞</div>
                <div>Sell Fish</div>
            </button>
            <button class="fish-action-btn" onclick="openMilestone()">
                <div class="action-icon">üèÜ</div>
                <div>Milestones</div>
            </button>
            <button class="fish-action-btn" onclick="openFishGear()">
                <div class="action-icon">‚öôÔ∏è</div>
                <div>Gear</div>
            </button>
            <button class="fish-action-btn" onclick="openMerchant()">
                <div class="action-icon">üè™</div>
                <div>Shop</div>
            </button>
            <button class="fish-action-btn" onclick="openConsumable()">
    <div class="action-icon">üß™</div>
    <div>Consumables</div>
</button>
<button class="fish-action-btn" onclick="openLogs()">
    <div class="action-icon">üìú</div>
    <div>Logs</div>
</button>
<button class="fish-action-btn" onclick="openFreeRods()">
    <div class="action-icon">üéÅ</div>
    <div>Free Rods</div>
</button>
<button class="fish-action-btn" onclick="openEliteMerchant()">
    <div class="action-icon">üëë</div>
    <div>Merchant</div>
</button>
        </div>
    `;
}

const ConsumableData = {
    owned: {
        luck_potion: 0,
        gold_potion: 0,
        weight_potion: 0
    },
    activeEffects: [],
    
    items: {
        luck_potion: {
            name: 'Luck Potion',
            emoji: 'üçÄ',
            desc: '+5 Luck for 1 minute',
            price: 200,
            duration: 60000, // 1 menit
            effect: { type: 'luck', value: 5 }
        },
        gold_potion: {
            name: 'Gold Potion',
            emoji: 'üí∞',
            desc: '+25 Gold per fish for 1 minute',
            price: 300,
            duration: 60000,
            effect: { type: 'gold', value: 25 }
        },
        weight_potion: {
            name: 'Weight Potion',
            emoji: '‚öñÔ∏è',
            desc: '+100 Weight for 2 minutes',
            price: 250,
            duration: 120000, // 2 menit
            effect: { type: 'weight', value: 100 }
        }
    }
};

// Load Consumable Data
function loadConsumableData() {
    try {
        const saved = localStorage.getItem('consumableData');
        if (saved) {
            const data = JSON.parse(saved);
            ConsumableData.owned = data.owned || { luck_potion: 0, gold_potion: 0, weight_potion: 0 };
            ConsumableData.activeEffects = data.activeEffects || [];
            
            // Clean expired effects
            const now = Date.now();
            ConsumableData.activeEffects = ConsumableData.activeEffects.filter(e => e.endTime > now);
        }
    } catch (error) {
        console.error('Error loading consumable data:', error);
    }
}

// Save Consumable Data
function saveConsumableData() {
    try {
        localStorage.setItem('consumableData', JSON.stringify({
            owned: ConsumableData.owned,
            activeEffects: ConsumableData.activeEffects
        }));
    } catch (error) {
        console.error('Error saving consumable data:', error);
    }
}

// Buy Consumable
function buyConsumable(itemId) {
    const item = ConsumableData.items[itemId];
    if (!item) return;
    
    if (gameState.player.gold < item.price) {
        alert(`‚ùå Not enough gold! Need ${item.price} gold.`);
        return;
    }
    
    gameState.player.gold -= item.price;
    ConsumableData.owned[itemId]++;
    
    saveConsumableData();
    if (typeof saveGameState === 'function') saveGameState();
    
    alert(`‚úÖ Purchased ${item.emoji} ${item.name}!`);
    
    addLog(
        LOG_TYPES.BUY_CONSUMABLE,
        `Bought ${item.name}`,
        `${item.emoji} ${item.desc} | üí∞ -${item.price} Gold`,
        item.emoji
    );
    
    openConsumable();
}

// Use Consumable
function useConsumable(itemId) {
    const item = ConsumableData.items[itemId];
    if (!item) return;
    
    if (ConsumableData.owned[itemId] <= 0) {
        alert(`‚ùå You don't have any ${item.name}!`);
        return;
    }
    
    // Check if same effect already active
    const existingEffect = ConsumableData.activeEffects.find(e => e.itemId === itemId);
    if (existingEffect) {
        alert(`‚ö†Ô∏è ${item.name} is already active! Wait until it expires.`);
        return;
    }
    
    // Use potion
    ConsumableData.owned[itemId]--;
    
    // Add effect
    ConsumableData.activeEffects.push({
        itemId: itemId,
        name: item.name,
        emoji: item.emoji,
        effect: item.effect,
        endTime: Date.now() + item.duration
    });
    
    saveConsumableData();
    
    alert(`‚úÖ Used ${item.emoji} ${item.name}!\n\nEffect active for ${item.duration / 60000} minute(s)!`);
    
    addLog(
        LOG_TYPES.USE_CONSUMABLE,
        `Used ${item.name}`,
        `${item.emoji} Effect active for ${item.duration / 60000} minute(s)`,
        item.emoji
    );
    
    openConsumable();
    initFisherLake();
}

// Get Active Effects
function getActiveEffects() {
    const now = Date.now();
    ConsumableData.activeEffects = ConsumableData.activeEffects.filter(e => e.endTime > now);
    return ConsumableData.activeEffects;
}

// Get Bonus from Active Effects
function getConsumableBonus(type) {
    const effects = getActiveEffects();
    let bonus = 0;
    effects.forEach(e => {
        if (e.effect.type === type) bonus += e.effect.value;
    });
    return bonus;
}

// Open Consumable Modal
function openConsumable() {
    loadConsumableData();
    const modal = document.getElementById('consumableModal');
    const content = document.getElementById('consumableContent');
    
    let html = '';
    
    // Active Effects Section
    const activeEffects = getActiveEffects();
    if (activeEffects.length > 0) {
        html += '<div class="active-effects"><h3>üî• Active Effects</h3>';
        activeEffects.forEach(effect => {
            const remaining = Math.ceil((effect.endTime - Date.now()) / 1000);
            html += `
                <div class="effect-item">
                    <span>${effect.emoji} ${effect.name}</span>
                    <span class="effect-timer">‚è∞ ${remaining}s</span>
                </div>
            `;
        });
        html += '</div>';
    }
    
    // Shop Section
    html += '<h3 style="margin-top: 20px;">üõí Buy Consumables</h3>';
    html += '<div class="consumable-grid">';
    
    Object.entries(ConsumableData.items).forEach(([itemId, item]) => {
        const owned = ConsumableData.owned[itemId] || 0;
        const canAfford = gameState.player.gold >= item.price;
        const cssClass = item.effect.type;
        
        html += `
            <div class="consumable-item ${cssClass}">
                <div class="consumable-emoji">${item.emoji}</div>
                <div class="consumable-name">${item.name}</div>
                <div class="consumable-desc">${item.desc}</div>
                <div class="consumable-price">üí∞ ${item.price} Gold</div>
                <div class="consumable-owned">Owned: ${owned}</div>
                <button class="buy-consumable-btn" onclick="buyConsumable('${itemId}')" ${!canAfford ? 'disabled' : ''}>
                    BUY
                </button>
                <button class="use-consumable-btn" onclick="useConsumable('${itemId}')" ${owned <= 0 ? 'disabled' : ''}>
                    USE
                </button>
            </div>
        `;
    });
    
    html += '</div>';
    content.innerHTML = html;
    modal.classList.add('active');
    
    // Auto-refresh untuk timer
    if (activeEffects.length > 0) {
        setTimeout(() => {
            if (modal.classList.contains('active')) openConsumable();
        }, 1000);
    }
}

// Close Consumable Modal
function closeConsumable() {
    document.getElementById('consumableModal').classList.remove('active');
}

const LogsData = {
    logs: []
};

// Log Types
const LOG_TYPES = {
    CATCH: 'catch',
    SELL: 'sell',
    BUY_ROD: 'buy-rod',
    BUY_CONSUMABLE: 'buy-consumable',
    USE_CONSUMABLE: 'use-consumable',
    MILESTONE: 'milestone'
};

// Load Logs from localStorage
function loadLogs() {
    try {
        const saved = localStorage.getItem('fishingLogs');
        if (saved) {
            LogsData.logs = JSON.parse(saved);
        }
    } catch (error) {
        console.error('Error loading logs:', error);
        LogsData.logs = [];
    }
}

// Save Logs to localStorage
function saveLogs() {
    try {
        // Keep only last 200 logs
        if (LogsData.logs.length > 200) {
            LogsData.logs = LogsData.logs.slice(-200);
        }
        localStorage.setItem('fishingLogs', JSON.stringify(LogsData.logs));
    } catch (error) {
        console.error('Error saving logs:', error);
    }
}

function addLog(type, title, detail, icon) {
    const log = {
        id: Date.now(),
        type: type,
        title: title,
        detail: detail,
        icon: icon,
        timestamp: new Date().toISOString()
    };
    
    LogsData.logs.push(log);
    saveLogs();
    console.log('üìú Log added:', title);
}

// Format timestamp
function formatLogTime(isoString) {
    const date = new Date(isoString);
    const now = new Date();
    const diff = now - date;
    
    // Kurang dari 1 menit
    if (diff < 60000) {
        return 'Just now';
    }
    // Kurang dari 1 jam
    if (diff < 3600000) {
        const mins = Math.floor(diff / 60000);
        return `${mins} minute${mins > 1 ? 's' : ''} ago`;
    }
    // Kurang dari 24 jam
    if (diff < 86400000) {
        const hours = Math.floor(diff / 3600000);
        return `${hours} hour${hours > 1 ? 's' : ''} ago`;
    }
    // Lebih dari 24 jam
    return date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

// Open Logs Modal
function openLogs() {
    loadLogs();
    const modal = document.getElementById('logsModal');
    const content = document.getElementById('logsContent');
    
    // Calculate stats
    const stats = {
        totalCatch: LogsData.logs.filter(l => l.type === LOG_TYPES.CATCH).length,
        totalSell: LogsData.logs.filter(l => l.type === LOG_TYPES.SELL).length,
        totalRodBuy: LogsData.logs.filter(l => l.type === LOG_TYPES.BUY_ROD).length,
        totalConsumable: LogsData.logs.filter(l => l.type === LOG_TYPES.BUY_CONSUMABLE).length
    };
    
    let html = `
        <div class="logs-stats">
            <div class="log-stat-card">
                <div class="log-stat-value">üêü ${stats.totalCatch}</div>
                <div class="log-stat-label">Fish Caught</div>
            </div>
            <div class="log-stat-card">
                <div class="log-stat-value">üí∞ ${stats.totalSell}</div>
                <div class="log-stat-label">Fish Sold</div>
            </div>
            <div class="log-stat-card">
                <div class="log-stat-value">üé£ ${stats.totalRodBuy}</div>
                <div class="log-stat-label">Rods Bought</div>
            </div>
            <div class="log-stat-card">
                <div class="log-stat-value">üß™ ${stats.totalConsumable}</div>
                <div class="log-stat-label">Consumables</div>
            </div>
        </div>
        
        <div class="logs-filter">
            <button class="filter-btn active" onclick="filterLogs('all')">All</button>
            <button class="filter-btn" onclick="filterLogs('catch')">üêü Catch</button>
            <button class="filter-btn" onclick="filterLogs('sell')">üí∞ Sell</button>
            <button class="filter-btn" onclick="filterLogs('buy-rod')">üé£ Rod</button>
            <button class="filter-btn" onclick="filterLogs('buy-consumable')">üß™ Consumable</button>
        </div>
        
        <div class="logs-container" id="logsContainer">
    `;
    
    if (LogsData.logs.length === 0) {
        html += `
            <div class="logs-empty">
                <div style="font-size: 3em; margin-bottom: 15px;">üìú</div>
                <div>No activity logs yet.</div>
                <div style="color: #666; margin-top: 5px;">Start fishing to see your logs!</div>
            </div>
        `;
    } else {
        // Show logs (newest first)
        const reversedLogs = [...LogsData.logs].reverse();
        reversedLogs.forEach(log => {
            html += `
                <div class="log-item ${log.type}" data-type="${log.type}">
                    <div class="log-icon">${log.icon}</div>
                    <div class="log-content">
                        <div class="log-title">${log.title}</div>
                        <div class="log-detail">${log.detail}</div>
                        <div class="log-time">${formatLogTime(log.timestamp)}</div>
                    </div>
                </div>
            `;
        });
    }
    
    html += '</div>';
    
    // Clear logs button
    if (LogsData.logs.length > 0) {
        html += `<button class="clear-logs-btn" onclick="clearAllLogs()" style="margin: 10px;">üóëÔ∏è Clear All Logs</button>`;
    }
    
    content.innerHTML = html;
    modal.classList.add('active');
}

// Filter Logs
function filterLogs(type) {
    // Update active button
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Filter log items
    document.querySelectorAll('.log-item').forEach(item => {
        if (type === 'all' || item.dataset.type === type) {
            item.style.display = 'flex';
        } else {
            item.style.display = 'none';
        }
    });
}

// Clear All Logs
function clearAllLogs() {
    if (confirm('Are you sure you want to clear all logs?')) {
        LogsData.logs = [];
        saveLogs();
        openLogs(); // Refresh
        alert('‚úÖ All logs cleared!');
    }
}

// Close Logs Modal
function closeLogs() {
    document.getElementById('logsModal').classList.remove('active');
}

// Get event details
function getEventDetails(event) {
    switch (event.type) {
        case 'bloodmoon':
            return `
                <div>üåë <strong>Bloodmoon Curse:</strong></div>
                <div>‚Ä¢ ULTRA RARE EVENT (1 minute only!)</div>
                <div>‚Ä¢ All fish: +100 Gold bonus</div>
                <div>‚Ä¢ Bloodmoon fish: +200 Gold (1:500K chance)</div>
                <div>‚Ä¢ Bloodmoon Whale: Ultimate prize (1:6M chance)</div>
                <div>‚Ä¢ Random time: Mon-Fri only</div>
                <div>‚Ä¢ Next event: ${event.duration || 'Tomorrow'}</div>
            `;
        case 'spooky':
    return `
        <div>üëª <strong>Spooky Night Curse:</strong></div>
        <div>‚Ä¢ Active: Mon-Fri, 11:30 PM - 11:59 PM</div>
        <div>‚Ä¢ üßüü¶à Zombie Megalodon (1:4M chance)</div>
        <div>‚Ä¢ üëª Spooky Fish (1:800K chance)</div>
        <div>‚Ä¢ üèÆ Lantern Fish (1:500K chance)</div>
        <div>‚Ä¢ üí∞ All fish: +40 Gold bonus</div>
    `;
case 'starfall':
    return `
        <div>‚≠ê <strong>Starfall Blessing:</strong></div>
        <div>‚Ä¢ Active: Friday only, 10:30 PM - 10:59 PM</div>
        <div>‚Ä¢ ü¶Ö‚ú® Hawk Fish available (1:10M chance)</div>
        <div>‚Ä¢ üçÄ +10 Luck boost</div>
        <div>‚Ä¢ The rarest event in the game!</div>
    `;    
        case 'weekend':
            return `
                <div>üéâ <strong>Weekend Bonus:</strong></div>
                <div>‚Ä¢ All fish sell for +25% more gold</div>
                <div>‚Ä¢ +8 Luck boost while fishing</div>
                <div>‚Ä¢ Active all day Saturday & Sunday</div>
            `;
        case 'dewfall':
            return `
                <div>üíß <strong>Dewfall Special:</strong></div>
                <div>‚Ä¢ Exclusive Dewfall fish available</div>
                <div>‚Ä¢ Dewfall fish sell for +50% more gold</div>
                <div>‚Ä¢ Active: 12:00 PM - 1:00 PM</div>
            `;
        case 'sunset':
            return `
                <div>üåÖ <strong>Golden Hour:</strong></div>
                <div>‚Ä¢ +15 Luck boost for better catches</div>
                <div>‚Ä¢ Perfect time for rare fishing</div>
                <div>‚Ä¢ Active: 6:00 PM - 7:00 PM</div>
            `;
        case 'midnight':
            return `
                <div>üåô <strong>Midnight Mystery:</strong></div>
                <div>‚Ä¢ Exclusive Midnight fish available</div>
                <div>‚Ä¢ Midnight fish sell for +60% more gold</div>
                <div>‚Ä¢ Active: 9:00 PM - 10:00 PM</div>
            `;
        default:
            return '<div>Event details not available</div>';
    }
}

// ========== SPOOKY NIGHT EVENT ==========

const SpookyState = {
    isActive: false,
    endTime: null
};

// Check Spooky Night Event (Mon-Fri, 11:30 PM - 11:59 PM)
function checkSpookyEvent() {
    const now = new Date();
    const day = now.getDay();
    const hour = now.getHours();
    const minute = now.getMinutes();
    
    // Only weekdays (Mon-Fri: 1-5)
    if (day === 0 || day === 6) {
        SpookyState.isActive = false;
        return false;
    }
    
    // 11:30 PM - 11:59 PM (23:30 - 23:59)
    if (hour === 23 && minute >= 30 && minute <= 59) {
        if (!SpookyState.isActive) {
            SpookyState.isActive = true;
            SpookyState.endTime = new Date(now);
            SpookyState.endTime.setHours(23, 59, 59);
            applySpookyEffect();
            alert('üëª SPOOKY NIGHT EVENT! üëª\n\nüßü Zombie Megalodon (1:4M)\nüëª Spooky Fish (1:800K)\nüèÆ Lantern Fish (1:500K)\nüí∞ All fish +40 Gold!');
        }
        return true;
    }
    
    if (SpookyState.isActive) {
        SpookyState.isActive = false;
        removeSpookyEffect();
    }
    return false;
}

function applySpookyEffect() {
    document.body.classList.add('spooky-active');
    const lake = document.querySelector('.lake-container');
    if (lake) lake.classList.add('spooky-active');
    showSpookyCountdown();
}

function removeSpookyEffect() {
    document.body.classList.remove('spooky-active');
    const lake = document.querySelector('.lake-container');
    if (lake) lake.classList.remove('spooky-active');
    const countdown = document.getElementById('spookyCountdown');
    if (countdown) countdown.remove();
}

function showSpookyCountdown() {
    const existing = document.getElementById('spookyCountdown');
    if (existing) existing.remove();
    
    const countdown = document.createElement('div');
    countdown.id = 'spookyCountdown';
    countdown.className = 'spooky-countdown';
    document.body.appendChild(countdown);
    updateSpookyCountdown();
}

function updateSpookyCountdown() {
    const countdown = document.getElementById('spookyCountdown');
    if (!countdown || !SpookyState.isActive) return;
    
    const now = new Date();
    const remaining = Math.max(0, Math.floor((SpookyState.endTime - now) / 1000));
    const mins = Math.floor(remaining / 60);
    const secs = remaining % 60;
    
    countdown.innerHTML = `üëª SPOOKY NIGHT<br>‚è∞ ${mins}:${secs.toString().padStart(2, '0')}`;
    
    if (remaining > 0) setTimeout(updateSpookyCountdown, 1000);
}

// ========== STARFALL EVENT ==========

const StarfallState = {
    isActive: false,
    endTime: null
};

// Check Starfall Event (Friday only, 10:30 PM - 10:59 PM)
function checkStarfallEvent() {
    const now = new Date();
    const day = now.getDay();
    const hour = now.getHours();
    const minute = now.getMinutes();
    
    // Only Friday (5)
    if (day !== 5) {
        StarfallState.isActive = false;
        return false;
    }
    
    // 10:30 PM - 10:59 PM (22:30 - 22:59)
    if (hour === 22 && minute >= 30 && minute <= 59) {
        if (!StarfallState.isActive) {
            StarfallState.isActive = true;
            StarfallState.endTime = new Date(now);
            StarfallState.endTime.setHours(22, 59, 59);
            applyStarfallEffect();
            alert('‚≠ê STARFALL EVENT! ‚≠ê\n\nü¶Ö Hawk Fish available (1:10M)\nüçÄ +10 Luck boost!\n\nOnly on Friday nights!');
        }
        return true;
    }
    
    if (StarfallState.isActive) {
        StarfallState.isActive = false;
        removeStarfallEffect();
    }
    return false;
}

function applyStarfallEffect() {
    document.body.classList.add('starfall-active');
    const lake = document.querySelector('.lake-container');
    if (lake) lake.classList.add('starfall-active');
    showStarfallCountdown();
}

function removeStarfallEffect() {
    document.body.classList.remove('starfall-active');
    const lake = document.querySelector('.lake-container');
    if (lake) lake.classList.remove('starfall-active');
    const countdown = document.getElementById('starfallCountdown');
    if (countdown) countdown.remove();
}

function showStarfallCountdown() {
    const existing = document.getElementById('starfallCountdown');
    if (existing) existing.remove();
    
    const countdown = document.createElement('div');
    countdown.id = 'starfallCountdown';
    countdown.className = 'starfall-countdown';
    document.body.appendChild(countdown);
    updateStarfallCountdown();
}

function updateStarfallCountdown() {
    const countdown = document.getElementById('starfallCountdown');
    if (!countdown || !StarfallState.isActive) return;
    
    const now = new Date();
    const remaining = Math.max(0, Math.floor((StarfallState.endTime - now) / 1000));
    const mins = Math.floor(remaining / 60);
    const secs = remaining % 60;
    
    countdown.innerHTML = `‚≠ê STARFALL<br>‚è∞ ${mins}:${secs.toString().padStart(2, '0')}`;
    
    if (remaining > 0) setTimeout(updateStarfallCountdown, 1000);
}

// Toggle event details
function toggleEventDetails(eventType) {
    const details = document.getElementById(`eventDetails_${eventType}`);
    if (details) {
        details.classList.toggle('active');
    }
}

// Reel Mini Game Variables
let reelGameActive = false;
let reelTimer = 6; // Lebih cepat: 6 detik
let reelInterval = null;
let fishZoneInterval = null;
let cursorPosition = 50;
let fishZonePosition = 0;
let fishZoneWidth = 25; // Zona lebih besar
let catchSuccess = false;
let currentFishToCatch = null;
let cursorVelocity = 0; // Untuk smooth movement
let cursorAnimationFrame = null;

// Start Fishing
function startFishing() {
    if (!checkLakeAccess()) {
        alert('Lake is only accessible during 12-3 PM and 6-11:59 PM!');
        return;
    }
    
    currentFishToCatch = determineFish();
    
    if (!currentFishToCatch) {
        showFishingResult(false, null, 'No fish in this area...');
        return;
    }
    
    const currentRod = FishingData.rods[FishingData.currentRod];
const totalWeight = currentRod.weight + getConsumableBonus('weight');
if (currentFishToCatch.weight > totalWeight) {
    showFishingResult(false, currentFishToCatch, 'Fish too heavy for your rod!');
    return;
}
    
    startReelGame();
}

// Determine Fish Based on RNG and Luck (FULL UPDATE with all events)
function determineFish() {
    const luck = getTotalLuck();
    const roll = Math.random() * 100;
    const events = getCurrentEvents();
    
    const bloodmoonActive = events.some(e => e.type === 'bloodmoon');
    const dewfallActive = events.some(e => e.type === 'dewfall');
    const midnightActive = events.some(e => e.type === 'midnight');
    const spookyActive = events.some(e => e.type === 'spooky');
    const starfallActive = events.some(e => e.type === 'starfall');
    
    // ========== STARFALL EVENT ULTRA RARE CHECK (1:10M) ==========
    if (starfallActive) {
        const hawkRoll = Math.random();
        if (hawkRoll < 1 / 10000000) {
            const hawk = FishingData.fishTypes.find(f => f.name === 'Hawk Fish');
            if (hawk) {
                alert('ü¶Ö‚ú® MEGA ULTRA RARE! ü¶Ö‚ú®\n\nYOU CAUGHT THE LEGENDARY HAWK FISH!\n\nChance: 1 in 10 MILLION!\n\nThis is the rarest fish in the game!');
                return hawk;
            }
        }
    }
    
    // ========== BLOODMOON EVENT ULTRA RARE CHECKS ==========
    if (bloodmoonActive) {
        // Bloodmoon Whale check (1 in 6 million)
        const whaleRoll = Math.random();
        if (whaleRoll < 1 / 6000000) {
            const whale = FishingData.fishTypes.find(f => f.name === 'Bloodmoon Whale');
            if (whale) {
                alert('üåëüêã ULTRA MEGA RARE! üåëüêã\n\nYOU CAUGHT THE LEGENDARY BLOODMOON WHALE!\n\nChance: 1 in 6 MILLION!');
                return whale;
            }
        }
        
        // Bloodmoon regular fish check (1 in 500k)
        const bloodmoonFishRoll = Math.random();
        if (bloodmoonFishRoll < 1 / 500000) {
            const bloodmoonFish = FishingData.fishTypes.filter(f => f.bloodmoonFish === true);
            if (bloodmoonFish.length > 0) {
                const selectedFish = bloodmoonFish[Math.floor(Math.random() * bloodmoonFish.length)];
                alert('üî¥ BLOODMOON FISH! üî¥\n\nYou caught a rare Bloodmoon fish!\n\nChance: 1 in 500,000!');
                return selectedFish;
            }
        }
    }
    
    // ========== SPOOKY NIGHT EVENT ULTRA RARE CHECKS ==========
    if (spookyActive) {
        // Zombie Megalodon (1 in 4 million)
        const zombieRoll = Math.random();
        if (zombieRoll < 1 / 4000000) {
            const zombie = FishingData.fishTypes.find(f => f.name === 'Zombie Megalodon');
            if (zombie) {
                alert('üßüü¶à ULTRA RARE! üßüü¶à\n\nYOU CAUGHT THE ZOMBIE MEGALODON!\n\nChance: 1 in 4 MILLION!');
                return zombie;
            }
        }
        
        // Spooky Fish (1 in 800k)
        const spookyFishRoll = Math.random();
        if (spookyFishRoll < 1 / 800000) {
            const spookyFish = FishingData.fishTypes.find(f => f.name === 'Spooky Fish');
            if (spookyFish) {
                alert('üëª LEGENDARY CATCH! üëª\n\nSpooky Fish caught!\n\nChance: 1 in 800,000!');
                return spookyFish;
            }
        }
        
        // Lantern Fish (1 in 500k)
        const lanternRoll = Math.random();
        if (lanternRoll < 1 / 500000) {
            const lantern = FishingData.fishTypes.find(f => f.name === 'Lantern Fish');
            if (lantern) {
                alert('üèÆ LEGENDARY CATCH! üèÆ\n\nLantern Fish caught!\n\nChance: 1 in 500,000!');
                return lantern;
            }
        }
    }
    
    // ========== REGULAR FISH SELECTION ==========
    // Filter available fish based on active events
    let availableFish = FishingData.fishTypes.filter(fish => {
        // Exclude special event-only fish from regular pool
        if (fish.bloodmoonFish === true) return false;
        if (fish.name === 'Bloodmoon Whale') return false;
        if (fish.name === 'Zombie Megalodon') return false;
        if (fish.name === 'Spooky Fish') return false;
        if (fish.name === 'Lantern Fish') return false;
        if (fish.name === 'Hawk Fish') return false;
        if (fish.milestone) return false;
        
        // Include regular fish (no event requirement)
        if (!fish.event) return true;
        
        // Include event fish only if event is active
        if (fish.event === 'dewfall') return dewfallActive;
        if (fish.event === 'midnight') return midnightActive;
        
        return false;
    });
    
    // ========== DETERMINE RARITY BASED ON LUCK ==========
    let rarity = 'common';
    
    if (roll < 0.5 + (luck * 0.05)) {
        rarity = 'secret';
    } else if (roll < 2 + (luck * 0.15)) {
        rarity = 'mythic';
    } else if (roll < 8 + (luck * 0.3)) {
        rarity = 'legendary';
    } else if (roll < 20 + (luck * 0.5)) {
        rarity = 'epic';
    } else if (roll < 45 + (luck * 0.3)) {
        rarity = 'rare';
    } else {
        rarity = 'common';
    }
    
    // ========== SELECT FISH OF DETERMINED RARITY ==========
    const fishOfRarity = availableFish.filter(f => f.rarity === rarity);
    
    // Fallback to common if no fish of that rarity exists
    if (fishOfRarity.length === 0) {
        const commonFish = availableFish.filter(f => f.rarity === 'common');
        if (commonFish.length === 0) return null;
        return commonFish[Math.floor(Math.random() * commonFish.length)];
    }
    
    // Return random fish of the determined rarity
    return fishOfRarity[Math.floor(Math.random() * fishOfRarity.length)];
}

// Start Reel Mini Game
function startReelGame() {
    reelGameActive = true;
    reelTimer = 6; // 6 detik
    cursorPosition = 50;
    cursorVelocity = 0;
    fishZonePosition = Math.random() * 60 + 15;
    fishZoneWidth = 22 + Math.random() * 15;
    catchSuccess = false;
    
    const overlay = document.getElementById('reelGameOverlay');
    const fishZone = document.getElementById('fishZone');
    const cursor = document.getElementById('reelCursor');
    const timerElement = document.getElementById('reelTimer');
    
    // PENTING: Set timer display DULU sebelum show overlay
    timerElement.textContent = reelTimer; // Set ke 6
    
    // Show overlay
    overlay.classList.add('active');
    
    // Set initial positions
    fishZone.style.left = fishZonePosition + '%';
    fishZone.style.width = fishZoneWidth + '%';
    cursor.style.left = cursorPosition + '%';
    
    // Start timer countdown
    reelInterval = setInterval(() => {
        reelTimer--;
        timerElement.textContent = reelTimer;
        
        if (reelTimer <= 0) {
            endReelGame(catchSuccess);
        }
    }, 1000);
    
    // Move fish zone
    fishZoneInterval = setInterval(() => {
        fishZonePosition = Math.random() * (100 - fishZoneWidth - 10) + 5;
        fishZone.style.left = fishZonePosition + '%';
    }, 800);
    
    // Start smooth cursor animation
    startCursorAnimation();
    
    // Add tap button event
    document.getElementById('tapReelBtn').onclick = tapReel;
    
    // Keyboard support
    document.onkeydown = (e) => {
        if (reelGameActive && (e.code === 'Space' || e.code === 'Enter')) {
            e.preventDefault();
            tapReel();
        }
    };
    
    checkCatchSuccess();
}

function tapReel() {
    if (!reelGameActive) return;
    
    // Tentukan arah berdasarkan posisi fish zone
    const fishCenter = fishZonePosition + (fishZoneWidth / 2);
    const direction = fishCenter > cursorPosition ? 1 : -1;
    
    // Tambahkan velocity (impulse)
    cursorVelocity += direction * 12; // Impulse lebih kuat
    
    // Clamp velocity
    cursorVelocity = Math.max(-25, Math.min(25, cursorVelocity));
}

// Smooth Cursor Animation Loop
function startCursorAnimation() {
    const cursor = document.getElementById('reelCursor');
    
    function animate() {
        if (!reelGameActive) {
            cancelAnimationFrame(cursorAnimationFrame);
            return;
        }
        
        // Apply velocity to position
        cursorPosition += cursorVelocity * 0.15; // Smooth movement
        
        // Apply friction (deceleration)
        cursorVelocity *= 0.92; // Friction
        
        // Bounce off edges
        if (cursorPosition <= 3) {
            cursorPosition = 3;
            cursorVelocity = Math.abs(cursorVelocity) * 0.5; // Bounce
        }
        if (cursorPosition >= 97) {
            cursorPosition = 97;
            cursorVelocity = -Math.abs(cursorVelocity) * 0.5; // Bounce
        }
        
        // Update cursor position
        cursor.style.left = cursorPosition + '%';
        
        // Check if in zone
        checkCatchSuccess();
        
        // Continue animation
        cursorAnimationFrame = requestAnimationFrame(animate);
    }
    
    cursorAnimationFrame = requestAnimationFrame(animate);
}

// Move Cursor on Tap
function moveCursor() {
    if (!reelGameActive) return;
    
    // Move cursor towards fish zone
    const fishCenter = fishZonePosition + (fishZoneWidth / 2);
    const direction = fishCenter > cursorPosition ? 1 : -1;
    const moveAmount = 15 + Math.random() * 10; // Random movement between 15-25%
    
    cursorPosition += direction * moveAmount;
    cursorPosition = Math.max(5, Math.min(95, cursorPosition)); // Keep within bounds
    
    document.getElementById('reelCursor').style.left = cursorPosition + '%';
    checkCatchSuccess();
}

// Check if cursor is in fish zone
function checkCatchSuccess() {
    const fishStart = fishZonePosition;
    const fishEnd = fishZonePosition + fishZoneWidth;
    const fishZone = document.getElementById('fishZone');
    
    if (cursorPosition >= fishStart && cursorPosition <= fishEnd) {
        if (!catchSuccess) {
            catchSuccess = true;
            fishZone.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
            fishZone.style.boxShadow = '0 0 20px rgba(46, 204, 113, 0.8)';
        }
    } else {
        if (catchSuccess) {
            catchSuccess = false;
            fishZone.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
            fishZone.style.boxShadow = 'none';
        }
    }
}

// End Reel Game
function endReelGame(success) {
    reelGameActive = false;
    clearInterval(reelInterval);
    clearInterval(fishZoneInterval);
    cancelAnimationFrame(cursorAnimationFrame);
    
    // Remove keyboard listener
    document.onkeydown = null;
    
    const overlay = document.getElementById('reelGameOverlay');
    overlay.classList.remove('active');
    
    // Reset fish zone style
    const fishZone = document.getElementById('fishZone');
    fishZone.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
    fishZone.style.boxShadow = 'none';
    
    if (success && currentFishToCatch) {
        // Calculate random weight
        const weight = Math.random() * (currentFishToCatch.maxWeight - currentFishToCatch.minWeight) + currentFishToCatch.minWeight;
        const fishCopy = {
            ...currentFishToCatch,
            weight: parseFloat(weight.toFixed(1))
        };
        
        addLog(
        LOG_TYPES.CATCH,
        `Caught ${fishCopy.name}`,
        `${fishCopy.emoji} Weight: ${fishCopy.weight}kg | Rarity: ${fishCopy.rarity.toUpperCase()}`,
        fishCopy.emoji
    );
        
        // Add fish to inventory
        FishingData.caughtFish.push(fishCopy);
        
        // Track total weight
        if (!FishingData.stats) {
            FishingData.stats = { totalGoldEarned: 0, totalWeight: 0 };
        }
        FishingData.stats.totalWeight += fishCopy.weight;
        
        // Update weight milestones
        FishingData.milestoneList.forEach(milestone => {
            if (milestone.type === 'total_weight') {
                const milestoneData = FishingData.milestones[milestone.id];
                if (milestoneData && !milestoneData.claimed) {
                    milestoneData.progress = Math.floor(FishingData.stats.totalWeight);
                }
            }
        });
        
        // Update other milestones
        updateMilestoneProgress(fishCopy);
        saveFishingData();
        
        showFishingResult(true, fishCopy);
        
        // Check completed milestones
        const completedMilestones = checkCompletedMilestones();
        if (completedMilestones.length > 0) {
            setTimeout(() => {
                alert(`üèÜ You have ${completedMilestones.length} milestone(s) ready to claim!\nCheck the Milestones tab!`);
            }, 2000);
        }
    } else {
        showFishingResult(false, currentFishToCatch, 'The fish got away...');
    }
}

// Show Fishing Result
function showFishingResult(success, fish, message = '') {
    if (success && fish) {
        const events = getCurrentEvents();
        let displayName = fish.name;
        
        // Add "Spooky" prefix during Spooky event (except for already spooky fish)
        if (events.some(e => e.type === 'spooky') && !fish.event && !fish.name.includes('Spooky')) {
            displayName = 'Spooky ' + fish.name;
        }
        
        let bonusText = '';
        if (events.length > 0) {
            bonusText = '\n\nActive Events:\n';
            events.forEach(event => {
                bonusText += `${event.icon} ${event.name}\n`;
            });
        }
        
        // Show active consumable effects
        const activeEffects = getActiveEffects();
        if (activeEffects.length > 0) {
            bonusText += '\nüß™ Active Potions:\n';
            activeEffects.forEach(effect => {
                bonusText += `${effect.emoji} ${effect.name}\n`;
            });
        }
        
        alert(`üé£ FISH CAUGHT! üé£\n\n${fish.emoji} ${displayName}\n‚öñÔ∏è Weight: ${fish.weight}kg\nüè∑Ô∏è Rarity: ${fish.rarity.toUpperCase()}${bonusText}`);
    } else {
        alert(`üé£ Fishing Result\n\n${message || 'Better luck next time!'}`);
    }
    
    setTimeout(() => { initFisherLake(); }, 100);
}

console.log('üß™ Consumable System Loaded!');
console.log('üëª Spooky Night Event Loaded!');
console.log('‚≠ê Starfall Event Loaded!');

// ========== MODAL FUNCTIONS ==========

// Open Fish Inventory
function openFishInventory() {
    const modal = document.getElementById('fishInventoryModal');
    const content = document.getElementById('fishInventoryContent');
    
    if (FishingData.caughtFish.length === 0) {
        content.innerHTML = '<p style="text-align: center; color: #bbb;">No fish caught yet. Go fishing! üé£</p>';
    } else {
        let inventoryHtml = '<div class="fish-inventory-grid">';
        
        // Group fish by type and count them
        const fishGroups = {};
        FishingData.caughtFish.forEach(fish => {
            const key = fish.name;
            if (!fishGroups[key]) {
                fishGroups[key] = {
                    ...fish,
                    count: 0,
                    totalWeight: 0
                };
            }
            fishGroups[key].count++;
            fishGroups[key].totalWeight += fish.weight;
        });
        
        Object.values(fishGroups).forEach(fishGroup => {
            inventoryHtml += `
                <div class="fish-item ${fishGroup.rarity}">
                    <div class="fish-emoji">${fishGroup.emoji}</div>
                    <div style="font-size: 0.9em; margin-bottom: 5px;">${fishGroup.name}</div>
                    <div class="fish-weight">Count: ${fishGroup.count}</div>
                    <div class="fish-weight">Total: ${fishGroup.totalWeight.toFixed(1)}kg</div>
                    <div class="fish-rarity">${fishGroup.rarity}</div>
                </div>
            `;
        });
        
        inventoryHtml += '</div>';
        content.innerHTML = inventoryHtml;
    }
    
    modal.classList.add('active');
}

// Close Fish Inventory
function closeFishInventory() {
    document.getElementById('fishInventoryModal').classList.remove('active');
}

// Open Sell Fish - WITH GOLD & EXP DISPLAY
function openSellFish() {
    const modal = document.getElementById('sellFishModal');
    const content = document.getElementById('sellFishContent');
    
    if (FishingData.caughtFish.length === 0) {
        content.innerHTML = '<p style="text-align: center; color: #bbb;">No fish to sell. Go fishing first! üé£</p>';
        modal.classList.add('active');
        return;
    }
    
    // Group fish by type
    const fishGroups = {};
    
    FishingData.caughtFish.forEach((fish, index) => {
        const key = fish.name;
        
        if (!fishGroups[key]) {
            fishGroups[key] = {
                emoji: fish.emoji || 'üêü',
                name: fish.name || 'Unknown Fish',
                rarity: fish.rarity || 'common',
                count: 0,
                totalGold: 0,
                totalExp: 0
            };
        }
        
        fishGroups[key].count++;
        
        // Calculate individual fish value
        try {
            const rarity = fish.rarity || 'common';
            const basePrice = FishingData.rarityPrices[rarity];
            
            if (basePrice && basePrice.gold && basePrice.exp) {
                const priceData = getFishPriceMultiplier(fish);
                
                let multiplier = 1;
                let bonusGold = 0;
                
                if (priceData) {
                    multiplier = priceData.multiplier || 1;
                    bonusGold = priceData.bonusGold || 0;
                }
                
                // Calculate gold and exp
                const fishGold = Math.floor((basePrice.gold * multiplier) + bonusGold);
                const fishExp = Math.floor(basePrice.exp * multiplier);
                
                if (!isNaN(fishGold) && fishGold >= 0) {
                    fishGroups[key].totalGold += fishGold;
                } else {
                    fishGroups[key].totalGold += basePrice.gold;
                }
                
                if (!isNaN(fishExp) && fishExp >= 0) {
                    fishGroups[key].totalExp += fishExp;
                } else {
                    fishGroups[key].totalExp += basePrice.exp;
                }
            } else {
                console.warn('No base price for rarity:', rarity);
                fishGroups[key].totalGold += 20;
                fishGroups[key].totalExp += 20;
            }
        } catch (error) {
            console.error('Error calculating fish value:', error);
            fishGroups[key].totalGold += 20;
            fishGroups[key].totalExp += 20;
        }
    });
    
    // Calculate total values for "Sell All" button
    let totalAllGold = 0;
    let totalAllExp = 0;
    Object.values(fishGroups).forEach(group => {
        totalAllGold += group.totalGold;
        totalAllExp += group.totalExp;
    });
    
    let sellHtml = '<div style="margin-bottom: 20px;">';
    sellHtml += `
        <button class="menu-button" onclick="sellAllFish()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); width: 100%; padding: 15px; font-size: 1em;">
            üí∞ Sell All Fish
            <div style="font-size: 0.85em; margin-top: 5px; opacity: 0.9;">
                üí∞ +${totalAllGold} Gold | ‚≠ê +${totalAllExp} EXP
            </div>
        </button>
    `;
    sellHtml += '</div>';
    
    // Active events info
    const events = getCurrentEvents();
    if (events.length > 0) {
        sellHtml += '<div style="background: rgba(52, 152, 219, 0.1); border: 2px solid rgba(52, 152, 219, 0.3); border-radius: 10px; padding: 10px; margin-bottom: 15px;">';
        sellHtml += '<div style="font-weight: bold; margin-bottom: 5px;">üéâ Active Events:</div>';
        events.forEach(event => {
            sellHtml += `<div style="font-size: 0.85em; color: #bbb;">${event.icon} ${event.name}</div>`;
        });
        sellHtml += '</div>';
    }
    
    sellHtml += '<div class="fish-inventory-grid">';
    
    Object.values(fishGroups).forEach(fishGroup => {
        const displayGold = Math.max(0, fishGroup.totalGold || 0);
        const displayExp = Math.max(0, fishGroup.totalExp || 0);
        
        sellHtml += `
            <div class="fish-item ${fishGroup.rarity}">
                <div class="fish-emoji">${fishGroup.emoji}</div>
                <div style="font-size: 0.9em; margin-bottom: 5px; font-weight: bold;">${fishGroup.name}</div>
                <div class="fish-weight">üêü Count: ${fishGroup.count}</div>
                <div class="fish-rarity" style="margin: 8px 0;">${fishGroup.rarity.toUpperCase()}</div>
                <div style="background: rgba(255, 255, 255, 0.05); padding: 8px; border-radius: 6px; margin: 8px 0; font-size: 0.85em;">
                    <div style="color: #f39c12;">üí∞ ${displayGold} Gold</div>
                    <div style="color: #3498db;">‚≠ê ${displayExp} EXP</div>
                </div>
                <button 
                    onclick="sellFishGroup('${fishGroup.name.replace(/'/g, "\\'")}')" 
                    style="
                        margin-top: 5px; 
                        padding: 8px 12px; 
                        font-size: 0.8em; 
                        background: linear-gradient(135deg, #2ecc71, #27ae60); 
                        border: none; 
                        color: white; 
                        border-radius: 6px; 
                        cursor: pointer;
                        width: 100%;
                        font-weight: bold;
                        transition: transform 0.2s;
                    "
                    onmouseover="this.style.transform='scale(1.05)'"
                    onmouseout="this.style.transform='scale(1)'"
                >
                    üí∞ SELL
                </button>
            </div>
        `;
    });
    
    sellHtml += '</div>';
    content.innerHTML = sellHtml;
    modal.classList.add('active');
}

// Sell Fish Group - FULL DEBUG VERSION
function sellFishGroup(fishName) {
    const fishToSell = FishingData.caughtFish.filter(fish => fish.name === fishName);
    
    if (fishToSell.length === 0) {
        alert('‚ùå No fish found with that name!');
        return;
    }
    
    let totalGold = 0;
    let totalExp = 0;
    
    fishToSell.forEach(fish => {
        if (!fish.rarity) {
            console.error('‚ùå Fish missing rarity:', fish);
            return;
        }
        
        const basePrice = FishingData.rarityPrices[fish.rarity];
        if (!basePrice) {
            console.error('‚ùå No price found for rarity:', fish.rarity);
            return;
        }
        
        let priceData = getFishPriceMultiplier(fish);
        if (!priceData || typeof priceData.multiplier !== 'number') {
            priceData = { multiplier: 1, bonusGold: 0 };
        }
        
        const goldEarned = Math.floor((basePrice.gold * priceData.multiplier) + (priceData.bonusGold || 0));
        const expEarned = Math.floor(basePrice.exp * priceData.multiplier);
        
        totalGold += goldEarned;
        totalExp += expEarned;
    });
    
    if (isNaN(totalGold) || isNaN(totalExp)) {
        console.error('‚ùå NaN detected!', { totalGold, totalExp });
        alert('‚ùå Error calculating fish value! Check console.');
        return;
    }
    
    // Remove sold fish
    FishingData.caughtFish = FishingData.caughtFish.filter(fish => fish.name !== fishName);
    
    // Add to player stats
    gameState.player.gold = (gameState.player.gold || 0) + totalGold;
    gameState.player.exp = (gameState.player.exp || 0) + totalExp;
    
    // ========== FIX: TRACK GOLD EARNED ==========
    // Initialize stats if not exists
    if (!FishingData.stats) {
        FishingData.stats = { totalGoldEarned: 0, totalWeight: 0 };
    }
    
    // Add gold to total earned
    FishingData.stats.totalGoldEarned += totalGold;
    
    // Update gold_earned milestones
    FishingData.milestoneList.forEach(milestone => {
        if (milestone.type === 'gold_earned') {
            const milestoneData = FishingData.milestones[milestone.id];
            if (milestoneData && !milestoneData.claimed) {
                milestoneData.progress = FishingData.stats.totalGoldEarned;
            }
        }
    });
    
    console.log('üí∞ Gold earned updated:', FishingData.stats.totalGoldEarned);
    // ========== END FIX ==========
    
    saveFishingData();
    if (typeof saveGameState === 'function') saveGameState();
    if (typeof checkLevelUp === 'function') checkLevelUp();
    
    alert(`üí∞ Fish Sold!\n\n${fishToSell[0].emoji} ${fishName} x${fishToSell.length}\nüí∞ +${totalGold} Gold\n‚≠ê +${totalExp} EXP\n\nüìä Total Gold Earned: ${FishingData.stats.totalGoldEarned}`);
    
    addLog(
        LOG_TYPES.SELL,
        `Sold ${fishName} x${fishToSell.length}`,
        `üí∞ +${totalGold} Gold | ‚≠ê +${totalExp} EXP`,
        fishToSell[0].emoji
    );
    
    openSellFish();
}

// Sell All Fish - FULL DEBUG VERSION
function sellAllFish() {
    if (FishingData.caughtFish.length === 0) {
        alert('No fish to sell!');
        return;
    }
    
    let totalGold = 0;
    let totalExp = 0;
    let fishCount = FishingData.caughtFish.length;
    
    FishingData.caughtFish.forEach(fish => {
        if (!fish.rarity) {
            console.error('‚ùå Fish missing rarity:', fish);
            return;
        }
        
        const basePrice = FishingData.rarityPrices[fish.rarity];
        if (!basePrice) {
            console.error('‚ùå No price found for rarity:', fish.rarity);
            return;
        }
        
        let priceData = getFishPriceMultiplier(fish);
        if (!priceData || typeof priceData.multiplier !== 'number') {
            priceData = { multiplier: 1, bonusGold: 0 };
        }
        
        const goldEarned = Math.floor((basePrice.gold * priceData.multiplier) + (priceData.bonusGold || 0));
        const expEarned = Math.floor(basePrice.exp * priceData.multiplier);
        
        totalGold += goldEarned;
        totalExp += expEarned;
    });
    
    if (isNaN(totalGold) || isNaN(totalExp)) {
        console.error('‚ùå NaN detected!', { totalGold, totalExp });
        alert('‚ùå Error calculating fish value! Check console.');
        return;
    }
    
    // Clear all fish
    FishingData.caughtFish = [];
    
    // Add to player stats
    gameState.player.gold = (gameState.player.gold || 0) + totalGold;
    gameState.player.exp = (gameState.player.exp || 0) + totalExp;
    
    // ========== FIX: TRACK GOLD EARNED ==========
    // Initialize stats if not exists
    if (!FishingData.stats) {
        FishingData.stats = { totalGoldEarned: 0, totalWeight: 0 };
    }
    
    // Add gold to total earned
    FishingData.stats.totalGoldEarned += totalGold;
    
    // Update gold_earned milestones
    FishingData.milestoneList.forEach(milestone => {
        if (milestone.type === 'gold_earned') {
            const milestoneData = FishingData.milestones[milestone.id];
            if (milestoneData && !milestoneData.claimed) {
                milestoneData.progress = FishingData.stats.totalGoldEarned;
            }
        }
    });
    
    console.log('üí∞ Gold earned updated:', FishingData.stats.totalGoldEarned);
    // ========== END FIX ==========
    
    saveFishingData();
    if (typeof saveGameState === 'function') saveGameState();
    if (typeof checkLevelUp === 'function') checkLevelUp();
    
    alert(`üí∞ All Fish Sold!\n\nüêü Sold ${fishCount} fish\nüí∞ +${totalGold} Gold\n‚≠ê +${totalExp} EXP\n\nüìä Total Gold Earned: ${FishingData.stats.totalGoldEarned}`);
    
    addLog(
        LOG_TYPES.SELL,
        `Sold All Fish (${fishCount})`,
        `üí∞ +${totalGold} Gold | ‚≠ê +${totalExp} EXP`,
        'üí∞'
    );
    
    closeSellFish();
    initFisherLake();
}

function getFishPriceMultiplier(fish) {
    let multiplier = 1;
    let bonusGold = 0;
    
    if (!fish) return { multiplier: 1, bonusGold: 0 };
    
    const events = getCurrentEvents();
    
    events.forEach(event => {
        if (event.type === 'weekend') {
            multiplier += 0.25;
        }
        if (fish.event === 'dewfall' && event.type === 'dewfall') {
            multiplier += 0.5;
        }
        if (fish.event === 'midnight' && event.type === 'midnight') {
            multiplier += 0.6;
        }
        if (event.type === 'bloodmoon') {
            bonusGold += 100;
            if (fish.bloodmoonFish === true || fish.name === 'Bloodmoon Whale') {
                bonusGold += 200;
            }
        }
        // SPOOKY EVENT: +40 gold to ALL fish
        if (event.type === 'spooky') {
            bonusGold += 40;
        }
    });
    
    // Add consumable gold bonus
    bonusGold += getConsumableBonus('gold');
    
    return { multiplier, bonusGold };
}

// Close Sell Fish
function closeSellFish() {
    document.getElementById('sellFishModal').classList.remove('active');
}

// Open Fish Gear
function openFishGear() {
    const modal = document.getElementById('fishGearModal');
    const content = document.getElementById('fishGearContent');
    
    let gearHtml = '<h3>üé£ Current Rod</h3>';
    const currentRod = FishingData.rods[FishingData.currentRod];
    
    gearHtml += `
        <div class="rod-item" style="border-color: #f39c12; background: rgba(243, 156, 18, 0.1);">
            <div class="rod-info">
                <div class="rod-name">${currentRod.icon} ${currentRod.name} <span class="equipped-badge">EQUIPPED</span></div>
                <div class="rod-stats">üçÄ Luck: ${currentRod.luck}% | ‚öñÔ∏è Max Weight: ${currentRod.weight}kg</div>
            </div>
        </div>
    `;
    
    gearHtml += '<h3 style="margin-top: 30px;">üéí Owned Rods</h3>';
    gearHtml += '<div class="rod-shop-grid">';
    
    FishingData.ownedRods.forEach(rodId => {
        const rod = FishingData.rods[rodId];
        if (rodId === FishingData.currentRod) return; // Skip current rod
        
        gearHtml += `
            <div class="rod-item">
                <div class="rod-info">
                    <div class="rod-name">${rod.icon} ${rod.name}</div>
                    <div class="rod-stats">üçÄ Luck: ${rod.luck}% | ‚öñÔ∏è Max Weight: ${rod.weight}kg</div>
                </div>
                <button onclick="equipRod('${rodId}')" style="background: #3498db; border: none; color: white; padding: 8px 15px; border-radius: 6px; cursor: pointer;">Equip</button>
            </div>
        `;
    });
    
    gearHtml += '</div>';
    content.innerHTML = gearHtml;
    modal.classList.add('active');
}

// Equip Rod
function equipRod(rodId) {
    if (!FishingData.ownedRods.includes(rodId)) {
        alert('‚ùå You don\'t own this rod!');
        return;
    }
    
    FishingData.currentRod = rodId;
    saveFishingData();
    
    const rod = FishingData.rods[rodId];
    alert(`üé£ Equipped ${rod.name}!\n\nüçÄ Luck: ${rod.luck}%\n‚öñÔ∏è Max Weight: ${rod.weight}kg`);
    
    closeFishGear();
    initFisherLake(); // Refresh to show new rod stats
}

// Close Fish Gear
function closeFishGear() {
    document.getElementById('fishGearModal').classList.remove('active');
}

// Open Merchant
function openMerchant() {
    const modal = document.getElementById('fishermanMerchantModal');
    const content = document.getElementById('merchantContent');
    
    let merchantHtml = '<h3>üè™ Fishing Rod Shop</h3>';
    merchantHtml += '<p style="color: #bbb; margin-bottom: 20px;">Upgrade your fishing gear!</p>';
    merchantHtml += '<div class="rod-shop-grid">';
    
    Object.entries(FishingData.rods).forEach(([rodId, rod]) => {
        if (rod.price === 0 && rodId !== 'basic_rod') return; // Skip milestone rewards
        
        const owned = FishingData.ownedRods.includes(rodId);
        const canAfford = gameState.player.gold >= rod.price;
        
        merchantHtml += `
            <div class="rod-item">
                <div class="rod-info">
                    <div class="rod-name">${rod.icon} ${rod.name}</div>
                    <div class="rod-stats">üçÄ Luck: ${rod.luck}% | ‚öñÔ∏è Max Weight: ${rod.weight}kg</div>
                    <div class="rod-stats">üí∞ Price: ${rod.price === 0 ? 'Free' : rod.price + ' Gold'}</div>
                </div>
                <button 
                    onclick="buyRod('${rodId}')" 
                    class="buy-rod-btn"
                    ${owned || !canAfford || rod.price === 0 ? 'disabled' : ''}
                    style="${owned ? 'background: #2ecc71;' : (!canAfford && rod.price > 0) ? 'background: #95a5a6;' : ''}"
                >
                    ${owned ? 'OWNED' : (rod.price === 0 ? 'MILESTONE' : canAfford ? 'BUY' : 'NOT ENOUGH')}
                </button>
            </div>
        `;
    });
    
    merchantHtml += '</div>';
    content.innerHTML = merchantHtml;
    modal.classList.add('active');
}

// Buy Rod
function buyRod(rodId) {
    const rod = FishingData.rods[rodId];
    
    if (FishingData.ownedRods.includes(rodId)) {
        alert('‚ùå You already own this rod!');
        return;
    }
    
    if (gameState.player.gold < rod.price) {
        alert(`‚ùå Not enough gold! Need ${rod.price} gold.`);
        return;
    }
    
    gameState.player.gold -= rod.price;
    FishingData.ownedRods.push(rodId);
    saveFishingData();
    
    alert(`üé£ Purchased ${rod.name}!\n\nüçÄ Luck: ${rod.luck}%\n‚öñÔ∏è Max Weight: ${rod.weight}kg\n\nCheck your gear to equip it!`);
    
    addLog(
        LOG_TYPES.BUY_ROD,
        `Bought ${rod.name}`,
        `${rod.icon} Luck: ${rod.luck}% | Weight: ${rod.weight}kg | üí∞ -${rod.price} Gold`,
        rod.icon
    );
    
    // Refresh merchant
    openMerchant();
}

// Close Merchant
function closeMerchant() {
    document.getElementById('fishermanMerchantModal').classList.remove('active');
}

// Auto-refresh lake access every minute
setInterval(() => {
    if (currentScreen === 'fisherLakeScreen') {
        initFisherLake();
    }
}, 60000);

// ========== INITIALIZATION ==========

// Initialize Fisher Lake when screen is shown
function showScreen(screenId) {
    // Hide all screens
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });
    
    // Show selected screen
    const targetScreen = document.getElementById(screenId);
    if (targetScreen) {
        targetScreen.classList.add('active');
        currentScreen = screenId;
        
        // Initialize Fisher Lake if it's being shown
        if (screenId === 'fisherLakeScreen') {
            initFisherLake();
        }
    }
}

console.log('üé£ Fisher Lake System Loaded Successfully! üé£');

// ========== FISHER LAKE NAVIGATION (FIXED) ==========

// Navigate to Fisher Lake (konsisten dengan nav button lain)
function navigateToFisherLake() {
    console.log('üé£ Navigating to Fisher Lake...');
    
    try {
        // Hide all screens (remove active class)
        document.querySelectorAll('.screen').forEach(s => {
            s.classList.remove('active');
        });
        
        // Show Fisher Lake screen
        const fisherScreen = document.getElementById('fisherLakeScreen');
        if (fisherScreen) {
            fisherScreen.classList.add('active');
            
            // Initialize Fisher Lake
            initFisherLake();
            
            console.log('‚úÖ Fisher Lake loaded!');
        } else {
            console.error('‚ùå Fisher Lake screen not found!');
            alert('Error: Fisher Lake screen not found. Please check your HTML.');
        }
    } catch (error) {
        console.error('‚ùå Error navigating to Fisher Lake:', error);
    }
}

// Update showScreen function (optional, untuk kompatibilitas)
function showScreen(screenId) {
    console.log(`üì± Showing screen: ${screenId}`);
    
    // Hide all screens
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });
    
    // Show target screen
    const targetScreen = document.getElementById(screenId);
    if (targetScreen) {
        targetScreen.classList.add('active');
        
        // Initialize screen-specific content
        switch(screenId) {
            case 'fisherLakeScreen':
                initFisherLake();
                break;
            case 'mainScreen':
                if (typeof updateMainScreen === 'function') updateMainScreen();
                break;
            case 'upgradeScreen':
                if (typeof updateUpgradeScreen === 'function') updateUpgradeScreen();
                break;
            case 'achievementScreen':
                if (typeof updateAchievementScreen === 'function') updateAchievementScreen();
                break;
            case 'skillScreen':
                if (typeof updateSkillScreen === 'function') updateSkillScreen();
                break;
            case 'settingsScreen':
                if (typeof updateSettingsScreen === 'function') updateSettingsScreen();
                break;
            case 'questScreen':
                if (typeof updateQuestScreen === 'function') updateQuestScreen();
                break;
            case 'shopScreen':
                if (typeof updateShopScreen === 'function') updateShopScreen();
                break;
        }
        
        console.log(`‚úÖ Screen ${screenId} loaded!`);
    } else {
        console.error(`‚ùå Screen ${screenId} not found!`);
    }
}
</script>

<style>
.gambling-container {
    max-width: 500px;
    margin: 0 auto;
}

.gambling-tabs {
    display: flex;
    margin-bottom: 20px;
    background: rgba(0,0,0,0.3);
    border-radius: 12px;
    padding: 5px;
}

.tab-btn {
    flex: 1;
    background: none;
    border: none;
    color: #888;
    padding: 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: bold;
}

.tab-btn.active {
    background: var(--primary-color);
    color: white;
    box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.gamble-section {
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    backdrop-filter: blur(10px);
}

.gamble-input-group {
    display: flex;
    gap: 10px;
    align-items: center;
    margin: 15px 0;
    max-width: 100%; /* Pastikan tidak melebihi lebar container */
}

.gamble-input {
    flex: 1;
    background: rgba(0,0,0,0.4);
    border: 2px solid rgba(255,255,255,0.1);
    color: white;
    padding: 12px;
    border-radius: 8px;
    font-size: 1em;
    min-width: 0; /* Memungkinkan input untuk menyusut */
}

.gamble-input:focus {
    border-color: var(--secondary-color);
    outline: none;
    box-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
}

.gamble-btn {
    background: linear-gradient(135deg, #e94560 0%, #f2709c 100%);
    border: none;
    color: white;
    padding: 8px 12px; /* Dikecilkan lagi untuk muat dalam area */
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.85em; /* Dikecilkan font sedikit lagi */
    transition: all 0.3s ease;
    white-space: nowrap; /* Mencegah text wrap */
    flex-shrink: 0; /* Button tidak akan menyusut */
}

.gamble-btn:active {
    transform: scale(0.95);
}

.skill-point-btns {
    display: flex;
    gap: 10px;
}

.sp-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    flex: 1;
    transition: all 0.3s ease;
}

.sp-btn:active {
    transform: scale(0.95);
}

.milestone-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin: 20px 0;
}

.milestone-card {
    background: rgba(255,255,255,0.05);
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    position: relative;
    backdrop-filter: blur(10px);
}

.milestone-card.claimed {
    border-color: #2ecc71;
    background: rgba(46, 204, 113, 0.1);
}

.milestone-card.available {
    border-color: var(--secondary-color);
    background: rgba(78, 205, 196, 0.1);
    animation: milestoneGlow 2s ease-in-out infinite;
}

@keyframes milestoneGlow {
    0%, 100% { box-shadow: 0 0 10px rgba(78, 205, 196, 0.3); }
    50% { box-shadow: 0 0 20px rgba(78, 205, 196, 0.6); }
}

.milestone-progress {
    background: rgba(0,0,0,0.4);
    border-radius: 10px;
    height: 8px;
    margin: 10px 0;
    overflow: hidden;
}

.milestone-progress-fill {
    background: linear-gradient(90deg, var(--secondary-color), #2ecc71);
    height: 100%;
    border-radius: 10px;
    transition: width 0.3s ease;
}

.gambling-stats {
    background: rgba(0,0,0,0.3);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 20px;
    text-align: center;
}

.result-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.95);
    padding: 20px;
    border-radius: 15px;
    z-index: 1001;
    text-align: center;
    border: 2px solid var(--secondary-color);
    display: none;
}

.claim-btn {
    background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 10px;
    transition: all 0.3s ease;
}

.claim-btn:active {
    transform: scale(0.95);
}

.claim-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}
</style>

<!-- HTML Screen -->
<div id="gamblingScreen" class="screen">
    <h1 class="main-title">üé∞ Gambling Den</h1>
    
    <div class="gambling-container">
        <div class="gambling-stats">
            <div style="font-size: 1.2em; margin-bottom: 10px;">üìä Gambling Stats</div>
            <div>Successful Gambles: <span id="successfulGambles">0</span></div>
            <div>Total Milestone Progress: <span id="milestoneProgress">0</span></div>
        </div>

        <div class="gambling-tabs">
            <button class="tab-btn active" onclick="switchGamblingTab('gamble')">üé≤ Gamble</button>
            <button class="tab-btn" onclick="switchGamblingTab('milestone')">üèÜ Milestone</button>
        </div>

        <div id="gambleTab" class="tab-content active">
            <div class="gamble-section">
                <h3 style="text-align: center; margin-bottom: 15px;">üí∞ Gold Gamble</h3>
                <p style="font-size: 0.9em; color: #bbb; margin-bottom: 15px;">Minimum: 100 Gold | 50% chance to win +50% or lose -50%</p>
                <div class="gamble-input-group">
                    <input type="number" id="goldGambleInput" class="gamble-input" placeholder="Enter gold amount" min="100">
                    <button class="gamble-btn" onclick="gambleResource('gold')">Gamble</button>
                </div>
            </div>

            <div class="gamble-section">
                <h3 style="text-align: center; margin-bottom: 15px;">‚≠ê EXP Gamble</h3>
                <p style="font-size: 0.9em; color: #bbb; margin-bottom: 15px;">Minimum: 100 EXP | 50% chance to win +50% or lose -50%</p>
                <div class="gamble-input-group">
                    <input type="number" id="expGambleInput" class="gamble-input" placeholder="Enter EXP amount" min="100">
                    <button class="gamble-btn" onclick="gambleResource('exp')">Gamble</button>
                </div>
            </div>

            <div class="gamble-section">
                <h3 style="text-align: center; margin-bottom: 15px;">üîÆ Skill Points Gamble</h3>
                <p style="font-size: 0.9em; color: #bbb; margin-bottom: 15px;">Fixed amounts | 50% chance to win +50% or lose -50%</p>
                <div class="skill-point-btns">
                    <button class="sp-btn" onclick="gambleSkillPoints(10)">Gamble 10 SP</button>
                    <button class="sp-btn" onclick="gambleSkillPoints(20)">Gamble 20 SP</button>
                </div>
            </div>
        </div>

        <div id="milestoneTab" class="tab-content">
            <div class="milestone-grid">
                <div class="milestone-card" id="milestone25">
                    <div style="font-size: 2em;">ü•â</div>
                    <div style="font-weight: bold; margin: 10px 0;">25 Successful Gambles</div>
                    <div style="color: #f39c12;">Reward: 150 Gold</div>
                    <div class="milestone-progress">
                        <div class="milestone-progress-fill" id="progress25" style="width: 0%"></div>
                    </div>
                    <button class="claim-btn" id="claim25" onclick="claimMilestone(25)" disabled>Claim</button>
                </div>

                <div class="milestone-card" id="milestone50">
                    <div style="font-size: 2em;">ü•à</div>
                    <div style="font-weight: bold; margin: 10px 0;">50 Successful Gambles</div>
                    <div style="color: #3498db;">Reward: 300 EXP</div>
                    <div class="milestone-progress">
                        <div class="milestone-progress-fill" id="progress50" style="width: 0%"></div>
                    </div>
                    <button class="claim-btn" id="claim50" onclick="claimMilestone(50)" disabled>Claim</button>
                </div>

                <div class="milestone-card" id="milestone75">
                    <div style="font-size: 2em;">ü•á</div>
                    <div style="font-weight: bold; margin: 10px 0;">75 Successful Gambles</div>
                    <div style="color: #4ecdc4;">Reward: 8 Skill Points</div>
                    <div class="milestone-progress">
                        <div class="milestone-progress-fill" id="progress75" style="width: 0%"></div>
                    </div>
                    <button class="claim-btn" id="claim75" onclick="claimMilestone(75)" disabled>Claim</button>
                </div>

                <div class="milestone-card" id="milestone100">
                    <div style="font-size: 2em;">üëë</div>
                    <div style="font-weight: bold; margin: 10px 0;">100 Successful Gambles</div>
                    <div style="color: #e74c3c;">Reward: 300 Gold, 600 EXP, 12 SP</div>
                    <div class="milestone-progress">
                        <div class="milestone-progress-fill" id="progress100" style="width: 0%"></div>
                    </div>
                    <button class="claim-btn" id="claim100" onclick="claimMilestone(100)" disabled>Claim</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="gamblingResult" class="result-popup">
    <div id="resultContent"></div>
    <button onclick="closeResultPopup()" class="claim-btn">Close</button>
</div>

<!-- JavaScript -->
<script>
// Gambling system
let gamblingData = {
    successfulGambles: parseInt(localStorage.getItem('successfulGambles')) || 0,
    claimedMilestones: JSON.parse(localStorage.getItem('claimedMilestones')) || []
};

function switchGamblingTab(tab) {
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    if (tab === 'gamble') {
        document.querySelector('.tab-btn').classList.add('active');
        document.getElementById('gambleTab').classList.add('active');
    } else {
        document.querySelectorAll('.tab-btn')[1].classList.add('active');
        document.getElementById('milestoneTab').classList.add('active');
    }
}

function gambleResource(type) {
    let amount, inputId;
    
    if (type === 'gold') {
        amount = parseInt(document.getElementById('goldGambleInput').value);
        inputId = 'goldGambleInput';
    } else if (type === 'exp') {
        amount = parseInt(document.getElementById('expGambleInput').value);
        inputId = 'expGambleInput';
    }
    
    // Validasi input kosong atau tidak valid
    if (!amount || isNaN(amount) || amount <= 0) {
        showResult(`‚ùå Please enter a valid ${type} amount!`, false);
        return;
    }
    
    if (amount < 100) {
        showResult(`‚ùå Minimum ${type} amount is 100!`, false);
        return;
    }
    
    if (type === 'gold' && gameState.player.gold < amount) {
        showResult('‚ùå Not enough gold!', false);
        return;
    }
    
    if (type === 'exp' && gameState.player.exp < amount) {
        showResult('‚ùå Not enough EXP!', false);
        return;
    }
    
    // Deduct amount first
    if (type === 'gold') {
        gameState.player.gold -= amount;
    } else {
        gameState.player.exp -= amount;
    }
    
    // 50% chance
    const success = Math.random() < 0.5;
    const changeAmount = Math.floor(amount * 0.5);
    
    if (success) {
        const finalAmount = amount + changeAmount;
        if (type === 'gold') {
            gameState.player.gold += finalAmount;
        } else {
            gameState.player.exp += finalAmount;
        }
        gamblingData.successfulGambles++;
        showResult(`üéâ Success! You won ${changeAmount} ${type}!\nTotal: ${finalAmount} ${type}`, true);
    } else {
        const finalAmount = amount - changeAmount;
        if (type === 'gold') {
            gameState.player.gold += finalAmount;
        } else {
            gameState.player.exp += finalAmount;
        }
        showResult(`üí∏ Failed! You lost ${changeAmount} ${type}!\nTotal: ${finalAmount} ${type}`, false);
    }
    
    document.getElementById(inputId).value = '';
    saveGamblingData();
    updateGamblingDisplay();
    updateDisplay();
}

function gambleSkillPoints(amount) {
    if (gameState.player.skillPoints < amount) {
        showResult('‚ùå Not enough skill points!', false);
        return;
    }
    
    gameState.player.skillPoints -= amount;
    
    const success = Math.random() < 0.5;
    const changeAmount = Math.floor(amount * 0.5);
    
    if (success) {
        const finalAmount = amount + changeAmount;
        gameState.player.skillPoints += finalAmount;
        gamblingData.successfulGambles++;
        showResult(`üéâ Success! You won ${changeAmount} SP!\nTotal: ${finalAmount} SP`, true);
    } else {
        const finalAmount = amount - changeAmount;
        gameState.player.skillPoints += finalAmount;
        showResult(`üí∏ Failed! You lost ${changeAmount} SP!\nTotal: ${finalAmount} SP`, false);
    }
    
    saveGamblingData();
    updateGamblingDisplay();
    updateDisplay();
}

function showResult(message, success) {
    const resultDiv = document.getElementById('resultContent');
    resultDiv.innerHTML = `<div style="font-size: 1.2em; margin-bottom: 15px;">${message}</div>`;
    document.getElementById('gamblingResult').style.display = 'block';
}

function closeResultPopup() {
    document.getElementById('gamblingResult').style.display = 'none';
}

function claimMilestone(milestone) {
    if (gamblingData.claimedMilestones.includes(milestone)) return;
    
    gamblingData.claimedMilestones.push(milestone);
    
    if (milestone === 25) {
        gameState.player.gold += 150;
        showResult('üéâ Milestone Claimed!\n+150 Gold', true);
    } else if (milestone === 50) {
        gameState.player.exp += 300;
        showResult('üéâ Milestone Claimed!\n+300 EXP', true);
    } else if (milestone === 75) {
        gameState.player.skillPoints += 8;
        showResult('üéâ Milestone Claimed!\n+8 Skill Points', true);
    } else if (milestone === 100) {
        gameState.player.gold += 300;
        gameState.player.exp += 600;
        gameState.player.skillPoints += 12;
        showResult('üéâ Ultimate Milestone Claimed!\n+300 Gold, +600 EXP, +12 SP', true);
    }
    
    saveGamblingData();
    updateGamblingDisplay();
    updateDisplay();
}

function updateGamblingDisplay() {
    document.getElementById('successfulGambles').textContent = gamblingData.successfulGambles;
    document.getElementById('milestoneProgress').textContent = gamblingData.successfulGambles;
    
    // Update milestone progress
    const milestones = [25, 50, 75, 100];
    milestones.forEach(milestone => {
        const progress = Math.min(gamblingData.successfulGambles / milestone * 100, 100);
        document.getElementById(`progress${milestone}`).style.width = progress + '%';
        
        const card = document.getElementById(`milestone${milestone}`);
        const claimBtn = document.getElementById(`claim${milestone}`);
        
        if (gamblingData.claimedMilestones.includes(milestone)) {
            card.classList.add('claimed');
            claimBtn.textContent = 'Claimed';
            claimBtn.disabled = true;
        } else if (gamblingData.successfulGambles >= milestone) {
            card.classList.add('available');
            claimBtn.disabled = false;
        }
    });
}

function saveGamblingData() {
    localStorage.setItem('successfulGambles', gamblingData.successfulGambles.toString());
    localStorage.setItem('claimedMilestones', JSON.stringify(gamblingData.claimedMilestones));
}

// Initialize gambling display when page loads
document.addEventListener('DOMContentLoaded', function() {
    updateGamblingDisplay();
});
</script>

<style>
.redeem-container {
    max-width: 500px;
    margin: 40px auto;
    padding: 20px;
}

.redeem-box {
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
    padding: 30px;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(78, 205, 196, 0.3);
    margin-bottom: 20px;
}

.redeem-input {
    width: 100%;
    background: rgba(0,0,0,0.4);
    border: 2px solid rgba(78, 205, 196, 0.5);
    border-radius: 12px;
    padding: 15px;
    font-size: 1.1em;
    color: #fff;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 2px;
    font-weight: bold;
    margin-bottom: 20px;
}

.redeem-input:focus {
    outline: none;
    border-color: var(--secondary-color);
    box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
}

.redeem-input::placeholder {
    color: #666;
    text-transform: none;
    letter-spacing: normal;
}

.redeem-btn {
    width: 100%;
    background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
    border: none;
    color: white;
    padding: 18px;
    font-size: 1.2em;
    font-weight: bold;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
}

.redeem-btn:active {
    transform: scale(0.97);
}

.redeem-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.redeem-info {
    background: rgba(255,255,255,0.03);
    border-radius: 10px;
    padding: 15px;
    margin-top: 20px;
    font-size: 0.9em;
    color: #bbb;
    line-height: 1.6;
}

.redeem-history {
    margin-top: 30px;
}

.history-item {
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 4px solid #2ecc71;
}

.history-code {
    font-weight: bold;
    color: var(--secondary-color);
}

.history-reward {
    font-size: 0.9em;
    color: #f39c12;
}

.weekend-popup {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: 20px;
    animation: fadeIn 0.3s ease;
}

.weekend-popup.active {
    display: flex;
}

.weekend-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    max-width: 400px;
    width: 100%;
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    border: 3px solid #f39c12;
    animation: scaleIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes scaleIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.weekend-title {
    font-size: 2em;
    margin-bottom: 20px;
    text-shadow: 0 0 20px rgba(255,255,255,0.5);
}

.weekend-code-box {
    background: rgba(0,0,0,0.4);
    padding: 20px;
    border-radius: 12px;
    margin: 20px 0;
    border: 2px dashed #f39c12;
}

.weekend-code {
    font-size: 1.3em;
    font-weight: bold;
    color: #f39c12;
    letter-spacing: 2px;
    margin: 10px 0;
}

.copy-btn {
    background: #f39c12;
    border: none;
    color: white;
    padding: 12px 30px;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 15px;
    transition: all 0.3s ease;
}

.copy-btn:active {
    transform: scale(0.95);
}

.close-popup-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 12px 30px;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 20px;
    transition: all 0.3s ease;
}

.close-popup-btn:active {
    transform: scale(0.95);
}

.reward-animation {
    animation: rewardPop 0.6s ease;
}

@keyframes rewardPop {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}
.redeem-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    background: linear-gradient(135deg, #666 0%, #444 100%);
}
</style>

<!-- Redeem Code Screen -->
<div id="redeemScreen" class="screen">
    <h1 class="main-title">üéÅ Redeem Code</h1>
    
    <div class="redeem-container">
        <div class="redeem-box">
            <h3 style="margin-bottom: 20px; text-align: center; color: var(--secondary-color);">Enter Redeem Code</h3>
            
            <input 
                type="text" 
                id="redeemInput" 
                class="redeem-input" 
                placeholder="XXXX-XXXX-XXXX-XXXX"
                maxlength="19"
            >
            
            <button class="redeem-btn" onclick="redeemCode()">
                üéÅ Redeem Now
            </button>
            
            <div class="redeem-info">
                ‚ÑπÔ∏è <strong>How to use:</strong><br>
                ‚Ä¢ Enter code in format: XXXX-XXXX-XXXX-XXXX<br>
                ‚Ä¢ Each code can be used by 5 devices only<br>
                ‚Ä¢ Codes have expiration dates<br>
                ‚Ä¢ Weekend Special Code. Available every Saturday and Sunday at 1 PM only<br>
                ‚Ä¢ Rewards: Gold, EXP, Skill Points, or Items
            </div>
        </div>
        
        <div class="redeem-history">
            <h3 style="margin-bottom: 15px; color: var(--secondary-color);">‚úÖ Redeemed Codes</h3>
            <div id="redeemHistoryList">
                <p style="text-align: center; color: #666; padding: 20px;">No codes redeemed yet</p>
            </div>
        </div>
    </div>
</div>

<!-- Weekend Special Popup -->
<div id="weekendPopup" class="weekend-popup">
    <div class="weekend-content">
        <div class="weekend-title">üéâ WEEKEND SPECIAL! üéâ</div>
        <p style="font-size: 1.1em; margin: 15px 0;">Limited Time Offer!</p>
        
        <div class="weekend-code-box">
            <div style="font-size: 0.9em; color: #ddd;">Your Special Code:</div>
            <div class="weekend-code" id="weekendCodeDisplay">FREE-WEEK-ENDC-ODE1</div>
            <div style="font-size: 0.85em; color: #f39c12; margin-top: 10px;">
                ‚ö†Ô∏è Limited to 3 devices only!
            </div>
        </div>
        
        <button class="copy-btn" onclick="copyWeekendCode()">
            üìã Copy Code
        </button>
        
        <button class="close-popup-btn" onclick="closeWeekendPopup()">
            Close
        </button>
        
        <div style="margin-top: 15px; font-size: 0.85em; color: #ddd;">
            Available: Saturday & Sunday, 1:00 PM
        </div>
    </div>
</div>

<script>
// Redeem Code System
const REDEEM_CODES_URL = 'https://raw.githubusercontent.com/mhtpsg/mhtpsg.github.io/refs/heads/main/Ninja%20Legacy/redeem-codes.json';

// Fallback codes jika fetch gagal (embed langsung di code)
// NO NEEDED FALLBACK_CODES!
const FALLBACK_CODES = [
    {
        code: "FREE-CODE-ITEM-GEAR",
        validUntil: "2025-12-31T23:59:59",
        maxRedeems: 5,
        redeemed: 0,
        rewards: {
            type: "random",
            gold: [50, 150],
            exp: [50, 150],
            skillPoints: [1, 2],
            itemChance: 0.3
        }
    },
    {
        code: "NEWB-IEGF-TFRE-E100",
        validUntil: "2025-12-25T23:59:59",
        maxRedeems: 5,
        redeemed: 0,
        rewards: {
            type: "random",
            gold: [100, 150],
            exp: [75, 125],
            skillPoints: [1, 2],
            itemChance: 0.4
        }
    },
    {
        code: "FREE-WEEK-ENDC-ODE1",
        validUntil: "2025-12-31T23:59:59",
        maxRedeems: 3,
        redeemed: 0,
        weekendOnly: true,
        rewards: {
            type: "premium",
            gold: [200, 250],
            exp: [200, 250],
            skillPoints: [2, 5],
            itemChance: 0.5
        }
    },
    {
        code: "TEST-CODE-WORK-GOOD",
        validUntil: "2025-12-31T23:59:59",
        maxRedeems: 10,
        redeemed: 0,
        rewards: {
            type: "random",
            gold: [100, 200],
            exp: [100, 200],
            skillPoints: [2, 3],
            itemChance: 0.5
        }
    }
];

// Load redeem codes dengan fallback
async function loadRedeemCodes() {
    // Try to load from URL first
    try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout
        
        const response = await fetch(REDEEM_CODES_URL, { 
            signal: controller.signal,
            mode: 'cors',
            cache: 'no-cache'
        });
        
        clearTimeout(timeoutId);
        
        if (!response.ok) {
            throw new Error('Failed to fetch codes');
        }
        
        const data = await response.json();
        console.log('‚úÖ Codes loaded from URL');
        return data.codes || FALLBACK_CODES;
        
    } catch (error) {
        console.warn('‚ö†Ô∏è Failed to load codes from URL, using fallback codes:', error.message);
        // Return fallback codes
        return FALLBACK_CODES;
    }
}

// Format input otomatis dengan dash
document.getElementById('redeemInput')?.addEventListener('input', function(e) {
    let value = e.target.value.replace(/[^A-Z0-9]/gi, '').toUpperCase();
    let formatted = '';
    
    for (let i = 0; i < value.length && i < 16; i++) {
        if (i > 0 && i % 4 === 0) {
            formatted += '-';
        }
        formatted += value[i];
    }
    
    e.target.value = formatted;
});

// Check if device already redeemed code
function hasRedeemedCode(code) {
    const deviceId = getDeviceId();
    const redeemedCodes = JSON.parse(localStorage.getItem('redeemedCodes') || '[]');
    return redeemedCodes.some(r => r.code === code && r.deviceId === deviceId);
}

// Get device ID
function getDeviceId() {
    let deviceId = localStorage.getItem('deviceId');
    if (!deviceId) {
        deviceId = 'device_' + Math.random().toString(36).substr(2, 9) + Date.now();
        localStorage.setItem('deviceId', deviceId);
    }
    return deviceId;
}

// Save redeemed code
function saveRedeemedCode(code, rewards) {
    const deviceId = getDeviceId();
    const redeemedCodes = JSON.parse(localStorage.getItem('redeemedCodes') || '[]');
    
    redeemedCodes.push({
        code: code,
        deviceId: deviceId,
        timestamp: Date.now(),
        rewards: rewards
    });
    
    localStorage.setItem('redeemedCodes', JSON.stringify(redeemedCodes));
    updateRedeemHistory();
}

// Update redeem history display
function updateRedeemHistory() {
    const redeemedCodes = JSON.parse(localStorage.getItem('redeemedCodes') || '[]');
    const historyList = document.getElementById('redeemHistoryList');
    
    if (!historyList) return;
    
    if (redeemedCodes.length === 0) {
        historyList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No codes redeemed yet</p>';
        return;
    }
    
    historyList.innerHTML = redeemedCodes.slice().reverse().map(item => {
        const date = new Date(item.timestamp).toLocaleDateString();
        let rewardText = '';
        
        if (item.rewards.gold) rewardText += `üí∞ ${item.rewards.gold} Gold `;
        if (item.rewards.exp) rewardText += `‚≠ê ${item.rewards.exp} EXP `;
        if (item.rewards.skillPoints) rewardText += `üîÆ ${item.rewards.skillPoints} SP `;
        if (item.rewards.item) rewardText += `üéÅ ${item.rewards.item}`;
        
        return `
            <div class="history-item">
                <div>
                    <div class="history-code">${item.code}</div>
                    <div style="font-size: 0.8em; color: #666;">${date}</div>
                </div>
                <div class="history-reward">${rewardText}</div>
            </div>
        `;
    }).join('');
}

// Random reward generator
function generateReward(rewardConfig) {
    const rewards = {};
    
    // Random gold
    if (rewardConfig.gold) {
        rewards.gold = Math.floor(Math.random() * (rewardConfig.gold[1] - rewardConfig.gold[0] + 1)) + rewardConfig.gold[0];
    }
    
    // Random exp
    if (rewardConfig.exp) {
        rewards.exp = Math.floor(Math.random() * (rewardConfig.exp[1] - rewardConfig.exp[0] + 1)) + rewardConfig.exp[0];
    }
    
    // Random skill points
    if (rewardConfig.skillPoints) {
        rewards.skillPoints = Math.floor(Math.random() * (rewardConfig.skillPoints[1] - rewardConfig.skillPoints[0] + 1)) + rewardConfig.skillPoints[0];
    }
    
    // Random item - pastikan GameData.equipment ada
    if (rewardConfig.itemChance && Math.random() < rewardConfig.itemChance) {
        if (typeof GameData !== 'undefined' && GameData.equipment) {
            const items = Object.keys(GameData.equipment);
            if (items.length > 0) {
                rewards.item = items[Math.floor(Math.random() * items.length)];
            }
        }
    }
    
    return rewards;
}

// Main redeem function - UPDATED
async function redeemCode() {
    const input = document.getElementById('redeemInput');
    const code = input.value.trim().toUpperCase();
    
    // Check if empty
    if (!code) {
        alert('‚ö†Ô∏è Please enter a redeem code first!');
        input.focus();
        return;
    }
    
    // Check format validation
    if (!/^[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/.test(code)) {
        alert('‚ùå Invalid code format!\n\nPlease use format: XXXX-XXXX-XXXX-XXXX\nExample: FREE-CODE-ITEM-GEAR');
        input.focus();
        return;
    }
    
    // Check if already redeemed
    if (hasRedeemedCode(code)) {
        alert('‚ö†Ô∏è You have already redeemed this code on this device!');
        return;
    }
    
    // Show loading
    const btn = document.querySelector('.redeem-btn');
    const originalText = btn.innerHTML;
    btn.innerHTML = '‚è≥ Checking...';
    btn.disabled = true;
    
    try {
        // Load codes (will use fallback if URL fails)
        const codes = await loadRedeemCodes();
        const codeData = codes.find(c => c.code === code);
        
        // Check if code exists
        if (!codeData) {
            alert('‚ùå Invalid Code!\n\nThis code does not exist or has been removed.\nPlease check your code and try again.');
            btn.innerHTML = originalText;
            btn.disabled = false;
            return;
        }
        
        // Check expiration
        const now = new Date();
        const validUntil = new Date(codeData.validUntil);
        
        if (now > validUntil) {
            alert('‚è∞ Code Expired!\n\nThis code expired on:\n' + validUntil.toLocaleDateString());
            btn.innerHTML = originalText;
            btn.disabled = false;
            return;
        }
        
        // Check weekend only codes
        if (codeData.weekendOnly) {
            const day = now.getDay();
            const hour = now.getHours();
            
            if ((day !== 0 && day !== 6) || hour !== 13) {
                alert('‚ö†Ô∏è Weekend Special Code!\n\nThis code is only available on:\n‚Ä¢ Saturday & Sunday\n‚Ä¢ At 1:00 PM\n\nPlease come back during that time!');
                btn.innerHTML = originalText;
                btn.disabled = false;
                return;
            }
        }
        
        // Check max redeems
        const deviceRedeems = parseInt(localStorage.getItem('globalRedeems_' + code) || '0');
        
        if (deviceRedeems >= codeData.maxRedeems) {
            alert('‚ö†Ô∏è Redemption Limit Reached!\n\nThis code has been redeemed by the maximum number of devices (' + codeData.maxRedeems + ').\n\nPlease check for new codes!');
            btn.innerHTML = originalText;
            btn.disabled = false;
            return;
        }
        
        // Generate rewards
        const rewards = generateReward(codeData.rewards);
        
        // Apply rewards to gameState
        if (typeof gameState !== 'undefined' && gameState.player) {
            if (rewards.gold) {
                gameState.player.gold += rewards.gold;
            }
            if (rewards.exp) {
                gameState.player.exp += rewards.exp;
                if (typeof checkLevelUp === 'function') {
                    checkLevelUp();
                }
            }
            if (rewards.skillPoints) {
                gameState.player.skillPoints += rewards.skillPoints;
            }
            if (rewards.item) {
                if (!gameState.player.inventory) {
                    gameState.player.inventory = [];
                }
                if (!gameState.player.inventory.includes(rewards.item)) {
                    gameState.player.inventory.push(rewards.item);
                }
            }
            
            // Save progress
            if (typeof saveGame === 'function') {
                saveGame();
            }
        }
        
        // Save redeemed code
        saveRedeemedCode(code, rewards);
        localStorage.setItem('globalRedeems_' + code, (deviceRedeems + 1).toString());
        
        // Build reward message for alert
        let rewardMessage = 'üéâ CODE REDEEMED SUCCESSFULLY! üéâ\n\n';
        rewardMessage += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
        rewardMessage += 'REWARDS RECEIVED:\n';
        rewardMessage += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
        
        if (rewards.gold) rewardMessage += `üí∞ Gold: +${rewards.gold}\n`;
        if (rewards.exp) rewardMessage += `‚≠ê EXP: +${rewards.exp}\n`;
        if (rewards.skillPoints) rewardMessage += `üîÆ Skill Points: +${rewards.skillPoints}\n`;
        if (rewards.item) {
            const itemName = (typeof GameData !== 'undefined' && GameData.equipment && GameData.equipment[rewards.item]) 
                ? GameData.equipment[rewards.item].name 
                : rewards.item;
            rewardMessage += `üéÅ Item: ${itemName}\n`;
        }
        
        rewardMessage += '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê';
        
        alert(rewardMessage);
        
        // Clear input
        input.value = '';
        
        // Update UI
        if (typeof updatePlayerInfo === 'function') {
            updatePlayerInfo();
        }
        
        // Reset button
        btn.innerHTML = originalText;
        btn.disabled = false;
        
    } catch (error) {
        console.error('Redeem error:', error);
        alert('‚ùå Error!\n\nSomething went wrong: ' + error.message);
        btn.innerHTML = originalText;
        btn.disabled = false;
    }
}

// Weekend popup check
function checkWeekendPopup() {
    const now = new Date();
    const day = now.getDay();
    const hour = now.getHours();
    
    // Check if Saturday (6) or Sunday (0) and hour is 13 (1 PM)
    if ((day === 0 || day === 6) && hour === 13) {
        const lastShown = localStorage.getItem('lastWeekendPopup');
        const today = now.toDateString();
        
        // Show once per day
        if (lastShown !== today) {
            setTimeout(() => {
                const popup = document.getElementById('weekendPopup');
                if (popup) {
                    popup.classList.add('active');
                    localStorage.setItem('lastWeekendPopup', today);
                }
            }, 2000);
        }
    }
}

// Copy weekend code
function copyWeekendCode() {
    const code = document.getElementById('weekendCodeDisplay').textContent;
    
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(code).then(() => {
            alert('‚úÖ Code Copied!\n\n' + code + '\n\nGo to Redeem screen to use it.');
        }).catch(() => {
            fallbackCopy(code);
        });
    } else {
        fallbackCopy(code);
    }
}

// Fallback copy method
function fallbackCopy(text) {
    const input = document.createElement('textarea');
    input.value = text;
    input.style.position = 'fixed';
    input.style.opacity = '0';
    document.body.appendChild(input);
    input.select();
    
    try {
        document.execCommand('copy');
        alert('‚úÖ Code Copied!\n\n' + text + '\n\nGo to Redeem screen to use it.');
    } catch (err) {
        alert('‚ö†Ô∏è Could not copy code automatically.\n\nPlease copy manually:\n' + text);
    }
    
    document.body.removeChild(input);
}

// Close weekend popup
function closeWeekendPopup() {
    const popup = document.getElementById('weekendPopup');
    if (popup) {
        popup.classList.remove('active');
    }
}

// Initialize redeem screen
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeRedeemSystem);
} else {
    initializeRedeemSystem();
}

function initializeRedeemSystem() {
    updateRedeemHistory();
    checkWeekendPopup();
    
    // Check every minute for weekend popup
    setInterval(checkWeekendPopup, 60000);
}

// Initialize redeem screen
document.addEventListener('DOMContentLoaded', function() {
    updateRedeemHistory();
    checkWeekendPopup();
    
    // Check every minute for weekend popup
    setInterval(checkWeekendPopup, 60000);
});
</script>

<style>
/* Milestone V2 - Scoped Styles Only */
#milestoneV2Screen .milestone-v2-container {
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    margin: 15px;
    overflow-y: auto;
    max-height: calc(100vh - 120px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

#milestoneV2Screen .milestone-v2-header {
    text-align: center;
    color: white;
    margin-bottom: 20px;
}

#milestoneV2Screen .milestone-v2-header h2 {
    margin: 0 0 10px 0;
    font-size: 26px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

#milestoneV2Screen .milestone-stats {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    font-size: 14px;
    color: rgba(255,255,255,0.95);
    background: rgba(0,0,0,0.2);
    padding: 10px 20px;
    border-radius: 25px;
    margin: 0 auto;
    backdrop-filter: blur(10px);
}

#milestoneV2Screen .stat-item {
    display: flex;
    align-items: center;
    gap: 5px;
}

#milestoneV2Screen .stat-item strong {
    color: #f1c40f;
    font-size: 18px;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}

#milestoneV2Screen .stat-divider {
    color: rgba(255,255,255,0.4);
    font-size: 18px;
}

#milestoneV2Screen .milestone-v2-grid {
    display: flex;
    flex-direction: column;
    gap: 15px;
    padding-bottom: 20px;
}

#milestoneV2Screen .milestone-item {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 0;
    border: 2px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px);
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

#milestoneV2Screen .milestone-item.available {
    border-color: #2ecc71;
    background: rgba(46, 204, 113, 0.15);
    box-shadow: 0 8px 25px rgba(46, 204, 113, 0.3);
    transform: translateY(-2px);
}

#milestoneV2Screen .milestone-item.claimed {
    border-color: #95a5a6;
    background: rgba(149, 165, 166, 0.15);
    opacity: 0.8;
}

#milestoneV2Screen .milestone-item.locked {
    border-color: #e74c3c;
    background: rgba(231, 76, 60, 0.1);
}

#milestoneV2Screen .milestone-content {
    display: flex;
    align-items: center;
    padding: 20px;
    gap: 15px;
}

#milestoneV2Screen .milestone-icon-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 80px;
}

#milestoneV2Screen .milestone-number {
    font-size: 32px;
    font-weight: bold;
    color: #e74c3c;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    line-height: 1;
}

#milestoneV2Screen .milestone-icon {
    font-size: 24px;
    margin-top: 5px;
}

#milestoneV2Screen .milestone-details {
    flex: 1;
    display: flex;
    gap: 15px;
}

#milestoneV2Screen .milestone-requirements {
    background: rgba(0,0,0,0.3);
    border-radius: 10px;
    padding: 12px;
    min-width: 100px;
}

#milestoneV2Screen .milestone-requirements-title {
    font-size: 12px;
    font-weight: bold;
    color: #ecf0f1;
    margin-bottom: 8px;
    text-align: center;
}

#milestoneV2Screen .milestone-requirement-item {
    color: #bdc3c7;
    font-size: 11px;
    line-height: 1.4;
    text-align: center;
}

#milestoneV2Screen .milestone-rewards {
    background: rgba(0,0,0,0.3);
    border-radius: 10px;
    padding: 12px;
    flex: 1;
}

#milestoneV2Screen .milestone-rewards-title {
    font-size: 12px;
    font-weight: bold;
    color: #f1c40f;
    margin-bottom: 8px;
    text-align: center;
}

#milestoneV2Screen .milestone-reward-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: white;
    font-size: 12px;
    margin: 4px 0;
    line-height: 1.4;
}

#milestoneV2Screen .milestone-reward-icon {
    font-size: 14px;
    min-width: 16px;
}

#milestoneV2Screen .milestone-button-section {
    display: flex;
    align-items: center;
    min-width: 80px;
}

#milestoneV2Screen .milestone-claim-btn {
    padding: 12px 16px;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
    min-width: 80px;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

#milestoneV2Screen .milestone-claim-btn.can-claim {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
    transform: scale(1.05);
}

#milestoneV2Screen .milestone-claim-btn.can-claim:hover {
    background: linear-gradient(135deg, #27ae60, #229954);
}

#milestoneV2Screen .milestone-claim-btn.can-claim:active {
    transform: scale(0.95);
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

#milestoneV2Screen .milestone-claim-btn:disabled {
    background: linear-gradient(135deg, #95a5a6, #7f8c8d);
    color: #bdc3c7;
    cursor: not-allowed;
    transform: none;
}

/* Status indicators - Scoped */
#milestoneV2Screen .milestone-item.available .milestone-number {
    color: #2ecc71;
    animation: milestonePulse 2s infinite;
}

#milestoneV2Screen .milestone-item.claimed .milestone-number {
    color: #95a5a6;
}

#milestoneV2Screen .milestone-item.locked .milestone-number {
    color: #e74c3c;
}

@keyframes milestonePulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
}

/* Mobile responsive - Scoped */
@media (max-width: 480px) {
    #milestoneV2Screen .milestone-v2-container {
        margin: 10px;
        padding: 15px;
    }
    
    #milestoneV2Screen .milestone-v2-header h2 {
        font-size: 22px;
    }
    
    #milestoneV2Screen .milestone-stats {
        flex-direction: column;
        gap: 10px;
        padding: 12px;
    }
    
    #milestoneV2Screen .stat-divider {
        display: none;
    }
    
    #milestoneV2Screen .milestone-content {
        flex-direction: column;
        text-align: center;
        gap: 12px;
        padding: 15px;
    }
    
    #milestoneV2Screen .milestone-details {
        flex-direction: column;
        width: 100%;
        gap: 10px;
    }
    
    #milestoneV2Screen .milestone-number {
        font-size: 28px;
    }
    
    #milestoneV2Screen .milestone-icon {
        font-size: 20px;
    }
    
    #milestoneV2Screen .milestone-claim-btn {
        min-width: 100px;
        font-size: 11px;
    }
}

@media (max-width: 360px) {
    #milestoneV2Screen .milestone-v2-container {
        margin: 5px;
        padding: 12px;
    }
    
    #milestoneV2Screen .milestone-content {
        padding: 12px;
    }
    
    #milestoneV2Screen .milestone-number {
        font-size: 24px;
    }
    
    #milestoneV2Screen .milestone-rewards-title,
    #milestoneV2Screen .milestone-requirements-title {
        font-size: 11px;
    }
    
    #milestoneV2Screen .milestone-reward-item,
    #milestoneV2Screen .milestone-requirement-item {
        font-size: 10px;
    }
}
</style>

<!-- Milestone V2 Screen -->
<div id="milestoneV2Screen" class="screen">
    <div class="milestone-v2-container">
        <div class="milestone-v2-header">
            <h2>üèÜ Milestone V2</h2>
            <div class="milestone-stats">
                <span class="stat-item">üìä Level: <strong id="currentLevelDisplay">1</strong></span>
                <span class="stat-divider">|</span>
                <span class="stat-item">‚öîÔ∏è Battles: <strong id="totalBattlesDisplay">0</strong></span>
            </div>
        </div>
        <div class="milestone-v2-grid" id="milestoneV2Grid">
            <div style="color: white; text-align: center; padding: 30px; font-size: 16px;">
                <div style="font-size: 48px; margin-bottom: 15px;">‚è≥</div>
                Loading milestones...
            </div>
        </div>
    </div>
</div>

<script>
// Milestone V2 data
const milestoneV2Data = {
    25: { gold: 100 },
    50: { exp: 250 },
    75: { level: 3 },
    100: { randomGear: 1 },
    150: { skillPoints: 5 },
    300: { gold: 500, exp: 500, skillPoints: 10 },
    500: { level: 5, skillPoints: 5 },
    750: { randomGear: 1, gold: 1500 },
    1000: { randomGear: 2, exp: 1500 }
};

// Save milestone progress ke localStorage
function saveMilestoneV2Progress() {
    try {
        const progressData = {
            claimed: gameState.milestoneV2Progress.claimed || []
        };
        localStorage.setItem('milestoneV2Progress', JSON.stringify(progressData));
        console.log('‚úì Milestone V2 progress saved:', progressData.claimed);
        return true;
    } catch (e) {
        console.error('‚ùå Error saving milestone progress:', e);
        return false;
    }
}

// Load milestone progress dari localStorage
function loadMilestoneV2Progress() {
    try {
        const saved = localStorage.getItem('milestoneV2Progress');
        if (saved) {
            const data = JSON.parse(saved);
            gameState.milestoneV2Progress = {
                claimed: data.claimed || []
            };
            console.log('‚úì Milestone V2 progress loaded:', gameState.milestoneV2Progress.claimed);
        } else {
            gameState.milestoneV2Progress = { claimed: [] };
            console.log('‚úì New milestone progress initialized');
        }
    } catch (e) {
        console.error('‚ùå Error loading milestone progress:', e);
        gameState.milestoneV2Progress = { claimed: [] };
    }
}

// Initialize milestone progress
function initMilestoneV2() {
    if (!gameState.milestoneV2Progress) {
        loadMilestoneV2Progress();
    }
}

function openMilestoneV2Screen() {
    // Check if player level is at least 5
    if (gameState.player.level < 5) {
        alert('üîí You need to reach level 5 to access Milestone V2!');
        return;
    }
    
    // Initialize and load progress
    initMilestoneV2();
    
    // Show screen
    document.getElementById('milestoneV2Screen').classList.add('active');
    document.querySelectorAll('.screen').forEach(s => {
        if (s.id !== 'milestoneV2Screen') {
            s.classList.remove('active');
        }
    });
    
    // Update display
    setTimeout(() => {
        updateMilestoneV2Display();
    }, 100);
}

function updateMilestoneV2Display() {
    const grid = document.getElementById('milestoneV2Grid');
    if (!grid) return;
    
    // Initialize and load progress
    initMilestoneV2();
    
    const currentLevel = gameState.player.level || 1;
    const totalBattles = gameState.totalBattles || 0;
    
    // Update progress display
    const levelDisplay = document.getElementById('currentLevelDisplay');
    const battlesDisplay = document.getElementById('totalBattlesDisplay');
    if (levelDisplay) levelDisplay.textContent = currentLevel;
    if (battlesDisplay) battlesDisplay.textContent = totalBattles;
    
    // Clear grid
    grid.innerHTML = '';
    
    // Get milestones sorted
    const milestones = Object.keys(milestoneV2Data).map(m => parseInt(m)).sort((a, b) => a - b);
    
    milestones.forEach(milestone => {
        const rewards = milestoneV2Data[milestone];
        const isClaimed = gameState.milestoneV2Progress.claimed.includes(milestone);
        const canClaim = currentLevel >= milestone && totalBattles >= milestone && !isClaimed;
        const isLocked = !canClaim && !isClaimed;
        
        const milestoneDiv = document.createElement('div');
        milestoneDiv.className = 'milestone-item';
        
        if (isClaimed) {
            milestoneDiv.classList.add('claimed');
        } else if (canClaim) {
            milestoneDiv.classList.add('available');
        } else {
            milestoneDiv.classList.add('locked');
        }
        
        // Build rewards HTML
        let rewardsHTML = '';
        if (rewards.gold) rewardsHTML += `<div class="milestone-reward-item"><span class="milestone-reward-icon">üí∞</span><span>+${rewards.gold} Gold</span></div>`;
        if (rewards.exp) rewardsHTML += `<div class="milestone-reward-item"><span class="milestone-reward-icon">‚≠ê</span><span>+${rewards.exp} EXP</span></div>`;
        if (rewards.level) rewardsHTML += `<div class="milestone-reward-item"><span class="milestone-reward-icon">üéä</span><span>+${rewards.level} Levels</span></div>`;
        if (rewards.skillPoints) rewardsHTML += `<div class="milestone-reward-item"><span class="milestone-reward-icon">üîß</span><span>+${rewards.skillPoints} Skills</span></div>`;
        if (rewards.randomGear) rewardsHTML += `<div class="milestone-reward-item"><span class="milestone-reward-icon">üéÅ</span><span>${rewards.randomGear} Gear${rewards.randomGear > 1 ? 's' : ''}</span></div>`;
        
        // Button text and status
        let statusText = '';
        let btnDisabled = '';
        if (isClaimed) {
            statusText = '‚úì CLAIMED';
            btnDisabled = 'disabled';
        } else if (canClaim) {
            statusText = 'üéÅ CLAIM';
        } else {
            statusText = 'üîí LOCKED';
            btnDisabled = 'disabled';
        }
        
        milestoneDiv.innerHTML = `
            <div class="milestone-content">
                <div class="milestone-icon-section">
                    <div class="milestone-number">${milestone}</div>
                    <div class="milestone-icon">üéØ</div>
                </div>
                
                <div class="milestone-details">
                    <div class="milestone-requirements">
                        <div class="milestone-requirements-title">Requires:</div>
                        <div class="milestone-requirement-item">Level ${milestone}</div>
                        <div class="milestone-requirement-item">${milestone} Battles</div>
                    </div>
                    
                    <div class="milestone-rewards">
                        <div class="milestone-rewards-title">Rewards:</div>
                        ${rewardsHTML}
                    </div>
                </div>
                
                <div class="milestone-button-section">
                    <button class="milestone-claim-btn ${canClaim ? 'can-claim' : ''}" 
                            onclick="claimMilestoneV2(${milestone})" 
                            ${btnDisabled}>
                        ${statusText}
                    </button>
                </div>
            </div>
        `;
        
        grid.appendChild(milestoneDiv);
    });
}

function claimMilestoneV2(milestone) {
    // Initialize and load progress
    initMilestoneV2();
    
    // Check if already claimed
    if (gameState.milestoneV2Progress.claimed.includes(milestone)) {
        alert('‚ö†Ô∏è You have already claimed this milestone!\n\nMilestone ' + milestone + ' rewards have been collected previously.');
        return;
    }
    
    const currentLevel = gameState.player.level || 1;
    const totalBattles = gameState.totalBattles || 0;
    
    // Check requirements
    if (currentLevel < milestone || totalBattles < milestone) {
        alert('‚ùå Requirements not met!\n\nYou need:\n‚Ä¢ Level ' + milestone + ' (Current: ' + currentLevel + ')\n‚Ä¢ ' + milestone + ' Total Battles (Current: ' + totalBattles + ')');
        return;
    }
    
    const rewards = milestoneV2Data[milestone];
    let rewardMessages = [];
    
    // Apply gold reward
    if (rewards.gold) {
        gameState.player.gold += rewards.gold;
        rewardMessages.push(`üí∞ +${rewards.gold} Gold`);
    }
    
    // Apply exp reward
    if (rewards.exp) {
        const oldLevel = gameState.player.level;
        gameState.player.experience += rewards.exp;
        
        while (gameState.player.experience >= gameState.player.level * 100) {
            gameState.player.experience -= gameState.player.level * 100;
            gameState.player.level++;
        }
        
        rewardMessages.push(`‚≠ê +${rewards.exp} EXP`);
        
        if (gameState.player.level > oldLevel) {
            rewardMessages.push(`üéä Level Up! Now level ${gameState.player.level}!`);
        }
    }
    
    // Apply level reward
    if (rewards.level) {
        gameState.player.level += rewards.level;
        rewardMessages.push(`üéä +${rewards.level} Levels! Now level ${gameState.player.level}!`);
    }
    
    // Apply skill points reward
    if (rewards.skillPoints) {
        gameState.player.skillPoints += rewards.skillPoints;
        rewardMessages.push(`üîß +${rewards.skillPoints} Skill Points`);
    }
    
    // Apply random gear reward
    if (rewards.randomGear) {
        const foundGear = Object.keys(GameData.equipment).filter(id => 
            GameData.equipment[id].rarity === 'found'
        );
        
        for (let i = 0; i < rewards.randomGear; i++) {
            if (foundGear.length > 0) {
                const randomGear = foundGear[Math.floor(Math.random() * foundGear.length)];
                if (!gameState.player.inventory[randomGear]) {
                    gameState.player.inventory[randomGear] = 0;
                }
                gameState.player.inventory[randomGear]++;
                rewardMessages.push(`üéÅ Found: ${GameData.equipment[randomGear].name}!`);
            }
        }
    }
    
    // Mark as claimed
    gameState.milestoneV2Progress.claimed.push(milestone);
    
    // SAVE ke localStorage
    const saveSuccess = saveMilestoneV2Progress();
    
    // Save game state juga (untuk gold, exp, level, dll)
    if (typeof saveGameState === 'function') {
        saveGameState();
    }
    
    // Show SUCCESS alert
    if (saveSuccess) {
        alert('‚úÖ SUCCESS! Milestone ' + milestone + ' Claimed!\n\n' + 
              'üéÅ You received:\n' + 
              rewardMessages.join('\n') + 
              '\n\n‚úì Progress has been saved!');
    } else {
        alert('‚ö†Ô∏è Rewards claimed but save failed!\n\n' + 
              'Please try refreshing the page.\n\n' + 
              rewardMessages.join('\n'));
    }
    
    // Update displays
    if (typeof updatePlayerDisplay === 'function') {
        updatePlayerDisplay();
    }
    updateMilestoneV2Display();
}

// Auto-load on page load
window.addEventListener('DOMContentLoaded', function() {
    loadMilestoneV2Progress();
    console.log('Milestone V2 system initialized');
});

// Also load when game state exists
if (typeof gameState !== 'undefined') {
    loadMilestoneV2Progress();
}
</script>

<style>
.expedition-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin: 20px 0;
}

.stamina-bar-container {
    background: rgba(0,0,0,0.4);
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 20px;
    backdrop-filter: blur(10px);
}

.stamina-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.stamina-text {
    font-size: 1.1em;
    font-weight: bold;
    color: #2ecc71;
}

.expedition-card {
    background: rgba(255,255,255,0.05);
    border: 2px solid rgba(78, 205, 196, 0.3);
    border-radius: 15px;
    padding: 18px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.expedition-card:active {
    transform: scale(0.98);
}

.expedition-card.in-progress {
    border-color: #f39c12;
    background: rgba(243, 156, 18, 0.1);
}

.expedition-card.completed {
    border-color: #2ecc71;
    background: rgba(46, 204, 113, 0.1);
    animation: completedPulse 2s ease-in-out infinite;
}

.expedition-card.locked {
    opacity: 0.5;
    pointer-events: none;
    filter: grayscale(0.8);
}

@keyframes completedPulse {
    0%, 100% { box-shadow: 0 0 10px rgba(46, 204, 113, 0.3); }
    50% { box-shadow: 0 0 20px rgba(46, 204, 113, 0.6); }
}

.expedition-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.expedition-title {
    font-size: 1.2em;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 8px;
}

.expedition-duration {
    background: rgba(52, 152, 219, 0.3);
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.85em;
    color: #3498db;
    font-weight: bold;
}

.expedition-rewards {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin: 15px 0;
    padding: 12px;
    background: rgba(0,0,0,0.3);
    border-radius: 10px;
}

.reward-item {
    font-size: 0.9em;
    display: flex;
    align-items: center;
    gap: 5px;
}

.reward-probability {
    margin-top: 10px;
    padding: 10px;
    background: rgba(0,0,0,0.2);
    border-radius: 8px;
    font-size: 0.85em;
}

.probability-item {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 5px 0;
    color: #bbb;
}

.expedition-timer {
    background: rgba(243, 156, 18, 0.2);
    padding: 10px;
    border-radius: 10px;
    text-align: center;
    font-weight: bold;
    color: #f39c12;
    margin: 10px 0;
}

.expedition-actions {
    display: flex;
    gap: 10px;
    margin-top: 12px;
}

.expedition-btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.95em;
}

.expedition-btn.start {
    background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
    color: white;
}

.expedition-btn.claim {
    background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
    color: white;
}

.expedition-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(1);
}

.expedition-btn:active:not(:disabled) {
    transform: scale(0.95);
}

.stamina-cost {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(231, 76, 60, 0.9);
    color: white;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 0.85em;
    font-weight: bold;
}

.expedition-difficulty {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 0.75em;
    font-weight: bold;
    margin-left: 8px;
}

.difficulty-easy { background: #2ecc71; color: white; }
.difficulty-normal { background: #3498db; color: white; }
.difficulty-hard { background: #e67e22; color: white; }
.difficulty-expert { background: #e74c3c; color: white; }

.refresh-timer {
    text-align: center;
    background: rgba(155, 89, 182, 0.2);
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 15px;
    color: #9b59b6;
    font-weight: bold;
}

.no-expeditions {
    text-align: center;
    padding: 40px 20px;
    color: #888;
    font-size: 1.1em;
}

.active-expedition-notice {
    background: rgba(243, 156, 18, 0.2);
    border: 2px solid rgba(243, 156, 18, 0.5);
    padding: 15px;
    border-radius: 12px;
    text-align: center;
    margin-bottom: 15px;
    color: #f39c12;
    font-weight: bold;
}

.locked-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8);
    padding: 10px 20px;
    border-radius: 10px;
    color: #e74c3c;
    font-weight: bold;
    font-size: 0.9em;
    z-index: 10;
}
</style>

<!-- Expedition Screen -->
<div id="expeditionScreen" class="screen">
    <h1 class="main-title">üó∫Ô∏è Expedition</h1>
    
    <div class="stamina-bar-container">
        <div class="stamina-info">
            <span class="stamina-text">‚ö° Stamina</span>
            <span class="stamina-text" id="staminaValue">100/100</span>
        </div>
        <div class="bar-container">
            <div class="bar-fill" id="staminaBar" style="width: 100%; background: linear-gradient(90deg, #2ecc71, #27ae60);"></div>
        </div>
        <div style="text-align: center; font-size: 0.85em; color: #bbb; margin-top: 8px;">
            ‚è±Ô∏è Regenerates 10 stamina every 1 hour
        </div>
    </div>

    <div id="activeExpeditionNotice" class="active-expedition-notice" style="display: none;">
        ‚ö†Ô∏è You can do up to 3 expeditions at a time! Complete or claim expeditions to start new ones.
    </div>

    <div id="refreshTimer" class="refresh-timer" style="display: none;">
        Next expeditions in: <span id="refreshTimerValue">--:--</span>
    </div>

    <div id="expeditionContainer" class="expedition-container">
        <!-- Expeditions akan dimuat di sini -->
    </div>
</div>

<script>
// Expedition System
const expeditionSystem = {
    stamina: 100,
    maxStamina: 100,
    staminaRegenRate: 10, // 10 stamina per 1 hour
    staminaRegenInterval: 3600000, // 1 hour in ms
    expeditions: [],
    activeExpeditions: [],
    lastRefreshTime: Date.now(),
    nextRefreshTime: null,
    lastStaminaUpdate: Date.now(),
    maxActiveExpeditions: 3, // Bisa mengambil 3 expedition sekaligus
    
    init() {
        this.loadExpeditionData();
        this.processOfflineTime();
        this.generateExpeditionsIfNeeded();
        this.startStaminaRegen();
        this.startExpeditionTimers();
        this.render();
    },
    
    loadExpeditionData() {
        const saved = localStorage.getItem('expeditionData');
        if (saved) {
            try {
                const data = JSON.parse(saved);
                this.stamina = data.stamina || 100;
                this.activeExpeditions = data.activeExpeditions || [];
                this.lastRefreshTime = data.lastRefreshTime || Date.now();
                this.nextRefreshTime = data.nextRefreshTime || null;
                this.expeditions = data.expeditions || [];
                this.lastStaminaUpdate = data.lastStaminaUpdate || Date.now();
                
                console.log('Loaded expedition data:', data);
                console.log('Active expeditions count:', this.expeditions.filter(e => e.status === 'in-progress' || e.status === 'completed').length);
            } catch (error) {
                console.error('Failed to load expedition data:', error);
                this.resetExpeditionData();
            }
        } else {
            console.log('No saved expedition data found');
        }
    },
    
    processOfflineTime() {
        const now = Date.now();
        
        // Process offline stamina regeneration
        const timePassed = now - this.lastStaminaUpdate;
        const staminaToAdd = Math.floor(timePassed / this.staminaRegenInterval) * this.staminaRegenRate;
        if (staminaToAdd > 0) {
            this.stamina = Math.min(this.stamina + staminaToAdd, this.maxStamina);
            console.log(`Offline stamina regen: +${staminaToAdd} (${timePassed}ms passed)`);
        }
        this.lastStaminaUpdate = now;
        
        // Check and update expedition statuses
        let completedCount = 0;
        this.expeditions.forEach(expedition => {
            if (expedition.status === 'in-progress' && now >= expedition.endTime) {
                expedition.status = 'completed';
                completedCount++;
                console.log(`Expedition completed offline: ${expedition.name}`);
            }
        });
        
        if (completedCount > 0) {
            console.log(`${completedCount} expeditions completed while offline`);
        }
        
        // Check if refresh time has passed
        if (this.nextRefreshTime && now >= this.nextRefreshTime) {
            console.log('Expedition refresh time has passed, generating new expeditions');
            this.generateExpeditions();
        }
    },
    
    generateExpeditionsIfNeeded() {
        if (this.expeditions.length === 0) {
            console.log('No expeditions found, generating new ones');
            this.generateExpeditions();
        }
    },
    
    resetExpeditionData() {
        this.stamina = 100;
        this.expeditions = [];
        this.activeExpeditions = [];
        this.lastRefreshTime = Date.now();
        this.nextRefreshTime = null;
        this.lastStaminaUpdate = Date.now();
        this.generateExpeditions();
    },
    
    saveExpeditionData() {
        const data = {
            stamina: this.stamina,
            activeExpeditions: this.activeExpeditions,
            lastRefreshTime: this.lastRefreshTime,
            nextRefreshTime: this.nextRefreshTime,
            expeditions: this.expeditions,
            lastStaminaUpdate: this.lastStaminaUpdate,
            savedAt: Date.now()
        };
        
        try {
            localStorage.setItem('expeditionData', JSON.stringify(data));
            console.log('Expedition data saved successfully');
        } catch (error) {
            console.error('Failed to save expedition data:', error);
        }
    },
    
    generateExpeditions() {
        const count = Math.floor(Math.random() * 6) + 10; // 10-15 expeditions
        this.expeditions = [];
        
        const expeditionTemplates = [
            { name: "Forest Patrol", icon: "üå≤", difficulty: "easy" },
            { name: "Mountain Climb", icon: "‚õ∞Ô∏è", difficulty: "normal" },
            { name: "Cave Exploration", icon: "üï≥Ô∏è", difficulty: "normal" },
            { name: "Desert Journey", icon: "üèúÔ∏è", difficulty: "hard" },
            { name: "Ancient Ruins", icon: "üèõÔ∏è", difficulty: "hard" },
            { name: "Dark Dungeon", icon: "üè∞", difficulty: "expert" },
            { name: "Volcano Expedition", icon: "üåã", difficulty: "expert" },
            { name: "Ocean Quest", icon: "üåä", difficulty: "normal" },
            { name: "Sky Temple", icon: "‚òÅÔ∏è", difficulty: "hard" },
            { name: "Shadow Realm", icon: "üåë", difficulty: "expert" },
            { name: "Crystal Mines", icon: "üíé", difficulty: "normal" },
            { name: "Bamboo Forest", icon: "üéã", difficulty: "easy" },
            { name: "Ice Cavern", icon: "‚ùÑÔ∏è", difficulty: "hard" },
            { name: "Mystic Library", icon: "üìö", difficulty: "normal" },
            { name: "Dragon's Lair", icon: "üêâ", difficulty: "expert" },
            { name: "Enchanted Grove", icon: "üßö", difficulty: "easy" },
            { name: "Thunder Peaks", icon: "‚ö°", difficulty: "hard" },
            { name: "Moonlit Cemetery", icon: "ü™¶", difficulty: "normal" },
            { name: "Coral Reef Dive", icon: "ü™∏", difficulty: "normal" },
            { name: "Wizard's Tower", icon: "üßô", difficulty: "expert" },
            { name: "Golden Sands", icon: "üèñÔ∏è", difficulty: "easy" },
            { name: "Forbidden Temple", icon: "üõï", difficulty: "expert" },
            { name: "Starfall Valley", icon: "üå†", difficulty: "hard" },
            { name: "Phantom Ship", icon: "üëª", difficulty: "expert" },
            { name: "Jade Garden", icon: "üå∏", difficulty: "easy" },
            { name: "Lava Tunnels", icon: "üî•", difficulty: "hard" },
            { name: "Celestial Observatory", icon: "üî≠", difficulty: "normal" },
            { name: "Mushroom Cavern", icon: "üçÑ", difficulty: "easy" },
            { name: "Storm Castle", icon: "üè∞", difficulty: "expert" },
            { name: "Emerald Lake", icon: "üíö", difficulty: "normal" }
        ];
        
        const durations = [
            { hours: 0.1, label: "6 Minutes" }, // For testing - 6 minutes
            { hours: 1, label: "1 Hour" },
            { hours: 2, label: "2 Hours" },
            { hours: 4, label: "4 Hours" },
            { hours: 6, label: "6 Hours" },
            { hours: 12, label: "12 Hours" }
        ];
        
        for (let i = 0; i < count; i++) {
            const template = expeditionTemplates[Math.floor(Math.random() * expeditionTemplates.length)];
            const duration = durations[Math.floor(Math.random() * durations.length)];
            
            const baseRewards = this.calculateRewards(duration.hours, template.difficulty);
            
            this.expeditions.push({
                id: Date.now() + Math.random() + i, // Ensure unique ID
                name: template.name,
                icon: template.icon,
                difficulty: template.difficulty,
                duration: duration.hours * 3600000, // Convert to ms
                durationLabel: duration.label,
                rewards: baseRewards,
                status: 'available', // available, in-progress, completed
                startTime: null,
                endTime: null
            });
        }
        
        this.nextRefreshTime = null;
        console.log(`Generated ${count} new expeditions`);
        this.saveExpeditionData();
    },
    
    calculateRewards(hours, difficulty) {
        const multipliers = {
            easy: 1,
            normal: 1.5,
            hard: 2.5,
            expert: 4
        };
        
        const mult = multipliers[difficulty] || 1;
        const baseGold = Math.max(hours * 50 * mult, 50); // Minimum 50 gold
        const baseExp = Math.max(hours * 30 * mult, 30); // Minimum 30 exp
        
        return {
            gold: Math.floor(baseGold + (Math.random() * baseGold * 0.3)),
            exp: Math.floor(baseExp + (Math.random() * baseExp * 0.3))
        };
    },
    
    getActiveExpeditionCount() {
        return this.expeditions.filter(e => e.status === 'in-progress' || e.status === 'completed').length;
    },
    
    canStartExpedition() {
        return this.getActiveExpeditionCount() < this.maxActiveExpeditions;
    },
    
    startExpedition(expeditionId) {
        const expedition = this.expeditions.find(e => e.id === expeditionId);
        if (!expedition || expedition.status !== 'available') {
            console.log('Invalid expedition or not available:', expedition);
            return;
        }
        
        // Check if we can start more expeditions
        if (!this.canStartExpedition()) {
            this.showMessage('‚ö†Ô∏è You can only do 3 expeditions at a time!', 'error');
            return;
        }
        
        if (this.stamina < 30) {
            this.showMessage('‚ö° Not enough stamina! (Need 30)', 'error');
            return;
        }
        
        const now = Date.now();
        
        this.stamina -= 30;
        expedition.status = 'in-progress';
        expedition.startTime = now;
        expedition.endTime = now + expedition.duration;
        
        // Update active expeditions array
        const existingIndex = this.activeExpeditions.findIndex(e => e.id === expedition.id);
        if (existingIndex === -1) {
            this.activeExpeditions.push({...expedition});
        } else {
            this.activeExpeditions[existingIndex] = {...expedition};
        }
        
        console.log(`Started expedition: ${expedition.name}, will complete at: ${new Date(expedition.endTime)}`);
        
        this.saveExpeditionData();
        this.render();
        this.showMessage(`üó∫Ô∏è Started: ${expedition.name}`, 'success');
    },
    
    claimExpedition(expeditionId) {
        const expedition = this.expeditions.find(e => e.id === expeditionId);
        if (!expedition || expedition.status !== 'completed') {
            console.log('Invalid expedition or not completed:', expedition);
            return;
        }
        
        // Calculate final rewards with probability system
        let finalGold = expedition.rewards.gold;
        let finalExp = expedition.rewards.exp;
        let skillPointsGained = 0;
        let droppedItem = null;
        
        // Generate random number for reward type (95% gold, 4% skill point, 1% gear)
        const rewardRoll = Math.random() * 100;
        
        let rewardType = 'basic'; // Gold + EXP
        
        if (rewardRoll >= 99) {
            // 1% chance - Random Gear
            rewardType = 'gear';
            if (typeof GameData !== 'undefined' && GameData.equipment) {
                const availableGear = Object.keys(GameData.equipment);
                droppedItem = availableGear[Math.floor(Math.random() * availableGear.length)];
                if (typeof gameState !== 'undefined' && gameState.inventory && !gameState.inventory.includes(droppedItem)) {
                    gameState.inventory.push(droppedItem);
                }
            }
        } else if (rewardRoll >= 95) {
            // 4% chance - Skill Points
            rewardType = 'skillpoint';
            skillPointsGained = 1;
        }
        
        // Apply bonuses from events (if available)
        if (typeof GameData !== 'undefined' && GameData.events) {
            if (GameData.events.double_rewards?.active) {
                finalGold *= 2;
                finalExp *= 2;
            }
            if (GameData.events.skill_point_bonus?.active && skillPointsGained > 0) {
                skillPointsGained += 1;
            }
        }
        
        // Add rewards to player (if gameState exists)
        if (typeof gameState !== 'undefined' && gameState.player) {
            gameState.player.gold += finalGold;
            gameState.player.exp += finalExp;
            gameState.player.skillPoints += skillPointsGained;
            
            // Check level up
            if (typeof checkLevelUp === 'function') {
                checkLevelUp();
            }
            
            // Save game
            if (typeof saveGame === 'function') {
                saveGame();
            }
            
            // Update UI
            if (typeof updateUI === 'function') {
                updateUI();
            }
        }
        
        // Show rewards based on what was obtained
        let rewardMessage = `
            <div style="font-size: 1.1em; margin-bottom: 10px;">üéâ Expedition Complete!</div>
            <div style="color: #f39c12;">üí∞ +${finalGold} Gold</div>
            <div style="color: #3498db;">‚≠ê +${finalExp} EXP</div>
        `;
        
        if (rewardType === 'skillpoint') {
            rewardMessage += `<div style="color: #9b59b6; margin-top: 8px;">‚ú® BONUS! üåü +${skillPointsGained} Skill Points</div>`;
        } else if (rewardType === 'gear' && droppedItem) {
            const itemName = (typeof GameData !== 'undefined' && GameData.equipment && GameData.equipment[droppedItem]) 
                ? GameData.equipment[droppedItem].name 
                : droppedItem;
            rewardMessage += `<div style="color: #e74c3c; margin-top: 8px;">üéä RARE DROP! üéÅ Found: ${itemName}!</div>`;
        }
        
        if (typeof showModal === 'function') {
            showModal('Victory!', rewardMessage);
        } else {
            alert(rewardMessage.replace(/<[^>]*>/g, ''));
        }
        
        console.log(`Claimed expedition: ${expedition.name}, rewards: ${finalGold} gold, ${finalExp} exp, ${skillPointsGained} SP`);
        
        // Remove expedition
        this.expeditions = this.expeditions.filter(e => e.id !== expeditionId);
        this.activeExpeditions = this.activeExpeditions.filter(e => e.id !== expeditionId);
        
        // Set refresh timer if all expeditions are done
        if (this.expeditions.length === 0 && !this.nextRefreshTime) {
            this.nextRefreshTime = Date.now() + 3600000; // 1 hour
            console.log('All expeditions completed, refresh timer set for 1 hour');
        }
        
        this.saveExpeditionData();
        this.render();
    },
    
    startStaminaRegen() {
        setInterval(() => {
            if (this.stamina < this.maxStamina) {
                this.stamina = Math.min(this.stamina + this.staminaRegenRate, this.maxStamina);
                this.lastStaminaUpdate = Date.now();
                this.updateStaminaBar();
                this.saveExpeditionData();
            }
        }, this.staminaRegenInterval);
    },
    
    startExpeditionTimers() {
        setInterval(() => {
            let needsUpdate = false;
            const now = Date.now();
            
            this.expeditions.forEach(expedition => {
                if (expedition.status === 'in-progress' && now >= expedition.endTime) {
                    expedition.status = 'completed';
                    needsUpdate = true;
                    console.log(`Expedition completed: ${expedition.name}`);
                }
            });
            
            if (needsUpdate) {
                this.saveExpeditionData();
                this.render();
            }
            
            // Update timers display
            this.updateTimers();
            
            // Check refresh timer
            if (this.nextRefreshTime && now >= this.nextRefreshTime) {
                console.log('Refresh timer expired, generating new expeditions');
                this.generateExpeditions();
                this.render();
            }
        }, 1000);
    },
    
    updateTimers() {
        const now = Date.now();
        
        this.expeditions.forEach(expedition => {
            if (expedition.status === 'in-progress') {
                const remaining = expedition.endTime - now;
                const timerElement = document.getElementById(`timer-${expedition.id}`);
                if (timerElement && remaining > 0) {
                    timerElement.textContent = this.formatTime(remaining);
                }
            }
        });
        
        // Update refresh timer
        if (this.nextRefreshTime) {
            const remaining = this.nextRefreshTime - now;
            const refreshElement = document.getElementById('refreshTimerValue');
            if (refreshElement && remaining > 0) {
                refreshElement.textContent = this.formatTime(remaining);
                document.getElementById('refreshTimer').style.display = 'block';
            } else if (refreshElement) {
                document.getElementById('refreshTimer').style.display = 'none';
            }
        } else {
            const refreshTimer = document.getElementById('refreshTimer');
            if (refreshTimer) {
                refreshTimer.style.display = 'none';
            }
        }
    },
    
    formatTime(ms) {
        const seconds = Math.floor(ms / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        
        if (hours > 0) {
            return `${hours}h ${minutes % 60}m`;
        } else if (minutes > 0) {
            return `${minutes}m ${seconds % 60}s`;
        } else {
            return `${seconds}s`;
        }
    },
    
    updateStaminaBar() {
        const staminaBar = document.getElementById('staminaBar');
        const staminaValue = document.getElementById('staminaValue');
        
        if (staminaBar && staminaValue) {
            const percentage = (this.stamina / this.maxStamina) * 100;
            staminaBar.style.width = percentage + '%';
            staminaValue.textContent = `${this.stamina}/${this.maxStamina}`;
        }
    },
    
    showMessage(message, type) {
        const color = type === 'error' ? '#e74c3c' : '#2ecc71';
        if (typeof showModal === 'function') {
            showModal('Info', `<div style="color: ${color};">${message}</div>`);
        } else {
            alert(message);
        }
    },
    
    render() {
        const container = document.getElementById('expeditionContainer');
        if (!container) return;
        
        const activeCount = this.getActiveExpeditionCount();
        
        // Show/hide active expedition notice
        const notice = document.getElementById('activeExpeditionNotice');
        if (notice) {
            notice.style.display = activeCount >= this.maxActiveExpeditions ? 'block' : 'none';
        }
        
        if (this.expeditions.length === 0) {
            container.innerHTML = `
                <div class="no-expeditions">
                    <div style="font-size: 3em; margin-bottom: 15px;">üó∫Ô∏è</div>
                    <div>No expeditions available</div>
                    <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
                        New expeditions will appear soon...
                    </div>
                </div>
            `;
            return;
        }
        
        container.innerHTML = this.expeditions.map(exp => {
            const isInProgress = exp.status === 'in-progress';
            const isCompleted = exp.status === 'completed';
            const isLocked = activeCount >= this.maxActiveExpeditions && exp.status === 'available';
            const canStart = exp.status === 'available' && this.stamina >= 30 && !isLocked;
            
            return `
                <div class="expedition-card ${isInProgress ? 'in-progress' : ''} ${isCompleted ? 'completed' : ''} ${isLocked ? 'locked' : ''}">
                    ${isLocked ? '<div class="locked-overlay">üîí Complete expeditions first (Max 3)</div>' : ''}
                    
                    <div class="stamina-cost">‚ö° 30</div>
                    
                    <div class="expedition-header">
                        <div class="expedition-title">
                            <span style="font-size: 1.5em;">${exp.icon}</span>
                            <span>${exp.name}</span>
                            <span class="expedition-difficulty difficulty-${exp.difficulty}">
                                ${exp.difficulty.toUpperCase()}
                            </span>
                        </div>
                    </div>
                    
                    <div class="expedition-duration">‚è±Ô∏è ${exp.durationLabel}</div>
                    
                    <div class="expedition-rewards">
                        <div class="reward-item">üí∞ ${exp.rewards.gold} Gold</div>
                        <div class="reward-item">‚≠ê ${exp.rewards.exp} EXP</div>
                    </div>
                    
                    <div class="reward-probability">
                        <div style="font-weight: bold; margin-bottom: 8px; color: #fff;">üéÅ Possible Rewards:</div>
                        <div class="probability-item">
                            <span style="color: #f39c12;">üí∞</span>
                            <span>Gold & EXP</span>
                        </div>
                        <div class="probability-item">
                            <span style="color: #9b59b6;">üåü</span>
                            <span>Skill Points</span>
                        </div>
                        <div class="probability-item">
                            <span style="color: #e74c3c;">üéÅ</span>
                            <span>Random Gear Drop</span>
                        </div>
                    </div>
                    
                    ${isInProgress ? `
                        <div class="expedition-timer">
                            ‚è≥ Time Remaining: <span id="timer-${exp.id}">Calculating...</span>
                        </div>
                    ` : ''}
                    
                    ${isCompleted ? `
                        <div class="expedition-timer" style="background: rgba(46, 204, 113, 0.2); color: #2ecc71;">
                            ‚úÖ Expedition Complete!
                        </div>
                    ` : ''}
                    
                    <div class="expedition-actions">
                        ${exp.status === 'available' ? `
                            <button class="expedition-btn start" 
                                    onclick="expeditionSystem.startExpedition(${exp.id})"
                                    ${!canStart ? 'disabled' : ''}>
                                üöÄ Start Expedition
                            </button>
                        ` : ''}
                        
                        ${isCompleted ? `
                            <button class="expedition-btn claim" 
                                    onclick="expeditionSystem.claimExpedition(${exp.id})">
                                üéÅ Claim Rewards
                            </button>
                        ` : ''}
                        
                        ${isInProgress ? `
                            <button class="expedition-btn" disabled style="background: #95a5a6;">
                                ‚è≥ In Progress...
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }).join('');
        
        this.updateStaminaBar();
        
        console.log('Rendered expeditions:', {
            total: this.expeditions.length,
            inProgress: this.expeditions.filter(e => e.status === 'in-progress').length,
            completed: this.expeditions.filter(e => e.status === 'completed').length,
            available: this.expeditions.filter(e => e.status === 'available').length,
            activeCount: activeCount
        });
    }
};

// Initialize expedition system when game loads
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing expedition system');
    expeditionSystem.init();
});

// Also initialize when script loads (in case DOM is already ready)
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => expeditionSystem.init());
} else {
    expeditionSystem.init();
}

// Helper function untuk show screen
function showScreen(screenId, buttonElement) {
    document.querySelectorAll('.screen').forEach(s => {
        s.classList.remove('active');
    });
    document.getElementById(screenId).classList.add('active');
    
    document.querySelectorAll('.nav-btn').forEach(b => {
        b.classList.remove('active');
    });
    if (buttonElement) {
        buttonElement.classList.add('active');
    }
    
    // Render expedition screen when opened
    if (screenId === 'expeditionScreen') {
        expeditionSystem.render();
    }
}

// Auto-save setiap 30 detik
setInterval(() => {
    if (expeditionSystem && typeof expeditionSystem.saveExpeditionData === 'function') {
        expeditionSystem.saveExpeditionData();
    }
}, 30000);

// Save saat window ditutup
window.addEventListener('beforeunload', () => {
    if (expeditionSystem && typeof expeditionSystem.saveExpeditionData === 'function') {
        expeditionSystem.saveExpeditionData();
    }
});
</script>

<!-- CSS untuk Artifacts - Manhwa/Manhua RPG System Style (Updated with Info) -->
<style>
    /* ===== MANHWA RPG SYSTEM INTERFACE ===== */
    
    /* Main Container - Full Screen Layout */
    .rpg-system-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0a0e27 100%);
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    /* Header Bar - Manhwa Style */
    .rpg-header-bar {
        position: relative;
        height: 60px;
        background: linear-gradient(180deg, rgba(20, 25, 45, 0.95) 0%, rgba(15, 20, 35, 0.98) 100%);
        border-bottom: 2px solid rgba(78, 205, 196, 0.3);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        z-index: 100;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    .rpg-header-bar::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(78, 205, 196, 0.5), transparent);
    }

    /* Back Button - Manhwa Style */
    .rpg-back-button {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: rgba(78, 205, 196, 0.1);
        border: 1px solid rgba(78, 205, 196, 0.3);
        border-radius: 6px;
        color: #4ecdc4;
        font-weight: 500;
        font-size: 11px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .rpg-back-button:hover {
        background: rgba(78, 205, 196, 0.2);
        border-color: #4ecdc4;
        transform: translateX(-2px);
    }

    .rpg-back-button span:first-child {
        font-size: 14px;
    }

    /* Title Section */
    .rpg-title-section {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
    }

    .rpg-title {
        font-size: 16px;
        font-weight: 600;
        color: #fff;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 0 0 8px rgba(78, 205, 196, 0.3);
        margin: 0;
    }

    .rpg-subtitle {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.5);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-top: 1px;
    }

    /* Navigation Tabs - New Addition */
    .rpg-nav-tabs {
        display: flex;
        gap: 15px;
        margin-left: auto;
        margin-right: 15px;
    }

    .rpg-nav-tab {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        background: rgba(20, 25, 45, 0.6);
        border: 1px solid rgba(78, 205, 196, 0.2);
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.7);
        font-weight: 500;
        font-size: 11px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .rpg-nav-tab:hover {
        background: rgba(78, 205, 196, 0.1);
        border-color: rgba(78, 205, 196, 0.4);
        color: #4ecdc4;
    }

    .rpg-nav-tab.active {
        background: rgba(78, 205, 196, 0.2);
        border-color: #4ecdc4;
        color: #4ecdc4;
        box-shadow: 0 0 10px rgba(78, 205, 196, 0.2);
    }

    .rpg-nav-tab span:first-child {
        font-size: 12px;
    }

    /* Gold Display - Manhwa Style */
    .rpg-gold-counter {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: linear-gradient(135deg, rgba(243, 156, 18, 0.2), rgba(230, 126, 34, 0.2));
        border: 1px solid rgba(243, 156, 18, 0.4);
        border-radius: 16px;
        font-weight: 600;
        font-size: 13px;
        color: #f39c12;
    }

    .rpg-gold-icon {
        font-size: 16px;
        filter: drop-shadow(0 0 5px rgba(243, 156, 18, 0.6));
    }

    /* Main Content Area */
    .rpg-content-area {
        flex: 1;
        display: flex;
        overflow: hidden;
        position: relative;
    }

    /* Side Panel - Stats & Info */
    .rpg-side-panel {
        width: 260px;
        background: rgba(15, 20, 35, 0.6);
        border-right: 1px solid rgba(78, 205, 196, 0.2);
        padding: 15px;
        overflow-y: auto;
        backdrop-filter: blur(10px);
    }

    .rpg-stat-card {
        background: rgba(20, 25, 45, 0.8);
        border: 1px solid rgba(78, 205, 196, 0.2);
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 12px;
    }

    .rpg-stat-title {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.6);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 6px;
    }

    .rpg-stat-value {
        font-size: 16px;
        font-weight: 600;
        color: #4ecdc4;
    }

    /* Center Panel - Main Content */
    .rpg-center-panel {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        overflow-x: hidden;
    }

    /* Grid System - Manhwa Style */
    .rpg-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 12px;
        padding: 8px;
    }

    /* Item Card - Manhwa Style */
    .rpg-item-card {
        position: relative;
        background: rgba(20, 25, 45, 0.6);
        border: 1px solid rgba(78, 205, 196, 0.2);
        border-radius: 6px;
        padding: 10px;
        cursor: pointer;
        transition: all 0.15s ease;
        backdrop-filter: blur(5px);
        will-change: transform;
    }

    .rpg-item-card:hover {
        background: rgba(20, 25, 45, 0.9);
        border-color: rgba(78, 205, 196, 0.5);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(78, 205, 196, 0.2);
    }

    /* Info Button - New Addition */
    .rpg-item-info-btn {
        position: absolute;
        top: 6px;
        right: 6px;
        width: 20px;
        height: 20px;
        background: rgba(52, 152, 219, 0.8);
        border: 1px solid rgba(52, 152, 219, 0.6);
        border-radius: 50%;
        color: white;
        font-size: 11px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        z-index: 10;
        backdrop-filter: blur(5px);
    }

    .rpg-item-info-btn:hover {
        background: rgba(52, 152, 219, 1);
        transform: scale(1.1);
        box-shadow: 0 0 8px rgba(52, 152, 219, 0.5);
    }

    .rpg-item-info-btn:active {
        transform: scale(0.95);
    }

    /* Rarity Borders */
    .rpg-item-card.rarity-common {
        border-color: rgba(149, 165, 166, 0.4);
    }

    .rpg-item-card.rarity-rare {
        border-color: rgba(52, 152, 219, 0.4);
        box-shadow: 0 0 8px rgba(52, 152, 219, 0.1);
    }

    .rpg-item-card.rarity-epic {
        border-color: rgba(155, 89, 182, 0.4);
        box-shadow: 0 0 8px rgba(155, 89, 182, 0.1);
    }

    .rpg-item-card.rarity-mythic {
        border-color: rgba(231, 76, 60, 0.4);
        box-shadow: 0 0 8px rgba(231, 76, 60, 0.1);
        animation: mythicGlow 2s ease-in-out infinite;
    }

    @keyframes mythicGlow {
        0%, 100% { box-shadow: 0 0 8px rgba(231, 76, 60, 0.2); }
        50% { box-shadow: 0 0 15px rgba(231, 76, 60, 0.4); }
    }

    .rpg-item-card.owned {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .rpg-item-card.owned .rpg-item-info-btn {
        opacity: 0.7;
    }

    .rpg-item-card.owned::after {
        content: '‚úì';
        position: absolute;
        top: 6px;
        right: 30px;
        width: 20px;
        height: 20px;
        background: rgba(46, 204, 113, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 12px;
        font-weight: bold;
    }

    /* Rarity Badge */
    .rpg-rarity-badge {
        position: absolute;
        top: 6px;
        left: 6px;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 8px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        z-index: 10;
    }

    .rpg-rarity-badge.common {
        background: rgba(149, 165, 166, 0.9);
        color: white;
    }

    .rpg-rarity-badge.rare {
        background: rgba(52, 152, 219, 0.9);
        color: white;
    }

    .rpg-rarity-badge.epic {
        background: rgba(155, 89, 182, 0.9);
        color: white;
    }

    .rpg-rarity-badge.mythic {
        background: rgba(231, 76, 60, 0.9);
        color: white;
    }

    /* Item Image */
    .rpg-item-image {
        width: 100%;
        aspect-ratio: 1;
        object-fit: contain;
        margin: 6px 0;
        filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));
    }

    .rpg-item-fallback {
        width: 100%;
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        background: rgba(30, 35, 55, 0.5);
        border-radius: 4px;
        margin: 6px 0;
    }

    /* Item Info */
    .rpg-item-name {
        font-size: 12px;
        font-weight: 500;
        color: #fff;
        margin: 6px 0 3px;
        text-align: center;
        line-height: 1.2;
        height: 30px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .rpg-item-stats {
        font-size: 10px;
        color: #4ecdc4;
        text-align: center;
        margin: 3px 0;
        font-weight: 500;
    }

    .rpg-item-price {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 3px;
        margin-top: 6px;
        padding: 4px;
        background: rgba(243, 156, 18, 0.15);
        border: 1px solid rgba(243, 156, 18, 0.3);
        border-radius: 4px;
        color: #f39c12;
        font-weight: 600;
        font-size: 11px;
    }

    /* Info Modal - New Addition */
    .rpg-info-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 99999;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
    }

    .rpg-info-modal.active {
        display: flex;
    }

    .rpg-info-modal-content {
        width: 90%;
        max-width: 500px;
        background: linear-gradient(135deg, #0f1423 0%, #1a1f3a 100%);
        border: 2px solid rgba(78, 205, 196, 0.4);
        border-radius: 12px;
        padding: 20px;
        position: relative;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
    }

    .rpg-info-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid rgba(78, 205, 196, 0.2);
    }

    .rpg-info-modal-title {
        font-size: 18px;
        font-weight: 600;
        color: #fff;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .rpg-info-modal-close {
        width: 30px;
        height: 30px;
        background: rgba(231, 76, 60, 0.2);
        border: 1px solid rgba(231, 76, 60, 0.4);
        border-radius: 50%;
        color: #e74c3c;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        font-weight: bold;
        line-height: 1;
    }

    .rpg-info-modal-close:hover {
        background: rgba(231, 76, 60, 0.3);
        border-color: #e74c3c;
        transform: rotate(90deg);
    }

    .rpg-info-content {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }

    .rpg-info-image-section {
        flex-shrink: 0;
        text-align: center;
    }

    .rpg-info-image {
        width: 120px;
        height: 120px;
        object-fit: contain;
        border-radius: 8px;
        border: 2px solid rgba(78, 205, 196, 0.3);
        padding: 10px;
        background: rgba(20, 25, 45, 0.5);
        filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.5));
    }

    .rpg-info-image-fallback {
        width: 120px;
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 60px;
        border-radius: 8px;
        border: 2px solid rgba(78, 205, 196, 0.3);
        background: rgba(20, 25, 45, 0.5);
    }

    .rpg-info-details {
        flex: 1;
    }

    .rpg-info-artifact-name {
        font-size: 20px;
        font-weight: 600;
        color: #fff;
        margin-bottom: 8px;
        text-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
    }

    .rpg-info-artifact-stats {
        font-size: 16px;
        color: #4ecdc4;
        font-weight: 500;
        margin-bottom: 12px;
        padding: 8px 12px;
        background: rgba(78, 205, 196, 0.1);
        border-radius: 6px;
        border: 1px solid rgba(78, 205, 196, 0.2);
    }

    .rpg-info-artifact-price {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 14px;
        color: #f39c12;
        font-weight: 600;
        margin-bottom: 15px;
        padding: 6px 10px;
        background: rgba(243, 156, 18, 0.1);
        border-radius: 6px;
        border: 1px solid rgba(243, 156, 18, 0.3);
        width: fit-content;
    }

    .rpg-info-lore-section {
        background: rgba(15, 20, 35, 0.8);
        border: 1px solid rgba(78, 205, 196, 0.2);
        border-radius: 8px;
        padding: 15px;
    }

    .rpg-info-lore-title {
        font-size: 14px;
        font-weight: 600;
        color: #bb8fce;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .rpg-info-lore-text {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.5;
        text-align: justify;
        font-style: italic;
    }

    /* Inventory Slot System */
    .rpg-slot-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 12px;
        padding: 8px;
    }

    .rpg-slot-card {
        position: relative;
        background: rgba(20, 25, 45, 0.6);
        border: 2px dashed rgba(78, 205, 196, 0.3);
        border-radius: 6px;
        padding: 12px;
        min-height: 180px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        backdrop-filter: blur(5px);
    }

    .rpg-slot-card:hover:not(.locked):not(.filled) {
        background: rgba(20, 25, 45, 0.9);
        border-color: rgba(78, 205, 196, 0.6);
        border-style: solid;
    }

    .rpg-slot-card.filled {
        border-style: solid;
        border-color: rgba(46, 204, 113, 0.5);
        background: rgba(46, 204, 113, 0.05);
        cursor: default;
    }

    .rpg-slot-card.locked {
        background: rgba(30, 20, 20, 0.6);
        border-color: rgba(231, 76, 60, 0.3);
        cursor: default;
    }

    .rpg-slot-number {
        position: absolute;
        top: 8px;
        left: 8px;
        width: 24px;
        height: 24px;
        background: rgba(78, 205, 196, 0.2);
        border: 1px solid rgba(78, 205, 196, 0.4);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 11px;
        color: #4ecdc4;
    }

    .rpg-slot-remove {
        position: absolute;
        top: 8px;
        right: 8px;
        width: 24px;
        height: 24px;
        background: rgba(231, 76, 60, 0.9);
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        font-weight: bold;
        line-height: 1;
    }

    .rpg-slot-remove:hover {
        background: rgba(231, 76, 60, 1);
        transform: scale(1.1);
    }

    .rpg-slot-lock-icon {
        font-size: 40px;
        color: rgba(231, 76, 60, 0.6);
        margin-bottom: 8px;
    }

    .rpg-slot-unlock-btn {
        margin-top: 8px;
        padding: 6px 12px;
        background: rgba(78, 205, 196, 0.2);
        border: 1px solid rgba(78, 205, 196, 0.4);
        border-radius: 4px;
        color: #4ecdc4;
        font-weight: 500;
        font-size: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .rpg-slot-unlock-btn:hover:not(:disabled) {
        background: rgba(78, 205, 196, 0.3);
        border-color: #4ecdc4;
    }

    .rpg-slot-unlock-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Timer Display */
    .rpg-timer-bar {
        background: rgba(15, 20, 35, 0.8);
        border: 1px solid rgba(78, 205, 196, 0.2);
        border-radius: 6px;
        padding: 12px 16px;
        margin: 12px 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .rpg-timer-label {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.6);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .rpg-timer-value {
        font-size: 16px;
        font-weight: 600;
        color: #4ecdc4;
        font-family: 'Courier New', monospace;
    }

    /* Action Button */
    .rpg-action-btn {
        padding: 8px 16px;
        background: linear-gradient(135deg, rgba(155, 89, 182, 0.3), rgba(142, 68, 173, 0.3));
        border: 1px solid rgba(155, 89, 182, 0.5);
        border-radius: 6px;
        color: #bb8fce;
        font-weight: 500;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition: all 0.2s ease;
        margin: 15px;
    }

    .rpg-action-btn:hover {
        background: linear-gradient(135deg, rgba(155, 89, 182, 0.4), rgba(142, 68, 173, 0.4));
        border-color: #bb8fce;
        transform: translateY(-1px);
    }

    /* Modal - Manhwa Style */
    .rpg-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        z-index: 9999;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(5px);
    }

    .rpg-modal.active {
        display: flex;
    }

    .rpg-modal-content {
        width: 90%;
        max-width: 800px;
        max-height: 80vh;
        background: linear-gradient(135deg, #0f1423 0%, #1a1f3a 100%);
        border: 2px solid rgba(78, 205, 196, 0.3);
        border-radius: 8px;
        padding: 20px;
        overflow-y: auto;
        position: relative;
    }

    .rpg-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(78, 205, 196, 0.2);
    }

    .rpg-modal-title {
        font-size: 16px;
        font-weight: 600;
        color: #fff;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .rpg-modal-close {
        width: 28px;
        height: 28px;
        background: rgba(231, 76, 60, 0.2);
        border: 1px solid rgba(231, 76, 60, 0.4);
        border-radius: 50%;
        color: #e74c3c;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        font-weight: bold;
        line-height: 1;
    }

    .rpg-modal-close:hover {
        background: rgba(231, 76, 60, 0.3);
        border-color: #e74c3c;
        transform: rotate(90deg);
    }

    /* Notification Toast */
    .rpg-toast {
        position: fixed;
        top: 80px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        background: rgba(15, 20, 35, 0.95);
        border: 1px solid rgba(78, 205, 196, 0.5);
        border-radius: 6px;
        color: #4ecdc4;
        font-weight: 500;
        font-size: 12px;
        z-index: 99999;
        backdrop-filter: blur(10px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
    }

    .rpg-toast.show {
        opacity: 1;
    }

    .rpg-toast.success {
        border-color: rgba(46, 204, 113, 0.5);
        color: #2ecc71;
    }

    .rpg-toast.error {
        border-color: rgba(231, 76, 60, 0.5);
        color: #e74c3c;
    }

    /* Scrollbar Styling */
    .rpg-side-panel::-webkit-scrollbar,
    .rpg-center-panel::-webkit-scrollbar,
    .rpg-modal-content::-webkit-scrollbar {
        width: 5px;
    }

    .rpg-side-panel::-webkit-scrollbar-track,
    .rpg-center-panel::-webkit-scrollbar-track,
    .rpg-modal-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
    }

    .rpg-side-panel::-webkit-scrollbar-thumb,
    .rpg-center-panel::-webkit-scrollbar-thumb,
    .rpg-modal-content::-webkit-scrollbar-thumb {
        background: rgba(78, 205, 196, 0.3);
        border-radius: 3px;
    }

    .rpg-side-panel::-webkit-scrollbar-thumb:hover,
    .rpg-center-panel::-webkit-scrollbar-thumb:hover,
    .rpg-modal-content::-webkit-scrollbar-thumb:hover {
        background: rgba(78, 205, 196, 0.5);
    }

    /* Empty State */
    .rpg-empty-state {
        text-align: center;
        padding: 50px 15px;
        color: rgba(255, 255, 255, 0.4);
        grid-column: 1 / -1;
    }

    .rpg-empty-icon {
        font-size: 50px;
        margin-bottom: 12px;
        opacity: 0.5;
    }

    .rpg-empty-text {
        font-size: 14px;
        font-weight: 500;
    }

    .rpg-empty-subtext {
        font-size: 11px;
        margin-top: 6px;
        opacity: 0.7;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .rpg-side-panel {
            display: none;
        }

        .rpg-grid {
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 10px;
        }

        .rpg-nav-tabs {
            display: none;
        }
    }

    @media (max-width: 768px) {
        .rpg-header-bar {
            height: 50px;
            padding: 0 12px;
        }

        .rpg-title {
            font-size: 14px;
        }

        .rpg-subtitle {
            display: none;
        }

        .rpg-back-button {
            padding: 5px 8px;
            font-size: 10px;
        }

        .rpg-gold-counter {
            font-size: 11px;
            padding: 5px 10px;
        }

        .rpg-grid {
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 8px;
            padding: 6px;
        }

        .rpg-slot-grid {
            grid-template-columns: 1fr;
        }

        .rpg-item-name {
            font-size: 11px;
            height: 26px;
        }

        .rpg-item-stats {
            font-size: 9px;
        }

        .rpg-modal-content {
            width: 95%;
            padding: 16px;
        }

        .rpg-info-modal-content {
            width: 95%;
            padding: 16px;
        }

        .rpg-info-content {
            flex-direction: column;
            text-align: center;
        }

        .rpg-info-image,
        .rpg-info-image-fallback {
            width: 100px;
            height: 100px;
        }

        .rpg-nav-tabs {
            display: flex;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 20, 35, 0.95);
            border-top: 2px solid rgba(78, 205, 196, 0.3);
            padding: 10px;
            gap: 10px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .rpg-nav-tab {
            flex: 1;
            justify-content: center;
        }
        
        .rpg-center-panel {
            padding-bottom: 70px;
        }
    }

    /* Performance Optimizations */
    .rpg-item-card,
    .rpg-slot-card {
        transform: translateZ(0);
        backface-visibility: hidden;
        perspective: 1000px;
    }

    /* Animation improvements */
    .rpg-info-modal-content {
        animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: scale(0.9) translateY(20px);
        }
        to {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }
</style>

<!-- Artifacts Shop Screen - Manhwa RPG Style -->
<div id="artifactsShopScreen" class="screen">
    <div class="rpg-system-container">
        <!-- Header Bar -->
        <div class="rpg-header-bar">
            <button class="rpg-back-button" onclick="Utils.showScreen('gameScreen')">
                <span>‚Üê</span>
                <span>BACK</span>
            </button>
            
            <div class="rpg-title-section">
                <div class="rpg-title">‚öîÔ∏è ARTIFACTS SHOP</div>
                <div class="rpg-subtitle">Equipment Store</div>
            </div>

            <!-- Navigation Tabs -->
            <div class="rpg-nav-tabs">
                <button class="rpg-nav-tab active" id="shopTab" onclick="ManhwaArtifacts.switchTab('shop')">
                    <span>üè™</span>
                    <span>SHOP</span>
                </button>
                <button class="rpg-nav-tab" id="inventoryTab" onclick="ManhwaArtifacts.switchTab('inventory')">
                    <span>üì¶</span>
                    <span>INVENTORY</span>
                </button>
            </div>
            
            <div class="rpg-gold-counter">
                <span class="rpg-gold-icon">üí∞</span>
                <span id="artifactShopGold">0</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="rpg-content-area">
            <!-- Side Panel -->
            <div class="rpg-side-panel">
                <div class="rpg-stat-card">
                    <div class="rpg-stat-title">‚è±Ô∏è Next Refresh</div>
                    <div class="rpg-stat-value" id="sideRefreshTimer">3:00:00</div>
                </div>
                
                <div class="rpg-stat-card">
                    <div class="rpg-stat-title">üì¶ Owned Artifacts</div>
                    <div class="rpg-stat-value" id="ownedCount">0</div>
                </div>
                
                <div class="rpg-stat-card">
                    <div class="rpg-stat-title">‚ö° Equipped</div>
                    <div class="rpg-stat-value" id="equippedCount">0</div>
                </div>
                
                <!-- Total Bonuses Display -->
                <div class="rpg-stat-card">
                    <div class="rpg-stat-title">‚öîÔ∏è Total Damage</div>
                    <div class="rpg-stat-value" id="totalDamageBonus">+0</div>
                </div>
                
                <div class="rpg-stat-card">
                    <div class="rpg-stat-title">‚ù§Ô∏è Total HP</div>
                    <div class="rpg-stat-value" id="totalHPBonus">+0</div>
                </div>
                
                <div class="rpg-stat-card">
                    <div class="rpg-stat-title">üíô Total MP</div>
                    <div class="rpg-stat-value" id="totalMPBonus">+0</div>
                </div>
            </div>

            <!-- Center Panel -->
            <div class="rpg-center-panel">
                <!-- Shop Content -->
                <div id="shopContent">
                    <div class="rpg-timer-bar">
                        <span class="rpg-timer-label">‚è∞ Shop Refreshes In:</span>
                        <span class="rpg-timer-value" id="mainRefreshTimer">3:00:00</span>
                    </div>

                    <div class="rpg-grid" id="artifactShopGrid">
                        <div class="rpg-empty-state">
                            <div class="rpg-empty-icon">‚öîÔ∏è</div>
                            <div class="rpg-empty-text">Loading Artifacts...</div>
                        </div>
                    </div>
                </div>

                <!-- Inventory Content -->
                <div id="inventoryContent" style="display: none;">
                    <div class="rpg-slot-grid" id="artifactSlots">
                        <div class="rpg-empty-state">
                            <div class="rpg-empty-icon">üì¶</div>
                            <div class="rpg-empty-text">Loading Slots...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Artifact Selection -->
<div id="artifactSelectionModal" class="rpg-modal">
    <div class="rpg-modal-content">
        <div class="rpg-modal-header">
            <div class="rpg-modal-title">‚öîÔ∏è SELECT ARTIFACT</div>
            <button class="rpg-modal-close" onclick="ManhwaArtifacts.closeModal()">√ó</button>
        </div>
        <div class="rpg-grid" id="artifactSelectionGrid"></div>
    </div>
</div>

<!-- Modal for Artifact Info -->
<div id="artifactInfoModal" class="rpg-info-modal">
    <div class="rpg-info-modal-content">
        <div class="rpg-info-modal-header">
            <div class="rpg-info-modal-title">üìú ARTIFACT INFO</div>
            <button class="rpg-info-modal-close" onclick="ManhwaArtifacts.closeInfoModal()">√ó</button>
        </div>
        
        <div class="rpg-info-content">
            <div class="rpg-info-image-section">
                <img id="infoArtifactImage" class="rpg-info-image" alt="Artifact" style="display: none;">
                <div id="infoArtifactImageFallback" class="rpg-info-image-fallback" style="display: none;"></div>
            </div>
            
            <div class="rpg-info-details">
                <div id="infoArtifactName" class="rpg-info-artifact-name"></div>
                <div id="infoArtifactRarity" class="rpg-rarity-badge"></div>
                <div id="infoArtifactStats" class="rpg-info-artifact-stats"></div>
                <div id="infoArtifactPrice" class="rpg-info-artifact-price"></div>
            </div>
        </div>
        
        <div class="rpg-info-lore-section">
            <div class="rpg-info-lore-title">
                <span>üìñ</span>
                <span>WEAPON LORE</span>
            </div>
            <div id="infoArtifactLore" class="rpg-info-lore-text"></div>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div id="rpgToast" class="rpg-toast"></div>

<!-- JavaScript untuk Manhwa RPG Artifacts System (Updated with Lore) -->
<script>
const ManhwaArtifacts = {
    artifacts: [
        { id: 1, name: 'Double Kunai', rarity: 'common', price: 1000, effect: { type: 'damage', value: 5 }, lore: 'Twin blades forged in the shadows of ancient dojos. These kunai were crafted by master smiths who believed that dual weapons represented the balance between offense and defense. Many novice ninjas have relied on these simple yet effective tools to begin their journey into the world of martial arts.' },
        { id: 2, name: 'Shuriken', rarity: 'common', price: 1200, effect: { type: 'hp', value: 20 }, lore: 'The most iconic throwing weapon of the ninja clans. Crafted from tempered steel and balanced for perfect flight, these star-shaped projectiles have been used for centuries. Legend says that a true master can throw eight shuriken simultaneously, each finding its mark with deadly precision.' },
        { id: 3, name: 'Multiple Shuriken', rarity: 'common', price: 1500, effect: { type: 'mp', value: 15 }, lore: 'A collection of smaller, lighter shuriken designed for rapid succession throws. Created by the Hayabusa clan, these weapons allow warriors to create a storm of steel in the air. Each shuriken is inscribed with ancient symbols that are said to guide them to their targets through the will of the wind spirits.' },
        { id: 4, name: 'Sai', rarity: 'common', price: 1800, effect: { type: 'damage', value: 8 }, lore: 'Traditional three-pronged weapons originally used by Okinawan farmers to defend their crops. The curved prongs can catch and disarm enemy blades while the center spike delivers precise strikes. Masters of the sai are known to wield them with such speed that they appear as silver blurs in combat.' },
        { id: 5, name: 'Tonfa', rarity: 'common', price: 2000, effect: { type: 'hp', value: 25 }, lore: 'Wooden clubs with perpendicular handles, originally used as rice grinders before becoming formidable weapons. The tonfa represents the philosophy that even the most mundane tools can become instruments of great power when wielded by those who understand their true potential. Many monastery guardians still prefer these humble weapons.' },
        { id: 6, name: 'Spiked Ball', rarity: 'common', price: 2200, effect: { type: 'damage', value: 10 }, lore: 'A crude but effective weapon consisting of a heavy iron ball covered in razor-sharp spikes. Born from desperation during the siege wars, these weapons were crafted by blacksmiths using whatever materials they could find. Despite their simple construction, they have claimed the lives of countless warriors who underestimated their brutal efficiency.' },
        { id: 7, name: 'Nunchaku', rarity: 'common', price: 2500, effect: { type: 'mp', value: 20 }, lore: 'Two wooden or metal sticks connected by a chain or cord, originally used as a farming flail. The nunchaku requires years of practice to master, as the weapon is as dangerous to its wielder as it is to enemies. Bruce Lee popularized these weapons, but their origins trace back to ancient Okinawan farmers who transformed their tools into symbols of resistance.' },
        { id: 8, name: 'Barbed Wire', rarity: 'common', price: 2800, effect: { type: 'damage', value: 12 }, lore: 'Twisted metal wire with sharp barbs, originally designed to contain livestock but quickly adapted for warfare. This unconventional weapon represents the ingenuity born from desperation. Wrapped around fists or used as a whip, barbed wire has become the signature weapon of underground fighters who prefer psychological warfare alongside physical damage.' },
        { id: 9, name: 'Chain Flail', rarity: 'common', price: 3000, effect: { type: 'hp', value: 30 }, lore: 'A heavy metal ball connected to a sturdy handle by a thick chain. This medieval weapon requires immense strength and skill to wield effectively. The chain flail was favored by knights who needed to crush heavily armored opponents, its swinging motion generating devastating force that could dent the finest plate armor.' },
        { id: 10, name: 'Boomerang', rarity: 'common', price: 3200, effect: { type: 'damage', value: 15 }, lore: 'A curved throwing stick that returns to its thrower when properly launched. Originally used by indigenous hunters, the boomerang has been adapted by modern warriors who appreciate its unique flight pattern. Masters can throw multiple boomerangs in sequence, creating a deadly aerial dance that confuses and overwhelms enemies.' },
        { id: 11, name: 'Rope Whip', rarity: 'rare', price: 11000, effect: { type: 'mp_reduction', value: 5 }, lore: 'A flexible weapon made from tightly woven silk cords, often tipped with metal fragments. Used by circus performers turned fighters, the rope whip combines grace with lethality. Its unpredictable movement patterns make it nearly impossible to defend against, and master whip users are known to disarm opponents from incredible distances.' },
        { id: 12, name: 'Hook', rarity: 'rare', price: 12000, effect: { type: 'damage', value: 18 }, lore: 'A curved metal implement originally used by dock workers and sailors, adapted for close combat. The hook excels at catching enemy weapons and armor, allowing skilled fighters to manipulate their opponents position. Pirates and naval fighters have long favored hooks for their versatility in both combat and utility aboard ships.' },
        { id: 13, name: 'Poison Vial', rarity: 'rare', price: 13000, effect: { type: 'hp', value: 40 }, lore: 'A small glass container filled with deadly toxins extracted from rare plants and venomous creatures. Created by alchemists who walk the thin line between healer and assassin, these vials contain concentrated death. The mere knowledge of possessing such weapons often prevents conflicts before they begin, as few dare to face a poison master.' },
        { id: 14, name: 'Spiked Bracelet', rarity: 'rare', price: 14000, effect: { type: 'damage', value: 20 }, lore: 'Ornate metal bracelets adorned with sharpened spikes, worn by ancient gladiators and modern street fighters alike. These defensive ornaments can turn a simple punch into a devastating attack. The spikes are often coated with various substances, from simple rust to exotic poisons, making each strike potentially lethal.' },
        { id: 15, name: 'Blowgun', rarity: 'rare', price: 15000, effect: { type: 'mp', value: 30 }, lore: 'A hollow tube used to fire small darts with precision and silence. Favored by jungle hunters and assassins, the blowgun represents the philosophy that the smallest weapons can achieve the greatest results. Master marksmen can hit targets at incredible distances, delivering everything from sleep-inducing darts to instant death.' },
        { id: 16, name: 'Brass Knuckles', rarity: 'rare', price: 16000, effect: { type: 'damage', value: 22 }, lore: 'Metal reinforcements worn over the knuckles to amplify the damage of punches. Popular among street fighters and underground brawlers, brass knuckles represent raw, unrefined combat power. These weapons have been crafted from various materials throughout history, from simple brass to exotic alloys, each adding its own deadly characteristics'},
        { id: 17, name: 'Throwing Axe', rarity: 'rare', price: 17000, effect: { type: 'hp', value: 45 }, lore: 'A specially balanced axe designed for throwing rather than melee combat. Used by northern warriors and lumberjacks turned fighters, these axes can cleave through armor and bone with equal ease. The art of axe throwing requires perfect timing and strength, as a missed throw leaves the warrior temporarily disarmed but creates psychological pressure on enemies.' },
        { id: 18, name: 'War Hammer', rarity: 'rare', price: 18000, effect: { type: 'damage', value: 25 }, lore: 'A heavy hammer designed specifically for warfare, capable of crushing armor and bones with devastating force. Favored by dwarven smiths and human knights alike, the war hammer represents the philosophy that sometimes the most direct approach is the most effective. Its weight requires great strength to wield, but the results are often instantly decisive.' },
        { id: 19, name: 'Chakram', rarity: 'rare', price: 19000, effect: { type: 'mp_reduction', value: 8 }, lore: 'A circular throwing weapon with sharpened edges, used by warriors of the eastern kingdoms. The chakram spins through the air with deadly precision, capable of severing limbs or returning to its thrower when properly thrown. Masters of this weapon are said to control multiple chakrams simultaneously, creating deadly geometric patterns in the air.' },
        { id: 20, name: 'Meteor Hammer', rarity: 'rare', price: 20000, effect: { type: 'damage', value: 28 }, lore: 'A rope or chain weapon with heavy metal spheres attached to both ends. Originating from ancient Chinese martial arts, the meteor hammer requires incredible skill to master due to its complex movement patterns. Warriors who achieve mastery can strike from unexpected angles and distances, making this weapon particularly effective against multiple opponents.' },
        { id: 21, name: 'Blood Kunai', rarity: 'epic', price: 51000, effect: { type: 'exp_boost', value: 10 }, lore: 'Cursed kunai forged from meteoric iron and quenched in the blood of ancient demons. These weapons pulse with dark energy and seem to guide themselves toward vital organs. Legend speaks of a master assassin who used these blades to eliminate an entire corrupt dynasty in a single night, the kunai drinking deeply from each kill and growing stronger with every drop of blood spilled.' },
        { id: 22, name: 'Ice Shards', rarity: 'epic', price: 53000, effect: { type: 'damage', value: 35 }, lore: 'Crystalline projectiles formed from eternal ice that never melts. Created by frost mages in the northern wastelands, these shards contain the essence of winter itself. Each impact not only pierces flesh but also spreads numbing cold through the victims body, slowing their movements and gradually freezing their blood from within.' },
        { id: 23, name: 'Lightning Bolt', rarity: 'epic', price: 55000, effect: { type: 'mp', value: 50 }, lore: 'Pure electrical energy contained within a crystalline matrix, allowing it to be thrown like a physical weapon. Crafted by storm shamans during the peak of thunderstorms, each bolt contains the raw power of nature itself. When released, it seeks the path of least resistance through its target, often jumping to nearby enemies in a chain of devastating electrical discharge.' },
        { id: 24, name: 'Dragon Claw', rarity: 'epic', price: 57000, effect: { type: 'hp', value: 70 }, lore: 'The actual claw of an ancient red dragon, preserved through powerful enchantments and shaped into a weapon. This artifact radiates intense heat and is said to burn with the dragons eternal flame. Warriors who wield it gain not only its physical power but also a fraction of the dragons legendary resilience and pride, making them nearly unstoppable in battle.' },
        { id: 25, name: 'Phoenix Feather', rarity: 'epic', price: 59000, effect: { type: 'gold_boost', value: 15 }, lore: 'A single feather from the legendary phoenix, glowing with inner fire and radiating warmth even in the coldest environments. This feather is said to bring fortune and prosperity to its bearer, as the phoenix represents rebirth and endless possibility. Merchants and adventurers prize these feathers above gold, believing they attract wealth and opportunity.' },
        { id: 26, name: 'Shadow Blade', rarity: 'epic', price: 61000, effect: { type: 'damage', value: 40 }, lore: 'A weapon forged from solidified darkness and tempered in the void between worlds. This blade appears as a shifting shadow that barely maintains its physical form. It cuts through both flesh and spirit, leaving wounds that heal slowly and scar the soul. Assassins who master shadow blades are said to become one with darkness itself, striking from dimensions beyond normal perception.' },
        { id: 27, name: 'Crystal Shard', rarity: 'epic', price: 63000, effect: { type: 'mp_reduction', value: 12 }, lore: 'A fragment of the legendary Crystal of Eternal Magic, containing concentrated arcane energy that resonates with spellcasters. This shard amplifies magical abilities while reducing the mental strain of casting spells. Mages who carry crystal shards report that their spells become more efficient and their magical reserves seem nearly bottomless during crucial moments.' },
        { id: 28, name: 'Void Orb', rarity: 'epic', price: 65000, effect: { type: 'exp_boost', value: 12 }, lore: 'A perfect sphere of crystallized nothingness, containing the essence of the void itself. This orb exists in a state between reality and non-existence, granting its bearer insights into the fundamental nature of existence. Philosophers and warriors alike seek these orbs, believing that understanding the void is the key to transcending mortal limitations and achieving true enlightenment.' },
        { id: 29, name: 'Flame Spear', rarity: 'epic', price: 67000, effect: { type: 'damage', value: 42 }, lore: 'A spear with a blade forged from condensed fire elemental essence, burning eternally without consuming fuel. Created by the salamander lords of the fire planes, this weapon can pierce through the strongest armor while simultaneously cauterizing the wounds it creates. The spear grows more powerful in hot environments and can ignite flammable materials with a mere touch.' },
        { id: 30, name: 'Wind Chakram', rarity: 'epic', price: 69000, effect: { type: 'hp', value: 75 }, lore: 'A circular blade that harnesses the power of wind elementals, allowing it to fly faster and farther than any normal throwing weapon. Crafted by sky dancers who live among the clouds, this chakram can change direction mid-flight and return to its thrower even against strong winds. Masters report that the weapon seems to have a mind of its own, seeking out enemies with supernatural accuracy.' },
        { id: 31, name: 'Demon Fang', rarity: 'mythic', price: 201000, effect: { type: 'damage', value: 80 }, lore: 'The fang of an archdemong lord, extracted during the Great Binding ritual that imprisoned the creature for eternity. This weapon pulses with malevolent energy and whispers dark promises to its wielder. Each strike not only inflicts devastating physical damage but also corrupts the target\'s soul, gradually turning enemies into thralls. Only heroes with unshakeable will can resist the fang\'s corrupting influence while wielding its power.' },
        { id: 32, name: 'Angel Wing', rarity: 'mythic', price: 205000, effect: { type: 'hp', value: 150 }, lore: 'A pristine white feather from an archangel\'s wing, radiating divine light and holy energy. This sacred artifact provides protection against all forms of evil and grants its bearer a portion of celestial grace. Warriors blessed with angel wings find their wounds healing faster, their spirits lifted, and their resolve strengthened. The wing also serves as a beacon of hope, inspiring allies and terrifying creatures of darkness.' },
        { id: 33, name: 'Cosmic Stone', rarity: 'mythic', price: 210000, effect: { type: 'mp', value: 200 }, lore: 'A fragment of the original star that gave birth to magic itself, containing infinite arcane potential within its crystalline structure. This stone exists partially outside normal space-time, allowing its bearer to tap into magical energies from across multiple dimensions. Archmages who possess cosmic stones report that reality itself seems more malleable, and impossible spells become merely difficult to cast.' },
        { id: 34, name: 'Time Crystal', rarity: 'mythic', price: 215000, effect: { type: 'exp_boost', value: 25 }, lore: 'A crystallized moment in time, trapped within a perfect geometric matrix that exists simultaneously in past, present, and future. This artifact allows its bearer to learn from experiences that haven\'t happened yet while retaining wisdom from ages past. Time crystals are said to accelerate personal growth by allowing warriors to experience countless battles and victories across multiple timelines simultaneously.' },
        { id: 35, name: 'Reality Shard', rarity: 'mythic', price: 220000, effect: { type: 'gold_boost', value: 30 }, lore: 'A fragment of pure possibility, containing the power to alter probability itself in favor of its bearer. This shard exists in a constant state of quantum flux, creating favorable outcomes and unlikely fortunes for those who carry it. Merchants report that deals always seem to fall in their favor, while adventurers find that treasure chests contain exactly what they need most. The shard bends luck itself to its wielder\'s will.' },
        { id: 36, name: 'Soul Reaper', rarity: 'mythic', price: 225000, effect: { type: 'damage', value: 85 }, lore: 'The personal weapon of Death itself, temporarily loaned to mortals who have impressed the Grim Reaper with their dedication to the art of ending lives. This scythe can cut through the barrier between life and death, inflicting wounds that affect not just the body but the very essence of existence. Each kill feeds the weapon, making it stronger and more thirsty for souls. Only those who can resist its hunger can wield it without losing themselves.' },
        { id: 37, name: 'Genesis Core', rarity: 'mythic', price: 230000, effect: { type: 'mp_reduction', value: 20 }, lore: 'The crystallized essence of creation itself, containing the same energy that sparked the birth of the universe. This core pulses with the rhythm of reality\'s heartbeat and grants its bearer the ability to manipulate fundamental forces with minimal effort. Wielders report that magic feels as natural as breathing, and even the most complex spells require barely a thought to manifest into reality.' },
        { id: 38, name: 'Infinity Blade', rarity: 'mythic', price: 235000, effect: { type: 'damage', value: 90 }, lore: 'A sword that exists in all possible states simultaneously, sharp enough to cut through dimensions and durable enough to survive the heat death of the universe. Forged in the space between realities by cosmic entities, this blade can cleave through any material, including abstract concepts like fate and destiny. Masters of the infinity blade are said to become living legends, their deeds echoing across all possible timelines.' },
        { id: 39, name: 'Void Heart', rarity: 'mythic', price: 240000, effect: { type: 'hp', value: 180 }, lore: 'The still-beating heart of an entity that existed before creation, containing life force that predates existence itself. This artifact grants its bearer resilience beyond mortal comprehension, allowing them to survive attacks that would erase others from reality. The heart beats in rhythm with the wielder\'s own, gradually transforming them into something more than mortal while retaining their essential humanity.' },
        { id: 40, name: 'Omniscient Eye', rarity: 'mythic', price: 245000, effect: { type: 'exp_boost', value: 30 }, lore: 'The preserved eye of an ancient oracle who achieved perfect wisdom before transcending physical existence. This artifact allows its bearer to see all possible futures and learn from infinite potential experiences simultaneously. Warriors who carry the omniscient eye find that they instinctively know the perfect response to any situation, as if they had lived through every possible variation of events countless times before.' },
        { id: 41, name: 'Absolute Zero Shard', rarity: 'mythic', price: 250000, effect: { type: 'damage', value: 95 }, lore: 'A fragment of the theoretical point where all motion ceases, containing cold so absolute that it can freeze time itself. Created during the death of a frost god, this shard radiates cold that affects not just temperature but the very concept of energy. Enemies struck by weapons containing this shard find their life force itself beginning to slow and eventually stop entirely.' },
        { id: 42, name: 'Divine Spark', rarity: 'mythic', price: 255000, effect: { type: 'gold_boost', value: 35 }, lore: 'A fragment of pure divinity that fell to the mortal realm during a war between gods. This spark contains the essence of divine authority and cosmic significance, making its bearer important to the fundamental structure of reality itself. Events and opportunities seem to arrange themselves around those who carry divine sparks, as if the universe itself conspires to ensure their success and prosperity.' },
        { id: 43, name: 'Eternal Flame', rarity: 'mythic', price: 260000, effect: { type: 'mp', value: 220 }, lore: 'The first flame that brought light to the universe, burning since the moment of creation without consuming any fuel. This flame contains the pure essence of magical energy in its most primal form. Mages who bond with the eternal flame find that their magical abilities transcend normal limitations, allowing them to cast spells that reshape reality itself with the same ease others light candles.' },
        { id: 44, name: 'Chaos Engine', rarity: 'mythic', price: 265000, effect: { type: 'mp_reduction', value: 25 }, lore: 'A mechanical device that harnesses the raw power of entropy and randomness, allowing its user to manipulate probability and causality. Created by mad artificers who sought to build a machine that could think impossible thoughts, the chaos engine makes the impossible merely improbable and the improbable inevitable. Users report that reality becomes more flexible around them, bending to accommodate their will.' },
        { id: 45, name: 'Perfect Balance', rarity: 'mythic', price: 270000, effect: { type: 'hp', value: 200 }, lore: 'A crystallized moment of perfect equilibrium between all opposing forces in the universe. This artifact grants its bearer harmony with all aspects of existence, making them nearly immune to extremes of any kind. Whether facing scorching fire or freezing cold, holy light or corrupting darkness, those who achieve perfect balance find that all forces pass through them harmlessly, unable to disturb their inner peace.' },
        { id: 46, name: 'Primal Scream', rarity: 'mythic', price: 275000, effect: { type: 'damage', value: 100 }, lore: 'The crystallized echo of the universe\'s birth cry, containing the raw emotional power of creation itself. This sonic weapon can shatter not just physical objects but also break apart magical constructs, dispel illusions, and even crack the foundations of reality. When unleashed, the primal scream reminds all who hear it of the awesome power that brought everything into existence from nothingness.' },
        { id: 47, name: 'Final Answer', rarity: 'mythic', price: 280000, effect: { type: 'exp_boost', value: 35 }, lore: 'A crystallized solution to the ultimate question of existence, containing the knowledge of everything that was, is, and ever could be. This artifact grants its bearer understanding so complete that learning becomes instantaneous and growth becomes exponential. Scholars who possess the final answer report that all knowledge feels familiar, as if they are simply remembering things they always knew but had forgotten.' },
        { id: 48, name: 'Universal Key', rarity: 'mythic', price: 285000, effect: { type: 'gold_boost', value: 40 }, lore: 'A master key that can unlock any barrier, whether physical, magical, or conceptual in nature. Forged by cosmic locksmiths from crystallized possibility, this key opens doors that lead to treasure chambers in dimensions that exist purely as mathematical concepts. Those who carry the universal key find that all barriers become permeable, all secrets become accessible, and all limitations become merely suggestions.' },
        { id: 49, name: 'Alpha Point', rarity: 'mythic', price: 290000, effect: { type: 'mp_reduction', value: 30 }, lore: 'The exact coordinate in space-time where the universe began, crystallized into a portable artifact that serves as a reference point for all magic. This device allows its bearer to cast spells with the authority of creation itself, reducing all magical costs to nearly nothing. Archmages who possess alpha points report that magic feels less like manipulation of energy and more like gentle suggestions to a cooperative universe.' },
        { id: 50, name: 'Omega Terminus', rarity: 'mythic', price: 300000, effect: { type: 'damage', value: 120 }, lore: 'The final moment of the universe crystallized into a weapon of absolute ending. This artifact contains the power to conclude anything - battles, spells, lives, or even concepts themselves. The omega terminus represents the inevitability of conclusion and the peace that comes with acceptance of ending. Warriors who master this weapon become agents of closure, able to bring definitive resolution to any conflict or challenge they encounter.' }
    ],

    // Lore data stored separately for easier management
    loreData: {
        1: 'Twin blades forged in the shadows of ancient dojos. These kunai were crafted by master smiths who believed that dual weapons represented the balance between offense and defense. Many novice ninjas have relied on these simple yet effective tools to begin their journey into the world of martial arts.',
        2: 'The most iconic throwing weapon of the ninja clans. Crafted from tempered steel and balanced for perfect flight, these star-shaped projectiles have been used for centuries. Legend says that a true master can throw eight shuriken simultaneously, each finding its mark with deadly precision.',
        3: 'A collection of smaller, lighter shuriken designed for rapid succession throws. Created by the Hayabusa clan, these weapons allow warriors to create a storm of steel in the air. Each shuriken is inscribed with ancient symbols that are said to guide them to their targets through the will of the wind spirits.',
        // ... continuing for all 50 artifacts
    },

    state: {
        availableArtifacts: [],
        ownedArtifacts: [],
        equippedSlots: [null, null, null, null, null, null],
        unlockedSlots: [true, false, false, false, false, false],
        slotPrices: [0, 10000, 25000, 50000, 100000, 200000],
        nextRefreshTime: 0,
        currentSelectedSlot: null,
        lastUpdateTime: 0
    },

    init() {
        this.loadData();
        this.generateShop();
        this.render();
        this.startTimer();
        this.updateGoldDisplay();
        
        console.log('üó°Ô∏è Manhwa Artifacts System initialized');
    },

    generateShop() {
        const now = Date.now();
        
        if (now >= this.state.nextRefreshTime || this.state.availableArtifacts.length === 0) {
            this.state.availableArtifacts = [];
            
            // Generate 6 random artifacts with weighted rarity
            for (let i = 0; i < 6; i++) {
                let rarity;
                const roll = Math.random() * 100;
                
                if (roll < 50) rarity = 'common';
                else if (roll < 75) rarity = 'rare';
                else if (roll < 90) rarity = 'epic';
                else rarity = 'mythic';
                
                const availableByRarity = this.artifacts.filter(a => 
                    a.rarity === rarity && 
                    !this.state.availableArtifacts.includes(a.id)
                );
                
                if (availableByRarity.length > 0) {
                    const selected = availableByRarity[Math.floor(Math.random() * availableByRarity.length)];
                    this.state.availableArtifacts.push(selected.id);
                }
            }
            
            this.state.nextRefreshTime = now + (3 * 60 * 60 * 1000); // 3 hours
            this.saveData();
        }
    },

    switchTab(tab) {
        const shopTab = document.getElementById('shopTab');
        const inventoryTab = document.getElementById('inventoryTab');
        const shopContent = document.getElementById('shopContent');
        const inventoryContent = document.getElementById('inventoryContent');
        
        if (tab === 'shop') {
            shopTab.classList.add('active');
            inventoryTab.classList.remove('active');
            shopContent.style.display = 'block';
            inventoryContent.style.display = 'none';
            this.renderShop();
        } else {
            inventoryTab.classList.add('active');
            shopTab.classList.remove('active');
            inventoryContent.style.display = 'block';
            shopContent.style.display = 'none';
            this.renderInventory();
        }
    },

    render() {
        this.renderShop();
        this.updateSidePanel();
    },

    renderShop() {
        const grid = document.getElementById('artifactShopGrid');
        if (!grid) return;
        
        requestAnimationFrame(() => {
            const fragment = document.createDocumentFragment();
            
            if (this.state.availableArtifacts.length === 0) {
                const empty = document.createElement('div');
                empty.className = 'rpg-empty-state';
                empty.innerHTML = `
                    <div class="rpg-empty-icon">üîÑ</div>
                    <div class="rpg-empty-text">Refreshing Shop...</div>
                `;
                fragment.appendChild(empty);
            } else {
                this.state.availableArtifacts.forEach(artifactId => {
                    const artifact = this.artifacts.find(a => a.id === artifactId);
                    if (artifact) {
                        const card = this.createItemCard(artifact);
                        fragment.appendChild(card);
                    }
                });
            }
            
            grid.innerHTML = '';
            grid.appendChild(fragment);
        });
    },

    renderInventory() {
        const grid = document.getElementById('artifactSlots');
        if (!grid) return;
        
        requestAnimationFrame(() => {
            const fragment = document.createDocumentFragment();
            
            for (let i = 0; i < 6; i++) {
                const card = this.createSlotCard(i);
                fragment.appendChild(card);
            }
            
            grid.innerHTML = '';
            grid.appendChild(fragment);
        });
    },

    createItemCard(artifact) {
        const isOwned = this.state.ownedArtifacts.includes(artifact.id);
        const canAfford = gameState.player && gameState.player.gold >= artifact.price;
        
        const card = document.createElement('div');
        card.className = `rpg-item-card rarity-${artifact.rarity}${isOwned ? ' owned' : ''}`;
        
        card.innerHTML = `
            <div class="rpg-rarity-badge ${artifact.rarity}">${artifact.rarity}</div>
            <button class="rpg-item-info-btn" onclick="ManhwaArtifacts.showArtifactInfo(${artifact.id}); event.stopPropagation();">i</button>
            <img src="https://mhtpsg.github.io/Ninja Legacy/artifacts/${artifact.id}.png" 
                 class="rpg-item-image" 
                 alt="${artifact.name}"
                 loading="lazy"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="rpg-item-fallback" style="display: none;">${this.getIcon(artifact.id)}</div>
            <div class="rpg-item-name">${artifact.name}</div>
            <div class="rpg-item-stats">${this.getEffectText(artifact.effect)}</div>
            <div class="rpg-item-price">
                <span>üí∞</span>
                <span>${artifact.price.toLocaleString()}</span>
            </div>
        `;

        if (!isOwned) {
            card.onclick = (e) => {
                if (e.target.classList.contains('rpg-item-info-btn')) return;
                this.buyArtifact(artifact.id);
            };
            if (!canAfford) {
                card.style.opacity = '0.6';
                card.style.cursor = 'not-allowed';
            }
        }

        return card;
    },

    showArtifactInfo(artifactId) {
        const artifact = this.artifacts.find(a => a.id === artifactId);
        if (!artifact) return;

        const modal = document.getElementById('artifactInfoModal');
        const nameEl = document.getElementById('infoArtifactName');
        const rarityEl = document.getElementById('infoArtifactRarity');
        const statsEl = document.getElementById('infoArtifactStats');
        const priceEl = document.getElementById('infoArtifactPrice');
        const loreEl = document.getElementById('infoArtifactLore');
        const imageEl = document.getElementById('infoArtifactImage');
        const imageFallback = document.getElementById('infoArtifactImageFallback');

        if (!modal || !nameEl || !statsEl || !loreEl) return;

        // Set artifact details
        nameEl.textContent = artifact.name;
        rarityEl.textContent = artifact.rarity;
        rarityEl.className = `rpg-rarity-badge ${artifact.rarity}`;
        statsEl.textContent = this.getEffectText(artifact.effect);
        priceEl.innerHTML = `<span>üí∞</span><span>${artifact.price.toLocaleString()} Gold</span>`;
        loreEl.textContent = artifact.lore || `Ancient weapon with mysterious origins. Artifact ID: ${artifact.id}`;

        // Set image
        imageEl.src = `https://mhtpsg.github.io/Ninja Legacy/artifacts/${artifact.id}.png`;
        imageEl.style.display = 'block';
        imageFallback.style.display = 'none';
        
        imageEl.onerror = () => {
            imageEl.style.display = 'none';
            imageFallback.style.display = 'flex';
            imageFallback.textContent = this.getIcon(artifact.id);
        };

        // Show modal
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    },

    closeInfoModal() {
        const modal = document.getElementById('artifactInfoModal');
        if (modal) {
            modal.classList.remove('active');
        }
        document.body.style.overflow = 'auto';
    },

    createSlotCard(index) {
        const isLocked = !this.state.unlockedSlots[index];
        const card = document.createElement('div');
        
        const artifactId = this.state.equippedSlots[index];
        const artifact = artifactId ? this.artifacts.find(a => a.id === artifactId) : null;
        
        card.className = `rpg-slot-card ${isLocked ? 'locked' : (artifact ? 'filled' : '')}`;
        
        if (isLocked) {
            const canUnlock = gameState.player && gameState.player.gold >= this.state.slotPrices[index];
            
            card.innerHTML = `
                <div class="rpg-slot-number">${index + 1}</div>
                <div class="rpg-slot-lock-icon">üîí</div>
                <div style="color: rgba(255, 255, 255, 0.6); font-size: 14px; font-weight: 600; margin: 8px 0;">
                    SLOT ${index + 1} LOCKED
                </div>
                <div style="color: rgba(231, 76, 60, 0.8); font-size: 12px; margin: 4px 0;">
                    Requires: ${this.state.slotPrices[index].toLocaleString()} Gold
                </div>
                <button class="rpg-slot-unlock-btn" 
                        onclick="ManhwaArtifacts.unlockSlot(${index})"
                        ${!canUnlock ? 'disabled' : ''}>
                    ${canUnlock ? 'üîì UNLOCK' : '‚ùå NOT ENOUGH GOLD'}
                </button>
            `;
        } else if (artifact) {
            card.innerHTML = `
                <div class="rpg-slot-number">${index + 1}</div>
                <button class="rpg-slot-remove" onclick="ManhwaArtifacts.removeArtifact(${index})">√ó</button>
                <button class="rpg-item-info-btn" style="top: 8px; right: 35px;" onclick="ManhwaArtifacts.showArtifactInfo(${artifact.id}); event.stopPropagation();">i</button>
                <img src="https://mhtpsg.github.io/Ninja Legacy/artifacts/${artifact.id}.png" 
                     class="rpg-item-image" 
                     alt="${artifact.name}"
                     loading="lazy"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                     style="width: 80px; height: 80px; object-fit: contain; margin: 10px 0;">
                <div class="rpg-item-fallback" style="display: none; width: 80px; height: 80px; font-size: 40px;">${this.getIcon(artifact.id)}</div>
                <div class="rpg-item-name" style="margin: 8px 0 4px;">${artifact.name}</div>
                <div class="rpg-rarity-badge ${artifact.rarity}" style="position: relative; margin: 4px 0;">${artifact.rarity}</div>
                <div class="rpg-item-stats" style="margin: 8px 0;">${this.getEffectText(artifact.effect)}</div>
                <div style="color: rgba(46, 204, 113, 0.8); font-size: 12px; font-weight: 600;">‚ö° EQUIPPED</div>
            `;
            
            card.onclick = null;
        } else {
            card.innerHTML = `
                <div class="rpg-slot-number">${index + 1}</div>
                <div style="font-size: 48px; color: rgba(78, 205, 196, 0.3); margin: 20px 0;">‚öîÔ∏è</div>
                <div style="color: rgba(255, 255, 255, 0.6); font-size: 14px; font-weight: 600; margin: 8px 0;">
                    EMPTY SLOT
                </div>
                <div style="color: rgba(78, 205, 196, 0.8); font-size: 12px; font-weight: 600;">
                    Click to equip artifact
                </div>
            `;
            
            card.onclick = () => this.openSelection(index);
        }
        
        return card;
    },

    updateSidePanel() {
        const bonuses = this.getEquippedBonuses();
        
        const elements = {
            ownedCount: document.getElementById('ownedCount'),
            equippedCount: document.getElementById('equippedCount'),
            totalDamageBonus: document.getElementById('totalDamageBonus'),
            totalHPBonus: document.getElementById('totalHPBonus'),
            totalMPBonus: document.getElementById('totalMPBonus')
        };
        
        if (elements.ownedCount) elements.ownedCount.textContent = this.state.ownedArtifacts.length;
        if (elements.equippedCount) elements.equippedCount.textContent = this.state.equippedSlots.filter(slot => slot !== null).length;
        if (elements.totalDamageBonus) elements.totalDamageBonus.textContent = `+${bonuses.damage}`;
        if (elements.totalHPBonus) elements.totalHPBonus.textContent = `+${bonuses.hp}`;
        if (elements.totalMPBonus) elements.totalMPBonus.textContent = `+${bonuses.mp}`;
    },

    startTimer() {
        const updateTimer = () => {
            const now = Date.now();
            const timeLeft = Math.max(0, this.state.nextRefreshTime - now);
            
            if (timeLeft === 0) {
                this.generateShop();
                this.renderShop();
            }
            
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const mainTimer = document.getElementById('mainRefreshTimer');
            const sideTimer = document.getElementById('sideRefreshTimer');
            
            if (mainTimer) mainTimer.textContent = timeString;
            if (sideTimer) sideTimer.textContent = timeString;
        };
        
        updateTimer();
        setInterval(updateTimer, 1000);
    },

    updateGoldDisplay() {
        const goldEl = document.getElementById('artifactShopGold');
        if (goldEl && gameState.player) {
            goldEl.textContent = gameState.player.gold.toLocaleString();
        }
        
        setTimeout(() => this.updateGoldDisplay(), 1000);
    },

    getIcon(id) {
        const icons = ['‚öîÔ∏è', 'üó°Ô∏è', 'üèπ', 'üî™', '‚ö°', 'üî•', '‚ùÑÔ∏è', 'üíé', 'üåü', 'üíÄ'];
        return icons[id % icons.length];
    },

    getEffectText(effect) {
        const typeMap = {
            damage: 'DMG',
            hp: 'HP', 
            mp: 'MP',
            mp_reduction: 'MP Cost',
            exp_boost: 'EXP',
            gold_boost: 'Gold'
        };
        
        const symbol = {
            damage: '‚öîÔ∏è',
            hp: '‚ù§Ô∏è',
            mp: 'üíô',
            mp_reduction: '‚ö°',
            exp_boost: '‚ú®',
            gold_boost: 'üí∞'
        };
        
        const prefix = effect.type.includes('boost') || effect.type.includes('reduction') ? '+' : '+';
        const suffix = effect.type.includes('boost') || effect.type.includes('reduction') ? '%' : '';
        
        return `${symbol[effect.type]} ${prefix}${effect.value}${suffix} ${typeMap[effect.type]}`;
    },

    // Continue with remaining methods...
    buyArtifact(artifactId) {
        if (!gameState.player) return;
        
        const artifact = this.artifacts.find(a => a.id === artifactId);
        if (!artifact) return;
        
        if (gameState.player.gold < artifact.price) {
            this.showToast('‚ùå Not enough gold!', 'error');
            return;
        }
        
        if (this.state.ownedArtifacts.includes(artifactId)) {
            this.showToast('‚ö†Ô∏è Already owned!', 'error');
            return;
        }
        
        gameState.player.gold -= artifact.price;
        this.state.ownedArtifacts.push(artifactId);
        this.saveData();
        
        this.showToast(`‚úÖ Acquired ${artifact.name}!`, 'success');
        this.renderShop();
        this.updateSidePanel();
        
        if (typeof updateDisplay === 'function') {
            updateDisplay();
        }
    },

    unlockSlot(index) {
        if (!gameState.player) return;
        
        const price = this.state.slotPrices[index];
        
        if (gameState.player.gold < price) {
            this.showToast('‚ùå Not enough gold!', 'error');
            return;
        }
        
        if (this.state.unlockedSlots[index]) {
            this.showToast('‚ö†Ô∏è Slot already unlocked!', 'error');
            return;
        }
        
        gameState.player.gold -= price;
        this.state.unlockedSlots[index] = true;
        this.saveData();
        
        this.showToast(`‚úÖ Unlocked Slot ${index + 1}!`, 'success');
        this.renderInventory();
        this.updateSidePanel();
        
        if (typeof updateDisplay === 'function') {
            updateDisplay();
        }
    },

    removeArtifact(index) {
        const artifactId = this.state.equippedSlots[index];
        if (!artifactId) return;
        
        this.state.equippedSlots[index] = null;
        this.saveData();
        
        this.showToast('‚úÖ Artifact removed!', 'success');
        this.renderInventory();
        this.updateSidePanel();
        
        if (typeof updateDisplay === 'function') {
            updateDisplay();
        }
    },

    openSelection(slotIndex) {
        this.state.currentSelectedSlot = slotIndex;
        const modal = document.getElementById('artifactSelectionModal');
        const grid = document.getElementById('artifactSelectionGrid');
        
        if (!modal || !grid) return;
        
        const fragment = document.createDocumentFragment();
        
        if (this.state.ownedArtifacts.length === 0) {
            const empty = document.createElement('div');
            empty.className = 'rpg-empty-state';
            empty.innerHTML = `
                <div class="rpg-empty-icon">üì¶</div>
                <div class="rpg-empty-text">No artifacts owned</div>
                <div class="rpg-empty-subtext">Visit the shop to acquire artifacts!</div>
            `;
            fragment.appendChild(empty);
        } else {
            this.state.ownedArtifacts.forEach(artifactId => {
                const artifact = this.artifacts.find(a => a.id === artifactId);
                if (!artifact) return;
                
                const alreadyEquipped = this.state.equippedSlots.includes(artifactId);
                const equippedSlot = this.state.equippedSlots.findIndex(id => id === artifactId);
                
                const card = this.createSelectionCard(artifact, alreadyEquipped, equippedSlot);
                fragment.appendChild(card);
            });
        }
        
        grid.innerHTML = '';
        grid.appendChild(fragment);
        modal.classList.add('active');
        
        document.body.style.overflow = 'hidden';
    },

    createSelectionCard(artifact, alreadyEquipped, equippedSlot) {
        const card = document.createElement('div');
        card.className = `rpg-item-card rarity-${artifact.rarity}${alreadyEquipped ? ' owned' : ''}`;
        
        card.innerHTML = `
            <div class="rpg-rarity-badge ${artifact.rarity}">${artifact.rarity}</div>
            <button class="rpg-item-info-btn" onclick="ManhwaArtifacts.showArtifactInfo(${artifact.id}); event.stopPropagation();">i</button>
            <img src="https://mhtpsg.github.io/Ninja Legacy/artifacts/${artifact.id}.png" 
                 class="rpg-item-image" 
                 alt="${artifact.name}"
                 loading="lazy"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="rpg-item-fallback" style="display: none;">${this.getIcon(artifact.id)}</div>
            <div class="rpg-item-name">${artifact.name}</div>
            <div class="rpg-item-stats">${this.getEffectText(artifact.effect)}</div>
            ${alreadyEquipped ? 
                `<div style="color: #f39c12; margin: 8px 0; font-weight: 600; font-size: 12px;">‚ö° Equipped in Slot ${equippedSlot + 1}</div>` : 
                '<div style="color: #4ecdc4; margin: 8px 0; font-weight: 600; font-size: 12px;">‚úÖ Available</div>'
            }
        `;

        if (!alreadyEquipped) {
            card.onclick = (e) => {
                if (e.target.classList.contains('rpg-item-info-btn')) return;
                this.equipArtifact(artifact.id);
            };
            card.style.cursor = 'pointer';
        } else {
            card.style.opacity = '0.6';
            card.style.cursor = 'not-allowed';
        }

        return card;
    },

    equipArtifact(artifactId) {
        if (this.state.currentSelectedSlot === null) return;
        
        const artifact = this.artifacts.find(a => a.id === artifactId);
        if (!artifact) return;
        
        this.state.equippedSlots[this.state.currentSelectedSlot] = artifactId;
        this.saveData();
        
        this.showToast(`‚úÖ Equipped ${artifact.name}!`, 'success');
        this.closeModal();
        this.renderInventory();
        this.updateSidePanel();
        
        if (typeof updateDisplay === 'function') {
            updateDisplay();
        }
    },

    closeModal() {
        const modal = document.getElementById('artifactSelectionModal');
        if (modal) {
            modal.classList.remove('active');
        }
        this.state.currentSelectedSlot = null;
        document.body.style.overflow = 'auto';
    },

    showToast(message, type = 'info') {
        const toast = document.getElementById('rpgToast');
        if (!toast) return;
        
        toast.textContent = message;
        toast.className = `rpg-toast ${type} show`;
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    },

    getEquippedBonuses() {
        const bonuses = {
            damage: 0,
            hp: 0,
            mp: 0,
            mpReduction: 0,
            expBoost: 0,
            goldBoost: 0
        };

        this.state.equippedSlots.forEach(artifactId => {
            if (artifactId) {
                const artifact = this.artifacts.find(a => a.id === artifactId);
                if (artifact) {
                    switch(artifact.effect.type) {
                        case 'damage':
                            bonuses.damage += artifact.effect.value;
                            break;
                        case 'hp':
                            bonuses.hp += artifact.effect.value;
                            break;
                        case 'mp':
                            bonuses.mp += artifact.effect.value;
                            break;
                        case 'mp_reduction':
                            bonuses.mpReduction += artifact.effect.value;
                            break;
                        case 'exp_boost':
                            bonuses.expBoost += artifact.effect.value;
                            break;
                        case 'gold_boost':
                            bonuses.goldBoost += artifact.effect.value;
                            break;
                    }
                }
            }
        });

        return bonuses;
    },

    // Method untuk apply bonus artifacts ke player stats
    applyArtifactBonuses(player) {
        if (!player) return player;
        
        const bonuses = this.getEquippedBonuses();
        
        // Apply bonus HP
        if (bonuses.hp > 0) {
            const oldMaxHP = player.maxHP || 100;
            player.maxHP = (player.baseMaxHP || oldMaxHP) + bonuses.hp;
            
            // Jika HP current melebihi max baru, adjust
            if (player.hp > player.maxHP) {
                player.hp = player.maxHP;
            }
        }
        
        // Apply bonus MP
        if (bonuses.mp > 0) {
            const oldMaxMP = player.maxMP || 100;
            player.maxMP = (player.baseMaxMP || oldMaxMP) + bonuses.mp;
            
            // Jika MP current melebihi max baru, adjust
            if (player.mp > player.maxMP) {
                player.mp = player.maxMP;
            }
        }
        
        // Store bonuses untuk diakses di battle system
        player.artifactBonuses = bonuses;
        
        return player;
    },

    // Method untuk calculate damage dengan artifact bonus
    calculateDamageBonus(baseDamage) {
        const bonuses = this.getEquippedBonuses();
        return baseDamage + bonuses.damage;
    },

    // Method untuk calculate MP cost dengan artifact reduction
    calculateMPCost(baseCost) {
        const bonuses = this.getEquippedBonuses();
        const reduction = bonuses.mpReduction / 100; // Convert percentage
        return Math.max(1, Math.floor(baseCost * (1 - reduction)));
    },

    // Method untuk calculate EXP dengan artifact boost
    calculateEXPGain(baseEXP) {
        const bonuses = this.getEquippedBonuses();
        const boost = bonuses.expBoost / 100; // Convert percentage
        return Math.floor(baseEXP * (1 + boost));
    },

    // Method untuk calculate Gold dengan artifact boost
    calculateGoldGain(baseGold) {
        const bonuses = this.getEquippedBonuses();
        const boost = bonuses.goldBoost / 100; // Convert percentage
        return Math.floor(baseGold * (1 + boost));
    },

    saveData() {
        try {
            const data = {
                availableArtifacts: this.state.availableArtifacts,
                ownedArtifacts: this.state.ownedArtifacts,
                equippedSlots: this.state.equippedSlots,
                unlockedSlots: this.state.unlockedSlots,
                nextRefreshTime: this.state.nextRefreshTime
            };
            
            localStorage.setItem('manhwaArtifactsData', JSON.stringify(data));
        } catch (error) {
            console.error('‚ùå Failed to save artifact data:', error);
        }
    },

    loadData() {
        try {
            const saved = localStorage.getItem('manhwaArtifactsData');
            if (saved) {
                const data = JSON.parse(saved);
                
                this.state.availableArtifacts = data.availableArtifacts || [];
                this.state.ownedArtifacts = data.ownedArtifacts || [];
                this.state.equippedSlots = data.equippedSlots || [null, null, null, null, null, null];
                this.state.unlockedSlots = data.unlockedSlots || [true, false, false, false, false, false];
                this.state.nextRefreshTime = data.nextRefreshTime || 0;
                
                console.log('‚úÖ Manhwa artifact data loaded successfully');
            }
        } catch (error) {
            console.error('‚ùå Failed to load artifact data:', error);
        }
    }
};

// Close modal when clicking outside
document.addEventListener('click', function(e) {
    const infoModal = document.getElementById('artifactInfoModal');
    const selectionModal = document.getElementById('artifactSelectionModal');
    
    if (e.target === infoModal) {
        ManhwaArtifacts.closeInfoModal();
    }
    
    if (e.target === selectionModal) {
        ManhwaArtifacts.closeModal();
    }
});

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        if (typeof gameState !== 'undefined' && gameState.player) {
            ManhwaArtifacts.init();
        } else {
            const retryInit = setInterval(() => {
                if (typeof gameState !== 'undefined' && gameState.player) {
                    ManhwaArtifacts.init();
                    clearInterval(retryInit);
                }
            }, 500);
        }
    }, 1000);
});

// Expose for global access
window.ManhwaArtifacts = ManhwaArtifacts;

console.log('üó°Ô∏è Manhwa RPG Artifacts System with Info Modal loaded successfully!');
</script>



    <!-- Arena -->
    
    <style>        
        /* Arena Styles - Updated */
        .arena-menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .arena-menu-card {
            background: linear-gradient(135deg, rgba(233, 69, 96, 0.1) 0%, rgba(78, 205, 196, 0.1) 100%);
            border: 2px solid rgba(78, 205, 196, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .arena-menu-card:active {
            transform: scale(0.95);
        }

        .arena-menu-card:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        }

        .arena-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .arena-battle-header {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .enemy-counter {
            font-size: 1.2em;
            color: var(--primary-color);
            font-weight: bold;
        }

        .arena-fighter {
            text-align: center;
            flex: 1;
        }

        .arena-fighter-sprite {
            font-size: 5em;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 20px rgba(255,255,255,0.4));
        }

        .arena-hp-bar {
            max-width: 150px;
            margin: 10px auto;
        }

        .arena-skill-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .arena-skill-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            position: relative;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
        }

        .arena-skill-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .arena-skill-btn.empty-slot {
            background: rgba(255,255,255,0.05);
            border: 2px dashed rgba(78, 205, 196, 0.3);
        }

        .arena-skill-btn.empty-slot:hover {
            border-color: var(--secondary-color);
            background: rgba(78, 205, 196, 0.1);
        }

        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .shop-item {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 200px;
        }

        .shop-item:hover {
            border-color: var(--secondary-color);
            background: rgba(78, 205, 196, 0.1);
        }

        .shop-item.owned {
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.1);
        }

        .shop-item.equipped {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
        }

        .shop-price {
            margin-top: auto;
            padding: 8px 12px;
            background: rgba(78, 205, 196, 0.2);
            border-radius: 8px;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .shop-description {
            font-size: 0.85em;
            color: #bbb;
            margin: 10px 0;
        }

        .milestone-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid #666;
            transition: all 0.3s ease;
            position: relative;
            min-height: 180px;
        }

        .milestone-card.unlocked {
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.1);
        }

        .heal-actions {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .heal-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .heal-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .profile-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .purchase-log {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .log-item {
            padding: 8px;
            margin: 5px 0;
            background: rgba(78, 205, 196, 0.1);
            border-left: 3px solid var(--secondary-color);
            border-radius: 5px;
            font-size: 0.9em;
        }

        .milestone-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .package-card {
            background: linear-gradient(135deg, rgba(233, 69, 96, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            border: 2px solid var(--primary-color);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }

        .package-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .package-item {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
        }

        .battle-actions-bottom {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .battle-actions-bottom button {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .gear-boost-tabs {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(78, 205, 196, 0.3);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: rgba(78, 205, 196, 0.2);
            border-color: var(--secondary-color);
        }

        /* Loadout Container dengan scroll */
        .loadout-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            margin: 15px 0;
            /* Custom scrollbar */
            scrollbar-width: thin;
            scrollbar-color: var(--secondary-color) rgba(255,255,255,0.1);
        }

        .loadout-container::-webkit-scrollbar {
            width: 8px;
        }

        .loadout-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        .loadout-container::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: 4px;
        }

        .loadout-container::-webkit-scrollbar-thumb:hover {
            background: rgba(78, 205, 196, 0.8);
        }

        .loadout-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .loadout-slot {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .loadout-slot.empty {
            border: 2px dashed rgba(78, 205, 196, 0.3);
        }

        .loadout-slot.empty:hover {
            border-color: var(--secondary-color);
            background: rgba(78, 205, 196, 0.1);
        }

        .loadout-slot.filled {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
        }

        .loadout-slot.filled:hover {
            border-color: #f39c12;
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.3);
        }

        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            overflow-y: auto;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            margin: 5% auto;
            padding: 30px;
            border: 2px solid var(--secondary-color);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 0 30px rgba(78, 205, 196, 0.3);
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: var(--secondary-color);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .modal-action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .modal-action-btn.select {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .modal-action-btn.remove {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .modal-action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .modal-grid-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            /* Custom scrollbar for modal */
            scrollbar-width: thin;
            scrollbar-color: var(--secondary-color) rgba(255,255,255,0.1);
        }

        .modal-grid-container::-webkit-scrollbar {
            width: 8px;
        }

        .modal-grid-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        .modal-grid-container::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: 4px;
        }

        .modal-grid-container::-webkit-scrollbar-thumb:hover {
            background: rgba(78, 205, 196, 0.8);
        }

        .modal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }

        .modal-item {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-item:hover {
            border-color: var(--secondary-color);
            background: rgba(78, 205, 196, 0.1);
            transform: translateY(-5px);
        }

        .modal-item.selected {
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.2);
        }

        .modal-item.equipped {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
        }
    </style>

<!-- Audio element dengan URL GitHub Pages -->
<!-- Audio element dengan URL GitHub Pages -->
<audio id="bgMusic" loop preload="auto">
    <source src="https://hadrianuspage.github.io/theme.mp3" type="audio/mpeg">
</audio>

<!-- Kontrol musik (tidak tampil) -->
<div id="musicControl" style="position: fixed; top: 20px; right: 20px; z-index: 1001; background: rgba(0,0,0,0.7); border-radius: 10px; padding: 5px; display: none;">
    <button id="musicToggle" style="background: none; border: none; color: white; padding: 10px; border-radius: 50%; cursor: pointer; font-size: 1.5em;">
        üîá
    </button>
    <span id="musicStatus" style="color: white; font-size: 0.8em; margin-left: 5px;">OFF</span>
</div>

<style>
.afk-container {
    max-width: 400px;
    margin: 0 auto;
}

.afk-status-card {
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    margin: 20px 0;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(78, 205, 196, 0.3);
}

.afk-timer {
    font-size: 2.5em;
    font-weight: bold;
    color: var(--secondary-color);
    margin: 15px 0;
    text-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
}

.afk-rewards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin: 20px 0;
}

.reward-item {
    background: rgba(0,0,0,0.3);
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.1);
}

.reward-icon {
    font-size: 2em;
    margin-bottom: 8px;
}

.reward-amount {
    font-size: 1.2em;
    font-weight: bold;
    color: var(--secondary-color);
}

.afk-info {
    background: rgba(0,0,0,0.3);
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
    font-size: 0.9em;
    line-height: 1.6;
    color: #bbb;
}

.afk-progress-bar {
    width: 100%;
    height: 25px;
    background: rgba(0,0,0,0.4);
    border-radius: 12px;
    overflow: hidden;
    margin: 15px 0;
    border: 1px solid rgba(255,255,255,0.1);
}

.afk-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4ecdc4, #45b7d1);
    transition: width 1s linear;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8em;
    font-weight: bold;
    box-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
}

.afk-status-paused {
    color: #e74c3c !important;
    animation: pulse 2s infinite;
}

.afk-status-active {
    color: #f39c12 !important;
}

.afk-status-collecting {
    color: #2ecc71 !important;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.02); opacity: 0.8; }
}

@keyframes glow {
    0%, 100% { box-shadow: 0 0 10px rgba(78, 205, 196, 0.5); }
    50% { box-shadow: 0 0 20px rgba(78, 205, 196, 0.8); }
}

.afk-active .afk-progress-fill {
    animation: glow 3s infinite;
}
</style>

<!-- AFK Screen -->
<div id="afkScreen" class="screen">
    <h1 class="main-title">üí§ AFK Farming</h1>
    
    <div class="afk-container">
        <div class="afk-status-card">
            <div style="font-size: 1.5em; margin-bottom: 15px;">‚è∞ AFK Timer</div>
            <div class="afk-timer" id="afkTimer">00:00</div>
            <div id="afkStatus" class="afk-status-paused" style="font-size: 1.1em;">Open AFK screen to start farming...</div>
            
            <!-- Progress Bar -->
            <div class="afk-progress-bar">
                <div class="afk-progress-fill" id="afkProgressFill" style="width: 0%;">
                    <span id="afkProgressText">0%</span>
                </div>
            </div>
        </div>

        <div class="afk-rewards">
            <div class="reward-item">
                <div class="reward-icon">‚≠ê</div>
                <div class="reward-amount" id="pendingExp">0</div>
                <div style="font-size: 0.8em; color: #bbb;">EXP</div>
            </div>
            <div class="reward-item">
                <div class="reward-icon">üí∞</div>
                <div class="reward-amount" id="pendingGold">0</div>
                <div style="font-size: 0.8em; color: #bbb;">Gold</div>
            </div>
            <div class="reward-item">
                <div class="reward-icon">üîÆ</div>
                <div class="reward-amount" id="pendingSkillPoints">0</div>
                <div style="font-size: 0.8em; color: #bbb;">Skill Points</div>
            </div>
        </div>

        <div class="afk-info">
            <h3 style="color: var(--secondary-color); margin-bottom: 10px;">üéØ AFK Rewards Info</h3>
            <p>‚Ä¢ Auto earn rewards every 2 minutes</p>
            <p>‚Ä¢ Rewards: 10 EXP + 10 Gold + 1 Skill Point</p>
            <p>‚Ä¢ <strong style="color: #e74c3c;">Must stay on AFK screen to earn rewards!</strong></p>
            <p>‚Ä¢ When you are AFK, your gold and exp do not increased please relog</p>
        </div>
    </div>
</div>

<script>
// Global AFK System - hanya dapat diakses dari AFK screen
let afkState = {
    startTime: null,
    isActive: false,
    isOnAFKScreen: false,
    totalSeconds: 0,
    pausedSeconds: 0,
    lastAutoClaimTime: 0,
    updateInterval: null,
    totalClaimed: {
        exp: 0,
        gold: 0,
        skillPoints: 0
    }
};

// Fungsi untuk menampilkan AFK Screen
function showAFKScreen() {
    // Hide all screens
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('afkScreen').classList.add('active');
    
    // Update navigation
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    if (event && event.target) {
        event.target.closest('.nav-btn').classList.add('active');
    }
    
    // Set flag bahwa user sedang di AFK screen
    afkState.isOnAFKScreen = true;
    
    // Start atau resume AFK
    if (!afkState.isActive) {
        startAFK();
    } else {
        resumeAFK();
    }
}

// Override untuk semua fungsi navigasi screen lainnya
function showHomeScreen() {
    pauseAFK();
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('homeScreen').classList.add('active');
    updateNavigation();
}

function showBattleScreen() {
    pauseAFK();
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('battleScreen').classList.add('active');
    updateNavigation();
}

function showShopScreen() {
    pauseAFK();
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('shopScreen').classList.add('active');
    updateNavigation();
}

function showArenaScreen() {
    pauseAFK();
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('arenaScreen').classList.add('active');
    updateNavigation();
}

function showSkillScreen() {
    pauseAFK();
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('skillScreen').classList.add('active');
    updateNavigation();
}

function showInventoryScreen() {
    pauseAFK();
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('inventoryScreen').classList.add('active');
    updateNavigation();
}

// Fungsi universal untuk show screen dengan pause AFK
function showScreen(screenId) {
    if (screenId !== 'afkScreen') {
        pauseAFK();
    } else {
        showAFKScreen();
        return;
    }
    
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screenId).classList.add('active');
    updateNavigation();
}

function updateNavigation() {
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    if (event && event.target) {
        event.target.closest('.nav-btn').classList.add('active');
    }
}

function startAFK() {
    if (afkState.isOnAFKScreen && !afkState.isActive) {
        afkState.startTime = Date.now();
        afkState.isActive = true;
        
        // Add visual indicator
        document.querySelector('.afk-container').classList.add('afk-active');
        
        updateAFKDisplay();
    }
}

function pauseAFK() {
    if (afkState.isActive && afkState.isOnAFKScreen) {
        // Simpan waktu yang sudah berjalan
        const currentTime = Date.now();
        afkState.pausedSeconds = afkState.totalSeconds + Math.floor((currentTime - afkState.startTime) / 1000);
        
        // Set flag
        afkState.isOnAFKScreen = false;
        
        // Clear interval
        if (afkState.updateInterval) {
            clearInterval(afkState.updateInterval);
            afkState.updateInterval = null;
        }
        
        // Remove visual indicator
        document.querySelector('.afk-container')?.classList.remove('afk-active');
        
        // Update status display
        const statusElement = document.getElementById('afkStatus');
        if (statusElement) {
            statusElement.textContent = '‚è∏Ô∏è AFK Paused - Return to AFK screen to continue';
            statusElement.className = 'afk-status-paused';
        }
    }
}

function resumeAFK() {
    if (afkState.isOnAFKScreen) {
        // Resume dari waktu terakhir
        afkState.totalSeconds = afkState.pausedSeconds;
        afkState.startTime = Date.now();
        afkState.isActive = true;
        
        // Add visual indicator
        document.querySelector('.afk-container').classList.add('afk-active');
        
        updateAFKDisplay();
    }
}

function updateAFKDisplay() {
    // Hanya update jika sedang di AFK screen dan aktif
    if (!afkState.isActive || !afkState.isOnAFKScreen) {
        return;
    }
    
    const currentTime = Date.now();
    const elapsed = Math.floor((currentTime - afkState.startTime) / 1000) + afkState.totalSeconds;
    
    // Update timer display
    const minutes = Math.floor(elapsed / 60);
    const seconds = elapsed % 60;
    document.getElementById('afkTimer').textContent = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    // Calculate progress untuk 2 menit (120 detik)
    const currentCycle = elapsed % 120;
    const progress = Math.min((currentCycle / 120) * 100, 100);
    
    const progressFill = document.getElementById('afkProgressFill');
    const progressText = document.getElementById('afkProgressText');
    const statusElement = document.getElementById('afkStatus');
    
    progressFill.style.width = progress + '%';
    progressText.textContent = Math.floor(progress) + '%';
    
    // Update status
    if (currentCycle < 120) {
        const timeRemaining = 120 - currentCycle;
        const remMin = Math.floor(timeRemaining / 60);
        const remSec = timeRemaining % 60;
        statusElement.textContent = 
            `‚è∞ Next reward in: ${remMin}:${remSec.toString().padStart(2, '0')}`;
        statusElement.className = 'afk-status-active';
    } else {
        statusElement.textContent = 'üéÅ Collecting rewards...';
        statusElement.className = 'afk-status-collecting';
    }
    
    // Auto claim setiap 2 menit (120 detik) - hanya jika di AFK screen
    const completedCycles = Math.floor(elapsed / 120);
    const lastClaimedCycles = Math.floor(afkState.lastAutoClaimTime / 120);
    
    if (completedCycles > lastClaimedCycles) {
        const newCycles = completedCycles - lastClaimedCycles;
        autoClaimRewards(newCycles);
        afkState.lastAutoClaimTime = elapsed;
    }
    
    // Update display total claimed
    document.getElementById('pendingExp').textContent = afkState.totalClaimed.exp;
    document.getElementById('pendingGold').textContent = afkState.totalClaimed.gold;
    document.getElementById('pendingSkillPoints').textContent = afkState.totalClaimed.skillPoints;
    
    // Continue updating hanya jika masih di AFK screen
    if (afkState.isOnAFKScreen) {
        afkState.updateInterval = setTimeout(updateAFKDisplay, 1000);
    }
}

function autoClaimRewards(cycles) {
    // Hanya claim jika sedang di AFK screen
    if (!afkState.isOnAFKScreen) return;
    
    const expGained = cycles * 10;
    const goldGained = cycles * 10;
    const skillPointsGained = cycles * 1;
    
    // Add rewards to gameState (pastikan gameState sudah terdefinisi)
    if (typeof gameState !== 'undefined') {
        gameState.player.exp += expGained;
        gameState.player.gold += goldGained;
        gameState.player.skillPoints += skillPointsGained;
        
        // Check for level up
        let leveledUp = false;
        let levelsGained = 0;
        while (gameState.player.exp >= gameState.player.level * 100) {
            gameState.player.exp -= gameState.player.level * 100;
            gameState.player.level++;
            gameState.player.maxHp += 20;
            gameState.player.hp = gameState.player.maxHp;
            gameState.player.maxChakra += 10;
            gameState.player.chakra = gameState.player.maxChakra;
            leveledUp = true;
            levelsGained++;
        }
        
        // Update display jika fungsi tersedia
        if (typeof updatePlayerDisplay === 'function') {
            updatePlayerDisplay();
        }
        
        // Save game jika fungsi tersedia
        if (typeof saveGame === 'function') {
            saveGame();
        }
    }
    
    // Update total claimed
    afkState.totalClaimed.exp += expGained;
    afkState.totalClaimed.gold += goldGained;
    afkState.totalClaimed.skillPoints += skillPointsGained;
    
    // Show notification jika fungsi tersedia
    if (typeof showMessage === 'function') {
        showMessage(`
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 1.5em; margin-bottom: 15px;">üí§ AFK Rewards Collected!</div>
                <div style="color: #3498db; margin: 8px 0;">‚≠ê +${expGained} EXP</div>
                <div style="color: #f39c12; margin: 8px 0;">üí∞ +${goldGained} Gold</div>
                <div style="color: #4ecdc4; margin: 8px 0;">üîÆ +${skillPointsGained} Skill Points</div>
                ${typeof gameState !== 'undefined' && leveledUp ? 
                    `<div style="color: #2ecc71; margin-top: 15px;">üéä Level Up! ${levelsGained > 1 ? `+${levelsGained} levels!` : `Now level ${gameState.player.level}!`}</div>` : ''}
                <div style="margin-top: 15px; padding: 10px; background: rgba(78,205,196,0.1); border-radius: 8px;">
                    <div style="color: #4ecdc4; font-size: 0.9em;">üìä Total AFK Rewards:</div>
                    <div style="font-size: 0.85em; color: #bbb; margin-top: 5px;">
                        ${afkState.totalClaimed.exp} EXP ‚Ä¢ ${afkState.totalClaimed.gold} Gold ‚Ä¢ ${afkState.totalClaimed.skillPoints} SP
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(231,76,60,0.1); border-radius: 6px;">
                    <div style="color: #e74c3c; font-size: 0.8em;">‚ö†Ô∏è Stay on AFK screen to continue earning rewards!</div>
                </div>
            </div>
        `);
    }
}

// Reset AFK state saat page load
document.addEventListener('DOMContentLoaded', function() {
    // Reset semua state AFK
    afkState.isOnAFKScreen = false;
    afkState.isActive = false;
    afkState.totalSeconds = 0;
    afkState.pausedSeconds = 0;
    
    // Set initial display
    const timerElement = document.getElementById('afkTimer');
    const statusElement = document.getElementById('afkStatus');
    const progressFill = document.getElementById('afkProgressFill');
    const progressText = document.getElementById('afkProgressText');
    
    if (timerElement) timerElement.textContent = '00:00';
    if (statusElement) {
        statusElement.textContent = 'üí§ Open AFK screen to start farming...';
        statusElement.className = 'afk-status-paused';
    }
    if (progressFill) progressFill.style.width = '0%';
    if (progressText) progressText.textContent = '0%';
    
    // Reset reward displays
    const expElement = document.getElementById('pendingExp');
    const goldElement = document.getElementById('pendingGold');
    const spElement = document.getElementById('pendingSkillPoints');
    
    if (expElement) expElement.textContent = '0';
    if (goldElement) goldElement.textContent = '0';
    if (spElement) spElement.textContent = '0';
});

// Deteksi saat user meninggalkan halaman
window.addEventListener('beforeunload', function() {
    if (afkState.isActive) {
        pauseAFK();
    }
});

// Deteksi saat halaman menjadi tidak aktif/aktif
document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
        // Halaman tidak terlihat, pause AFK jika tidak di AFK screen
        if (afkState.isActive && !afkState.isOnAFKScreen) {
            pauseAFK();
        }
    } else {
        // Halaman kembali terlihat, resume jika di AFK screen
        if (afkState.isOnAFKScreen && !afkState.isActive) {
            resumeAFK();
        }
    }
});
</script>

    <!-- Tambahkan screen Arena di dalam body sebelum bottom-nav -->
    <div id="arenaScreen" class="screen">
        <h1 class="main-title">‚öîÔ∏è Shadow Arena</h1>
        
        <div class="arena-menu-grid">
            <div class="arena-menu-card" onclick="showArenaSection('league')">
                <div class="arena-icon">üèüÔ∏è</div>
                <div>Shadow Arena<br>League</div>
            </div>
            <div class="arena-menu-card" onclick="showArenaSection('shop')">
                <div class="arena-icon">üè™</div>
                <div>Arena Shop</div>
            </div>
            <div class="arena-menu-card" onclick="showArenaSection('profile')">
                <div class="arena-icon">üë§</div>
                <div>Arena Profile</div>
            </div>
            <div class="arena-menu-card" onclick="showArenaSection('milestone')">
                <div class="arena-icon">üèÜ</div>
                <div>Arena Milestone</div>
            </div>
            <div class="arena-menu-card" onclick="showArenaSection('package')">
                <div class="arena-icon">üì¶</div>
                <div>Shadow Package</div>
            </div>
        </div>
    </div>

    <!-- Arena League Section - Updated dengan Loadout System dan Scroll -->
    <div id="arenaLeagueScreen" class="screen">
        <h2 class="main-title">üèüÔ∏è Shadow Arena League</h2>
        
        <div class="arena-battle-header">
            <div class="enemy-counter">Enemy: <span id="currentEnemy">1</span>/5</div>
            <div class="enemy-counter">Badges: <span id="currentBadges">0</span> üéñÔ∏è</div>
        </div>

        <div class="battle-arena">
            <div class="fighters">
                <div class="arena-fighter">
                    <div class="fighter-name">You</div>
                    <div class="arena-fighter-sprite">ü•ã</div>
                    <div class="arena-hp-bar">
                        <div class="stat-bar">
                            <div class="bar-container">
                                <div class="bar-fill hp-bar" id="playerArenaHP" style="width: 100%"></div>
                            </div>
                        </div>
                        <div class="stat-value">HP: <span id="playerArenaHPText">100</span>/100</div>
                    </div>
                    <div class="arena-hp-bar">
                        <div class="stat-bar">
                            <div class="bar-container">
                                <div class="bar-fill chakra-bar" id="playerArenaMP" style="width: 100%"></div>
                            </div>
                        </div>
                        <div class="stat-value">MP: <span id="playerArenaMPText">100</span>/100</div>
                    </div>
                </div>

                <div class="vs-indicator">‚öîÔ∏è</div>

                <div class="arena-fighter">
                    <div class="fighter-name">Shadow Ninja</div>
                    <div class="arena-fighter-sprite" id="enemySprite">ü•∑</div>
                    <div class="arena-hp-bar">
                        <div class="stat-bar">
                            <div class="bar-container">
                                <div class="bar-fill hp-bar" id="enemyArenaHP" style="width: 100%"></div>
                            </div>
                        </div>
                        <div class="stat-value">HP: <span id="enemyArenaHPText">100</span>/100</div>
                    </div>
                    <div class="arena-hp-bar">
                        <div class="stat-bar">
                            <div class="bar-container">
                                <div class="bar-fill chakra-bar" id="enemyArenaMP" style="width: 100%"></div>
                            </div>
                        </div>
                        <div class="stat-value">MP: <span id="enemyArenaMPText">100</span>/100</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="battle-log" id="arenaLog"></div>

        <div class="gear-boost-tabs">
            <button class="tab-btn active" onclick="showLoadoutTab('skills')">Skills</button>
            <button class="tab-btn" onclick="showLoadoutTab('gear')">Gear</button>
            <button class="tab-btn" onclick="showLoadoutTab('boost')">Boost</button>
        </div>

        <!-- Skills Tab dengan Scroll Container -->
        <div id="skillsTab" class="loadout-tab">
            <div class="loadout-container">
                <div class="loadout-grid" id="skillLoadoutGrid"></div>
            </div>
        </div>

        <!-- Gear Tab dengan Scroll Container -->
        <div id="gearTab" class="loadout-tab" style="display: none;">
            <div class="loadout-container">
                <div class="loadout-grid" id="gearLoadoutGrid"></div>
            </div>
        </div>

        <!-- Boost Tab dengan Scroll Container -->
        <div id="boostTab" class="loadout-tab" style="display: none;">
            <div class="loadout-container">
                <div class="loadout-grid" id="boostLoadoutGrid"></div>
            </div>
        </div>

        <div class="heal-actions">
            <button onclick="arenaHeal()" id="arenaHealBtn" class="heal-btn" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">
                üíö Heal HP (4s CD)
            </button>
            <button onclick="arenaMPHeal()" id="arenaMPHealBtn" class="heal-btn" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                üíô Heal MP (6s CD)
            </button>
        </div>

        <div class="battle-actions-bottom">
            <button onclick="arenaRetreat()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white;">
                üèÉ Retreat
            </button>
        </div>

        <button class="menu-button" style="margin-top: 20px;" onclick="document.getElementById('arenaScreen').classList.add('active'); document.querySelectorAll('.screen').forEach(function(s) { if(s.id !== 'arenaScreen') s.classList.remove('active'); });">
            ‚Üê Back to Arena Menu
        </button>
    </div>

    <!-- Modal untuk memilih skill/gear/boost dengan Action Buttons -->
    <div id="loadoutModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeLoadoutModal()">&times;</span>
            <h2 style="color: var(--secondary-color); margin-bottom: 20px;" id="modalTitle">Select Item</h2>
            
            <!-- Action Buttons -->
            <div class="modal-actions">
                <button class="modal-action-btn select" id="selectBtn" onclick="selectModalItem()" disabled>
                    ‚úì Select Item
                </button>
                <button class="modal-action-btn remove" id="removeBtn" onclick="removeModalItem()">
                    ‚úï Remove Current
                </button>
            </div>
            
            <!-- Scrollable Grid Container -->
            <div class="modal-grid-container">
                <div class="modal-grid" id="modalItemGrid"></div>
            </div>
        </div>
    </div>

    <!-- Arena Shop Section -->
    <div id="arenaShopScreen" class="screen">
        <h2 class="main-title">üè™ Arena Shop</h2>
        
        <div style="text-align: center; margin: 20px 0; font-size: 1.3em;">
            üéñÔ∏è Ninja Badges: <span id="ninjaBadgeCount">0</span>
        </div>

        <h3 style="margin: 20px 0; color: var(--secondary-color);">‚öîÔ∏è Gear</h3>
        <div class="shop-grid" id="gearShopGrid"></div>

        <h3 style="margin: 20px 0; color: var(--secondary-color);">‚ú® Skills</h3>
        <div class="shop-grid" id="skillShopGrid"></div>

        <h3 style="margin: 20px 0; color: var(--secondary-color);">üöÄ Boost</h3>
        <div class="shop-grid" id="boostShopGrid"></div>

        <button onclick="document.getElementById('arenaScreen').classList.add('active'); document.querySelectorAll('.screen').forEach(function(s) { if(s.id !== 'arenaScreen') s.classList.remove('active'); });" class="menu-button" style="margin-top: 20px;">
            ‚Üê Back to Arena Menu
        </button>
    </div>

    <!-- Arena Profile Section -->
    <div id="arenaProfileScreen" class="screen">
        <h2 class="main-title">üë§ Arena Profile</h2>
        
        <div class="profile-section">
            <div style="text-align: center; font-size: 5em; margin-bottom: 20px;">ü•ã</div>
            
            <div class="profile-stats">
                <div class="stat-box">
                    <div style="color: #e74c3c; font-size: 1.2em; margin-bottom: 5px;">‚ù§Ô∏è HP</div>
                    <div style="font-size: 1.5em; font-weight: bold;" id="profileHP">100</div>
                </div>
                <div class="stat-box">
                    <div style="color: #3498db; font-size: 1.2em; margin-bottom: 5px;">üíß MP</div>
                    <div style="font-size: 1.5em; font-weight: bold;" id="profileMP">100</div>
                </div>
                <div class="stat-box">
                    <div style="color: var(--secondary-color); font-size: 1.2em; margin-bottom: 5px;">üéñÔ∏è Badges</div>
                    <div style="font-size: 1.5em; font-weight: bold;" id="profileBadges">0</div>
                </div>
                <div class="stat-box">
                    <div style="color: #f39c12; font-size: 1.2em; margin-bottom: 5px;">‚öîÔ∏è Damage</div>
                    <div style="font-size: 1.5em; font-weight: bold;" id="profileDamage">+0</div>
                </div>
            </div>

            <h3 style="margin: 20px 0; color: var(--secondary-color);">üìú Skills Owned</h3>
            <div id="profileSkills" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; min-height: 50px;"></div>

            <h3 style="margin: 20px 0; color: var(--secondary-color);">üõ°Ô∏è Purchase Log</h3>
            <div class="purchase-log" id="purchaseLog">
                <div style="text-align: center; color: #888;">No purchases yet</div>
            </div>
        </div>

        <button onclick="document.getElementById('arenaScreen').classList.add('active'); document.querySelectorAll('.screen').forEach(function(s) { if(s.id !== 'arenaScreen') s.classList.remove('active'); });" class="menu-button" style="margin-top: 20px;">
            ‚Üê Back to Arena Menu
        </button>
    </div>

    <!-- Arena Milestone Section -->
    <div id="arenaMilestoneScreen" class="screen">
        <h2 class="main-title">üèÜ Arena Milestone</h2>
        
        <div style="text-align: center; margin: 20px 0; font-size: 1.3em;">
            ‚öîÔ∏è Total Battles: <span id="totalBattles">0</span>
        </div>

        <div class="milestone-grid">
            <div class="milestone-card locked" id="milestone50">
                <div style="font-size: 2em; margin: 10px 0;">üó°Ô∏è</div>
                <div style="font-weight: bold; margin: 10px 0;">Shadow Knife</div>
                <div class="shop-description">Damage +2</div>
                <div style="margin-top: 10px; font-size: 0.9em; color: var(--secondary-color);">
                    Required: 50 battles<br>
                    <span id="progress50">0</span>/50
                </div>
            </div>

            <div class="milestone-card locked" id="milestone150">
                <div style="font-size: 2em; margin: 10px 0;">üéñÔ∏è</div>
                <div style="font-weight: bold; margin: 10px 0;">5 Ninja Badges</div>
                <div class="shop-description">Currency Reward</div>
                <div style="margin-top: 10px; font-size: 0.9em; color: var(--secondary-color);">
                    Required: 150 battles<br>
                    <span id="progress150">0</span>/150
                </div>
            </div>

            <div class="milestone-card locked" id="milestone300">
                <div style="font-size: 2em; margin: 10px 0;">üêô</div>
                <div style="font-weight: bold; margin: 10px 0;">Shadow Octopus Barrage</div>
                <div class="shop-description">Damage 80, MP 70</div>
                <div style="margin-top: 10px; font-size: 0.9em; color: var(--secondary-color);">
                    Required: 300 battles<br>
                    <span id="progress300">0</span>/300
                </div>
            </div>

            <div class="milestone-card locked" id="milestone500">
                <div style="font-size: 2em; margin: 10px 0;">üíä</div>
                <div style="font-weight: bold; margin: 10px 0;">Shadow Pill</div>
                <div class="shop-description">Damage +20, Heal +20</div>
                <div style="margin-top: 10px; font-size: 0.9em; color: var(--secondary-color);">
                    Required: 500 battles<br>
                    <span id="progress500">0</span>/500
                </div>
            </div>
        </div>

        <button onclick="document.getElementById('arenaScreen').classList.add('active'); document.querySelectorAll('.screen').forEach(function(s) { if(s.id !== 'arenaScreen') s.classList.remove('active'); });" class="menu-button" style="margin-top: 20px;">
            ‚Üê Back to Arena Menu
        </button>
    </div>

    <!-- Shadow Package Section -->
<div id="shadowPackageScreen" class="screen">
    <h2 class="main-title">üì¶ Shadow Package</h2>
    
    <div style="text-align: center; margin: 20px 0; font-size: 1.3em;">
        üéñÔ∏è Ninja Badges: <span id="packageBadgeCount">0</span>
    </div>

    <div class="package-card">
        <h3 style="font-size: 1.8em; margin-bottom: 15px;">üåë Ultimate Shadow Package</h3>
        <div style="font-size: 1.1em; color: var(--secondary-color); margin-bottom: 20px;">
            Complete shadow power in one bundle!
        </div>

        <div class="package-items">
            <div class="package-item">
                <div style="font-size: 2.5em; margin-bottom: 10px;">‚úã</div>
                <div style="font-weight: bold;">Inverted Shadow Hand</div>
                <div class="shop-description">Damage +30</div>
            </div>

            <div class="package-item">
                <div style="font-size: 2.5em; margin-bottom: 10px;">‚õìÔ∏è</div>
                <div style="font-weight: bold;">Chained Gama</div>
                <div class="shop-description">Damage 60, MP 20</div>
            </div>

            <div class="package-item">
                <div style="font-size: 2.5em; margin-bottom: 10px;">ü™∂</div>
                <div style="font-weight: bold;">Void Plume</div>
                <div class="shop-description">Damage +20</div>
            </div>
        </div>

        <div class="shop-price" style="font-size: 1.3em; display: inline-block; margin-top: 20px;">
            üéñÔ∏è 2000 Ninja Badges
        </div>

        <button onclick="buyShadowPackage()" class="menu-button" style="margin-top: 20px; background: linear-gradient(135deg, #e94560, #764ba2);" id="buyPackageBtn">
            üí∞ Purchase Package
        </button>

        <div id="packageOwned" style="display: none; margin-top: 20px; padding: 15px; background: rgba(46, 204, 113, 0.2); border-radius: 10px; color: #2ecc71; font-weight: bold;">
            ‚úÖ Package Already Owned
        </div>

        <div id="packageInsufficient" style="display: none; margin-top: 20px; padding: 15px; background: rgba(231, 76, 60, 0.2); border-radius: 10px; color: #e74c3c; font-weight: bold;">
            ‚ùå Insufficient Ninja Badges
        </div>
    </div>

    <button onclick="document.getElementById('arenaScreen').classList.add('active'); document.querySelectorAll('.screen').forEach(function(s) { if(s.id !== 'arenaScreen') s.classList.remove('active'); });" class="menu-button" style="margin-top: 20px;">
        ‚Üê Back to Arena Menu
    </button>
</div>

    <script>
        // Arena Game State - Updated dengan Loadout System dan Selected Item
        const arenaState = {
            playerHP: 100,
            playerMaxHP: 100,
            playerMP: 100,
            playerMaxMP: 100,
            enemyHP: 100,
            enemyMaxHP: 100,
            enemyMP: 100,
            enemyMaxMP: 100,
            currentEnemy: 1,
            ninjaBadges: 0,
            totalBattles: 0,
            currentBattleBadges: 0, // Badge yang didapat di battle saat ini
            healCooldown: 0,
            mpHealCooldown: 0,
            enemyStunned: false,
            stunDuration: 0,
            
            // Loadout System - 3 slots masing-masing
            equippedSkills: [null, null, null],
            equippedGear: [null, null, null],
            equippedBoost: [null, null, null],
            
            // Available Items
            availableSkills: [
                { id: 'whiteSerp', name: 'White Serpent Hand', icon: 'üêç', damage: 5, mp: 0, owned: true },
                { id: 'whiteFang', name: 'White Fang', icon: 'ü¶∑', damage: 25, mp: 15, owned: true },
                { id: 'whiteSeal', name: 'White Chained Seal', icon: '‚õìÔ∏è', damage: 0, mp: 30, stun: 4, owned: true }
            ],
            
            availableGear: [],
            availableBoost: [],
            
            // Enemy Skills
            enemySkills: [
                { name: 'Black Serpent', damage: 8, mp: 0 },
                { name: 'Black Tiger', damage: 15, mp: 20 },
                { name: 'Black Vortex', damage: 30, mp: 40 }
            ],
            
shopGear: [
    // MURAH (3-7 badges) - Stats rendah
    { id: 'ironVest', name: 'Iron Vest', icon: 'ü¶∫', hp: 5, price: 3, owned: false },
    { id: 'woodenSword', name: 'Wooden Sword', icon: 'üó°Ô∏è', damage: 2, price: 4, owned: false },
    { id: 'leatherGloves', name: 'Leather Gloves', icon: 'üß§', mp: 8, price: 5, owned: false },
    { id: 'copperHelm', name: 'Copper Helmet', icon: '‚õëÔ∏è', hp: 3, mp: 5, price: 3, owned: false },
    { id: 'clothRobe', name: 'Cloth Robe', icon: 'ü•ã', mp: 10, price: 4, owned: false },
    { id: 'bronzeShield', name: 'Bronze Shield', icon: 'üõ°Ô∏è', hp: 6, price: 5, owned: false },
    { id: 'leatherBoots', name: 'Leather Boots', icon: 'ü•æ', damage: 1, hp: 4, price: 6, owned: false },
    { id: 'apprenticeWand', name: 'Apprentice Wand', icon: 'ü™Ñ', damage: 3, mp: 6, price: 7, owned: false },
    
    // SEDANG (8-15 badges) - Stats menengah
    { id: 'steelArmor', name: 'Steel Armor', icon: 'üõ°Ô∏è', damage: 3, hp: 10, price: 8, owned: false },
    { id: 'silverBlade', name: 'Silver Blade', icon: '‚öîÔ∏è', damage: 5, mp: 5, price: 10, owned: false },
    { id: 'mysticRobe', name: 'Mystic Robe', icon: 'üëò', hp: 8, mp: 15, price: 12, owned: false },
    { id: 'knightHelm', name: 'Knight Helmet', icon: 'üëë', damage: 2, hp: 12, price: 9, owned: false },
    { id: 'mageStaff', name: 'Mage Staff', icon: 'ü™Ñ', damage: 6, mp: 12, price: 11, owned: false },
    { id: 'chainmail', name: 'Chainmail Vest', icon: 'ü¶∫', hp: 14, price: 10, owned: false },
    { id: 'battleAxe', name: 'Battle Axe', icon: 'ü™ì', damage: 8, price: 13, owned: false },
    { id: 'wizardHat', name: 'Wizard Hat', icon: 'üé©', mp: 18, damage: 1, price: 14, owned: false },
    { id: 'ironGauntlets', name: 'Iron Gauntlets', icon: 'üß§', damage: 4, hp: 6, price: 15, owned: false },
    
    // MAHAL (18-30 badges) - Stats tinggi
    { id: 'shadowChest', name: 'Shadow Chestplate', icon: 'üõ°Ô∏è', damage: 6, hp: 15, mp: 10, price: 18, owned: false },
    { id: 'shadowBlade', name: 'Shadow Blade', icon: '‚öîÔ∏è', damage: 10, price: 20, owned: false },
    { id: 'dragonScale', name: 'Dragon Scale Armor', icon: 'üê≤', damage: 4, hp: 20, mp: 12, price: 25, owned: false },
    { id: 'flameSword', name: 'Flame Sword', icon: 'üî•', damage: 12, mp: 8, price: 22, owned: false },
    { id: 'frostArmor', name: 'Frost Armor', icon: '‚ùÑÔ∏è', hp: 18, mp: 14, price: 24, owned: false },
    { id: 'thunderSpear', name: 'Thunder Spear', icon: '‚ö°', damage: 11, mp: 10, price: 26, owned: false },
    { id: 'crystalCrown', name: 'Crystal Crown', icon: 'üëë', damage: 5, mp: 20, price: 28, owned: false },
    { id: 'demonClaws', name: 'Demon Claws', icon: 'üëπ', damage: 13, hp: 8, price: 30, owned: false },
    
    // SANGAT MAHAL (35-60 badges) - Stats sangat tinggi
    { id: 'voidArmor', name: 'Void Armor', icon: 'üåå', damage: 8, hp: 25, mp: 20, price: 35, owned: false },
    { id: 'godSlayer', name: 'God Slayer Sword', icon: '‚ö°', damage: 15, mp: 8, price: 40, owned: false },
    { id: 'etherealCloak', name: 'Ethereal Cloak', icon: 'üëª', damage: 12, hp: 18, mp: 25, price: 50, owned: false }
],

shopSkills: [
    // MURAH (4-8 badges) - Damage rendah
    { id: 'fireBall', name: 'Fire Ball', icon: 'üî•', damage: 15, mp: 8, price: 4, owned: false },
    { id: 'windSlash', name: 'Wind Slash', icon: 'üí®', damage: 18, mp: 10, price: 6, owned: false },
    { id: 'waterSpear', name: 'Water Spear', icon: 'üíß', damage: 20, mp: 12, price: 7, owned: false },
    { id: 'rockThrow', name: 'Rock Throw', icon: 'ü™®', damage: 12, mp: 6, price: 4, owned: false },
    { id: 'iceShards', name: 'Ice Shards', icon: '‚ùÑÔ∏è', damage: 16, mp: 9, price: 5, owned: false },
    { id: 'spark', name: 'Electric Spark', icon: '‚ö°', damage: 14, mp: 7, price: 5, owned: false },
    { id: 'poisonDart', name: 'Poison Dart', icon: 'üèπ', damage: 13, mp: 8, price: 6, owned: false },
    { id: 'shadowStrike', name: 'Shadow Strike', icon: 'üó°Ô∏è', damage: 19, mp: 11, price: 8, owned: false },
    
    // SEDANG (10-18 badges) - Damage menengah
    { id: 'lightningBolt', name: 'Lightning Bolt', icon: '‚ö°', damage: 35, mp: 20, price: 10, owned: false },
    { id: 'earthShaker', name: 'Earth Shaker', icon: 'üåç', damage: 40, mp: 25, price: 12, owned: false },
    { id: 'iceSpike', name: 'Ice Spike', icon: '‚ùÑÔ∏è', damage: 38, mp: 22, price: 15, owned: false },
    { id: 'flameWhip', name: 'Flame Whip', icon: 'üî•', damage: 32, mp: 18, price: 11, owned: false },
    { id: 'windTornado', name: 'Wind Tornado', icon: 'üå™Ô∏è', damage: 42, mp: 24, price: 13, owned: false },
    { id: 'waterCannon', name: 'Water Cannon', icon: 'üíß', damage: 36, mp: 21, price: 12, owned: false },
    { id: 'metalSpikes', name: 'Metal Spikes', icon: '‚öîÔ∏è', damage: 39, mp: 23, price: 14, owned: false },
    { id: 'acidBlast', name: 'Acid Blast', icon: 'üß™', damage: 41, mp: 26, price: 16, owned: false },
    { id: 'psychicWave', name: 'Psychic Wave', icon: 'üß†', damage: 37, mp: 19, price: 18, owned: false },
    
    // MAHAL (20-35 badges) - Damage tinggi
    { id: 'shadowCurse', name: 'Shadow Curse', icon: 'üëπ', damage: 55, mp: 35, price: 20, owned: false },
    { id: 'phoenixFlame', name: 'Phoenix Flame', icon: 'üî•', damage: 65, mp: 40, price: 25, owned: false },
    { id: 'shadowHalo', name: 'Shadow Halo Beam', icon: 'üòá', damage: 70, mp: 45, price: 30, owned: false },
    { id: 'dragonBreath', name: 'Dragon Breath', icon: 'üê≤', damage: 60, mp: 38, price: 22, owned: false },
    { id: 'celestialStorm', name: 'Celestial Storm', icon: '‚õàÔ∏è', damage: 68, mp: 42, price: 28, owned: false },
    { id: 'voidSlash', name: 'Void Slash', icon: 'üåë', damage: 58, mp: 36, price: 24, owned: false },
    { id: 'divineJudgment', name: 'Divine Judgment', icon: '‚öñÔ∏è', damage: 72, mp: 48, price: 32, owned: false },
    { id: 'demonSummon', name: 'Demon Summon', icon: 'üë∫', damage: 66, mp: 44, price: 35, owned: false },
    
    // SANGAT MAHAL (40-70 badges) - Damage sangat tinggi
    { id: 'voidBlast', name: 'Void Blast', icon: 'üåë', damage: 85, mp: 50, price: 40, owned: false },
    { id: 'cosmicRay', name: 'Cosmic Ray', icon: 'üåü', damage: 100, mp: 60, price: 50, owned: false },
    { id: 'apocalypse', name: 'Apocalypse', icon: 'üíÄ', damage: 120, mp: 80, price: 60, owned: false },
    { id: 'galaxyCollapse', name: 'Galaxy Collapse', icon: 'üåå', damage: 110, mp: 70, price: 55, owned: false },
    { id: 'omnislash', name: 'Omnislash', icon: '‚öîÔ∏è', damage: 95, mp: 55, price: 45, owned: false },
    { id: 'timeStop', name: 'Time Stop', icon: '‚è∞', damage: 80, mp: 65, price: 42, owned: false },
    { id: 'realityBreak', name: 'Reality Break', icon: 'üí•', damage: 130, mp: 85, price: 65, owned: false },
    { id: 'godWrath', name: 'God Wrath', icon: 'üò°', damage: 140, mp: 90, price: 70, owned: false }
],

shopBoost: [
    // MURAH (2-5 badges) - Bonus kecil
    { id: 'healthPotion', name: 'Health Potion', icon: 'üß™', heal: 20, price: 2, owned: false },
    { id: 'powerRing', name: 'Power Ring', icon: 'üíç', damage: 2, price: 3, owned: false },
    { id: 'energyDrink', name: 'Energy Drink', icon: 'ü•§', damage: 1, heal: 15, price: 4, owned: false },
    { id: 'luckyCoin', name: 'Lucky Coin', icon: 'ü™ô', damage: 1, price: 2, owned: false },
    { id: 'vitaminPill', name: 'Vitamin Pill', icon: 'üíä', heal: 18, price: 3, owned: false },
    { id: 'ironTonic', name: 'Iron Tonic', icon: 'üç∂', damage: 2, heal: 8, price: 4, owned: false },
    { id: 'herbalTea', name: 'Herbal Tea', icon: 'üçµ', heal: 22, price: 3, owned: false },
    { id: 'crystalShard', name: 'Crystal Shard', icon: 'üíé', damage: 3, price: 5, owned: false },
    
    // SEDANG (6-12 badges) - Bonus menengah
    { id: 'shadowPotion', name: 'Shadow Potion', icon: 'üß™', damage: 4, heal: 10, price: 6, owned: false },
    { id: 'strengthAmulet', name: 'Strength Amulet', icon: 'üîÆ', damage: 6, price: 8, owned: false },
    { id: 'shadowHeal', name: 'Shadow Heal', icon: 'üíö', heal: 40, price: 10, owned: false },
    { id: 'battleBrew', name: 'Battle Brew', icon: 'üç∫', damage: 5, heal: 15, price: 7, owned: false },
    { id: 'mysticOil', name: 'Mystic Oil', icon: 'ü´ó', damage: 7, price: 9, owned: false },
    { id: 'lifeCrystal', name: 'Life Crystal', icon: 'üíé', heal: 35, price: 8, owned: false },
    { id: 'powerGem', name: 'Power Gem', icon: 'üîÆ', damage: 8, price: 11, owned: false },
    { id: 'healingRing', name: 'Healing Ring', icon: 'üíç', heal: 45, price: 12, owned: false },
    { id: 'strengthSerum', name: 'Strength Serum', icon: '‚öóÔ∏è', damage: 6, heal: 20, price: 10, owned: false },
    
    // MAHAL (15-28 badges) - Bonus tinggi
    { id: 'berserkerPotion', name: 'Berserker Potion', icon: '‚öóÔ∏è', damage: 8, heal: 20, price: 15, owned: false },
    { id: 'dragonHeart', name: 'Dragon Heart', icon: '‚ù§Ô∏è', damage: 5, heal: 60, price: 18, owned: false },
    { id: 'vitalityOrb', name: 'Vitality Orb', icon: 'üîµ', heal: 80, price: 25, owned: false },
    { id: 'titanEssence', name: 'Titan Essence', icon: 'üí™', damage: 10, heal: 25, price: 20, owned: false },
    { id: 'angelicBlessing', name: 'Angelic Blessing', icon: 'üòá', heal: 70, price: 22, owned: false },
    { id: 'demonPact', name: 'Demon Pact', icon: 'üë∫', damage: 12, price: 24, owned: false },
    { id: 'phoenixAsh', name: 'Phoenix Ash', icon: 'üî•', damage: 9, heal: 50, price: 26, owned: false },
    { id: 'dragonScale', name: 'Dragon Scale', icon: 'üê≤', damage: 11, heal: 30, price: 28, owned: false },
    
    // SANGAT MAHAL (30-50 badges) - Bonus sangat tinggi
    { id: 'godElixir', name: 'God Elixir', icon: '‚ú®', damage: 12, heal: 50, price: 30, owned: false },
    { id: 'phoenixFeather', name: 'Phoenix Feather', icon: 'ü™∂', heal: 100, price: 35, owned: false },
    { id: 'omnipotentGem', name: 'Omnipotent Gem', icon: 'üíé', damage: 15, heal: 80, price: 45, owned: false },
    { id: 'cosmicEssence', name: 'Cosmic Essence', icon: 'üåü', damage: 18, heal: 60, price: 40, owned: false },
    { id: 'voidCrystal', name: 'Void Crystal', icon: 'üåë', damage: 20, price: 42, owned: false },
    { id: 'eternityGem', name: 'Eternity Gem', icon: 'üíé', damage: 16, heal: 90, price: 48, owned: false },
    { id: 'ultimateElixir', name: 'Ultimate Elixir', icon: '‚ö±Ô∏è', damage: 22, heal: 100, price: 50, owned: false }
],
            
            // Milestones
            milestones: {
                50: { unlocked: false, reward: 'Shadow Knife', damage: 2 },
                150: { unlocked: false, reward: '5 Ninja Badges' },
                300: { unlocked: false, reward: 'Shadow Octopus Barrage', skill: true },
                500: { unlocked: false, reward: 'Shadow Pill', damage: 20, heal: 20 }
            },
            
            // Shadow Package
            shadowPackage: {
                owned: false,
                items: [
                    { id: 'invertedHand', name: 'Inverted Shadow Hand', damage: 30, type: 'gear' },
                    { id: 'chainedGama', name: 'Chained Gama', damage: 60, mp: 20, type: 'skill' },
                    { id: 'voidPlume', name: 'Void Plume', damage: 20, type: 'boost' }
                ]
            },
            
            purchaseLog: [],
            currentModalSlot: null,
            currentModalType: null,
            selectedModalItem: null
        };

        // Equip default skills
        arenaState.equippedSkills[0] = arenaState.availableSkills[0];
        arenaState.equippedSkills[1] = arenaState.availableSkills[1];
        arenaState.equippedSkills[2] = arenaState.availableSkills[2];

        // Update cooldown timers
        setInterval(() => {
            if (arenaState.healCooldown > 0) {
                arenaState.healCooldown--;
                updateHealButton();
            }
            
            if (arenaState.mpHealCooldown > 0) {
                arenaState.mpHealCooldown--;
                updateMPHealButton();
            }
            
            if (arenaState.stunDuration > 0) {
                arenaState.stunDuration--;
                if (arenaState.stunDuration === 0) {
                    arenaState.enemyStunned = false;
                    addArenaLog('Enemy is no longer stunned!');
                }
            }
        }, 1000);
        
        // Load saved data saat game dimulai
loadArenaData();
        
        // Fungsi untuk menyimpan data ke localStorage
function saveArenaData() {
    const dataToSave = {
        ninjaBadges: arenaState.ninjaBadges,
        totalBattles: arenaState.totalBattles,
        availableGear: arenaState.availableGear,
        availableSkills: arenaState.availableSkills,
        availableBoost: arenaState.availableBoost,
        shopGear: arenaState.shopGear,
        shopSkills: arenaState.shopSkills,
        shopBoost: arenaState.shopBoost,
        milestones: arenaState.milestones,
        shadowPackage: arenaState.shadowPackage,
        purchaseLog: arenaState.purchaseLog
    };
    
    localStorage.setItem('arenaGameData', JSON.stringify(dataToSave));
}

// Fungsi untuk memuat data dari localStorage
function loadArenaData() {
    const savedData = localStorage.getItem('arenaGameData');
    
    if (savedData) {
        try {
            const data = JSON.parse(savedData);
            
            arenaState.ninjaBadges = data.ninjaBadges || 0;
            arenaState.totalBattles = data.totalBattles || 0;
            
            if (data.availableGear) arenaState.availableGear = data.availableGear;
            if (data.availableSkills) arenaState.availableSkills = data.availableSkills;
            if (data.availableBoost) arenaState.availableBoost = data.availableBoost;
            
            if (data.shopGear) arenaState.shopGear = data.shopGear;
            if (data.shopSkills) arenaState.shopSkills = data.shopSkills;
            if (data.shopBoost) arenaState.shopBoost = data.shopBoost;
            
            if (data.milestones) arenaState.milestones = data.milestones;
            if (data.shadowPackage) arenaState.shadowPackage = data.shadowPackage;
            if (data.purchaseLog) arenaState.purchaseLog = data.purchaseLog;
            
            console.log('Arena data loaded successfully!');
        } catch (e) {
            console.error('Error loading arena data:', e);
        }
    }
}


        function showArenaSection(section) {
            const sections = {
                'league': 'arenaLeagueScreen',
                'shop': 'arenaShopScreen',
                'profile': 'arenaProfileScreen',
                'milestone': 'arenaMilestoneScreen',
                'package': 'shadowPackageScreen'
            };
            
            if (section === 'league') {
                startArenaLeague();
            } else if (section === 'shop') {
                renderShop();
            } else if (section === 'profile') {
                updateProfileScreen();
            } else if (section === 'milestone') {
                updateMilestoneScreen();
            } else if (section === 'package') {
                updatePackageScreen();
            }
            
            document.getElementById(sections[section]).classList.add('active');
            document.querySelectorAll('.screen').forEach(function(s) {
                if(s.id !== sections[section]) s.classList.remove('active');
            });
        }

        // Start arena with reset
        function startArenaLeague() {
            arenaState.playerHP = calculateMaxHP();
            arenaState.playerMaxHP = calculateMaxHP();
            arenaState.playerMP = calculateMaxMP();
            arenaState.playerMaxMP = calculateMaxMP();
            arenaState.enemyHP = 100;
            arenaState.enemyMP = 100;
            arenaState.currentEnemy = 1;
            arenaState.currentBattleBadges = 0;
            arenaState.enemyStunned = false;
            arenaState.stunDuration = 0;
            
            document.getElementById('arenaLog').innerHTML = '';
            
            updateArenaUI();
            renderLoadouts();
            addArenaLog('‚öîÔ∏è Arena battle started! Defeat 5 Shadow Ninjas!');
        }

        function renderLoadouts() {
            // Render Skills Loadout
            const skillGrid = document.getElementById('skillLoadoutGrid');
            skillGrid.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                const slot = document.createElement('div');
                const skill = arenaState.equippedSkills[i];
                
                if (skill) {
                    slot.className = 'loadout-slot filled';
                    slot.style.position = 'relative';
                    
                    const damageBonus = calculateDamageBonus();
                    const totalDamage = skill.damage + (skill.stun ? 0 : damageBonus);
                    
                    slot.innerHTML = `
                        <button class="remove-btn" onclick="removeFromSlot('skill', ${i}); event.stopPropagation();">√ó</button>
                        <div style="font-size: 2.5em; margin-bottom: 8px;">${skill.icon}</div>
                        <div style="font-weight: bold; font-size: 0.85em;">${skill.name}</div>
                        ${skill.stun ? 
                            `<div style="font-size: 0.75em; color: #f39c12; margin-top: 5px;">Stun ${skill.stun}s</div>` : 
                            `<div style="font-size: 0.75em; color: #e74c3c; margin-top: 5px;">DMG: ${totalDamage}</div>`
                        }
                        ${skill.mp > 0 ? `<div style="font-size: 0.75em; color: #3498db; margin-top: 3px;">${skill.mp} MP</div>` : ''}
                    `;
                    
                    // Make it clickable to use in battle
                    slot.onclick = () => useArenaSkill(i);
                } else {
                    slot.className = 'loadout-slot empty';
                    slot.innerHTML = `
                        <div style="font-size: 3em; color: rgba(78, 205, 196, 0.3);">+</div>
                        <div style="font-size: 0.85em; color: #888; margin-top: 10px;">Add Skill</div>
                    `;
                    slot.onclick = () => openLoadoutModal('skill', i);
                }
                
                skillGrid.appendChild(slot);
            }
            
            // Render Gear Loadout
            const gearGrid = document.getElementById('gearLoadoutGrid');
            gearGrid.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                const slot = document.createElement('div');
                const gear = arenaState.equippedGear[i];
                
                if (gear) {
                    slot.className = 'loadout-slot filled';
                    slot.style.position = 'relative';
                    
                    let stats = [];
                    if (gear.damage) stats.push(`+${gear.damage} DMG`);
                    if (gear.hp) stats.push(`+${gear.hp} HP`);
                    if (gear.mp) stats.push(`+${gear.mp} MP`);
                    
                    slot.innerHTML = `
                        <button class="remove-btn" onclick="removeFromSlot('gear', ${i}); event.stopPropagation();">√ó</button>
                        <div style="font-size: 2.5em; margin-bottom: 8px;">${gear.icon}</div>
                        <div style="font-weight: bold; font-size: 0.85em;">${gear.name}</div>
                        <div style="font-size: 0.75em; color: #bbb; margin-top: 5px;">${stats.join(', ')}</div>
                    `;
                    slot.onclick = () => openLoadoutModal('gear', i);
                } else {
                    slot.className = 'loadout-slot empty';
                    slot.innerHTML = `
                        <div style="font-size: 3em; color: rgba(78, 205, 196, 0.3);">+</div>
                        <div style="font-size: 0.85em; color: #888; margin-top: 10px;">Add Gear</div>
                    `;
                    slot.onclick = () => openLoadoutModal('gear', i);
                }
                
                gearGrid.appendChild(slot);
            }
            
            // Render Boost Loadout
            const boostGrid = document.getElementById('boostLoadoutGrid');
            boostGrid.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                const slot = document.createElement('div');
                const boost = arenaState.equippedBoost[i];
                
                if (boost) {
                    slot.className = 'loadout-slot filled';
                    slot.style.position = 'relative';
                    
                    let stats = [];
                    if (boost.damage) stats.push(`+${boost.damage} DMG`);
                    if (boost.heal) stats.push(`+${boost.heal} Heal`);
                    
                    slot.innerHTML = `
                        <button class="remove-btn" onclick="removeFromSlot('boost', ${i}); event.stopPropagation();">√ó</button>
                        <div style="font-size: 2.5em; margin-bottom: 8px;">${boost.icon}</div>
                        <div style="font-weight: bold; font-size: 0.85em;">${boost.name}</div>
                        <div style="font-size: 0.75em; color: #bbb; margin-top: 5px;">${stats.join(', ')}</div>
                    `;
                    slot.onclick = () => openLoadoutModal('boost', i);
                } else {
                    slot.className = 'loadout-slot empty';
                    slot.innerHTML = `
                        <div style="font-size: 3em; color: rgba(78, 205, 196, 0.3);">+</div>
                        <div style="font-size: 0.85em; color: #888; margin-top: 10px;">Add Boost</div>
                    `;
                    slot.onclick = () => openLoadoutModal('boost', i);
                }
                
                boostGrid.appendChild(slot);
            }
        }

        function openLoadoutModal(type, slotIndex) {
            arenaState.currentModalType = type;
            arenaState.currentModalSlot = slotIndex;
            arenaState.selectedModalItem = null;
            
            const modal = document.getElementById('loadoutModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalGrid = document.getElementById('modalItemGrid');
            const selectBtn = document.getElementById('selectBtn');
            const removeBtn = document.getElementById('removeBtn');
            
            modalTitle.textContent = `Select ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            modalGrid.innerHTML = '';
            
            // Check if current slot has item
            const hasCurrentItem = (type === 'skill' && arenaState.equippedSkills[slotIndex]) ||
                                  (type === 'gear' && arenaState.equippedGear[slotIndex]) ||
                                  (type === 'boost' && arenaState.equippedBoost[slotIndex]);
            
            removeBtn.disabled = !hasCurrentItem;
            selectBtn.disabled = true;
            
            let items = [];
            if (type === 'skill') {
                items = arenaState.availableSkills.filter(s => s.owned);
            } else if (type === 'gear') {
                items = arenaState.availableGear.filter(g => g.owned);
            } else if (type === 'boost') {
                items = arenaState.availableBoost.filter(b => b.owned);
            }
                        
            items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'modal-item';
                
                // Check if item is already equipped in any slot
                let isEquipped = false;
                                if (type === 'skill') {
                    isEquipped = arenaState.equippedSkills.some(s => s && s.id === item.id);
                } else if (type === 'gear') {
                    isEquipped = arenaState.equippedGear.some(g => g && g.id === item.id);
                } else if (type === 'boost') {
                    isEquipped = arenaState.equippedBoost.some(b => b && b.id === item.id);
                }
                
                if (isEquipped) {
                    itemDiv.classList.add('equipped');
                }
                
                let stats = [];
                if (item.damage) stats.push(`DMG: ${item.damage}`);
                if (item.hp) stats.push(`HP: +${item.hp}`);
                if (item.mp && !item.damage) stats.push(`MP: +${item.mp}`);
                if (item.mp && item.damage) stats.push(`MP: ${item.mp}`);
                if (item.heal) stats.push(`Heal: ${item.heal}`);
                if (item.stun) stats.push(`Stun: ${item.stun}s`);
                
                itemDiv.innerHTML = `
                    <div style="font-size: 2.5em; margin-bottom: 8px;">${item.icon}</div>
                    <div style="font-weight: bold; font-size: 0.85em; margin-bottom: 5px;">${item.name}</div>
                    <div style="font-size: 0.75em; color: #bbb;">${stats.join('<br>')}</div>
                    ${isEquipped ? '<div style="font-size: 0.7em; color: #f39c12; margin-top: 5px;">‚úì Equipped</div>' : ''}
                `;
                
                itemDiv.onclick = () => {
                    // Remove previous selection
                    document.querySelectorAll('.modal-item.selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    itemDiv.classList.add('selected');
                    arenaState.selectedModalItem = item;
                    selectBtn.disabled = false;
                };
                
                modalGrid.appendChild(itemDiv);
            });
            
            if (items.length === 0) {
                modalGrid.innerHTML = `
                    <div style="text-align: center; color: #888; grid-column: 1 / -1; padding: 40px;">
                        No ${type}s available. Purchase from Arena Shop!
                    </div>
                `;
            }
            
            modal.style.display = 'block';
        }

        function selectModalItem() {
            if (!arenaState.selectedModalItem) return;
            
            const type = arenaState.currentModalType;
            const slotIndex = arenaState.currentModalSlot;
            const item = arenaState.selectedModalItem;
            
            // Unequip item from other slots first
            if (type === 'skill') {
                arenaState.equippedSkills.forEach((skill, index) => {
                    if (skill && skill.id === item.id) {
                        arenaState.equippedSkills[index] = null;
                    }
                });
                arenaState.equippedSkills[slotIndex] = item;
            } else if (type === 'gear') {
                arenaState.equippedGear.forEach((gear, index) => {
                    if (gear && gear.id === item.id) {
                        arenaState.equippedGear[index] = null;
                    }
                });
                arenaState.equippedGear[slotIndex] = item;
            } else if (type === 'boost') {
                arenaState.equippedBoost.forEach((boost, index) => {
                    if (boost && boost.id === item.id) {
                        arenaState.equippedBoost[index] = null;
                    }
                });
                arenaState.equippedBoost[slotIndex] = item;
            }
            
            closeLoadoutModal();
            renderLoadouts();
            updateArenaUI(); // Update HP/MP bars in case gear affects them
        }

        function removeModalItem() {
            const type = arenaState.currentModalType;
            const slotIndex = arenaState.currentModalSlot;
            
            if (type === 'skill') {
                arenaState.equippedSkills[slotIndex] = null;
            } else if (type === 'gear') {
                arenaState.equippedGear[slotIndex] = null;
            } else if (type === 'boost') {
                arenaState.equippedBoost[slotIndex] = null;
            }
            
            closeLoadoutModal();
            renderLoadouts();
            updateArenaUI();
        }

        function removeFromSlot(type, slotIndex) {
            if (type === 'skill') {
                arenaState.equippedSkills[slotIndex] = null;
            } else if (type === 'gear') {
                arenaState.equippedGear[slotIndex] = null;
            } else if (type === 'boost') {
                arenaState.equippedBoost[slotIndex] = null;
            }
            
            renderLoadouts();
            updateArenaUI();
        }

        function closeLoadoutModal() {
            document.getElementById('loadoutModal').style.display = 'none';
            arenaState.currentModalType = null;
            arenaState.currentModalSlot = null;
            arenaState.selectedModalItem = null;
        }

        function showLoadoutTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.loadout-tab').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').style.display = 'block';
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // Calculate bonus stats from equipped gear and boosts
        function calculateDamageBonus() {
            let bonus = 0;
            
            // From gear
            arenaState.equippedGear.forEach(gear => {
                if (gear && gear.damage) bonus += gear.damage;
            });
            
            // From boosts
            arenaState.equippedBoost.forEach(boost => {
                if (boost && boost.damage) bonus += boost.damage;
            });
            
            // From milestones
            if (arenaState.milestones[50].unlocked) bonus += 2;
            if (arenaState.milestones[500].unlocked) bonus += 20;
            
            return bonus;
        }

        function calculateMaxHP() {
            let baseHP = 100;
            
            // From gear
            arenaState.equippedGear.forEach(gear => {
                if (gear && gear.hp) baseHP += gear.hp;
            });
            
            return baseHP;
        }

        function calculateMaxMP() {
            let baseMP = 100;
            
            // From gear
            arenaState.equippedGear.forEach(gear => {
                if (gear && gear.mp) baseMP += gear.mp;
            });
            
            return baseMP;
        }

        function calculateHealBonus() {
            let bonus = 0;
            
            // From boosts
            arenaState.equippedBoost.forEach(boost => {
                if (boost && boost.heal) bonus += boost.heal;
            });
            
            // From milestones
            if (arenaState.milestones[500].unlocked) bonus += 20;
            
            return bonus;
        }

        function useArenaSkill(skillIndex) {
            const skill = arenaState.equippedSkills[skillIndex];
            if (!skill) return;
            
            if (arenaState.playerMP < skill.mp) {
                addArenaLog('‚ùå Not enough MP!');
                return;
            }
            
            arenaState.playerMP -= skill.mp;
            
            if (skill.stun) {
                // Stun skill
                arenaState.enemyStunned = true;
                arenaState.stunDuration = skill.stun;
                addArenaLog(`üîó You used ${skill.name}! Enemy is stunned for ${skill.stun} seconds!`);
            } else {
                // Damage skill
                const damageBonus = calculateDamageBonus();
                const totalDamage = skill.damage + damageBonus;
                arenaState.enemyHP -= totalDamage;
                addArenaLog(`‚öîÔ∏è You used ${skill.name}! Dealt ${totalDamage} damage!`);
            }
            
            updateArenaUI();
            
            if (arenaState.enemyHP <= 0) {
                enemyDefeated();
                return;
            }
            
            // Enemy turn
            setTimeout(() => {
                if (!arenaState.enemyStunned) {
                    enemyAttack();
                } else {
                    addArenaLog('üîó Enemy is stunned and cannot attack!');
                }
            }, 1000);
        }

        function enemyAttack() {
            if (arenaState.enemyHP <= 0) return;
            
            const availableSkills = arenaState.enemySkills.filter(skill => 
                arenaState.enemyMP >= skill.mp
            );
            
            if (availableSkills.length === 0) {
                addArenaLog('üíß Enemy is out of MP!');
                return;
            }
            
            const skill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
            arenaState.enemyMP -= skill.mp;
            arenaState.playerHP -= skill.damage;
            
            addArenaLog(`üíÄ Enemy used ${skill.name}! You took ${skill.damage} damage!`);
            updateArenaUI();
            
            if (arenaState.playerHP <= 0) {
                addArenaLog('üíÄ You were defeated! Retreating from arena...');
                setTimeout(() => {
                    arenaRetreat();
                }, 2000);
            }
        }

        function enemyDefeated() {
            const badgeReward = Math.floor(Math.random() * 3) + 1;
            arenaState.ninjaBadges += badgeReward;
            arenaState.currentBattleBadges += badgeReward;
            arenaState.totalBattles++;
            
            saveArenaData();
            
            addArenaLog(`‚úÖ Shadow Ninja defeated! +${badgeReward} Ninja Badges!`);
            
            // Check milestones
            checkMilestones();
            
            if (arenaState.currentEnemy >= 5) {
                addArenaLog('üèÜ Arena completed! You defeated all 5 Shadow Ninjas!');
                setTimeout(() => {
                    addArenaLog(`üí∞ Total badges earned this run: ${arenaState.currentBattleBadges}`);
                    setTimeout(() => {
                        document.getElementById('arenaScreen').classList.add('active');
                        document.querySelectorAll('.screen').forEach(function(s) {
                            if(s.id !== 'arenaScreen') s.classList.remove('active');
                        });
                    }, 3000);
                }, 2000);
            } else {
                arenaState.currentEnemy++;
                arenaState.enemyHP = 100 + (arenaState.currentEnemy * 20);
                arenaState.enemyMaxHP = arenaState.enemyHP;
                arenaState.enemyMP = 100;
                addArenaLog(`‚öîÔ∏è Next Shadow Ninja appears! (${arenaState.currentEnemy}/5)`);
            }
            
            updateArenaUI();
        }

        function arenaHeal() {
            if (arenaState.healCooldown > 0) return;
            
            const healBonus = calculateHealBonus();
            const totalHeal = 40 + healBonus;
            arenaState.playerHP = Math.min(arenaState.playerMaxHP, arenaState.playerHP + totalHeal);
            arenaState.healCooldown = 4;
            
            addArenaLog(`üíö You healed for ${totalHeal} HP!`);
            updateArenaUI();
            updateHealButton();
        }

        function arenaMPHeal() {
            if (arenaState.mpHealCooldown > 0) return;
            
            arenaState.playerMP = Math.min(arenaState.playerMaxMP, arenaState.playerMP + 50);
            arenaState.mpHealCooldown = 6;
            
            addArenaLog('üíô You restored 50 MP!');
            updateArenaUI();
            updateMPHealButton();
        }

        function arenaRetreat() {
            addArenaLog(`üèÉ Retreating from arena... Badges earned this run: ${arenaState.currentBattleBadges}`);
            setTimeout(() => {
                document.getElementById('arenaScreen').classList.add('active');
                document.querySelectorAll('.screen').forEach(function(s) {
                    if(s.id !== 'arenaScreen') s.classList.remove('active');
                });
            }, 2000);
        }

        function updateArenaUI() {
            // Update HP bars
            const playerHPPercent = (arenaState.playerHP / arenaState.playerMaxHP) * 100;
            const enemyHPPercent = (arenaState.enemyHP / arenaState.enemyMaxHP) * 100;
            const playerMPPercent = (arenaState.playerMP / arenaState.playerMaxMP) * 100;
            const enemyMPPercent = (arenaState.enemyMP / arenaState.enemyMaxMP) * 100;
            
            document.getElementById('playerArenaHP').style.width = playerHPPercent + '%';
            document.getElementById('enemyArenaHP').style.width = Math.max(0, enemyHPPercent) + '%';
            document.getElementById('playerArenaMP').style.width = playerMPPercent + '%';
            document.getElementById('enemyArenaMP').style.width = enemyMPPercent + '%';
            
            document.getElementById('playerArenaHPText').textContent = Math.max(0, arenaState.playerHP);
            document.getElementById('enemyArenaHPText').textContent = Math.max(0, arenaState.enemyHP);
            document.getElementById('playerArenaMPText').textContent = arenaState.playerMP;
            document.getElementById('enemyArenaMPText').textContent = arenaState.enemyMP;
            
            // Update counters
            document.getElementById('currentEnemy').textContent = arenaState.currentEnemy;
            document.getElementById('currentBadges').textContent = arenaState.ninjaBadges;
        }

        function updateHealButton() {
            const btn = document.getElementById('arenaHealBtn');
            if (arenaState.healCooldown > 0) {
                btn.disabled = true;
                btn.textContent = `üíö Heal HP (${arenaState.healCooldown}s)`;
            } else {
                btn.disabled = false;
                btn.textContent = 'üíö Heal HP (4s CD)';
            }
        }

        function updateMPHealButton() {
            const btn = document.getElementById('arenaMPHealBtn');
            if (arenaState.mpHealCooldown > 0) {
                btn.disabled = true;
                btn.textContent = `üíô Heal MP (${arenaState.mpHealCooldown}s)`;
            } else {
                btn.disabled = false;
                btn.textContent = 'üíô Heal MP (6s CD)';
            }
        }

        function addArenaLog(message) {
            const log = document.getElementById('arenaLog');
            const p = document.createElement('p');
            p.textContent = message;
            p.style.margin = '5px 0';
            p.style.opacity = '0';
            p.style.transform = 'translateY(10px)';
            p.style.transition = 'all 0.3s ease';
            
            log.appendChild(p);
            
            setTimeout(() => {
                p.style.opacity = '1';
                p.style.transform = 'translateY(0)';
            }, 100);
            
            log.scrollTop = log.scrollHeight;
            
            // Keep only last 10 messages
            while (log.children.length > 10) {
                log.removeChild(log.firstChild);
            }
        }

        // Shop Functions
        function renderShop() {
            document.getElementById('ninjaBadgeCount').textContent = arenaState.ninjaBadges;
            
            // Render Gear Shop
            const gearGrid = document.getElementById('gearShopGrid');
            gearGrid.innerHTML = '';
            
            arenaState.shopGear.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                
                if (item.owned) {
                    itemDiv.classList.add('owned');
                }
                
                let stats = [];
                if (item.damage) stats.push(`Damage +${item.damage}`);
                if (item.hp) stats.push(`HP +${item.hp}`);
                if (item.mp) stats.push(`MP +${item.mp}`);
                
                itemDiv.innerHTML = `
                    <div style="font-size: 3em; margin-bottom: 15px;">${item.icon}</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">${item.name}</div>
                    <div class="shop-description">${stats.join('<br>')}</div>
                    <div class="shop-price">üéñÔ∏è ${item.price}</div>
                    ${item.owned ? '<div style="color: #2ecc71; margin-top: 10px;">‚úÖ Owned</div>' : ''}
                `;
                
                if (!item.owned) {
                    itemDiv.onclick = () => buyShopItem('gear', item);
                }
                
                gearGrid.appendChild(itemDiv);
            });
            
            // Render Skill Shop
            const skillGrid = document.getElementById('skillShopGrid');
            skillGrid.innerHTML = '';
            
            arenaState.shopSkills.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                
                if (item.owned) {
                    itemDiv.classList.add('owned');
                }
                
                itemDiv.innerHTML = `
                    <div style="font-size: 3em; margin-bottom: 15px;">${item.icon}</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">${item.name}</div>
                    <div class="shop-description">Damage: ${item.damage}<br>MP Cost: ${item.mp}</div>
                    <div class="shop-price">üéñÔ∏è ${item.price}</div>
                    ${item.owned ? '<div style="color: #2ecc71; margin-top: 10px;">‚úÖ Owned</div>' : ''}
                `;
                
                if (!item.owned) {
                    itemDiv.onclick = () => buyShopItem('skill', item);
                }
                
                skillGrid.appendChild(itemDiv);
            });
            
            // Render Boost Shop
            const boostGrid = document.getElementById('boostShopGrid');
            boostGrid.innerHTML = '';
            
            arenaState.shopBoost.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                
                if (item.owned) {
                    itemDiv.classList.add('owned');
                }
                
                let stats = [];
                if (item.damage) stats.push(`Damage +${item.damage}`);
                if (item.heal) stats.push(`Heal +${item.heal}`);
                
                itemDiv.innerHTML = `
                    <div style="font-size: 3em; margin-bottom: 15px;">${item.icon}</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">${item.name}</div>
                    <div class="shop-description">${stats.join('<br>')}</div>
                    <div class="shop-price">üéñÔ∏è ${item.price}</div>
                    ${item.owned ? '<div style="color: #2ecc71; margin-top: 10px;">‚úÖ Owned</div>' : ''}
                `;
                
                if (!item.owned) {
                    itemDiv.onclick = () => buyShopItem('boost', item);
                }
                
                boostGrid.appendChild(itemDiv);
            });
        }

        function buyShopItem(type, item) {
            if (arenaState.ninjaBadges < item.price) {
                alert('Not enough Ninja Badges!');
                return;
            }
            
            arenaState.ninjaBadges -= item.price;
            item.owned = true;
            
            // Add to available items
            if (type === 'gear') {
                arenaState.availableGear.push(item);
            } else if (type === 'skill') {
                arenaState.availableSkills.push(item);
            } else if (type === 'boost') {
                arenaState.availableBoost.push(item);
            }
            
            // Add to purchase log
            arenaState.purchaseLog.unshift({
                item: item.name,
                price: item.price,
                type: type,
                timestamp: new Date().toLocaleString()
            });
            
            saveArenaData();
            
            renderShop();
            alert(`‚úÖ Purchased ${item.name}!`);
        }

        // Profile Functions
        function updateProfileScreen() {
            document.getElementById('profileHP').textContent = calculateMaxHP();
            document.getElementById('profileMP').textContent = calculateMaxMP();
            document.getElementById('profileBadges').textContent = arenaState.ninjaBadges;
            document.getElementById('profileDamage').textContent = '+' + calculateDamageBonus();
            
            // Update skills list
            const skillsDiv = document.getElementById('profileSkills');
            const ownedSkills = arenaState.availableSkills.filter(s => s.owned);
            
            if (ownedSkills.length === 0) {
                skillsDiv.innerHTML = '<div style="text-align: center; color: #888;">No skills owned</div>';
            } else {
                skillsDiv.innerHTML = ownedSkills.map(skill => 
                    `<span style="display: inline-block; margin: 5px; padding: 5px 10px; background: rgba(78, 205, 196, 0.2); border-radius: 15px;">
                        ${skill.icon} ${skill.name}
                    </span>`
                ).join('');
            }
            
            // Update purchase log
            const logDiv = document.getElementById('purchaseLog');
            if (arenaState.purchaseLog.length === 0) {
                logDiv.innerHTML = '<div style="text-align: center; color: #888;">No purchases yet</div>';
            } else {
                logDiv.innerHTML = arenaState.purchaseLog.slice(0, 10).map(purchase => 
                    `<div class="log-item">
                        <strong>${purchase.item}</strong> (${purchase.type})<br>
                        <small>üéñÔ∏è ${purchase.price} badges - ${purchase.timestamp}</small>
                    </div>`
                ).join('');
            }
        }

        // Milestone Functions
        function checkMilestones() {
            const milestones = [50, 150, 300, 500];
            
            milestones.forEach(requirement => {
                if (arenaState.totalBattles >= requirement && !arenaState.milestones[requirement].unlocked) {
                    arenaState.milestones[requirement].unlocked = true;
                    
                    const milestone = arenaState.milestones[requirement];
                    addArenaLog(`üèÜ Milestone Unlocked: ${milestone.reward}!`);
                    
                    // Apply milestone rewards
                    if (requirement === 150) {
                        arenaState.ninjaBadges += 5;
                        addArenaLog('üí∞ +5 Ninja Badges added!');
                    } else if (requirement === 300) {
                        // Add Shadow Octopus Barrage skill
                        arenaState.availableSkills.push({
                            id: 'shadowOctopus',
                            name: 'Shadow Octopus Barrage',
                            icon: 'üêô',
                            damage: 80,
                            mp: 70,
                            owned: true
                        });
                        addArenaLog('‚ú® Shadow Octopus Barrage skill unlocked!');
                    }
                    saveArenaData();
                }
            });
        }

        function updateMilestoneScreen() {
            document.getElementById('totalBattles').textContent = arenaState.totalBattles;
            
            [50, 150, 300, 500].forEach(requirement => {
                const card = document.getElementById(`milestone${requirement}`);
                const progress = document.getElementById(`progress${requirement}`);
                
                progress.textContent = Math.min(arenaState.totalBattles, requirement);
                
                if (arenaState.milestones[requirement].unlocked) {
                    card.className = 'milestone-card unlocked';
                }
            });
        }

        // Shadow Package Functions
        function updatePackageScreen() {
    // Update badge count
    document.getElementById('packageBadgeCount').textContent = arenaState.ninjaBadges || 0;
    
    // Check if package is owned
    if (arenaState.shadowPackage && arenaState.shadowPackage.owned) {
        document.getElementById('buyPackageBtn').style.display = 'none';
        document.getElementById('packageOwned').style.display = 'block';
    } else {
        document.getElementById('buyPackageBtn').style.display = 'block';
        document.getElementById('packageOwned').style.display = 'none';
    }
    
    // Hide insufficient message
    document.getElementById('packageInsufficient').style.display = 'none';
}

        function buyShadowPackage() {
    console.log('Buy Shadow Package clicked'); // Debug
    console.log('Current Ninja Badges:', arenaState.ninjaBadges); // Debug
    console.log('Package owned:', arenaState.shadowPackage.owned); // Debug
    
    // Cek apakah package sudah dimiliki
    if (arenaState.shadowPackage && arenaState.shadowPackage.owned) {
        alert('üì¶ Package Already Owned!\n\n‚úÖ You already own the Ultimate Shadow Package');
        return;
    }
    
    // Cek apakah Ninja Badges cukup
    if (!arenaState.ninjaBadges || arenaState.ninjaBadges < 2000) {
        const currentBadges = arenaState.ninjaBadges || 0;
        const needed = 2000 - currentBadges;
        
        alert('‚ùå NOT ENOUGH NINJA BADGES!\n\n' +
              'üéñÔ∏è Required: 2000 Ninja Badges\n' +
              'üéñÔ∏è You have: ' + currentBadges + ' Ninja Badges\n' +
              '‚ö†Ô∏è You need ' + needed + ' more badges!');
        
        // Tampilkan pesan visual di halaman
        document.getElementById('packageInsufficient').style.display = 'block';
        setTimeout(function() {
            document.getElementById('packageInsufficient').style.display = 'none';
        }, 3000);
        
        return;
    }
    
    // Konfirmasi pembelian
    const confirmPurchase = confirm(
        'üåë PURCHASE ULTIMATE SHADOW PACKAGE?\n\n' +
        'üéñÔ∏è Price: 2000 Ninja Badges\n' +
        'üéñÔ∏è Your Balance: ' + arenaState.ninjaBadges + ' Ninja Badges\n\n' +
        'Package includes:\n' +
        '‚úã Inverted Shadow Hand (DMG +30)\n' +
        '‚õìÔ∏è Chained Gama (DMG 60, MP 20)\n' +
        'ü™∂ Void Plume (DMG +20)\n\n' +
        'Continue with purchase?'
    );
    
    if (!confirmPurchase) {
        return;
    }
    
    // Proses pembelian
    arenaState.ninjaBadges -= 2000;
    arenaState.shadowPackage.owned = true;
    
    // Add package items
    if (arenaState.shadowPackage.items) {
        arenaState.shadowPackage.items.forEach(function(item) {
            item.owned = true;
            
            if (item.type === 'gear') {
                arenaState.availableGear.push({
                    id: item.id,
                    name: item.name,
                    icon: '‚úã',
                    damage: item.damage,
                    owned: true
                });
            } else if (item.type === 'skill') {
                arenaState.availableSkills.push({
                    id: item.id,
                    name: item.name,
                    icon: '‚õìÔ∏è',
                    damage: item.damage,
                    mp: item.mp,
                    owned: true
                });
            } else if (item.type === 'boost') {
                arenaState.availableBoost.push({
                    id: item.id,
                    name: item.name,
                    icon: 'ü™∂',
                    damage: item.damage,
                    owned: true
                });
            }
        });
    }
    
    // Add to purchase log
    if (!arenaState.purchaseLog) {
        arenaState.purchaseLog = [];
    }
    
    arenaState.purchaseLog.unshift({
        item: 'Ultimate Shadow Package',
        price: 2000,
        type: 'package',
        timestamp: new Date().toLocaleString()
    });
    
    saveArenaData();
    updatePackageScreen();
    
    // Success message
    alert('üéâ PURCHASE SUCCESSFUL!\n\n' +
          'üåë Ultimate Shadow Package unlocked!\n' +
          '‚ú® All shadow items added to inventory!\n\n' +
          'üéñÔ∏è Remaining Badges: ' + arenaState.ninjaBadges);
}


        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('loadoutModal');
            if (event.target === modal) {
                closeLoadoutModal();
            }
        }
    </script>
    
   <!-- Turkey Event Screen -->
<div id="turkey-event-screen" class="screen">
    <h1 class="main-title">ü¶É Turkey Event</h1>
    
    <div class="game-header">
        <div class="player-info-grid">
            <div>
                <div class="stat-bar">
                    <span class="stat-label">HP</span>
                    <div class="bar-container">
                        <div class="bar-fill hp-bar" id="turkey-player-hp-bar" style="width: 100%"></div>
                    </div>
                    <span class="stat-value" id="turkey-player-hp">100/100</span>
                </div>
                <div class="stat-bar">
                    <span class="stat-label">MP</span>
                    <div class="bar-container">
                        <div class="bar-fill chakra-bar" id="turkey-player-mp-bar" style="width: 100%"></div>
                    </div>
                    <span class="stat-value" id="turkey-player-mp">50/50</span>
                </div>
                <div class="stat-bar">
                    <span class="stat-label">ü™∂</span>
                    <div class="bar-container" style="background: rgba(139,69,19,0.4);">
                        <div class="bar-fill" style="background: linear-gradient(90deg, #d2691e, #8b4513); width: 100%;"></div>
                    </div>
                    <span class="stat-value" id="turkey-feathers">0 Feathers</span>
                </div>
            </div>
            <div class="player-avatar">
                <div class="player-sprite">ü•∑</div>
            </div>
        </div>
    </div>

    <div class="battle-arena">
        <div class="fighters">
            <div class="fighter">
                <div class="fighter-sprite" id="turkey-player-sprite">ü•∑</div>
                <div class="fighter-name">You</div>
            </div>
            
            <div class="vs-indicator">ü¶É VS ü•∑</div>
            
            <div class="fighter">
                <div class="fighter-sprite" id="turkey-boss-sprite">ü¶É</div>
                <div class="fighter-name">Turkey Chicken</div>
                <div class="stat-bar" style="margin-top: 10px;">
                    <div class="bar-container" style="width: 150px;">
                        <div class="bar-fill hp-bar" id="turkey-boss-hp-bar" style="width: 100%"></div>
                    </div>
                    <div class="stat-value" id="turkey-boss-hp">150/150</div>
                </div>
            </div>
        </div>
    </div>

  <div class="action-grid" id="turkey-action-grid">
    <!-- Skill buttons will be dynamically generated here -->
    <button class="action-btn" onclick="turkeyHeal()">
        <div class="btn-icon">üíä</div>
        <div class="btn-name">Heal HP+MP</div>
        <div class="btn-cost">0 MP</div>
    </button>
    <button class="action-btn" onclick="openTurkeyGear()">
        <div class="btn-icon">‚öîÔ∏è</div>
        <div class="btn-name">Turkey Gear</div>
    </button>
    <!-- TAMBAHKAN BUTTON MILESTONE INI -->
    <button class="action-btn" onclick="document.getElementById('turkey-milestone-screen').classList.add('active'); document.querySelectorAll('.screen').forEach(s => s !== document.getElementById('turkey-milestone-screen') ? s.classList.remove('active') : null); updateMilestoneUI();">
        <div class="btn-icon">üèÜ</div>
        <div class="btn-name">Turkey Milestone</div>
        <div class="btn-cost">View Progress</div>
    </button>
</div>

    <div class="battle-log" id="turkey-battle-log">
        <div class="log-entry">ü¶É Turkey Chicken appears! Defeat it to earn Turkey Feathers!</div>
    </div>
</div>

<!-- Turkey Shop Screen -->
<div id="turkey-shop-screen" class="screen">
    <h1 class="main-title">ü¶É Turkey Shop</h1>
    
    <div class="game-header">
        <div style="text-align: center;">
            <h2>ü™∂ Turkey Feathers: <span id="shop-feathers">0</span></h2>
        </div>
    </div>

    <div style="margin: 20px 0;">
        <h3 style="color: var(--secondary-color); margin-bottom: 15px;">üó°Ô∏è Turkey Skills</h3>
        
        <!-- Basic Skills -->
        <h4 style="color: #95a5a6; margin: 10px 0;">‚≠ê Basic Skills</h4>
        <div class="equipment-grid">
            <div class="equipment-card turkey-shop-item" onclick="buyTurkeyItem('skill', 'hand', 6)">
                <div class="equipment-icon">‚úã</div>
                <div><strong>Turkey Hand</strong></div>
                <div class="equipment-stats">
                    Damage: 25<br>
                    MP Cost: 8<br>
                    Price: 6 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item" onclick="buyTurkeyItem('skill', 'bodyFist', 8)">
                <div class="equipment-icon">üëä</div>
                <div><strong>Turkey Body Fist</strong></div>
                <div class="equipment-stats">
                    Damage: 60<br>
                    MP Cost: 15<br>
                    Price: 8 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item" onclick="buyTurkeyItem('skill', 'rockSlam', 10)">
                <div class="equipment-icon">ü™®</div>
                <div><strong>Turkey Rock Slam</strong></div>
                <div class="equipment-stats">
                    Damage: 40<br>
                    MP Cost: 12<br>
                    Price: 10 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item rare" onclick="buyTurkeyItem('skill', 'fireBlast', 12)">
                <div class="equipment-icon">üî•</div>
                <div><strong>Turkey Fire Blast</strong></div>
                <div class="equipment-stats">
                    Damage: 55<br>
                    MP Cost: 14<br>
                    Price: 12 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item rare" onclick="buyTurkeyItem('skill', 'windSlash', 14)">
                <div class="equipment-icon">üå™Ô∏è</div>
                <div><strong>Turkey Wind Slash</strong></div>
                <div class="equipment-stats">
                    Damage: 65<br>
                    MP Cost: 15<br>
                    Price: 14 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item epic" onclick="buyTurkeyItem('skill', 'megaBlast', 15)">
                <div class="equipment-icon">üåü</div>
                <div><strong>Turkey Mega Blast</strong></div>
                <div class="equipment-stats">
                    Damage: 80<br>
                    MP Cost: 20<br>
                    Price: 15 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item epic" onclick="buyTurkeyItem('skill', 'iceSpear', 18)">
                <div class="equipment-icon">‚ùÑÔ∏è</div>
                <div><strong>Turkey Ice Spear</strong></div>
                <div class="equipment-stats">
                    Damage: 70<br>
                    MP Cost: 16<br>
                    Price: 18 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item epic" onclick="buyTurkeyItem('skill', 'shadowStrike', 20)">
                <div class="equipment-icon">üåô</div>
                <div><strong>Turkey Shadow Strike</strong></div>
                <div class="equipment-stats">
                    Damage: 90<br>
                    MP Cost: 18<br>
                    Price: 20 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item epic" onclick="buyTurkeyItem('skill', 'earthquake', 22)">
                <div class="equipment-icon">üåç</div>
                <div><strong>Turkey Earthquake</strong></div>
                <div class="equipment-stats">
                    Damage: 85<br>
                    MP Cost: 19<br>
                    Price: 22 ü™∂
                </div>
            </div>
        </div>

        <!-- High-tier Skills (25-50) -->
        <h4 style="color: #9b59b6; margin: 20px 0 10px 0;">‚ö° High-tier Skills (25-50 ü™∂)</h4>
        <div class="equipment-grid">
            <div class="equipment-card turkey-shop-item legendary" onclick="buyTurkeyItem('skill', 'thunderBolt', 25)">
                <div class="equipment-icon">‚õàÔ∏è</div>
                <div><strong>Turkey Thunder Bolt</strong></div>
                <div class="equipment-stats">
                    Damage: 100<br>
                    MP Cost: 22<br>
                    Price: 25 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item legendary" onclick="buyTurkeyItem('skill', 'ultimateStrike', 30)">
                <div class="equipment-icon">‚ö°</div>
                <div><strong>Turkey Ultimate Strike</strong></div>
                <div class="equipment-stats">
                    Damage: 120<br>
                    MP Cost: 20<br>
                    Price: 30 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item legendary" onclick="buyTurkeyItem('skill', 'meteorStrike', 35)">
                <div class="equipment-icon">‚òÑÔ∏è</div>
                <div><strong>Turkey Meteor Strike</strong></div>
                <div class="equipment-stats">
                    Damage: 135<br>
                    MP Cost: 25<br>
                    Price: 35 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item legendary" onclick="buyTurkeyItem('skill', 'dragonBreath', 40)">
                <div class="equipment-icon">üê≤</div>
                <div><strong>Turkey Dragon Breath</strong></div>
                <div class="equipment-stats">
                    Damage: 150<br>
                    MP Cost: 28<br>
                    Price: 40 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item legendary" onclick="buyTurkeyItem('skill', 'voidSlash', 45)">
                <div class="equipment-icon">üåÄ</div>
                <div><strong>Turkey Void Slash</strong></div>
                <div class="equipment-stats">
                    Damage: 145<br>
                    MP Cost: 26<br>
                    Price: 45 ü™∂
                </div>
            </div>
        </div>

        <!-- Epic Skills (50-100) -->
        <h4 style="color: #e74c3c; margin: 20px 0 10px 0;">üí´ Epic Skills (50-100 ü™∂)</h4>
        <div class="equipment-grid">
            <div class="equipment-card turkey-shop-item mythical" onclick="buyTurkeyItem('skill', 'cosmicBlast', 55)">
                <div class="equipment-icon">üåå</div>
                <div><strong>Turkey Cosmic Blast</strong></div>
                <div class="equipment-stats">
                    Damage: 180<br>
                    MP Cost: 30<br>
                    Price: 55 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item mythical" onclick="buyTurkeyItem('skill', 'titanFist', 65)">
                <div class="equipment-icon">üëä</div>
                <div><strong>Turkey Titan Fist</strong></div>
                <div class="equipment-stats">
                    Damage: 200<br>
                    MP Cost: 32<br>
                    Price: 65 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item mythical" onclick="buyTurkeyItem('skill', 'phoenixFlare', 75)">
                <div class="equipment-icon">üî•</div>
                <div><strong>Turkey Phoenix Flare</strong></div>
                <div class="equipment-stats">
                    Damage: 195<br>
                    MP Cost: 31<br>
                    Price: 75 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item mythical" onclick="buyTurkeyItem('skill', 'galaxyStorm', 90)">
                <div class="equipment-icon">üå†</div>
                <div><strong>Turkey Galaxy Storm</strong></div>
                <div class="equipment-stats">
                    Damage: 210<br>
                    MP Cost: 33<br>
                    Price: 90 ü™∂
                </div>
            </div>
        </div>

        <!-- Legendary Skills (200-500) -->
        <h4 style="color: #f39c12; margin: 20px 0 10px 0;">üëë Legendary Skills (200-500 ü™∂)</h4>
        <div class="equipment-grid">
            <div class="equipment-card turkey-shop-item divine" onclick="buyTurkeyItem('skill', 'apocalypse', 200)">
                <div class="equipment-icon">üíÄ</div>
                <div><strong>Turkey Apocalypse</strong></div>
                <div class="equipment-stats">
                    Damage: 300<br>
                    MP Cost: 40<br>
                    Price: 200 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item divine" onclick="buyTurkeyItem('skill', 'judgmentDay', 300)">
                <div class="equipment-icon">‚öñÔ∏è</div>
                <div><strong>Turkey Judgment Day</strong></div>
                <div class="equipment-stats">
                    Damage: 350<br>
                    MP Cost: 45<br>
                    Price: 300 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item divine" onclick="buyTurkeyItem('skill', 'divineWrath', 400)">
                <div class="equipment-icon">‚ú®</div>
                <div><strong>Turkey Divine Wrath</strong></div>
                <div class="equipment-stats">
                    Damage: 380<br>
                    MP Cost: 48<br>
                    Price: 400 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item divine" onclick="buyTurkeyItem('skill', 'celestialRuin', 500)">
                <div class="equipment-icon">üåü</div>
                <div><strong>Turkey Celestial Ruin</strong></div>
                <div class="equipment-stats">
                    Damage: 400<br>
                    MP Cost: 50<br>
                    Price: 500 ü™∂
                </div>
            </div>
        </div>

        <!-- Mythical Skills (500-1000) -->
        <h4 style="color: #fff; text-shadow: 0 0 10px #f39c12; margin: 20px 0 10px 0;">üåü Mythical Skills (500-1000 ü™∂)</h4>
        <div class="equipment-grid">
            <div class="equipment-card turkey-shop-item ultimate" onclick="buyTurkeyItem('skill', 'omegaDestruction', 550)">
                <div class="equipment-icon">üí•</div>
                <div><strong>Omega Destruction</strong></div>
                <div class="equipment-stats">
                    Damage: 500<br>
                    MP Cost: 55<br>
                    Price: 550 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item ultimate" onclick="buyTurkeyItem('skill', 'infinityBreaker', 700)">
                <div class="equipment-icon">‚ôæÔ∏è</div>
                <div><strong>Infinity Breaker</strong></div>
                <div class="equipment-stats">
                    Damage: 600<br>
                    MP Cost: 60<br>
                    Price: 700 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item ultimate" onclick="buyTurkeyItem('skill', 'universalCollapse', 850)">
                <div class="equipment-icon">üåê</div>
                <div><strong>Universal Collapse</strong></div>
                <div class="equipment-stats">
                    Damage: 700<br>
                    MP Cost: 65<br>
                    Price: 850 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item ultimate" onclick="buyTurkeyItem('skill', 'godSlayer', 1000)">
                <div class="equipment-icon">‚öîÔ∏è</div>
                <div><strong>Turkey God Slayer</strong></div>
                <div class="equipment-stats">
                    Damage: 999<br>
                    MP Cost: 70<br>
                    Price: 1000 ü™∂
                </div>
            </div>
        </div>
    </div>

    <div style="margin: 20px 0;">
        <h3 style="color: var(--halloween-orange); margin-bottom: 15px;">‚öîÔ∏è Turkey Gear</h3>
        
        <!-- Basic Gear -->
        <h4 style="color: #95a5a6; margin: 10px 0;">‚≠ê Basic Gear</h4>
        <div class="equipment-grid">
            <div class="equipment-card turkey-shop-item rare" onclick="buyTurkeyItem('gear', 'helmet', 7)">
                <div class="equipment-icon">ü™ñ</div>
                <div><strong>Turkey Helmet</strong></div>
                <div class="equipment-stats">
                    Defense: +15<br>
                    HP: +25<br>
                    Price: 7 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item epic" onclick="buyTurkeyItem('gear', 'chestplate', 12)">
                <div class="equipment-icon">ü¶∫</div>
                <div><strong>Turkey Chestplate</strong></div>
                <div class="equipment-stats">
                    Defense: +30<br>
                    HP: +40<br>
                    Price: 12 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item epic" onclick="buyTurkeyItem('gear', 'boots', 15)">
                <div class="equipment-icon">üë¢</div>
                <div><strong>Turkey Boots</strong></div>
                <div class="equipment-stats">
                    Speed: +25<br>
                    MP: +15<br>
                    Price: 15 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item legendary" onclick="buyTurkeyItem('gear', 'sword', 18)">
                <div class="equipment-icon">‚öîÔ∏è</div>
                <div><strong>Turkey Sword</strong></div>
                <div class="equipment-stats">
                    Attack: +35<br>
                    Critical: +10%<br>
                    Price: 18 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item epic" onclick="buyTurkeyItem('gear', 'crystal', 20)">
                <div class="equipment-icon">üíé</div>
                <div><strong>Turkey Crystal</strong></div>
                <div class="equipment-stats">
                    Speed: +15<br>
                    Attack: +15<br>
                    Price: 20 ü™∂
                </div>
            </div>
        </div>

        <!-- Mid-tier Gear -->
        <h4 style="color: #9b59b6; margin: 20px 0 10px 0;">‚ö° Mid-tier Gear (22-35 ü™∂)</h4>
        <div class="equipment-grid">
            <div class="equipment-card turkey-shop-item epic" onclick="buyTurkeyItem('gear', 'powerGloves', 22)">
                <div class="equipment-icon">ü•ä</div>
                <div><strong>Turkey Power Gloves</strong></div>
                <div class="equipment-stats">
                    Attack: +45<br>
                    Critical: +15%<br>
                    Price: 22 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item legendary" onclick="buyTurkeyItem('gear', 'katana', 25)">
                <div class="equipment-icon">üó°Ô∏è</div>
                <div><strong>Turkey Katana</strong></div>
                <div class="equipment-stats">
                    Attack: +60<br>
                    Speed: +20<br>
                    Price: 25 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item epic" onclick="buyTurkeyItem('gear', 'manaOrb', 28)">
                <div class="equipment-icon">üîÆ</div>
                <div><strong>Turkey Mana Orb</strong></div>
                <div class="equipment-stats">
                    MP: +50<br>
                    Speed: +30<br>
                    Price: 28 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item legendary" onclick="buyTurkeyItem('gear', 'shield', 30)">
                <div class="equipment-icon">üõ°Ô∏è</div>
                <div><strong>Turkey Shield</strong></div>
                <div class="equipment-stats">
                    Defense: +50<br>
                    Block: +25%<br>
                    Price: 30 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item legendary" onclick="buyTurkeyItem('gear', 'magicRobe', 35)">
                <div class="equipment-icon">üßô‚Äç‚ôÇÔ∏è</div>
                <div><strong>Turkey Magic Robe</strong></div>
                <div class="equipment-stats">
                    Defense: +40<br>
                    MP: +30<br>
                    Price: 35 ü™∂
                </div>
            </div>
        </div>

        <!-- High-tier Gear (40-50) -->
        <h4 style="color: #e74c3c; margin: 20px 0 10px 0;">üí´ High-tier Gear (40-50 ü™∂)</h4>
        <div class="equipment-grid">
            <div class="equipment-card turkey-shop-item legendary" onclick="buyTurkeyItem('gear', 'titaniumShield', 40)">
                <div class="equipment-icon">‚öóÔ∏è</div>
                <div><strong>Titanium Shield</strong></div>
                <div class="equipment-stats">
                    Defense: +80<br>
                    Block: +35%<br>
                    Price: 40 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item legendary" onclick="buyTurkeyItem('gear', 'dragonArmor', 45)">
                <div class="equipment-icon">üêâ</div>
                <div><strong>Turkey Dragon Armor</strong></div>
                <div class="equipment-stats">
                    Defense: +70<br>
                    HP: +80<br>
                    Price: 45 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item mythical" onclick="buyTurkeyItem('gear', 'flameSword', 48)">
                <div class="equipment-icon">üî•</div>
                <div><strong>Turkey Flame Sword</strong></div>
                <div class="equipment-stats">
                    Attack: +85<br>
                    Critical: +20%<br>
                    Price: 48 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item mythical" onclick="buyTurkeyItem('gear', 'stormBoots', 50)">
                <div class="equipment-icon">‚ö°</div>
                <div><strong>Turkey Storm Boots</strong></div>
                <div class="equipment-stats">
                    Speed: +60<br>
                    MP: +40<br>
                    Price: 50 ü™∂
                </div>
            </div>
        </div>

        <!-- Epic Gear (50-100) -->
        <h4 style="color: #f39c12; margin: 20px 0 10px 0;">üëë Epic Gear (50-100 ü™∂)</h4>
        <div class="equipment-grid">
            <div class="equipment-card turkey-shop-item mythical" onclick="buyTurkeyItem('gear', 'celestialArmor', 60)">
                <div class="equipment-icon">‚ú®</div>
                <div><strong>Celestial Armor</strong></div>
                <div class="equipment-stats">
                    Defense: +120<br>
                    HP: +150, Block: +15%<br>
                    Price: 60 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item mythical" onclick="buyTurkeyItem('gear', 'voidBlade', 75)">
                <div class="equipment-icon">üåÄ</div>
                <div><strong>Turkey Void Blade</strong></div>
                <div class="equipment-stats">
                    Attack: +130<br>
                    Crit: +30%, Speed: +25<br>
                    Price: 75 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item mythical" onclick="buyTurkeyItem('gear', 'arcaneRobe', 85)">
                <div class="equipment-icon">üîÆ</div>
                <div><strong>Turkey Arcane Robe</strong></div>
                <div class="equipment-stats">
                    Defense: +100<br>
                    MP: +100, Speed: +35<br>
                    Price: 85 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item mythical" onclick="buyTurkeyItem('gear', 'titanGauntlets', 95)">
                <div class="equipment-icon">ü•ä</div>
                <div><strong>Titan Gauntlets</strong></div>
                <div class="equipment-stats">
                    Attack: +140<br>
                    Def: +50, Crit: +25%<br>
                    Price: 95 ü™∂
                </div>
            </div>
        </div>

        <!-- Legendary Gear (200-500) -->
        <h4 style="color: #fff; text-shadow: 0 0 10px #9b59b6; margin: 20px 0 10px 0;">üåü Legendary Gear (200-500 ü™∂)</h4>
        <div class="equipment-grid">
            <div class="equipment-card turkey-shop-item divine" onclick="buyTurkeyItem('gear', 'dragonlordPlate', 250)">
                <div class="equipment-icon">üê≤</div>
                <div><strong>Dragonlord Plate</strong></div>
                <div class="equipment-stats">
                    Defense: +200<br>
                    HP: +300, Block: +40%<br>
                    Price: 250 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item divine" onclick="buyTurkeyItem('gear', 'eternityBlade', 300)">
                <div class="equipment-icon">‚öîÔ∏è</div>
                <div><strong>Eternity Blade</strong></div>
                <div class="equipment-stats">
                    Attack: +250<br>
                    Crit: +50%, Speed: +50<br>
                    Price: 300 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item divine" onclick="buyTurkeyItem('gear', 'cosmicShield', 350)">
                <div class="equipment-icon">üåå</div>
                <div><strong>Turkey Cosmic Shield</strong></div>
                <div class="equipment-stats">
                    Defense: +250<br>
                    Block: +60%, HP: +200<br>
                    Price: 350 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item divine" onclick="buyTurkeyItem('gear', 'sageRobes', 400)">
                <div class="equipment-icon">üßô</div>
                <div><strong>Turkey Sage Robes</strong></div>
                <div class="equipment-stats">
                    Defense: +180<br>
                    MP: +200, Speed: +70<br>
                    Price: 400 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item divine" onclick="buyTurkeyItem('gear', 'phoenixWings', 450)">
                <div class="equipment-icon">üî•</div>
                <div><strong>Turkey Phoenix Wings</strong></div>
                <div class="equipment-stats">
                    Speed: +100<br>
                    Attack: +150, MP: +150<br>
                    Price: 450 ü™∂
                </div>
            </div>
        </div>

        <!-- Mythical Gear (500-1000) -->
        <h4 style="color: #fff; text-shadow: 0 0 15px #f39c12; margin: 20px 0 10px 0;">üíé Mythical Gear (500-1000 ü™∂)</h4>
        <div class="equipment-grid">
            <div class="equipment-card turkey-shop-item ultimate" onclick="buyTurkeyItem('gear', 'godArmor', 600)">
                <div class="equipment-icon">üëë</div>
                <div><strong>Turkey God Armor</strong></div>
                <div class="equipment-stats">
                    Defense: +400<br>
                    HP: +500, Block: +80%<br>
                    MP: +100 | Price: 600 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item ultimate" onclick="buyTurkeyItem('gear', 'infinityWeapon', 750)">
                <div class="equipment-icon">‚ôæÔ∏è</div>
                <div><strong>Infinity Weapon</strong></div>
                <div class="equipment-stats">
                    Attack: +500<br>
                    Crit: +80%, Speed: +80<br>
                    Price: 750 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item ultimate" onclick="buyTurkeyItem('gear', 'omegaShield', 850)">
                <div class="equipment-icon">üõ°Ô∏è</div>
                <div><strong>Turkey Omega Shield</strong></div>
                <div class="equipment-stats">
                    Defense: +500<br>
                    Block: +90%, HP: +400<br>
                    Price: 850 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item ultimate" onclick="buyTurkeyItem('gear', 'celestialCrown', 900)">
                <div class="equipment-icon">üëë</div>
                <div><strong>Celestial Crown</strong></div>
                <div class="equipment-stats">
                    Attack: +300, Def: +300<br>
                    MP: +300, Crit: +60%<br>
                    Price: 900 ü™∂
                </div>
            </div>
            <div class="equipment-card turkey-shop-item ultimate" onclick="buyTurkeyItem('gear', 'universalOrb', 1000)">
                <div class="equipment-icon">üåê</div>
                <div><strong>Universal Orb</strong></div>
                <div class="equipment-stats">
                    MP: +500, Speed: +120<br>
                    Attack: +200, Crit: +70%<br>
                    Price: 1000 ü™∂
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Turkey Milestone Screen -->
<div id="turkey-milestone-screen" class="screen">
    <h1 class="main-title">üèÜ Turkey Milestones</h1>
    
    <div class="game-header">
        <div style="text-align: center;">
            <h2>‚öîÔ∏è Total Battles: <span id="milestone-battles">0</span></h2>
            <p style="color: var(--secondary-color); margin-top: 10px;">
                Fight turkeys to earn milestone points and unlock rewards!
            </p>
        </div>
    </div>

    <div class="milestone-container">
        <!-- Milestone Progress Bar -->
        <div class="milestone-progress-section">
            <h3 style="color: var(--halloween-orange); margin-bottom: 15px;">üìä Your Progress</h3>
            <div class="milestone-progress-bar">
                <div id="milestone-progress-fill" class="milestone-progress-fill"></div>
                <span id="milestone-progress-text" class="milestone-progress-text">0 / 10</span>
            </div>
        </div>

        <!-- Milestones Grid -->
        <div class="milestones-grid">
           <!-- 10 Battles -->
<div class="milestone-card" data-milestone="10">
    <div class="milestone-header">
        <span class="milestone-icon">ü•â</span>
        <span class="milestone-title">10 Battles</span>
        <div class="milestone-status locked">üîí Locked</div>
    </div>
    <div class="milestone-rewards">
        <div class="reward-item">
            <span class="reward-icon">ü¶É</span>
            <span class="reward-name">Turkey Stomp</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üéØ</span>
            <span class="reward-name">Turkey Bandana</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü™∂</span>
            <span class="reward-name">+10 Feathers</span>
        </div>
    </div>
    <button class="milestone-claim-btn" onclick="claimMilestone(10)" disabled>
        Claim Reward
    </button>
</div>

<!-- 25 Battles -->
<div class="milestone-card" data-milestone="25">
    <div class="milestone-header">
        <span class="milestone-icon">ü•à</span>
        <span class="milestone-title">25 Battles</span>
        <div class="milestone-status locked">üîí Locked</div>
    </div>
    <div class="milestone-rewards">
        <div class="reward-item">
            <span class="reward-icon">ü™∂</span>
            <span class="reward-name">Feather Storm</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü¶É</span>
            <span class="reward-name">Gobble Shield</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü™∂</span>
            <span class="reward-name">+20 Feathers</span>
        </div>
    </div>
    <button class="milestone-claim-btn" onclick="claimMilestone(25)" disabled>
        Claim Reward
    </button>
</div>

<!-- 50 Battles -->
<div class="milestone-card" data-milestone="50">
    <div class="milestone-header">
        <span class="milestone-icon">ü•á</span>
        <span class="milestone-title">50 Battles</span>
        <div class="milestone-status locked">üîí Locked</div>
    </div>
    <div class="milestone-rewards">
        <div class="reward-item">
            <span class="reward-icon">ü¶Ö</span>
            <span class="reward-name">Winged Assault</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üéñÔ∏è</span>
            <span class="reward-name">Veteran Plate</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">‚ú®</span>
            <span class="reward-name">Turkey Talisman</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü™∂</span>
            <span class="reward-name">+35 Feathers</span>
        </div>
    </div>
    <button class="milestone-claim-btn" onclick="claimMilestone(50)" disabled>
        Claim Reward
    </button>
</div>

<!-- 100 Battles -->
<div class="milestone-card rare" data-milestone="100">
    <div class="milestone-header">
        <span class="milestone-icon">üíé</span>
        <span class="milestone-title">100 Battles</span>
        <div class="milestone-status locked">üîí Locked</div>
    </div>
    <div class="milestone-rewards">
        <div class="reward-item">
            <span class="reward-icon">üí•</span>
            <span class="reward-name">Gobble Burst</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üëë</span>
            <span class="reward-name">Champion Helm</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üß£</span>
            <span class="reward-name">Battle Scarf</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü™∂</span>
            <span class="reward-name">+60 Feathers</span>
        </div>
    </div>
    <button class="milestone-claim-btn" onclick="claimMilestone(100)" disabled>
        Claim Reward
    </button>
</div>

<!-- 200 Battles -->
<div class="milestone-card epic" data-milestone="200">
    <div class="milestone-header">
        <span class="milestone-icon">‚ö°</span>
        <span class="milestone-title">200 Battles</span>
        <div class="milestone-status locked">üîí Locked</div>
    </div>
    <div class="milestone-rewards">
        <div class="reward-item">
            <span class="reward-icon">üîä</span>
            <span class="reward-name">Ancient Roar</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü¶Ö</span>
            <span class="reward-name">Elite Wings</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">‚öîÔ∏è</span>
            <span class="reward-name">Warrior Belt</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü™∂</span>
            <span class="reward-name">+100 Feathers</span>
        </div>
    </div>
    <button class="milestone-claim-btn" onclick="claimMilestone(200)" disabled>
        Claim Reward
    </button>
</div>

<!-- 350 Battles -->
<div class="milestone-card legendary" data-milestone="350">
    <div class="milestone-header">
        <span class="milestone-icon">üåü</span>
        <span class="milestone-title">350 Battles</span>
        <div class="milestone-status locked">üîí Locked</div>
    </div>
    <div class="milestone-rewards">
        <div class="reward-item">
            <span class="reward-icon">‚ö°</span>
            <span class="reward-name">Titanic Strike</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üõ°Ô∏è</span>
            <span class="reward-name">Heroic Armor</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">‚ö°</span>
            <span class="reward-name">Legend Blade</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü™∂</span>
            <span class="reward-name">+150 Feathers</span>
        </div>
    </div>
    <button class="milestone-claim-btn" onclick="claimMilestone(350)" disabled>
        Claim Reward
    </button>
</div>

<!-- 500 Battles -->
<div class="milestone-card mythical" data-milestone="500">
    <div class="milestone-header">
        <span class="milestone-icon">üëë</span>
        <span class="milestone-title">500 Battles</span>
        <div class="milestone-status locked">üîí Locked</div>
    </div>
    <div class="milestone-rewards">
        <div class="reward-item">
            <span class="reward-icon">üå†</span>
            <span class="reward-name">Cosmic Feather</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üßô</span>
            <span class="reward-name">Master Cloak</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üëä</span>
            <span class="reward-name">Mythic Gauntlets</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üëë</span>
            <span class="reward-name">Crown of Victory</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü™∂</span>
            <span class="reward-name">+250 Feathers</span>
        </div>
    </div>
    <button class="milestone-claim-btn" onclick="claimMilestone(500)" disabled>
        Claim Reward
    </button>
</div>

<!-- 750 Battles -->
<div class="milestone-card divine" data-milestone="750">
    <div class="milestone-header">
        <span class="milestone-icon">üí´</span>
        <span class="milestone-title">750 Battles</span>
        <div class="milestone-status locked">üîí Locked</div>
    </div>
    <div class="milestone-rewards">
        <div class="reward-item">
            <span class="reward-icon">üåã</span>
            <span class="reward-name">Primordial Force</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üèÜ</span>
            <span class="reward-name">Emperor Armor</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üíÄ</span>
            <span class="reward-name">Soul Reaver</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">‚ú®</span>
            <span class="reward-name">Divine Amulet</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü™∂</span>
            <span class="reward-name">+400 Feathers</span>
        </div>
    </div>
    <button class="milestone-claim-btn" onclick="claimMilestone(750)" disabled>
        Claim Reward
    </button>
</div>

<!-- 1000 Battles -->
<div class="milestone-card ultimate" data-milestone="1000">
    <div class="milestone-header">
        <span class="milestone-icon">‚öîÔ∏è</span>
        <span class="milestone-title">1000 Battles</span>
        <div class="milestone-status locked">üîí Locked</div>
    </div>
    <div class="milestone-rewards">
        <div class="reward-item">
            <span class="reward-icon">üíÄ</span>
            <span class="reward-name">Apocalyptic Wrath</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">‚öúÔ∏è</span>
            <span class="reward-name">Godking Plate</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">‚ôæÔ∏è</span>
            <span class="reward-name">Eternal Weapon</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üõ°Ô∏è</span>
            <span class="reward-name">Supreme Shield</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üëº</span>
            <span class="reward-name">Halo of Power</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü™∂</span>
            <span class="reward-name">+600 Feathers</span>
        </div>
    </div>
    <button class="milestone-claim-btn" onclick="claimMilestone(1000)" disabled>
        Claim Reward
    </button>
</div>

<!-- 1500 Battles - ULTIMATE REWARD -->
<div class="milestone-card ultimate-final" data-milestone="1500">
    <div class="milestone-header">
        <span class="milestone-icon">üåü</span>
        <span class="milestone-title">1500 Battles - ULTIMATE!</span>
        <div class="milestone-status locked">üîí Locked</div>
    </div>
    <div class="milestone-rewards">
        <div class="reward-item">
            <span class="reward-icon">üëë</span>
            <span class="reward-name">Omnipotent Strike</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üåç</span>
            <span class="reward-name">World Ender</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">üåü</span>
            <span class="reward-name">Absolute Armor</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">‚öîÔ∏è</span>
            <span class="reward-name">Infinity Edge</span>
        </div>
        <div class="reward-item">
            <span class="reward-icon">ü™∂</span>
            <span class="reward-name">+1000 Feathers</span>
        </div>
    </div>
    <button class="milestone-claim-btn" onclick="claimMilestone(1500)" disabled>
        Claim Reward
    </button>
</div>
</div>
    </div>
</div>

<!-- Turkey Gear Modal -->
<div id="turkey-gear-modal" class="modal">
    <div class="modal-content gear-modal">
        <div class="gear-header">
            <h2>ü¶É Turkey Arsenal</h2>
            <button class="close-btn" onclick="closeTurkeyGear()">‚úï</button>
        </div>
        
        <div class="gear-container">
            <!-- Left Panel - Character Stats -->
            <div class="character-panel">
                <div class="character-avatar">
                    <div class="avatar-sprite">ü•∑</div>
                    <div class="avatar-glow"></div>
                </div>
                <div class="character-stats">
                    <div class="stat-item">
                        <span class="stat-icon">‚öîÔ∏è</span>
                        <span class="stat-label">Attack</span>
                        <span class="stat-value" id="total-attack">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">üõ°Ô∏è</span>
                        <span class="stat-label">Defense</span>
                        <span class="stat-value" id="total-defense">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">‚ö°</span>
                        <span class="stat-label">Speed</span>
                        <span class="stat-value" id="total-speed">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">‚ù§Ô∏è</span>
                        <span class="stat-label">HP Bonus</span>
                        <span class="stat-value" id="total-hp">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">üíô</span>
                        <span class="stat-label">MP Bonus</span>
                        <span class="stat-value" id="total-mp">0</span>
                    </div>
                </div>
            </div>

            <!-- Middle Panel - Equipment Slots -->
            <div class="equipment-panel">
                <div class="equipment-title">‚öîÔ∏è Equipment Slots</div>
                
                <div class="equipment-slots">
                    <div class="slot-category">
                        <h4>üó°Ô∏è Active Skills</h4>
                        <div class="skill-slots">
                            <div class="equipment-slot skill-slot" id="skill-slot-1" onclick="openSlotSelection('skill', 1)">
                                <div class="slot-icon">+</div>
                                <div class="slot-name">Skill Slot 1</div>
                            </div>
                            <div class="equipment-slot skill-slot" id="skill-slot-2" onclick="openSlotSelection('skill', 2)">
                                <div class="slot-icon">+</div>
                                <div class="slot-name">Skill Slot 2</div>
                            </div>
                        </div>
                    </div>

                    <div class="slot-category">
                        <h4>‚öîÔ∏è Gear Equipment</h4>
                        <div class="gear-slots">
                            <div class="equipment-slot gear-slot" id="gear-slot-1" onclick="openSlotSelection('gear', 1)">
                                <div class="slot-icon">+</div>
                                <div class="slot-name">Gear Slot 1</div>
                            </div>
                            <div class="equipment-slot gear-slot" id="gear-slot-2" onclick="openSlotSelection('gear', 2)">
                                <div class="slot-icon">+</div>
                                <div class="slot-name">Gear Slot 2</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Inventory -->
            <div class="inventory-panel">
                <div class="inventory-title">üì¶ Inventory</div>
                <div class="inventory-tabs">
                    <button class="tab-btn active" onclick="switchInventoryTab('skills')">Skills</button>
                    <button class="tab-btn" onclick="switchInventoryTab('gear')">Gear</button>
                </div>
                <div class="inventory-content" id="inventory-content">
                    <!-- Inventory items will be populated here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Slot Selection Modal -->
<div id="slot-selection-modal" class="modal">
    <div class="modal-content slot-selection">
        <h3 id="selection-title">Select Item</h3>
        <div class="selection-grid" id="selection-grid">
            <!-- Available items for selection -->
        </div>
        <button class="menu-button" onclick="closeSlotSelection()">Cancel</button>
    </div>
</div>

<style>
    .turkey-skill-btn {
        background: linear-gradient(135deg, #d2691e 0%, #8b4513 100%);
        box-shadow: 0 3px 10px rgba(210, 105, 30, 0.3);
    }

    .turkey-shop-item {
        position: relative;
        transition: all 0.3s ease;
    }

    .turkey-shop-item:active {
        transform: scale(0.95);
    }

    .turkey-shop-item.purchased {
        opacity: 0.5;
        background: rgba(46, 204, 113, 0.1);
        border-color: #2ecc71;
    }

    .turkey-shop-item.equipped {
        border-color: #f39c12;
        background: rgba(243, 156, 18, 0.1);
        box-shadow: 0 0 15px rgba(243, 156, 18, 0.3);
    }

    .turkey-boss-attack {
        animation: bossAttack 0.5s ease-in-out;
    }

    @keyframes bossAttack {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.2) rotate(10deg); filter: hue-rotate(180deg); }
    }

    .turkey-victory {
        background: rgba(210, 105, 30, 0.2);
        border: 2px solid #d2691e;
        animation: victoryPulse 1s ease-in-out infinite;
    }

    @keyframes victoryPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    .action-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin: 20px 0;
    }

    .action-grid .action-btn:nth-child(6),
    .action-grid .action-btn:nth-child(7) {
        grid-column: span 1;
    }

    .action-grid .action-btn:nth-child(8) {
        grid-column: span 2;
    }

    /* Turkey Gear Modal Styles */
    .gear-modal {
        max-width: 1200px;
        width: 95%;
        height: 85vh;
        padding: 0;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        border: 3px solid #f39c12;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }

    .gear-header {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #d35400;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    .gear-header h2 {
        margin: 0;
        color: white;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        font-size: 1.5em;
    }

    .close-btn {
        background: rgba(255,255,255,0.2);
        border: 2px solid rgba(255,255,255,0.3);
        border-radius: 50%;
        width: 35px;
        height: 35px;
        color: white;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .close-btn:hover {
        background: rgba(255,255,255,0.3);
        transform: scale(1.1);
    }

    .gear-container {
        display: flex;
        height: calc(100% - 70px);
        gap: 15px;
        padding: 20px;
        overflow: hidden;
    }

    .character-panel {
        flex: 1;
        background: rgba(255,255,255,0.1);
        border-radius: 15px;
        padding: 20px;
        border: 2px solid rgba(255,255,255,0.2);
        backdrop-filter: blur(10px);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: #f39c12 transparent;
    }

    .character-avatar {
        position: relative;
        text-align: center;
        margin-bottom: 20px;
    }

    .avatar-sprite {
        font-size: 4em;
        position: relative;
        z-index: 2;
        display: inline-block;
        animation: float 3s ease-in-out infinite;
    }

    .avatar-glow {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 120px;
        height: 120px;
        background: radial-gradient(circle, rgba(243, 156, 18, 0.4) 0%, transparent 70%);
        border-radius: 50%;
        animation: pulse 2s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }

    @keyframes pulse {
        0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.7; }
        50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.9; }
    }

    .character-stats {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px;
        background: rgba(255,255,255,0.05);
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.1);
        transition: all 0.3s ease;
    }

    .stat-item:hover {
        background: rgba(255,255,255,0.1);
        transform: translateX(5px);
    }

    .stat-icon {
        font-size: 1.2em;
        width: 25px;
        text-align: center;
    }

    .stat-label {
        flex: 1;
        color: #ecf0f1;
        font-weight: 500;
    }

    .stat-value {
        color: #f39c12;
        font-weight: bold;
        font-size: 1.1em;
        text-shadow: 0 0 10px rgba(243, 156, 18, 0.5);
    }

    .equipment-panel {
        flex: 2;
        background: rgba(255,255,255,0.1);
        border-radius: 15px;
        padding: 20px;
        border: 2px solid rgba(255,255,255,0.2);
        backdrop-filter: blur(10px);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: #f39c12 transparent;
    }

    .equipment-title {
        text-align: center;
        font-size: 1.3em;
        font-weight: bold;
        color: #f39c12;
        margin-bottom: 20px;
        text-shadow: 0 0 10px rgba(243, 156, 18, 0.5);
    }

    .equipment-slots {
        display: flex;
        flex-direction: column;
        gap: 30px;
    }

    .slot-category h4 {
        color: #ecf0f1;
        margin-bottom: 15px;
        text-align: center;
        font-size: 1.1em;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
    }

    .skill-slots, .gear-slots {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .equipment-slot {
        width: 130px;
        height: 130px;
        background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
        border: 3px dashed rgba(255,255,255,0.3);
        border-radius: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(5px);
    }

    .equipment-slot::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .equipment-slot:hover::before {
        opacity: 1;
        animation: shine 1s ease-in-out;
    }

    @keyframes shine {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    .equipment-slot:hover {
        background: linear-gradient(135deg, rgba(243, 156, 18, 0.2) 0%, rgba(243, 156, 18, 0.1) 100%);
        border-color: #f39c12;
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(243, 156, 18, 0.3);
    }

    .equipment-slot.filled {
        background: linear-gradient(135deg, rgba(46, 204, 113, 0.2) 0%, rgba(39, 174, 96, 0.1) 100%);
        border: 3px solid #2ecc71;
        border-style: solid;
        box-shadow: 0 5px 20px rgba(46, 204, 113, 0.3);
    }

    .equipment-slot.filled:hover {
        background: linear-gradient(135deg, rgba(46, 204, 113, 0.3) 0%, rgba(39, 174, 96, 0.2) 100%);
        box-shadow: 0 15px 35px rgba(46, 204, 113, 0.4);
    }

    .slot-icon {
        font-size: 2.5em;
        margin-bottom: 8px;
        color: rgba(255,255,255,0.6);
        text-shadow: 0 0 10px rgba(255,255,255,0.3);
    }

    .equipment-slot.filled .slot-icon {
        color: #2ecc71;
        text-shadow: 0 0 15px rgba(46, 204, 113, 0.5);
    }

    .slot-name {
        font-size: 0.85em;
        color: rgba(255,255,255,0.8);
        text-align: center;
        font-weight: 500;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }

    .inventory-panel {
        flex: 1.5;
        background: rgba(255,255,255,0.1);
        border-radius: 15px;
        padding: 20px;
        border: 2px solid rgba(255,255,255,0.2);
        display: flex;
        flex-direction: column;
        backdrop-filter: blur(10px);
        overflow: hidden;
    }

    .inventory-title {
        text-align: center;
        font-size: 1.2em;
        font-weight: bold;
        color: #f39c12;
        margin-bottom: 15px;
        text-shadow: 0 0 10px rgba(243, 156, 18, 0.5);
    }

    .inventory-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-shrink: 0;
    }

    .tab-btn {
        flex: 1;
        padding: 12px;
        background: rgba(255,255,255,0.1);
        border: 2px solid rgba(255,255,255,0.2);
        border-radius: 8px;
        color: rgba(255,255,255,0.8);
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        backdrop-filter: blur(5px);
    }

    .tab-btn:hover {
        background: rgba(255,255,255,0.2);
        color: white;
        transform: translateY(-2px);
    }

    .tab-btn.active {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        border-color: #d35400;
        color: white;
        box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
    }

    .inventory-content {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(85px, 1fr));
        gap: 12px;
        padding-right: 5px;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: #f39c12 rgba(255,255,255,0.1);
        max-height: calc(100vh - 400px);
    }

    .inventory-item {
        aspect-ratio: 1;
        background: rgba(255,255,255,0.1);
        border: 2px solid rgba(255,255,255,0.2);
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        padding: 8px;
        font-size: 0.8em;
        text-align: center;
        backdrop-filter: blur(5px);
        position: relative;
        overflow: hidden;
    }

    .inventory-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, transparent 30%, rgba(243, 156, 18, 0.1) 50%, transparent 70%);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .inventory-item:hover::before {
        opacity: 1;
    }

    .inventory-item:hover {
        background: rgba(243, 156, 18, 0.2);
        border-color: #f39c12;
        transform: scale(1.05) translateY(-3px);
        box-shadow: 0 10px 25px rgba(243, 156, 18, 0.3);
    }

    .inventory-item .item-icon {
        font-size: 1.8em;
        margin-bottom: 4px;
        text-shadow: 0 0 10px rgba(255,255,255,0.3);
    }

    .inventory-item .item-name {
        color: white;
        font-size: 0.7em;
        font-weight: 500;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    }

    .slot-selection {
        max-width: 600px;
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        border: 3px solid #f39c12;
        border-radius: 15px;
        max-height: 80vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    .selection-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
        gap: 15px;
        margin: 20px 0;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: #f39c12 rgba(255,255,255,0.1);
        max-height: 400px;
        flex: 1;
    }

    .selection-item {
        background: rgba(255,255,255,0.1);
        border: 2px solid rgba(255,255,255,0.2);
        border-radius: 12px;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
    }

    .selection-item:hover {
        background: rgba(243, 156, 18, 0.2);
        border-color: #f39c12;
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(243, 156, 18, 0.3);
    }

    /* Enhanced Scrollbar Styling for All Platforms */
    .inventory-content::-webkit-scrollbar,
    .selection-grid::-webkit-scrollbar,
    .character-panel::-webkit-scrollbar,
    .equipment-panel::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    .inventory-content::-webkit-scrollbar-track,
    .selection-grid::-webkit-scrollbar-track,
    .character-panel::-webkit-scrollbar-track,
    .equipment-panel::-webkit-scrollbar-track {
        background: rgba(255,255,255,0.1);
        border-radius: 4px;
    }

    .inventory-content::-webkit-scrollbar-thumb,
    .selection-grid::-webkit-scrollbar-thumb,
    .character-panel::-webkit-scrollbar-thumb,
    .equipment-panel::-webkit-scrollbar-thumb {
        background: linear-gradient(45deg, #f39c12, #e67e22);
        border-radius: 4px;
        border: 1px solid rgba(255,255,255,0.2);
    }

    .inventory-content::-webkit-scrollbar-thumb:hover,
    .selection-grid::-webkit-scrollbar-thumb:hover,
    .character-panel::-webkit-scrollbar-thumb:hover,
    .equipment-panel::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(45deg, #e67e22, #d35400);
    }

    /* Enhanced Mobile Scrolling */
    @supports (-webkit-overflow-scrolling: touch) {
        .inventory-content,
        .selection-grid,
        .character-panel,
        .equipment-panel {
            -webkit-overflow-scrolling: touch;
        }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .gear-modal {
            width: 98%;
            height: 95vh;
            border-radius: 10px;
        }
        
        .gear-container {
            flex-direction: column;
            gap: 10px;
            padding: 15px;
            height: calc(100% - 60px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .character-panel, .equipment-panel, .inventory-panel {
            flex: none;
            min-height: auto;
            max-height: none;
        }
        
        .character-panel {
            order: 3;
            max-height: 200px;
        }
        
        .equipment-panel {
            order: 1;
            max-height: 400px;
        }
        
        .inventory-panel {
            order: 2;
            max-height: 350px;
        }
        
        .equipment-slots {
            gap: 20px;
        }
        
        .skill-slots, .gear-slots {
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .equipment-slot {
            width: 100px;
            height: 100px;
        }
        
        .inventory-content {
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            max-height: 250px;
        }
        
        .slot-selection {
            max-width: 95%;
            max-height: 90vh;
        }
        
        .selection-grid {
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            max-height: 60vh;
        }
    }

    @media (max-width: 480px) {
        .equipment-slot {
            width: 85px;
            height: 85px;
        }
        
        .slot-icon {
            font-size: 2em;
        }
        
        .slot-name {
            font-size: 0.7em;
        }
        
        .inventory-content {
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
        }
        
        .gear-container {
            padding: 10px;
        }
    }

    /* Ensure touch-friendly scrolling on all mobile devices */
    @media (hover: none) and (pointer: coarse) {
        .inventory-content,
        .selection-grid,
        .character-panel,
        .equipment-panel,
        .gear-container {
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }
        
        /* Hide scrollbars on mobile for cleaner look but keep functionality */
        .inventory-content::-webkit-scrollbar,
        .selection-grid::-webkit-scrollbar,
        .character-panel::-webkit-scrollbar,
        .equipment-panel::-webkit-scrollbar {
            width: 3px;
        }
    }
    /* Additional Rarity Classes */
.equipment-card.mythical {
    border: 2px solid #9b59b6;
    background: linear-gradient(135deg, rgba(155, 89, 182, 0.2) 0%, rgba(142, 68, 173, 0.1) 100%);
    box-shadow: 0 0 20px rgba(155, 89, 182, 0.4);
}

.equipment-card.mythical:hover {
    box-shadow: 0 0 30px rgba(155, 89, 182, 0.6);
    transform: translateY(-8px);
}

.equipment-card.divine {
    border: 2px solid #f39c12;
    background: linear-gradient(135deg, rgba(243, 156, 18, 0.3) 0%, rgba(230, 126, 34, 0.15) 100%);
    box-shadow: 0 0 25px rgba(243, 156, 18, 0.5);
}

.equipment-card.divine:hover {
    box-shadow: 0 0 35px rgba(243, 156, 18, 0.7);
    transform: translateY(-10px);
}

.equipment-card.ultimate {
    border: 3px solid #fff;
    background: linear-gradient(135deg, 
        rgba(255, 215, 0, 0.3) 0%, 
        rgba(255, 140, 0, 0.2) 25%,
        rgba(255, 0, 255, 0.2) 50%,
        rgba(0, 191, 255, 0.2) 75%,
        rgba(255, 215, 0, 0.3) 100%);
    box-shadow: 0 0 30px rgba(255, 255, 255, 0.6),
                0 0 50px rgba(243, 156, 18, 0.4);
    animation: ultimateGlow 2s ease-in-out infinite;
}

.equipment-card.ultimate:hover {
    box-shadow: 0 0 40px rgba(255, 255, 255, 0.8),
                0 0 60px rgba(243, 156, 18, 0.6);
    transform: translateY(-12px) scale(1.05);
}

@keyframes ultimateGlow {
    0%, 100% {
        box-shadow: 0 0 30px rgba(255, 255, 255, 0.6),
                    0 0 50px rgba(243, 156, 18, 0.4);
    }
    50% {
        box-shadow: 0 0 40px rgba(255, 255, 255, 0.8),
                    0 0 70px rgba(243, 156, 18, 0.6);
    }
}
/* Turkey Milestone Styles */
.milestone-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.milestone-progress-section {
    background: rgba(0, 0, 0, 0.3);
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 30px;
    border: 2px solid var(--secondary-color);
}

.milestone-progress-bar {
    position: relative;
    width: 100%;
    height: 40px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 20px;
    border: 2px solid var(--halloween-orange);
    overflow: hidden;
}

.milestone-progress-fill {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    background: linear-gradient(90deg, var(--halloween-orange), #f39c12);
    transition: width 0.5s ease;
    box-shadow: 0 0 20px var(--halloween-orange);
}

.milestone-progress-text {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.2em;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    z-index: 1;
}

.milestones-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.milestone-card {
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid var(--secondary-color);
    border-radius: 15px;
    padding: 20px;
    transition: all 0.3s ease;
}

.milestone-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(149, 165, 166, 0.3);
}

.milestone-card.rare {
    border-color: #3498db;
    background: linear-gradient(135deg, rgba(52, 152, 219, 0.2) 0%, rgba(41, 128, 185, 0.1) 100%);
}

.milestone-card.epic {
    border-color: #9b59b6;
    background: linear-gradient(135deg, rgba(155, 89, 182, 0.2) 0%, rgba(142, 68, 173, 0.1) 100%);
}

.milestone-card.legendary {
    border-color: var(--halloween-orange);
    background: linear-gradient(135deg, rgba(255, 140, 0, 0.2) 0%, rgba(230, 126, 34, 0.1) 100%);
}

.milestone-card.mythical {
    border-color: #e74c3c;
    background: linear-gradient(135deg, rgba(231, 76, 60, 0.3) 0%, rgba(192, 57, 43, 0.15) 100%);
    box-shadow: 0 0 20px rgba(231, 76, 60, 0.4);
}

.milestone-card.divine {
    border-color: #f39c12;
    background: linear-gradient(135deg, rgba(243, 156, 18, 0.3) 0%, rgba(230, 126, 34, 0.15) 100%);
    box-shadow: 0 0 25px rgba(243, 156, 18, 0.5);
}

.milestone-card.ultimate {
    border: 3px solid #fff;
    background: linear-gradient(135deg, 
        rgba(255, 215, 0, 0.3) 0%, 
        rgba(255, 140, 0, 0.2) 25%,
        rgba(255, 0, 255, 0.2) 50%,
        rgba(0, 191, 255, 0.2) 75%,
        rgba(255, 215, 0, 0.3) 100%);
    box-shadow: 0 0 30px rgba(255, 255, 255, 0.6);
    animation: ultimateGlow 2s ease-in-out infinite;
}

.milestone-card.ultimate-final {
    border: 4px solid gold;
    background: linear-gradient(135deg, 
        rgba(255, 215, 0, 0.4) 0%, 
        rgba(255, 140, 0, 0.3) 25%,
        rgba(255, 0, 255, 0.3) 50%,
        rgba(0, 255, 255, 0.3) 75%,
        rgba(255, 215, 0, 0.4) 100%);
    box-shadow: 0 0 40px gold, 0 0 80px rgba(255, 215, 0, 0.6);
    animation: ultimateFinalGlow 1.5s ease-in-out infinite;
}

@keyframes ultimateFinalGlow {
    0%, 100% {
        box-shadow: 0 0 40px gold, 0 0 80px rgba(255, 215, 0, 0.6);
        transform: scale(1);
    }
    50% {
        box-shadow: 0 0 60px gold, 0 0 100px rgba(255, 215, 0, 0.8);
        transform: scale(1.02);
    }
}

.milestone-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid rgba(255, 255, 255, 0.2);
}

.milestone-icon {
    font-size: 2em;
}

.milestone-title {
    font-size: 1.3em;
    font-weight: bold;
    color: var(--halloween-orange);
}

.milestone-rewards {
    margin: 15px 0;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.reward-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    transition: all 0.2s ease;
}

.reward-item:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateX(5px);
}

.reward-item.special-reward {
    background: linear-gradient(90deg, rgba(255, 215, 0, 0.3), rgba(255, 140, 0, 0.3));
    border: 2px solid gold;
    font-weight: bold;
    animation: specialPulse 2s ease-in-out infinite;
}

@keyframes specialPulse {
    0%, 100% {
        box-shadow: 0 0 10px gold;
    }
    50% {
        box-shadow: 0 0 20px gold;
    }
}

.reward-icon {
    font-size: 1.5em;
}

.reward-name {
    color: var(--secondary-color);
    font-size: 0.95em;
}

.milestone-claim-btn {
    width: 100%;
    padding: 12px;
    font-size: 1.1em;
    font-weight: bold;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 15px;
}

.milestone-claim-btn:disabled {
    background: rgba(100, 100, 100, 0.5);
    color: rgba(255, 255, 255, 0.5);
    cursor: not-allowed;
}

.milestone-claim-btn.ready {
    background: linear-gradient(135deg, var(--halloween-orange), #f39c12);
    color: white;
    box-shadow: 0 5px 15px rgba(255, 140, 0, 0.4);
    animation: pulseButton 1.5s ease-in-out infinite;
}

.milestone-claim-btn.ready:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 25px rgba(255, 140, 0, 0.6);
}

.milestone-claim-btn.claimed {
    background: rgba(46, 204, 113, 0.5);
    color: white;
    cursor: default;
}

@keyframes pulseButton {
    0%, 100% {
        box-shadow: 0 5px 15px rgba(255, 140, 0, 0.4);
    }
    50% {
        box-shadow: 0 5px 25px rgba(255, 140, 0, 0.7);
    }
}

.milestone-card.completed {
    opacity: 0.7;
    border-color: #2ecc71;
}

.milestone-card.completed .milestone-header {
    border-bottom-color: #2ecc71;
}
.milestone-status {
    font-size: 0.75em;
    padding: 3px 8px;
    border-radius: 12px;
    font-weight: bold;
    margin-top: 5px;
    text-align: center;
    min-width: 60px;
}

.milestone-status.locked {
    background: rgba(231, 76, 60, 0.2);
    color: #e74c3c;
    border: 1px solid #e74c3c;
}

.milestone-status.ready {
    background: rgba(46, 204, 113, 0.2);
    color: #2ecc71;
    border: 1px solid #2ecc71;
    animation: readyPulse 1.5s ease-in-out infinite;
}

.milestone-status.claimed {
    background: rgba(52, 152, 219, 0.2);
    color: #3498db;
    border: 1px solid #3498db;
}

@keyframes readyPulse {
    0%, 100% {
        box-shadow: 0 0 5px rgba(46, 204, 113, 0.5);
    }
    50% {
        box-shadow: 0 0 15px rgba(46, 204, 113, 0.8);
    }
}

.milestone-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid rgba(255, 255, 255, 0.2);
}

.milestone-header .milestone-icon {
    font-size: 2em;
}

.milestone-header .milestone-title {
    font-size: 1.3em;
    font-weight: bold;
    color: var(--halloween-orange);
    text-align: center;
}
</style>

<script>
// Turkey Event System dengan slot system yang berfungsi penuh
const turkeyGameState = {
    playerHP: 100,
    playerMaxHP: 100,
    playerMP: 50,
    playerMaxMP: 50,
    bossHP: 150,
    bossMaxHP: 150,
    turkeyFeathers: 0,
    battleActive: true,
    purchasedItems: {},
    equippedSlots: {},
    currentInventoryTab: 'skills',
    // Tambahkan milestone data
    totalBattles: 0,
    claimedMilestones: []
};

// Milestone Data - EXCLUSIVE REWARDS (tidak ada di shop)
const milestoneRewards = {
    10: {
        skills: ['turkeyStomp'],
        gear: ['turkeyBandana'],
        feathers: 10
    },
    25: {
        skills: ['featherStorm'],
        gear: ['gobbleShield'],
        feathers: 20
    },
    50: {
        skills: ['wingedAssault'],
        gear: ['veteranPlate', 'turkeyTalisman'],
        feathers: 35
    },
    100: {
        skills: ['gobbleBurst'],
        gear: ['championHelm', 'battleScarf'],
        feathers: 60
    },
    200: {
        skills: ['ancientRoar'],
        gear: ['eliteWings', 'warriorBelt'],
        feathers: 100
    },
    350: {
        skills: ['titanicStrike'],
        gear: ['heroicArmor', 'legendBlade'],
        feathers: 150
    },
    500: {
        skills: ['cosmicFeather'],
        gear: ['masterCloak', 'mythicGauntlets', 'crownOfVictory'],
        feathers: 250
    },
    750: {
        skills: ['primordialForce'],
        gear: ['emperorArmor', 'soulReaver', 'divineAmulet'],
        feathers: 400
    },
    1000: {
        skills: ['apocalypticWrath'],
        gear: ['godkingPlate', 'eternalWeapon', 'supremeShield', 'haloOfPower'],
        feathers: 600
    },
    1500: {
        skills: ['omnipotentStrike', 'worldEnder'],
        gear: ['absoluteArmor', 'infinityEdge'],
        feathers: 1000
    }
};

function updateMilestoneUI() {
    // Update battle count display
    document.getElementById('milestone-battles').textContent = turkeyGameState.totalBattles;
    
    // Find next milestone
    const milestones = Object.keys(milestoneRewards).map(Number).sort((a, b) => a - b);
    let nextMilestone = milestones.find(m => m > turkeyGameState.totalBattles) || milestones[milestones.length - 1];
    
    // Update progress bar
    const prevMilestone = milestones.filter(m => m <= turkeyGameState.totalBattles).pop() || 0;
    const progress = turkeyGameState.totalBattles - prevMilestone;
    const total = nextMilestone - prevMilestone;
    const percentage = (progress / total) * 100;
    
    document.getElementById('milestone-progress-fill').style.width = percentage + '%';
    document.getElementById('milestone-progress-text').textContent = 
        `${turkeyGameState.totalBattles} / ${nextMilestone}`;
    
    // Update milestone cards
    milestones.forEach(milestone => {
        const card = document.querySelector(`.milestone-card[data-milestone="${milestone}"]`);
        const button = card.querySelector('.milestone-claim-btn');
        const status = card.querySelector('.milestone-status');
        
        if (turkeyGameState.claimedMilestones.includes(milestone)) {
            // Already claimed
            card.classList.add('completed');
            button.textContent = '‚úÖ Claimed';
            button.classList.add('claimed');
            button.disabled = true;
            status.textContent = '‚úÖ Claimed';
            status.className = 'milestone-status claimed';
        } else if (turkeyGameState.totalBattles >= milestone) {
            // Ready to claim
            button.textContent = 'üéÅ Claim Reward!';
            button.classList.add('ready');
            button.disabled = false;
            status.textContent = 'üéÅ Ready!';
            status.className = 'milestone-status ready';
        } else {
            // Still locked
            const remaining = milestone - turkeyGameState.totalBattles;
            button.textContent = 'Claim Reward';
            button.classList.remove('ready', 'claimed');
            button.disabled = true;
            status.textContent = `üîí ${remaining} battles left`;
            status.className = 'milestone-status locked';
        }
    });
}

function claimMilestone(milestone) {
    if (turkeyGameState.totalBattles < milestone) {
        alert('You haven\'t reached this milestone yet!');
        return;
    }
    
    if (turkeyGameState.claimedMilestones.includes(milestone)) {
        alert('You already claimed this milestone!');
        return;
    }
    
    const rewards = milestoneRewards[milestone];
    let rewardText = 'You received:\n\n';
    
    // Grant skills
    if (rewards.skills) {
        rewards.skills.forEach(skillKey => {
            const purchaseKey = `skill-${skillKey}`;
            turkeyGameState.purchasedItems[purchaseKey] = true;
            rewardText += `‚öîÔ∏è ${turkeyPlayerSkills[skillKey].name}\n`;
        });
    }
    
    // Grant gear
    if (rewards.gear) {
        rewards.gear.forEach(gearKey => {
            const purchaseKey = `gear-${gearKey}`;
            turkeyGameState.purchasedItems[purchaseKey] = true;
            rewardText += `üõ°Ô∏è ${turkeyGearItems[gearKey].name}\n`;
        });
    }
    
    // Grant feathers
    if (rewards.feathers > 0) {
        turkeyGameState.turkeyFeathers += rewards.feathers;
        rewardText += `ü™∂ +${rewards.feathers} Turkey Feathers\n`;
    }
    
    // Special reward for 1500 battles
    if (milestone === 1500) {
        rewardText += '\nüëë TURKEY MASTER TITLE UNLOCKED!\n';
        rewardText += 'üèÜ You are now a legendary Turkey Slayer!';
    }
    
    // Mark as claimed
    turkeyGameState.claimedMilestones.push(milestone);
    
    // Save progress
    localStorage.setItem('turkeyPurchases', JSON.stringify(turkeyGameState.purchasedItems));
    localStorage.setItem('turkeyFeathers', turkeyGameState.turkeyFeathers.toString());
    localStorage.setItem('turkeyClaimedMilestones', JSON.stringify(turkeyGameState.claimedMilestones));
    
    // Show reward popup
    alert('üéâ MILESTONE REWARD CLAIMED! üéâ\n\n' + rewardText);
    
    // Update UI
    updateMilestoneUI();
    updateShopItems();
    generateActionButtons();
    updateTurkeyUI();
}

function showTurkeyMilestone() {
    hideAllScreens();
    document.getElementById('turkey-milestone-screen').style.display = 'block';
    updateMilestoneUI();
}

// Turkey Boss Skills
const turkeyBossSkills = [
    { name: 'Slash Knife', damage: 10, icon: 'üî™' },
    { name: 'Turkey Toast Blast', damage: 25, icon: 'üí•' },
    { name: 'Turkey Dance', damage: 40, icon: 'üíÉ' }
];

// Turkey Player Skills - Updated dengan skill baru yang lebih mahal
const turkeyPlayerSkills = {
    // Basic Skills (Shop)
    blame: { name: 'Turkey Blame', damage: 30, cost: 8 },
    swing: { name: 'Turkey Swing', damage: 50, cost: 12 },
    hit: { name: 'Turkey Hit', damage: 8, cost: 0 },
    bodyFist: { name: 'Turkey Body Fist', damage: 60, cost: 15 },
    rockSlam: { name: 'Turkey Rock Slam', damage: 40, cost: 12 },
    hand: { name: 'Turkey Hand', damage: 25, cost: 8 },
    megaBlast: { name: 'Turkey Mega Blast', damage: 80, cost: 20 },
    shadowStrike: { name: 'Turkey Shadow Strike', damage: 90, cost: 18 },
    fireBlast: { name: 'Turkey Fire Blast', damage: 55, cost: 14 },
    iceSpear: { name: 'Turkey Ice Spear', damage: 70, cost: 16 },
    windSlash: { name: 'Turkey Wind Slash', damage: 65, cost: 15 },
    earthquake: { name: 'Turkey Earthquake', damage: 85, cost: 19 },
    thunderBolt: { name: 'Turkey Thunder Bolt', damage: 100, cost: 22 },
    ultimateStrike: { name: 'Turkey Ultimate Strike', damage: 120, cost: 20 },
    meteorStrike: { name: 'Turkey Meteor Strike', damage: 135, cost: 25 },
    dragonBreath: { name: 'Turkey Dragon Breath', damage: 150, cost: 28 },
    voidSlash: { name: 'Turkey Void Slash', damage: 145, cost: 26 },
    cosmicBlast: { name: 'Turkey Cosmic Blast', damage: 180, cost: 30 },
    titanFist: { name: 'Turkey Titan Fist', damage: 200, cost: 32 },
    phoenixFlare: { name: 'Turkey Phoenix Flare', damage: 195, cost: 31 },
    galaxyStorm: { name: 'Turkey Galaxy Storm', damage: 210, cost: 33 },
    apocalypse: { name: 'Turkey Apocalypse', damage: 300, cost: 40 },
    judgmentDay: { name: 'Turkey Judgment Day', damage: 350, cost: 45 },
    divineWrath: { name: 'Turkey Divine Wrath', damage: 380, cost: 48 },
    celestialRuin: { name: 'Turkey Celestial Ruin', damage: 400, cost: 50 },
    omegaDestruction: { name: 'Turkey Omega Destruction', damage: 500, cost: 55 },
    infinityBreaker: { name: 'Turkey Infinity Breaker', damage: 600, cost: 60 },
    universalCollapse: { name: 'Turkey Universal Collapse', damage: 700, cost: 65 },
    godSlayer: { name: 'Turkey God Slayer', damage: 999, cost: 70 },
    
    // EXCLUSIVE MILESTONE SKILLS
    turkeyStomp: { name: 'ü¶É Turkey Stomp', damage: 45, cost: 10 },
    featherStorm: { name: 'ü™∂ Feather Storm', damage: 75, cost: 16 },
    wingedAssault: { name: 'ü¶Ö Winged Assault', damage: 110, cost: 21 },
    gobbleBurst: { name: 'üí• Gobble Burst', damage: 140, cost: 24 },
    ancientRoar: { name: 'üîä Ancient Roar', damage: 175, cost: 29 },
    titanicStrike: { name: '‚ö° Titanic Strike', damage: 220, cost: 34 },
    cosmicFeather: { name: 'üå† Cosmic Feather', damage: 280, cost: 38 },
    primordialForce: { name: 'üåã Primordial Force', damage: 360, cost: 44 },
    apocalypticWrath: { name: 'üíÄ Apocalyptic Wrath', damage: 450, cost: 52 },
    omnipotentStrike: { name: 'üëë Omnipotent Strike', damage: 650, cost: 62 },
    worldEnder: { name: 'üåç World Ender', damage: 888, cost: 68 }
};

// Turkey Gear Items - Updated dengan gear baru yang lebih mahal
const turkeyGearItems = {
    // Shop Gear
    helmet: { name: 'Turkey Helmet', defense: 15, hp: 25 },
    chestplate: { name: 'Turkey Chestplate', defense: 30, hp: 40 },
    sword: { name: 'Turkey Sword', attack: 35, critical: 10 },
    boots: { name: 'Turkey Boots', speed: 25, mp: 15 },
    crystal: { name: 'Turkey Crystal', speed: 15, attack: 15 },
    katana: { name: 'Turkey Katana', attack: 60, speed: 20 },
    shield: { name: 'Turkey Shield', defense: 50, block: 25 },
    magicRobe: { name: 'Turkey Magic Robe', defense: 40, mp: 30 },
    powerGloves: { name: 'Turkey Power Gloves', attack: 45, critical: 15 },
    speedRing: { name: 'Turkey Speed Ring', speed: 40, attack: 20 },
    manaOrb: { name: 'Turkey Mana Orb', mp: 50, speed: 30 },
    dragonArmor: { name: 'Turkey Dragon Armor', defense: 70, hp: 80 },
    titaniumShield: { name: 'Turkey Titanium Shield', defense: 80, block: 35 },
    flameSword: { name: 'Turkey Flame Sword', attack: 85, critical: 20 },
    stormBoots: { name: 'Turkey Storm Boots', speed: 60, mp: 40 },
    celestialArmor: { name: 'Turkey Celestial Armor', defense: 120, hp: 150, block: 15 },
    voidBlade: { name: 'Turkey Void Blade', attack: 130, critical: 30, speed: 25 },
    arcaneRobe: { name: 'Turkey Arcane Robe', defense: 100, mp: 100, speed: 35 },
    titanGauntlets: { name: 'Turkey Titan Gauntlets', attack: 140, defense: 50, critical: 25 },
    dragonlordPlate: { name: 'Turkey Dragonlord Plate', defense: 200, hp: 300, block: 40 },
    eternityBlade: { name: 'Turkey Eternity Blade', attack: 250, critical: 50, speed: 50 },
    cosmicShield: { name: 'Turkey Cosmic Shield', defense: 250, block: 60, hp: 200 },
    sageRobes: { name: 'Turkey Sage Robes', defense: 180, mp: 200, speed: 70 },
    phoenixWings: { name: 'Turkey Phoenix Wings', speed: 100, attack: 150, mp: 150 },
    godArmor: { name: 'Turkey God Armor', defense: 400, hp: 500, block: 80, mp: 100 },
    infinityWeapon: { name: 'Turkey Infinity Weapon', attack: 500, critical: 80, speed: 80 },
    omegaShield: { name: 'Turkey Omega Shield', defense: 500, block: 90, hp: 400 },
    celestialCrown: { name: 'Turkey Celestial Crown', attack: 300, defense: 300, mp: 300, critical: 60 },
    universalOrb: { name: 'Turkey Universal Orb', mp: 500, speed: 120, attack: 200, critical: 70 },
    
    // EXCLUSIVE MILESTONE GEAR
    turkeyBandana: { name: 'üéØ Turkey Bandana', attack: 20, speed: 15, critical: 8 },
    gobbleShield: { name: 'ü¶É Gobble Shield', defense: 45, hp: 50, block: 15 },
    veteranPlate: { name: 'üéñÔ∏è Veteran Plate', defense: 65, hp: 70, attack: 25 },
    turkeyTalisman: { name: '‚ú® Turkey Talisman', mp: 40, speed: 35, critical: 12 },
    championHelm: { name: 'üëë Champion Helm', defense: 90, hp: 100, mp: 50 },
    battleScarf: { name: 'üß£ Battle Scarf', attack: 70, speed: 45, critical: 18 },
    eliteWings: { name: 'ü¶Ö Elite Wings', speed: 80, attack: 95, mp: 60 },
    warriorBelt: { name: '‚öîÔ∏è Warrior Belt', attack: 110, defense: 85, hp: 120 },
    heroicArmor: { name: 'üõ°Ô∏è Heroic Armor', defense: 150, hp: 200, block: 30, mp: 80 },
    legendBlade: { name: '‚ö° Legend Blade', attack: 180, critical: 40, speed: 60 },
    masterCloak: { name: 'üßô Master Cloak', defense: 170, mp: 180, speed: 90, critical: 35 },
    mythicGauntlets: { name: 'üëä Mythic Gauntlets', attack: 220, defense: 100, critical: 45 },
    crownOfVictory: { name: 'üëë Crown of Victory', attack: 200, defense: 150, hp: 250, mp: 150 },
    emperorArmor: { name: 'üèÜ Emperor Armor', defense: 280, hp: 350, block: 50, mp: 120 },
    soulReaver: { name: 'üíÄ Soul Reaver', attack: 320, critical: 65, speed: 85 },
    divineAmulet: { name: '‚ú® Divine Amulet', mp: 250, speed: 100, attack: 180, defense: 120 },
    godkingPlate: { name: '‚öúÔ∏è Godking Plate', defense: 450, hp: 600, block: 85, mp: 200 },
    eternalWeapon: { name: '‚ôæÔ∏è Eternal Weapon', attack: 550, critical: 90, speed: 100 },
    supremeShield: { name: 'üõ°Ô∏è Supreme Shield', defense: 550, block: 95, hp: 500 },
    haloOfPower: { name: 'üëº Halo of Power', attack: 350, defense: 350, mp: 350, critical: 75, speed: 110 },
    absoluteArmor: { name: 'üåü Absolute Armor', defense: 700, hp: 800, block: 100, mp: 400, speed: 90 },
    infinityEdge: { name: '‚öîÔ∏è Infinity Edge', attack: 800, critical: 100, speed: 150, mp: 300 }
};

let currentSlotSelection = { type: null, slot: null };

function initTurkeyEvent() {
    // Load saved data
    const savedFeathers = localStorage.getItem('turkeyFeathers');
    const savedPurchases = localStorage.getItem('turkeyPurchases');
    const savedSlots = localStorage.getItem('turkeySlots');
    const savedBattles = localStorage.getItem('turkeyBattles');
    const savedMilestones = localStorage.getItem('turkeyClaimed Milestones');
    
    if (savedFeathers) {
        turkeyGameState.turkeyFeathers = parseInt(savedFeathers);
    }
    
    if (savedPurchases) {
        turkeyGameState.purchasedItems = JSON.parse(savedPurchases);
    }
    
    if (savedSlots) {
        turkeyGameState.equippedSlots = JSON.parse(savedSlots);
    }
    
    if (savedBattles) {
        turkeyGameState.totalBattles = parseInt(savedBattles);
    }
    
    if (savedMilestones) {
        turkeyGameState.claimedMilestones = JSON.parse(savedMilestones);
    }
    
    applyEquipmentBonuses();
    updateTurkeyUI();
    generateActionButtons();
    updateShopItems();
    updateMilestoneUI();
}

function generateActionButtons() {
    const actionGrid = document.getElementById('turkey-action-grid');
    
    // Clear existing skill buttons
    const skillButtons = actionGrid.querySelectorAll('.turkey-skill-btn');
    skillButtons.forEach(btn => btn.remove());
    
    // Get equipped skills from slots
    const equippedSkills = [];
    for (let i = 1; i <= 2; i++) {
        const slotKey = `skill-${i}`;
        const equippedSkill = turkeyGameState.equippedSlots[slotKey];
        if (equippedSkill && turkeyPlayerSkills[equippedSkill]) {
            equippedSkills.push(equippedSkill);
        }
    }
    
    // Always include basic skills if not equipped in slots
    const basicSkills = ['blame', 'swing', 'hit'];
    const allAvailableSkills = [...equippedSkills];
    
    // Add basic skills that aren't already equipped
    basicSkills.forEach(skill => {
        if (!allAvailableSkills.includes(skill)) {
            allAvailableSkills.unshift(skill);
        }
    });
    
    // Limit to 5 skills maximum
    const finalSkills = allAvailableSkills.slice(0, 5);
    
    // Create buttons
    finalSkills.forEach(skillKey => {
        const skill = turkeyPlayerSkills[skillKey];
        if (skill) {
            const button = document.createElement('button');
            button.className = 'action-btn turkey-skill-btn';
            button.onclick = () => useTurkeySkill(skillKey);
            button.innerHTML = `
                <div class="btn-icon">${getSkillIcon(skillKey)}</div>
                <div class="btn-name">${skill.name}</div>
                <div class="btn-cost">${skill.cost} MP</div>
            `;
            actionGrid.insertBefore(button, actionGrid.children[0]);
        }
    });
}

function getSkillIcon(skillKey) {
    const icons = {
        // Shop skills
        blame: 'ü´µ',
        swing: 'üó°Ô∏è',
        hit: '‚úä',
        bodyFist: 'üëä',
        rockSlam: 'ü™®',
        hand: '‚úã',
        megaBlast: 'üåü',
        ultimateStrike: '‚ö°',
        shadowStrike: 'üåô',
        fireBlast: 'üî•',
        iceSpear: '‚ùÑÔ∏è',
        thunderBolt: '‚õàÔ∏è',
        windSlash: 'üå™Ô∏è',
        earthquake: 'üåç',
        meteorStrike: '‚òÑÔ∏è',
        dragonBreath: 'üê≤',
        voidSlash: 'üåÄ',
        cosmicBlast: 'üåå',
        titanFist: 'üëä',
        phoenixFlare: 'üî•',
        galaxyStorm: 'üå†',
        apocalypse: 'üíÄ',
        judgmentDay: '‚öñÔ∏è',
        divineWrath: '‚ú®',
        celestialRuin: 'üåü',
        omegaDestruction: 'üí•',
        infinityBreaker: '‚ôæÔ∏è',
        universalCollapse: 'üåê',
        godSlayer: '‚öîÔ∏è',
        // Milestone exclusive skills
        turkeyStomp: 'ü¶É',
        featherStorm: 'ü™∂',
        wingedAssault: 'ü¶Ö',
        gobbleBurst: 'üí•',
        ancientRoar: 'üîä',
        titanicStrike: '‚ö°',
        cosmicFeather: 'üå†',
        primordialForce: 'üåã',
        apocalypticWrath: 'üíÄ',
        omnipotentStrike: 'üëë',
        worldEnder: 'üåç'
    };
    return icons[skillKey] || '‚öîÔ∏è';
}

function getGearIcon(gearKey) {
    const icons = {
        // Shop gear
        helmet: 'ü™ñ',
        chestplate: 'ü¶∫',
        sword: '‚öîÔ∏è',
        katana: 'üó°Ô∏è',
        boots: 'üë¢',
        shield: 'üõ°Ô∏è',
        crystal: 'üíé',
        magicRobe: 'üßô‚Äç‚ôÇÔ∏è',
        powerGloves: 'ü•ä',
        speedRing: 'üíç',
        dragonArmor: 'üêâ',
        manaOrb: 'üîÆ',
        titaniumShield: '‚öóÔ∏è',
        flameSword: 'üî•',
        stormBoots: '‚ö°',
        celestialArmor: '‚ú®',
        voidBlade: 'üåÄ',
        arcaneRobe: 'üîÆ',
        titanGauntlets: 'ü•ä',
        dragonlordPlate: 'üê≤',
        eternityBlade: '‚öîÔ∏è',
        cosmicShield: 'üåå',
        sageRobes: 'üßô',
        phoenixWings: 'üî•',
        godArmor: 'üëë',
        infinityWeapon: '‚ôæÔ∏è',
        omegaShield: 'üõ°Ô∏è',
        celestialCrown: 'üëë',
        universalOrb: 'üåê',
        // Milestone exclusive gear
        turkeyBandana: 'üéØ',
        gobbleShield: 'ü¶É',
        veteranPlate: 'üéñÔ∏è',
        turkeyTalisman: '‚ú®',
        championHelm: 'üëë',
        battleScarf: 'üß£',
        eliteWings: 'ü¶Ö',
        warriorBelt: '‚öîÔ∏è',
        heroicArmor: 'üõ°Ô∏è',
        legendBlade: '‚ö°',
        masterCloak: 'üßô',
        mythicGauntlets: 'üëä',
        crownOfVictory: 'üëë',
        emperorArmor: 'üèÜ',
        soulReaver: 'üíÄ',
        divineAmulet: '‚ú®',
        godkingPlate: '‚öúÔ∏è',
        eternalWeapon: '‚ôæÔ∏è',
        supremeShield: 'üõ°Ô∏è',
        haloOfPower: 'üëº',
        absoluteArmor: 'üåü',
        infinityEdge: '‚öîÔ∏è'
    };
    return icons[gearKey] || '‚öîÔ∏è';
}

function useTurkeySkill(skillKey) {
    if (!turkeyGameState.battleActive || turkeyGameState.bossHP <= 0) return;
    
    const skill = turkeyPlayerSkills[skillKey];
    if (!skill) return;
    
    if (turkeyGameState.playerMP < skill.cost) {
        addToTurkeyLog(`‚ùå Not enough MP! Need ${skill.cost} MP.`);
        return;
    }
    
    // Use MP
    turkeyGameState.playerMP -= skill.cost;
    
    // Calculate damage with equipment bonuses
    let damage = skill.damage;
    const totalStats = calculateTotalStats();
    damage += totalStats.attack;
    
    // Apply critical hit chance
    const criticalChance = totalStats.critical || 0;
    const isCritical = Math.random() * 100 < criticalChance;
    if (isCritical) {
        damage = Math.floor(damage * 1.5);
    }
    
    // Apply damage
    turkeyGameState.bossHP = Math.max(0, turkeyGameState.bossHP - damage);
    
    const critText = isCritical ? ' CRITICAL!' : '';
    addToTurkeyLog(`ü•∑ You used ${skill.name}! Dealt ${damage} damage${critText}!`);
    
    // Check if boss is defeated
    if (turkeyGameState.bossHP <= 0) {
        turkeyBossDefeated();
        return;
    }
    
    updateTurkeyUI();
    
    // Boss counterattack after a delay
    setTimeout(turkeyBossAttack, 1000);
}

function turkeyBossAttack() {
    if (turkeyGameState.bossHP <= 0) return;
    
    const bossSkill = turkeyBossSkills[Math.floor(Math.random() * turkeyBossSkills.length)];
    
    // Apply damage reduction from defense
    const totalStats = calculateTotalStats();
    let damage = bossSkill.damage;
    const damageReduction = Math.min(totalStats.defense * 0.5, damage * 0.8);
    damage = Math.max(1, Math.floor(damage - damageReduction));
    
    // Check for block
    const blockChance = totalStats.block || 0;
    const isBlocked = Math.random() * 100 < blockChance;
    if (isBlocked) {
        damage = Math.floor(damage * 0.3);
        addToTurkeyLog(`ü¶É Turkey used ${bossSkill.name} but you blocked it! Only ${damage} damage taken!`);
    } else {
        addToTurkeyLog(`ü¶É Turkey used ${bossSkill.name}! You took ${damage} damage!`);
    }
    
    turkeyGameState.playerHP = Math.max(0, turkeyGameState.playerHP - damage);
    
    // Boss attack animation
    const bossSprite = document.getElementById('turkey-boss-sprite');
    bossSprite.classList.add('turkey-boss-attack');
    setTimeout(() => {
        bossSprite.classList.remove('turkey-boss-attack');
    }, 500);
    
    if (turkeyGameState.playerHP <= 0) {
        addToTurkeyLog(`üíÄ You were defeated! Respawning...`);
        setTimeout(() => {
            turkeyGameState.playerHP = turkeyGameState.playerMaxHP;
            turkeyGameState.playerMP = turkeyGameState.playerMaxMP;
            turkeyGameState.bossHP = turkeyGameState.bossMaxHP;
            updateTurkeyUI();
        }, 2000);
    }
    
    updateTurkeyUI();
}

function turkeyBossDefeated() {
    turkeyGameState.battleActive = false;
    const feathersEarned = 1;
    turkeyGameState.turkeyFeathers += feathersEarned;
    
    // Increment battle count for milestone
    turkeyGameState.totalBattles += 1;
    localStorage.setItem('turkeyBattles', turkeyGameState.totalBattles.toString());
    
    addToTurkeyLog(`üéâ Turkey defeated! You earned ${feathersEarned} Turkey Feather!`);
    addToTurkeyLog(`‚öîÔ∏è Total Battles: ${turkeyGameState.totalBattles}`);
    
    // Check if new milestone is available
    const milestones = Object.keys(milestoneRewards).map(Number);
    const newMilestone = milestones.find(m => 
        m === turkeyGameState.totalBattles && 
        !turkeyGameState.claimedMilestones.includes(m)
    );
    
    if (newMilestone) {
        addToTurkeyLog(`üèÜ MILESTONE REACHED! Check Milestone screen for rewards!`);
    }
    
    // Save progress
    localStorage.setItem('turkeyFeathers', turkeyGameState.turkeyFeathers.toString());
    
    // Victory animation
    const battleArena = document.querySelector('.battle-arena');
    battleArena.classList.add('turkey-victory');
    
    setTimeout(() => {
        turkeyGameState.battleActive = true;
        turkeyGameState.bossHP = turkeyGameState.bossMaxHP;
        turkeyGameState.playerHP = turkeyGameState.playerMaxHP;
        turkeyGameState.playerMP = turkeyGameState.playerMaxMP;
        battleArena.classList.remove('turkey-victory');
        updateTurkeyUI();
        addToTurkeyLog(`ü¶É A new Turkey appears!`);
    }, 3000);
}

function turkeyHeal() {
    const hpHealAmount = Math.floor(turkeyGameState.playerMaxHP * 0.3);
    const mpHealAmount = Math.floor(turkeyGameState.playerMaxMP * 0.5);
    
    const oldHP = turkeyGameState.playerHP;
    const oldMP = turkeyGameState.playerMP;
    
    turkeyGameState.playerHP = Math.min(turkeyGameState.playerMaxHP, turkeyGameState.playerHP + hpHealAmount);
    turkeyGameState.playerMP = Math.min(turkeyGameState.playerMaxMP, turkeyGameState.playerMP + mpHealAmount);
    
    const actualHPHealed = turkeyGameState.playerHP - oldHP;
    const actualMPHealed = turkeyGameState.playerMP - oldMP;
    
    addToTurkeyLog(`üíä You used Heal! Restored ${actualHPHealed} HP and ${actualMPHealed} MP!`);
    updateTurkeyUI();
}

function updateTurkeyUI() {
    // Update player stats
    document.getElementById('turkey-player-hp').textContent = `${turkeyGameState.playerHP}/${turkeyGameState.playerMaxHP}`;
    document.getElementById('turkey-player-mp').textContent = `${turkeyGameState.playerMP}/${turkeyGameState.playerMaxMP}`;
    document.getElementById('turkey-feathers').textContent = `${turkeyGameState.turkeyFeathers} Feathers`;
    document.getElementById('shop-feathers').textContent = turkeyGameState.turkeyFeathers;
    
    // Update HP/MP bars
    const hpPercent = (turkeyGameState.playerHP / turkeyGameState.playerMaxHP) * 100;
    const mpPercent = (turkeyGameState.playerMP / turkeyGameState.playerMaxMP) * 100;
    document.getElementById('turkey-player-hp-bar').style.width = hpPercent + '%';
    document.getElementById('turkey-player-mp-bar').style.width = mpPercent + '%';
    
    // Update boss stats
    document.getElementById('turkey-boss-hp').textContent = `${turkeyGameState.bossHP}/${turkeyGameState.bossMaxHP}`;
    const bossHpPercent = (turkeyGameState.bossHP / turkeyGameState.bossMaxHP) * 100;
    document.getElementById('turkey-boss-hp-bar').style.width = bossHpPercent + '%';
}

function addToTurkeyLog(message) {
    const log = document.getElementById('turkey-battle-log');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.textContent = message;
    log.appendChild(entry);
    log.scrollTop = log.scrollHeight;
    
    // Keep only last 10 messages
    while (log.children.length > 10) {
        log.removeChild(log.firstChild);
    }
}

function buyTurkeyItem(type, itemKey, cost) {
    if (turkeyGameState.turkeyFeathers < cost) {
        alert(`Not enough feathers! You need ${cost} feathers.`);
        return;
    }
    
    const purchaseKey = `${type}-${itemKey}`;
    if (turkeyGameState.purchasedItems[purchaseKey]) {
        alert('You already own this item!');
        return;
    }
    
    turkeyGameState.turkeyFeathers -= cost;
    turkeyGameState.purchasedItems[purchaseKey] = true;
    
    localStorage.setItem('turkeyFeathers', turkeyGameState.turkeyFeathers.toString());
    localStorage.setItem('turkeyPurchases', JSON.stringify(turkeyGameState.purchasedItems));
    
    document.getElementById('shop-feathers').textContent = turkeyGameState.turkeyFeathers;
    updateShopItems();
    
    const itemName = type === 'skill' ? turkeyPlayerSkills[itemKey]?.name : turkeyGearItems[itemKey]?.name;
    alert(`Successfully purchased ${itemName}!`);
}

function updateShopItems() {
    document.querySelectorAll('.turkey-shop-item').forEach(item => {
        const onclick = item.getAttribute('onclick');
        if (onclick) {
            const match = onclick.match(/buyTurkeyItem\('(\w+)', '(\w+)', \d+\)/);
            if (match) {
                const [, type, itemKey] = match;
                const purchaseKey = `${type}-${itemKey}`;
                const isEquipped = Object.values(turkeyGameState.equippedSlots).includes(itemKey);
                
                if (turkeyGameState.purchasedItems[purchaseKey]) {
                    item.classList.add('purchased');
                    if (isEquipped) {
                        item.classList.add('equipped');
                    }
                }
            }
        }
    });
}

// Equipment System Functions
function calculateTotalStats() {
    let totalStats = {
        attack: 0,
        defense: 0,
        speed: 0,
        hp: 0,
        mp: 0,
        critical: 0,
        block: 0
    };
    
    // Calculate bonuses from equipped gear
    for (let i = 1; i <= 2; i++) {
        const gearKey = turkeyGameState.equippedSlots[`gear-${i}`];
        if (gearKey && turkeyGearItems[gearKey]) {
            const gear = turkeyGearItems[gearKey];
            totalStats.attack += gear.attack || 0;
            totalStats.defense += gear.defense || 0;
            totalStats.speed += gear.speed || 0;
            totalStats.hp += gear.hp || 0;
            totalStats.mp += gear.mp || 0;
            totalStats.critical += gear.critical || 0;
            totalStats.block += gear.block || 0;
        }
    }
    
    return totalStats;
}

function applyEquipmentBonuses() {
    const totalStats = calculateTotalStats();
    
    // Apply HP and MP bonuses
    const baseHP = 100;
    const baseMP = 50;
    
    turkeyGameState.playerMaxHP = baseHP + totalStats.hp;
    turkeyGameState.playerMaxMP = baseMP + totalStats.mp;
    
    // Heal to max if current values are higher than new max
    turkeyGameState.playerHP = Math.min(turkeyGameState.playerHP, turkeyGameState.playerMaxHP);
    turkeyGameState.playerMP = Math.min(turkeyGameState.playerMP, turkeyGameState.playerMaxMP);
}

function openTurkeyGear() {
    document.getElementById('turkey-gear-modal').style.display = 'flex';
    updateGearDisplay();
    updateInventoryDisplay();
}

function closeTurkeyGear() {
    document.getElementById('turkey-gear-modal').style.display = 'none';
}

function updateGearDisplay() {
    // Update equipped slots
    for (let i = 1; i <= 2; i++) {
        updateSlotDisplay('skill', i);
        updateSlotDisplay('gear', i);
    }
    
    // Update total stats
    const totalStats = calculateTotalStats();
    document.getElementById('total-attack').textContent = totalStats.attack;
    document.getElementById('total-defense').textContent = totalStats.defense;
    document.getElementById('total-speed').textContent = totalStats.speed;
    document.getElementById('total-hp').textContent = totalStats.hp;
    document.getElementById('total-mp').textContent = totalStats.mp;
}

function updateSlotDisplay(type, slot) {
    const slotElement = document.getElementById(`${type}-slot-${slot}`);
    const slotKey = `${type}-${slot}`;
    const equippedItem = turkeyGameState.equippedSlots[slotKey];
    
    if (equippedItem) {
        const isSkill = type === 'skill';
        const itemData = isSkill ? turkeyPlayerSkills[equippedItem] : turkeyGearItems[equippedItem];
        
        if (itemData) {
            slotElement.classList.add('filled');
            const icon = isSkill ? getSkillIcon(equippedItem) : getGearIcon(equippedItem);
            const name = itemData.name.replace('Turkey ', '');
            
            slotElement.innerHTML = `
                <div class="slot-icon">${icon}</div>
                <div class="slot-name">${name}</div>
            `;
        }
    } else {
        slotElement.classList.remove('filled');
        slotElement.innerHTML = `
            <div class="slot-icon">+</div>
            <div class="slot-name">${type === 'skill' ? 'Skill' : 'Gear'} Slot ${slot}</div>
        `;
    }
}

function switchInventoryTab(tab) {
    turkeyGameState.currentInventoryTab = tab;
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`.tab-btn:nth-child(${tab === 'skills' ? '1' : '2'})`).classList.add('active');
    updateInventoryDisplay();
}

function updateInventoryDisplay() {
    const inventoryContent = document.getElementById('inventory-content');
    inventoryContent.innerHTML = '';
    
    const isSkillTab = turkeyGameState.currentInventoryTab === 'skills';
    const items = isSkillTab ? turkeyPlayerSkills : turkeyGearItems;
    
    Object.keys(items).forEach(itemKey => {
        const purchaseKey = `${isSkillTab ? 'skill' : 'gear'}-${itemKey}`;
        if (turkeyGameState.purchasedItems[purchaseKey]) {
            const item = items[itemKey];
            const itemElement = document.createElement('div');
            itemElement.className = 'inventory-item';
            itemElement.onclick = () => equipFromInventory(isSkillTab ? 'skill' : 'gear', itemKey);
            
            const icon = isSkillTab ? getSkillIcon(itemKey) : getGearIcon(itemKey);
            const shortName = item.name.replace('Turkey ', '').substring(0, 12);
            
            itemElement.innerHTML = `
                <div class="item-icon">${icon}</div>
                <div class="item-name">${shortName}</div>
            `;
            
            inventoryContent.appendChild(itemElement);
        }
    });
}

function equipFromInventory(type, itemKey) {
    // Find an empty slot or replace the first slot
    for (let i = 1; i <= 2; i++) {
        const slotKey = `${type}-${i}`;
        if (!turkeyGameState.equippedSlots[slotKey]) {
            turkeyGameState.equippedSlots[slotKey] = itemKey;
            saveEquipmentState();
            updateGearDisplay();
            updateInventoryDisplay();
            updateShopItems();
            generateActionButtons();
            applyEquipmentBonuses();
            updateTurkeyUI();
            return;
        }
    }
    
    // If no empty slots, replace slot 1
    const slotKey = `${type}-1`;
    turkeyGameState.equippedSlots[slotKey] = itemKey;
    saveEquipmentState();
    updateGearDisplay();
    updateInventoryDisplay();
    updateShopItems();
    generateActionButtons();
    applyEquipmentBonuses();
    updateTurkeyUI();
}

function openSlotSelection(type, slot) {
    currentSlotSelection = { type, slot };
    const modal = document.getElementById('slot-selection-modal');
    const title = document.getElementById('selection-title');
    const grid = document.getElementById('selection-grid');
    
    title.textContent = `Select ${type === 'skill' ? 'Skill' : 'Gear'} for Slot ${slot}`;
    grid.innerHTML = '';
    
    // Add remove option if slot is filled
    const slotKey = `${type}-${slot}`;
    if (turkeyGameState.equippedSlots[slotKey]) {
        const removeItem = document.createElement('div');
        removeItem.className = 'selection-item';
        removeItem.onclick = () => removeFromSlot(type, slot);
        removeItem.innerHTML = `
            <div style="font-size: 2em;">‚ùå</div>
            <div>Remove Item</div>
        `;
        grid.appendChild(removeItem);
    }
    
    // Add available items
    const items = type === 'skill' ? turkeyPlayerSkills : turkeyGearItems;
    Object.keys(items).forEach(itemKey => {
        const purchaseKey = `${type}-${itemKey}`;
        if (turkeyGameState.purchasedItems[purchaseKey]) {
            const item = items[itemKey];
            const itemElement = document.createElement('div');
            itemElement.className = 'selection-item';
            itemElement.onclick = () => equipToSlot(type, slot, itemKey);
            
            const icon = type === 'skill' ? getSkillIcon(itemKey) : getGearIcon(itemKey);
            const shortName = item.name.replace('Turkey ', '');
            
            itemElement.innerHTML = `
                <div style="font-size: 2em;">${icon}</div>
                <div style="font-size: 0.9em;">${shortName}</div>
            `;
            
            grid.appendChild(itemElement);
        }
    });
    
    modal.style.display = 'flex';
}

function equipToSlot(type, slot, itemKey) {
    const slotKey = `${type}-${slot}`;
    turkeyGameState.equippedSlots[slotKey] = itemKey;
    saveEquipmentState();
    closeSlotSelection();
    updateGearDisplay();
    updateInventoryDisplay();
    updateShopItems();
    generateActionButtons();
    applyEquipmentBonuses();
    updateTurkeyUI();
}

function removeFromSlot(type, slot) {
    const slotKey = `${type}-${slot}`;
    delete turkeyGameState.equippedSlots[slotKey];
    saveEquipmentState();
    closeSlotSelection();
    updateGearDisplay();
    updateInventoryDisplay();
    updateShopItems();
    generateActionButtons();
    applyEquipmentBonuses();
    updateTurkeyUI();
}

function closeSlotSelection() {
    document.getElementById('slot-selection-modal').style.display = 'none';
    currentSlotSelection = { type: null, slot: null };
}

function saveEquipmentState() {
    localStorage.setItem('turkeySlots', JSON.stringify(turkeyGameState.equippedSlots));
}

// Navigation functions
function showTurkeyShop() {
    hideAllScreens();
    document.getElementById('turkey-shop-screen').style.display = 'block';
    updateShopItems();
}

function showTurkeyEvent() {
    hideAllScreens();
    document.getElementById('turkey-event-screen').style.display = 'block';
    generateActionButtons();
    updateTurkeyUI();
}

function openTurkeyMilestone() {
    document.getElementById('turkey-milestone-screen').classList.add('active');
    document.querySelectorAll('.screen').forEach(s => {
        if (s !== document.getElementById('turkey-milestone-screen')) {
            s.classList.remove('active');
        }
    });
    updateMilestoneUI();
}

// Initialize Turkey Event when the page loads
document.addEventListener('DOMContentLoaded', function() {
    if (typeof initTurkeyEvent === 'function') {
        initTurkeyEvent();
    }
});
</script>
   
    <!-- Shop Screen -->
    <div id="shopScreen" class="screen">
        <div class="section-header">
            <h2 class="section-title">üè™ Shop</h2>
            <span class="section-badge" id="shopGoldBadge">üí∞ 0</span>
        </div>

        <div class="tab-container">
            <button class="tab-btn active" data-tab="weapons">‚öîÔ∏è Weapons</button>
            <button class="tab-btn" data-tab="armor">ü¶∫ Armor</button>
            <button class="tab-btn" data-tab="accessories">üíé Accessories</button>
            <button class="tab-btn" data-tab="potions">üß™ Potions</button>
        </div>

        <div id="weaponsTab" class="tab-content active">
            <div id="weaponsList"></div>
        </div>

        <div id="armorTab" class="tab-content">
            <div id="armorList"></div>
        </div>

        <div id="accessoriesTab" class="tab-content">
            <div id="accessoriesList"></div>
        </div>

        <div id="potionsTab" class="tab-content">
            <div id="potionsList"></div>
        </div>
    </div>

    <!-- Inventory Screen -->
    <div id="inventoryScreen" class="screen">
        <div class="section-header">
            <h2 class="section-title">üéí Inventory</h2>
            <span class="section-badge" id="goldBadge">üí∞ 0</span>
        </div>

        <div class="tab-container">
            <button class="tab-btn active" data-tab="equipment">‚öîÔ∏è Equipment</button>
            <button class="tab-btn" data-tab="consumables">üß™ Items</button>
        </div>

        <div id="equipmentTab" class="tab-content active">
            <h3 style="margin: 15px 0;">Equipped Items</h3>
            <div id="equippedItems" class="equipment-grid"></div>
            
            <h3 style="margin: 20px 0 15px 0;">Available Equipment</h3>
            <div id="availableEquipment" class="equipment-grid"></div>
        </div>

        <div id="consumablesTab" class="tab-content">
            <div id="consumablesList" class="equipment-grid"></div>
        </div>
    </div>

    <!-- Skills Screen -->
    <div id="skillsScreen" class="screen">
        <div class="section-header">
            <h2 class="section-title">‚≠ê Skill Tree</h2>
            <span class="section-badge" id="skillPointsBadge">Points: 0</span>
        </div>

        <div id="skillTree" class="skill-tree"></div>
    </div>

    <!-- Quests Screen -->
    <div id="questsScreen" class="screen">
        <div class="section-header">
            <h2 class="section-title">üìú Quests</h2>
            <span class="section-badge" id="questCountBadge">0/0</span>
        </div>

        <div id="questsList" class="quest-list"></div>
    </div>

    <!-- Milestones Screen -->
    <div id="milestonesScreen" class="screen">
        <div class="section-header">
            <h2 class="section-title">üèÜ Milestones</h2>
            <span class="section-badge" id="milestoneCountBadge">0 Battles</span>
        </div>

        <div id="milestonesList"></div>
    </div>

   <!-- Events Screen -->
<div id="eventsScreen" class="screen">
    <div class="section-header">
        <h2 class="section-title">üéâ Active Events</h2>
    </div>

    <div id="eventsList"></div>

    <div class="button-group" style="margin-top: 40px;">
        <button class="menu-button" onclick="document.getElementById('eventsScreen').classList.remove('active'); document.getElementById('mainScreen').classList.add('active');">
            ‚¨ÖÔ∏è Back to Game
        </button>
    </div>
</div>

    <!-- Victory Modal -->
    <div id="victoryModal" class="modal">
        <div class="modal-content">
            <h2>üéâ Victory! üéâ</h2>
            <div id="victoryText"></div>
            <div id="lootDisplay"></div>
            <button class="menu-button" id="nextBattleBtn" style="margin-top: 20px;">Next Battle</button>
        </div>
    </div>

    <!-- Defeat Modal -->
    <div id="defeatModal" class="modal">
        <div class="modal-content">
            <h2>üíÄ Defeat üíÄ</h2>
            <p style="margin: 20px 0; font-size: 1.1em;">You have been defeated...</p>
            <div style="margin: 20px 0;">
                <button class="menu-button" id="retryBtn">Try Again</button>
                <button class="menu-button" id="mainMenuBtn" style="background: linear-gradient(135deg, #95a5a6, #7f8c8d); margin-top: 10px;">Main Menu</button>
            </div>
        </div>
    </div>

    <!-- Milestone Reward Modal -->
    <div id="milestoneModal" class="modal">
        <div class="modal-content">
            <h2>üèÜ Milestone Achieved! üèÜ</h2>
            <div id="milestoneRewardText"></div>
            <button class="menu-button" id="closeMilestoneBtn" style="margin-top: 20px;">Continue</button>
        </div>
    </div>

   <!-- About Modal -->
<div id="aboutModal" class="modal">
    <div class="modal-content">
<h2>ü•∑ Ninja Legacy</h2>
        <div style="text-align: left; margin: 20px 0;">
            <h3 style="color: var(--secondary-color); margin-bottom: 10px;">Patch 0.1 :</h3>
            <ul style="margin: 10px 0 20px 20px; line-height: 1.8;">
                <li>üßô‚Äç‚ôÇÔ∏è 30 unique characters from multiple anime</li>
                <li>‚öõÔ∏è 7 elemental systems (Fire, Lightning, Wind, Earth, Water, Ice, Dark)</li>
                <li>üå≤ Skill tree system</li>
                <li>‚öôÔ∏è Equipment & inventory management</li>
                <li>üìú Quest system with rewards</li>
                <li>üóìÔ∏è Added Events button to see what active events</li>
                <li>üõí Shop system for buying items</li>
                <li>üì± Mobile optimized</li>
                <li>üéÉ Added Halloween event</li>
            </ul>
            <h3 style="color: var(--secondary-color); margin: 20px 0 10px 0;">Patch 0.2 :</h3>
            <ul style="margin: 10px 0 20px 20px; line-height: 1.8;">
                <li>‚ö° 60+ unique jutsu techniques</li>
                <li>üî• Element-specific jutsu for each character</li>
                <li>üë• Character-specific signature moves</li>
                <li>üåü Universal jutsu unlocked by level</li>
                <li>üèÜ Added Milestone with 3 exclusive milestone jutsu (Inferno Style, Perfect Susanoo, Sage Mode)</li>
                 <li>ü¶É Added Turkey Event</li>
            </ul>
             <h3 style="color: var(--secondary-color); margin: 20px 0 10px 0;">Patch 0.3 :</h3>
            <ul style="margin: 10px 0 20px 20px; line-height: 1.8;">
                <li>üèüÔ∏è Added Arena</li>
                <li>üèüÔ∏è Arena Features include Shadow Arena League, Arena Shop, Arena Profile, Arena Milestone and Shadow Package</li>
                <li>üéµ Added background music for the game</li>
                <li>üí§ Added AFK Menu to farming gold, exp and skill points</li>
                <li>üêâ Added Dragon Slayer Event</li>
                <li>üéÅ Added Daily Gift Features</li>
                <li>üëπ Added Demon Hunter Event</li>
                </ul>
                <h3 style="color: var(--secondary-color); margin-bottom: 10px;">Patch 0.4 :</h3>
            <ul style="margin: 10px 0 20px 20px; line-height: 1.8;">
                <li>üé£ Added Fisherman Lake Event</li>
                 <li>üé£ Added a feature when fishing, now you can get random gear items</li>
                <li>üé∞ Added Gambling Features</li>
                <li>üèÜ Removed Milestone on Game Screen</li>
                 <li>üé£ Revamped Fisherman Lake Menu</li>
                  <li>üé£ Removed Random Gear Features when fishing</li>
                   <li>ü¶É Revamped and fix Turkey Gear. Also Turkey Event now have Milestone and more items on Turkey Shop</li>
                   <li>üéüÔ∏è Added Redeem Code Features</li>
                    <li>üèÜ Bring Back Milestone on Game Screen. Revamped Milestone</li>
                    <li>üó∫Ô∏è Added Expedition Features</li>
                    <li>üÜï Added new enemies, new items on shop and skill tree</li>
            </ul>
            <h3 style="color: var(--secondary-color); margin-bottom: 10px;">Patch 0.5 :</h3>
            <ul style="margin: 10px 0 20px 20px; line-height: 1.8;">
                <li>üåë Added Bloodmoon Event on Fishing Event</li>
                 <li>üé£ Fishing Event open for 24 hours when weekend arrived</li>
                 <li>üé£ Revamp Sell Fish Menu on Fishing Event and added gold mechanis feature</li>
                 <li>üëª Added Spooky Night Event on Fishing</li>
                 <li>‚≠ê Added Starfall Event on Fishing </li>
                 <li>üß™ Added Consumable Menu on Fishing Event</li>
                  <li>üé£ Adjust Rod Stats and added more milestones</li>
                  <li>ü™ù Fix Reel System on Fishing Event. Now Become Smooth</li>
                  <li>üìú Added Activity Logs on Fishing Event</li>
                   <li>ü¶Ø Added Free Rod and Merchant Menu on Fishing Event</li>
                   <li>üó°Ô∏è Added Artifacts Feature</li>
            </ul>
            
            <p style="color: var(--secondary-color); text-align: center; margin-top: 30px; font-size: 1.1em;">
                Version 0.5 : Ninja Legacy
            </p>
        </div>
        <button class="menu-button" id="closeAboutBtn">Close</button>
    </div>
</div>

    <!-- Bottom Navigation -->
    <div id="bottomNav" class="bottom-nav" style="display: none;">
        <button class="nav-btn active" id="battleNavBtn">
            <div class="nav-icon">‚öîÔ∏è</div>
            <div>Battle</div>
        </button>
        <button class="nav-btn" onclick="document.getElementById('demonHunterScreen').classList.add('active'); document.querySelectorAll('.screen').forEach(s => s !== document.getElementById('demonHunterScreen') ? s.classList.remove('active') : null); this.classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b !== this ? b.classList.remove('active') : null);">
    <div class="nav-icon">üëπ</div>
    <div>Demon Hunter</div>
</button>
        <button class="nav-btn" onclick="showDragonSlayer()">
    <div class="nav-icon">üêâ</div>
    <div>Dragon Slayer</div>
</button>
        <button class="nav-btn" onclick="document.getElementById('arenaScreen').classList.add('active'); document.querySelectorAll('.screen').forEach(s => s !== document.getElementById('arenaScreen') ? s.classList.remove('active') : null); this.classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b !== this ? b.classList.remove('active') : null);">
    <div class="nav-icon">üèüÔ∏è</div>
    <div>Arena</div>
</button>
        <button class="nav-btn" id="shopNavBtn">
            <div class="nav-icon">üè™</div>
            <div>Shop</div>
        </button>
        <button class="nav-btn" id="inventoryNavBtn">
            <div class="nav-icon">üéí</div>
            <div>Items</div>
        </button>
        <button class="nav-btn" id="skillsNavBtn">
            <div class="nav-icon">‚≠ê</div>
            <div>Skills</div>
        </button>
       <button class="nav-btn" id="milestonesNavBtn" style="display: none;">
    <div class="nav-icon">üèÜ</div>
    <div>Milestone</div>
</button>
        <button class="nav-btn" id="questsNavBtn">
            <div class="nav-icon">üìú</div>
            <div>Quests</div>
        </button>
          <button class="nav-btn" onclick="document.getElementById('turkey-event-screen').classList.add('active'); document.querySelectorAll('.screen').forEach(s => s !== document.getElementById('turkey-event-screen') ? s.classList.remove('active') : null); this.classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b !== this ? b.classList.remove('active') : null);">
        <div class="nav-icon">ü¶É</div>
        <div>Turkey Event</div>
    </button>
    <button class="nav-btn" id="turkey-shop-nav" onclick="document.getElementById('turkey-shop-screen').classList.add('active'); document.querySelectorAll('.screen').forEach(s => s !== document.getElementById('turkey-shop-screen') ? s.classList.remove('active') : null); this.classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b !== this ? b.classList.remove('active') : null);">
        <div class="nav-icon">üõí</div>
        <div>Turkey Shop</div>
    </button>
      <button class="nav-btn" onclick="showAFKScreen()">
    <div class="nav-icon">üí§</div>
    <div>AFK</div>
</button>
<button class="nav-btn" onclick="document.getElementById('giftScreen').classList.add('active'); document.querySelectorAll('.screen').forEach(s => s !== document.getElementById('giftScreen') ? s.classList.remove('active') : null); this.classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b !== this ? b.classList.remove('active') : null); updateGiftUI();">
    <div class="nav-icon">üéÅ</div>
    <div>Gift</div>
</button>
<button class="nav-btn" onclick="navigateToFisherLake(); this.classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b !== this ? b.classList.remove('active') : null);">
    <div class="nav-icon">üé£</div>
    <div>Fisherman Lake</div>
</button>
<button class="nav-btn" onclick="document.getElementById('gamblingScreen').classList.add('active'); document.querySelectorAll('.screen').forEach(s => s !== document.getElementById('gamblingScreen') ? s.classList.remove('active') : null); this.classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b !== this ? b.classList.remove('active') : null); updateGamblingStats();">
    <div class="nav-icon">üé∞</div>
    <div>Gambling</div>
</button>
<button class="nav-btn" onclick="showScreen('redeemScreen')">
    <div class="nav-icon">üéüÔ∏è</div>
    <div>Redeem</div>
</button>
<!-- Navigation Button -->
<button class="nav-btn" onclick="openMilestoneV2Screen(); this.classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b !== this ? b.classList.remove('active') : null);">
    <div class="nav-icon">üèÜ</div>
    <div>Milestone V2</div>
</button>
<button class="nav-btn" onclick="showScreen('expeditionScreen', this)">
    <div class="nav-icon">üó∫Ô∏è</div>
    <div>Expedition</div>
</button>
<button class="nav-btn" onclick="Utils.showScreen('artifactsShopScreen'); ArtifactSystem.renderShop(); this.classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b !== this ? b.classList.remove('active') : null);">
    <div class="nav-icon">üó°Ô∏è</div>
    <div>Artifacts</div>
</button>
        <button class="nav-btn" id="menuNavBtn">
            <div class="nav-icon">üè†</div>
            <div>Menu</div>
        </button>
    </div>
    
     <script>
        // ===== GAME DATA STRUCTURES =====
        
        const GameData = {
    characters: [
        // ========== NARUTO SERIES ==========
        {
            id: 'naruto',
            name: 'Naruto Uzumaki',
            emoji: 'ü¶ä',
            element: 'wind',
            description: 'Master of shadow clones and rasengan',
            baseStats: { 
                maxHp: 120, hp: 120,
                maxChakra: 80, chakra: 80,
                attack: 15, defense: 10, speed: 12 
            }
        },
        {
            id: 'sasuke',
            name: 'Sasuke Uchiha',
            emoji: '‚ö°',
            element: 'lightning',
            description: 'Sharingan user with lightning jutsu',
            baseStats: { 
                maxHp: 100, hp: 100,
                maxChakra: 90, chakra: 90,
                attack: 18, defense: 8, speed: 15 
            }
        },
        {
            id: 'madara',
            name: 'Madara Uchiha',
            emoji: 'üëÅÔ∏è',
            element: 'fire',
            description: 'Legendary Uchiha with Rinnegan',
            baseStats: { 
                maxHp: 180, hp: 180,
                maxChakra: 150, chakra: 150,
                attack: 25, defense: 20, speed: 18 
            }
        },
        {
            id: 'minato',
            name: 'Minato Namikaze',
            emoji: '‚ö°',
            element: 'wind',
            description: 'Yellow Flash with teleportation jutsu',
            baseStats: { 
                maxHp: 125, hp: 125,
                maxChakra: 110, chakra: 110,
                attack: 20, defense: 12, speed: 25 
            }
        },

        // ========== BORUTO SERIES ==========
        {
            id: 'boruto',
            name: 'Boruto Uzumaki',
            emoji: 'üåÄ',
            element: 'lightning',
            description: 'Next generation ninja with Jougan',
            baseStats: { 
                maxHp: 110, hp: 110,
                maxChakra: 85, chakra: 85,
                attack: 16, defense: 9, speed: 14 
            }
        },
        {
            id: 'kawaki',
            name: 'Kawaki',
            emoji: 'üîß',
            element: 'fire',
            description: 'Karma user with scientific ninja tools',
            baseStats: { 
                maxHp: 115, hp: 115,
                maxChakra: 75, chakra: 75,
                attack: 19, defense: 11, speed: 13 
            }
        },

        // ========== BLACK CLOVER ==========
        {
            id: 'asta',
            name: 'Asta',
            emoji: '‚öîÔ∏è',
            element: 'dark',
            description: 'Anti-magic swordsman',
            baseStats: { 
                maxHp: 140, hp: 140,
                maxChakra: 50, chakra: 50,
                attack: 22, defense: 15, speed: 11 
            }
        },
        {
            id: 'yuno',
            name: 'Yuno Grinberryall',
            emoji: 'üå™Ô∏è',
            element: 'wind',
            description: 'Wind magic prodigy',
            baseStats: { 
                maxHp: 105, hp: 105,
                maxChakra: 120, chakra: 120,
                attack: 17, defense: 8, speed: 16 
            }
        },
        {
            id: 'yami',
            name: 'Yami Sukehiro',
            emoji: 'üåë',
            element: 'dark',
            description: 'Dark magic captain',
            baseStats: { 
                maxHp: 160, hp: 160,
                maxChakra: 100, chakra: 100,
                attack: 24, defense: 18, speed: 10 
            }
        },

        // ========== BOKU NO HERO ACADEMIA ==========
        {
            id: 'deku',
            name: 'Izuku Midoriya',
            emoji: 'üíö',
            element: 'wind',
            description: 'One For All inheritor',
            baseStats: { 
                maxHp: 130, hp: 130,
                maxChakra: 90, chakra: 90,
                attack: 20, defense: 12, speed: 15 
            }
        },
        {
            id: 'bakugo',
            name: 'Katsuki Bakugo',
            emoji: 'üí•',
            element: 'fire',
            description: 'Explosion quirk user',
            baseStats: { 
                maxHp: 115, hp: 115,
                maxChakra: 85, chakra: 85,
                attack: 21, defense: 10, speed: 17 
            }
        },
        {
            id: 'todoroki',
            name: 'Shoto Todoroki',
            emoji: 'üßä',
            element: 'ice',
            description: 'Half-cold half-hot quirk',
            baseStats: { 
                maxHp: 120, hp: 120,
                maxChakra: 95, chakra: 95,
                attack: 19, defense: 14, speed: 12 
            }
        },
        {
            id: 'allmight',
            name: 'All Might',
            emoji: 'üí™',
            element: 'wind',
            description: 'Symbol of Peace',
            baseStats: { 
                maxHp: 200, hp: 200,
                maxChakra: 120, chakra: 120,
                attack: 30, defense: 25, speed: 15 
            }
        },

        // ========== KAIJU (8 characters) ==========
        {
            id: 'godzilla',
            name: 'Godzilla',
            emoji: 'ü¶ñ',
            element: 'fire',
            description: 'King of Monsters with atomic breath',
            baseStats: { 
                maxHp: 250, hp: 250,
                maxChakra: 80, chakra: 80,
                attack: 35, defense: 30, speed: 8 
            }
        },
        {
            id: 'king_ghidorah',
            name: 'King Ghidorah',
            emoji: 'üêâ',
            element: 'lightning',
            description: 'Three-headed space dragon',
            baseStats: { 
                maxHp: 220, hp: 220,
                maxChakra: 100, chakra: 100,
                attack: 32, defense: 25, speed: 12 
            }
        },
        {
            id: 'mothra',
            name: 'Mothra',
            emoji: 'ü¶ã',
            element: 'wind',
            description: 'Divine moth guardian',
            baseStats: { 
                maxHp: 180, hp: 180,
                maxChakra: 120, chakra: 120,
                attack: 25, defense: 20, speed: 20 
            }
        },
        {
            id: 'rodan',
            name: 'Rodan',
            emoji: 'ü¶Ö',
            element: 'fire',
            description: 'Fire pteranodon titan',
            baseStats: { 
                maxHp: 170, hp: 170,
                maxChakra: 90, chakra: 90,
                attack: 28, defense: 18, speed: 22 
            }
        },
        {
            id: 'mechagodzilla',
            name: 'Mechagodzilla',
            emoji: 'ü§ñ',
            element: 'lightning',
            description: 'Robotic kaiju destroyer',
            baseStats: { 
                maxHp: 200, hp: 200,
                maxChakra: 110, chakra: 110,
                attack: 33, defense: 28, speed: 10 
            }
        },
        {
            id: 'kong',
            name: 'King Kong',
            emoji: 'ü¶ç',
            element: 'earth',
            description: 'Giant ape titan',
            baseStats: { 
                maxHp: 190, hp: 190,
                maxChakra: 70, chakra: 70,
                attack: 30, defense: 22, speed: 14 
            }
        },
        {
            id: 'destoroyah',
            name: 'Destoroyah',
            emoji: 'ü¶Ç',
            element: 'dark',
            description: 'Oxygen destroyer evolution',
            baseStats: { 
                maxHp: 210, hp: 210,
                maxChakra: 95, chakra: 95,
                attack: 34, defense: 24, speed: 11 
            }
        },
        {
            id: 'biollante',
            name: 'Biollante',
            emoji: 'üåπ',
            element: 'earth',
            description: 'Plant-godzilla hybrid',
            baseStats: { 
                maxHp: 230, hp: 230,
                maxChakra: 85, chakra: 85,
                attack: 26, defense: 32, speed: 6 
            }
        },

        // ========== DEMON SLAYER ==========
        {
            id: 'tanjiro',
            name: 'Tanjiro Kamado',
            emoji: 'üî•',
            element: 'fire',
            description: 'Water and sun breathing user',
            baseStats: { 
                maxHp: 125, hp: 125,
                maxChakra: 85, chakra: 85,
                attack: 18, defense: 13, speed: 16 
            }
        },
        {
            id: 'giyu',
            name: 'Giyu Tomioka',
            emoji: 'üåä',
            element: 'water',
            description: 'Water Hashira',
            baseStats: { 
                maxHp: 135, hp: 135,
                maxChakra: 90, chakra: 90,
                attack: 21, defense: 16, speed: 14 
            }
        },

        // ========== ATTACK ON TITAN ==========
        {
            id: 'eren',
            name: 'Eren Yeager',
            emoji: '‚öîÔ∏è',
            element: 'fire',
            description: 'Attack Titan shifter',
            baseStats: { 
                maxHp: 150, hp: 150,
                maxChakra: 95, chakra: 95,
                attack: 23, defense: 17, speed: 13 
            }
        },
        {
            id: 'levi',
            name: 'Levi Ackerman',
            emoji: 'üó°Ô∏è',
            element: 'wind',
            description: 'Humanity\'s strongest soldier',
            baseStats: { 
                maxHp: 110, hp: 110,
                maxChakra: 75, chakra: 75,
                attack: 26, defense: 12, speed: 24 
            }
        },

        // ========== DRAGON BALL ==========
        {
            id: 'goku',
            name: 'Son Goku',
            emoji: 'üêí',
            element: 'wind',
            description: 'Saiyan warrior with Kamehameha',
            baseStats: { 
                maxHp: 180, hp: 180,
                maxChakra: 130, chakra: 130,
                attack: 28, defense: 20, speed: 19 
            }
        },
        {
            id: 'vegeta',
            name: 'Vegeta',
            emoji: 'üëë',
            element: 'fire',
            description: 'Saiyan prince with pride',
            baseStats: { 
                maxHp: 170, hp: 170,
                maxChakra: 125, chakra: 125,
                attack: 29, defense: 18, speed: 17 
            }
        },

        // ========== ONE PIECE ==========
        {
            id: 'luffy',
            name: 'Monkey D. Luffy',
            emoji: 'üëí',
            element: 'wind',
            description: 'Rubber pirate with Gear techniques',
            baseStats: { 
                maxHp: 160, hp: 160,
                maxChakra: 100, chakra: 100,
                attack: 24, defense: 15, speed: 18 
            }
        },
        {
            id: 'zoro',
            name: 'Roronoa Zoro',
            emoji: '‚öîÔ∏è',
            element: 'wind',
            description: 'Three-sword style swordsman',
            baseStats: { 
                maxHp: 145, hp: 145,
                maxChakra: 80, chakra: 80,
                attack: 27, defense: 19, speed: 15 
            }
        },

        // ========== JUJUTSU KAISEN ==========
        {
            id: 'yuji',
            name: 'Yuji Itadori',
            emoji: 'üëä',
            element: 'dark',
            description: 'Sukuna vessel with superhuman strength',
            baseStats: { 
                maxHp: 140, hp: 140,
                maxChakra: 85, chakra: 85,
                attack: 22, defense: 14, speed: 16 
            }
        },
        {
            id: 'gojo',
            name: 'Satoru Gojo',
            emoji: 'üëÅÔ∏è',
            element: 'wind',
            description: 'Six Eyes and Limitless user',
            baseStats: { 
                maxHp: 130, hp: 130,
                maxChakra: 150, chakra: 150,
                attack: 26, defense: 16, speed: 20 
            }
        }
    ],

            jutsus: {
    basic_attack: { 
        name: 'Basic Attack', 
        emoji: 'üëä', 
        damage: 1, 
        chakraCost: 0,
        description: 'A simple physical attack'
    },
    heal: { 
        name: 'Healing Jutsu', 
        emoji: 'üíö', 
        damage: -30, 
        chakraCost: 0,
        description: 'Restore HP'
    },
    chakra_boost: { 
        name: 'Chakra Focus', 
        emoji: 'üíô', 
        chakraCost: 0,
        effect: { type: 'chakra', value: 25 },
        description: 'Restore chakra'
    },
    defend: {
        name: 'Defense Stance',
        emoji: 'üõ°Ô∏è',
        chakraCost: 10,
        effect: { type: 'defense', value: 10, duration: 2 },
        description: 'Increase defense temporarily'
    },
    
    // Fire jutsu
    fireball: { 
        name: 'Fireball Jutsu', 
        emoji: 'üî•', 
        damage: 2, 
        chakraCost: 20,
        description: 'Launch a powerful fireball'
    },
    phoenix_flame: { 
        name: 'Phoenix Flame', 
        emoji: 'ü¶Ö', 
        damage: 1.5, 
        hits: 3, 
        chakraCost: 25,
        description: 'Multiple fire projectiles'
    },
    amaterasu: {
        name: 'Amaterasu',
        emoji: 'üî•',
        damage: 3.5,
        chakraCost: 45,
        description: 'Black flames that never extinguish',
        milestone: true
    },
    
    // Lightning jutsu
    chidori: { 
        name: 'Chidori', 
        emoji: '‚ö°', 
        damage: 2.5, 
        chakraCost: 30,
        description: 'Lightning blade technique'
    },
    lightning_blade: { 
        name: 'Lightning Blade', 
        emoji: 'ìå≥', 
        damage: 2.2, 
        chakraCost: 25,
        description: 'Enhanced lightning strike'
    },
    raikiri: {
        name: 'Raikiri',
        emoji: '‚ö°',
        damage: 3,
        chakraCost: 35,
        description: 'Lightning cutter technique',
        milestone: true
    },
    
    // Wind jutsu
    wind_blade: { 
        name: 'Wind Blade', 
        emoji: 'üå™Ô∏è', 
        damage: 1.8, 
        chakraCost: 20,
        description: 'Sharp wind attack'
    },
    rasengan: { 
        name: 'Rasengan', 
        emoji: 'üåÄ', 
        damage: 3, 
        chakraCost: 35,
        description: 'Spiraling chakra sphere'
    },
    rasenshuriken: {
        name: 'Rasenshuriken',
        emoji: 'üåÄ',
        damage: 4,
        chakraCost: 50,
        description: 'Ultimate wind technique',
        milestone: true
    },
    
    // Earth jutsu
    earth_wall: { 
        name: 'Earth Wall', 
        emoji: 'ü™®', 
        chakraCost: 20,
        effect: { type: 'defense', value: 8, duration: 3 },
        description: 'Create defensive earth barrier'
    },
    earth_spear: { 
        name: 'Earth Spear', 
        emoji: 'üóø', 
        damage: 2.1, 
        chakraCost: 22,
        description: 'Harden body for attack'
    },
    sand_coffin: {
        name: 'Sand Coffin',
        emoji: 'üèúÔ∏è',
        damage: 2.8,
        chakraCost: 30,
        description: 'Crushing sand attack'
    },
    
    // Water jutsu
    water_dragon: { 
        name: 'Water Dragon', 
        emoji: 'üêâ', 
        damage: 2.5, 
        chakraCost: 28,
        description: 'Summon water dragon'
    },
    water_wall: { 
        name: 'Water Wall', 
        emoji: 'üåä', 
        chakraCost: 18,
        effect: { type: 'defense', value: 6, duration: 2 },
        description: 'Water barrier jutsu'
    },

    // Milestone Special Jutsu
    inferno_style: {
        name: 'Inferno Style',
        emoji: 'üî•',
        damage: 4.5,
        chakraCost: 60,
        description: 'Ultimate fire technique',
        milestone: true
    },
    perfect_susanoo: {
        name: 'Perfect Susanoo',
        emoji: 'üëπ',
        damage: 5,
        chakraCost: 70,
        description: 'Legendary defensive strike',
        milestone: true
    },
    sage_mode: {
        name: 'Sage Mode',
        emoji: 'üßò',
        damage: 4.8,
        chakraCost: 65,
        description: 'Nature energy amplification',
        milestone: true
    },

    // Halloween Special Jutsu
    shadow_curse: {
        name: 'Shadow Curse',
        emoji: 'üëª',
        damage: 2.8,
        chakraCost: 35,
        description: 'Haunting shadow attack',
        halloween: true
    },
    pumpkin_bomb: {
        name: 'Pumpkin Bomb',
        emoji: 'üéÉ',
        damage: 3.2,
        chakraCost: 40,
        description: 'Explosive pumpkin jutsu',
        halloween: true
    },
    soul_drain: {
        name: 'Soul Drain',
        emoji: 'üíÄ',
        damage: 2,
        chakraCost: 30,
        effect: { type: 'lifesteal', value: 0.5 },
        description: 'Drain enemy life force',
        halloween: true
    },

    // ========== 30 JUTSU BERHUBUNGAN DENGAN KARAKTER ==========

    // NARUTO SERIES JUTSU (8)
    shadow_clone: {
        name: 'Shadow Clone Jutsu',
        emoji: 'üë•',
        damage: 1.5,
        hits: 2,
        chakraCost: 25,
        description: 'Create clones to attack'
    },
    sexy_jutsu: {
        name: 'Sexy Jutsu',
        emoji: 'üíã',
        chakraCost: 15,
        effect: { type: 'stun', duration: 1 },
        description: 'Confuse enemy with transformation'
    },
    summoning_jutsu: {
        name: 'Summoning Jutsu',
        emoji: 'üê∏',
        damage: 2.3,
        chakraCost: 30,
        description: 'Summon animal ally'
    },
    flying_raijin: {
        name: 'Flying Raijin',
        emoji: '‚ö°',
        damage: 2.8,
        chakraCost: 35,
        description: 'Teleport and strike'
    },
    tsukuyomi: {
        name: 'Tsukuyomi',
        emoji: 'üåô',
        damage: 3.3,
        chakraCost: 42,
        description: 'Genjutsu nightmare realm'
    },
    eight_gates: {
        name: 'Eight Gates',
        emoji: 'üö™',
        damage: 4.0,
        chakraCost: 55,
        description: 'Release body limiters'
    },
    kamui: {
        name: 'Kamui',
        emoji: 'üåÄ',
        damage: 3.7,
        chakraCost: 48,
        description: 'Space-time dimension attack'
    },
    planetary_devastation: {
        name: 'Planetary Devastation',
        emoji: 'ü™ê',
        damage: 4.5,
        chakraCost: 60,
        description: 'Create massive gravity sphere'
    },

    // BORUTO SERIES JUTSU (2)
    karma_seal: {
        name: 'Karma Seal',
        emoji: 'üî±',
        damage: 3.2,
        chakraCost: 40,
        description: 'Absorb and counter attack'
    },
    vanishing_rasengan: {
        name: 'Vanishing Rasengan',
        emoji: '‚ú®',
        damage: 2.7,
        chakraCost: 32,
        description: 'Invisible rasengan strike'
    },

    // BLACK CLOVER JUTSU (4)
    black_slash: {
        name: 'Black Slash',
        emoji: '‚ö´',
        damage: 2.4,
        chakraCost: 28,
        description: 'Anti-magic sword slash'
    },
    black_meteorite: {
        name: 'Black Meteorite',
        emoji: '‚òÑÔ∏è',
        damage: 3.5,
        chakraCost: 45,
        description: 'Massive anti-magic attack'
    },
    wind_spirit_dive: {
        name: 'Wind Spirit Dive',
        emoji: 'üå¨Ô∏è',
        damage: 2.6,
        chakraCost: 30,
        description: 'Spirit dive wind attack'
    },
    dark_cloaked_slash: {
        name: 'Dark Cloaked Slash',
        emoji: 'üåë',
        damage: 3.1,
        chakraCost: 38,
        description: 'Dimension slash attack'
    },

    // MY HERO ACADEMIA JUTSU (4)
    delaware_smash: {
        name: 'Delaware Smash',
        emoji: 'üíö',
        damage: 2.2,
        chakraCost: 25,
        description: 'Finger flick attack'
    },
    one_for_all_100: {
        name: 'One For All 100%',
        emoji: 'üí•',
        damage: 3.8,
        chakraCost: 50,
        description: 'Full power strike'
    },
    ap_shot: {
        name: 'AP Shot',
        emoji: 'üí£',
        damage: 2.5,
        chakraCost: 28,
        description: 'Concentrated explosion'
    },
    flashfreeze_heatwave: {
        name: 'Flashfreeze Heatwave',
        emoji: 'üî•‚ùÑÔ∏è',
        damage: 3.3,
        chakraCost: 42,
        description: 'Combined element attack'
    },

    // KAIJU JUTSU (4)
    atomic_breath: {
        name: 'Atomic Breath',
        emoji: '‚ò¢Ô∏è',
        damage: 4.2,
        chakraCost: 55,
        description: 'Devastating atomic beam'
    },
    gravity_beam: {
        name: 'Gravity Beam',
        emoji: 'üåÄ',
        damage: 3.7,
        chakraCost: 48,
        description: 'Lightning gravity attack'
    },
    god_rays: {
        name: 'God Rays',
        emoji: '‚ú®',
        damage: 2.9,
        chakraCost: 35,
        description: 'Divine light attack'
    },
    tail_whip: {
        name: 'Tail Whip',
        emoji: 'ü¶é',
        damage: 2.6,
        chakraCost: 30,
        description: 'Powerful tail strike'
    },

    // DEMON SLAYER JUTSU (2)
    water_breathing: {
        name: 'Water Breathing',
        emoji: 'üíß',
        damage: 2.4,
        chakraCost: 26,
        description: 'Flowing water technique'
    },
    hinokami_kagura: {
        name: 'Hinokami Kagura',
        emoji: 'üî•',
        damage: 3.6,
        chakraCost: 46,
        description: 'Sun breathing dance'
    },

    // ATTACK ON TITAN JUTSU (2)
    titan_transformation: {
        name: 'Titan Transformation',
        emoji: 'üëπ',
        damage: 3.4,
        chakraCost: 45,
        description: 'Transform into titan'
    },
    thunder_spear: {
        name: 'Thunder Spear',
        emoji: 'üí•',
        damage: 2.7,
        chakraCost: 32,
        description: 'Explosive spear attack'
    },

    // DRAGON BALL JUTSU (2)
    kamehameha: {
        name: 'Kamehameha',
        emoji: 'üåä',
        damage: 3.9,
        chakraCost: 52,
        description: 'Powerful energy wave'
    },
    galick_gun: {
        name: 'Galick Gun',
        emoji: 'üíú',
        damage: 3.8,
        chakraCost: 50,
        description: 'Purple energy blast'
    },

    // ONE PIECE JUTSU (2)
    gomu_gomu_gatling: {
        name: 'Gomu Gomu Gatling',
        emoji: 'üëä',
        damage: 2.1,
        hits: 4,
        chakraCost: 28,
        description: 'Rapid rubber punches'
    },
    oni_giri: {
        name: 'Oni Giri',
        emoji: '‚öîÔ∏è',
        damage: 2.8,
        chakraCost: 32,
        description: 'Three sword demon slash'
    },

    // JUJUTSU KAISEN JUTSU (2)
    black_flash: {
        name: 'Black Flash',
        emoji: '‚ö´',
        damage: 3.5,
        chakraCost: 44,
        description: 'Critical cursed energy strike'
    },
    unlimited_void: {
        name: 'Unlimited Void',
        emoji: 'üåå',
        damage: 4.1,
        chakraCost: 58,
        description: 'Domain expansion technique'
    },

    // ========== 30 JUTSU UMUM (TIDAK BERHUBUNGAN KARAKTER) ==========

    // ELEMENTAL JUTSU (10)
    meteor_strike: {
        name: 'Meteor Strike',
        emoji: '‚òÑÔ∏è',
        damage: 3.8,
        chakraCost: 48,
        description: 'Summon falling meteor'
    },
    ice_prison: {
        name: 'Ice Prison',
        emoji: 'üßä',
        damage: 2.3,
        chakraCost: 28,
        effect: { type: 'freeze', duration: 2 },
        description: 'Trap enemy in ice'
    },
    lightning_storm: {
        name: 'Lightning Storm',
        emoji: '‚õàÔ∏è',
        damage: 3.2,
        chakraCost: 40,
        description: 'Call down lightning bolts'
    },
    magma_eruption: {
        name: 'Magma Eruption',
        emoji: 'üåã',
        damage: 3.5,
        chakraCost: 44,
        description: 'Erupt molten lava'
    },
    blizzard: {
        name: 'Blizzard',
        emoji: '‚ùÑÔ∏è',
        damage: 2.8,
        chakraCost: 35,
        description: 'Freezing ice storm'
    },
    tornado: {
        name: 'Tornado',
        emoji: 'üå™Ô∏è',
        damage: 3.0,
        chakraCost: 38,
        description: 'Devastating wind vortex'
    },
    earthquake: {
        name: 'Earthquake',
        emoji: 'üèîÔ∏è',
        damage: 3.3,
        chakraCost: 42,
        description: 'Shake the ground violently'
    },
    tsunami: {
        name: 'Tsunami',
        emoji: 'üåä',
        damage: 3.6,
        chakraCost: 46,
        description: 'Massive tidal wave'
    },
    solar_flare: {
        name: 'Solar Flare',
        emoji: '‚òÄÔ∏è',
        damage: 2.5,
        chakraCost: 30,
        effect: { type: 'blind', duration: 2 },
        description: 'Blinding light attack'
    },
    void_blast: {
        name: 'Void Blast',
        emoji: 'üï≥Ô∏è',
        damage: 3.4,
        chakraCost: 43,
        description: 'Dark void energy'
    },

    // SUPPORT JUTSU (6)
    barrier_shield: {
        name: 'Barrier Shield',
        emoji: 'üõ°Ô∏è',
        chakraCost: 25,
        effect: { type: 'defense', value: 15, duration: 3 },
        description: 'Strong protective barrier'
    },
    speed_boost: {
        name: 'Speed Boost',
        emoji: 'üí®',
        chakraCost: 20,
        effect: { type: 'speed', value: 10, duration: 3 },
        description: 'Increase movement speed'
    },
    power_up: {
        name: 'Power Up',
        emoji: 'üí™',
        chakraCost: 30,
        effect: { type: 'attack', value: 15, duration: 3 },
        description: 'Boost attack power'
    },
    regeneration: {
        name: 'Regeneration',
        emoji: 'üíö',
        damage: -50,
        chakraCost: 35,
        description: 'Strong healing technique'
    },
    meditation: {
        name: 'Meditation',
        emoji: 'üßò',
        chakraCost: 0,
        effect: { type: 'chakra', value: 40 },
        description: 'Restore more chakra'
    },
    mirror_shield: {
        name: 'Mirror Shield',
        emoji: 'ü™û',
        chakraCost: 35,
        effect: { type: 'reflect', value: 0.5, duration: 2 },
        description: 'Reflect damage back'
    },

    // SPECIAL ATTACK JUTSU (8)
    poison_mist: {
        name: 'Poison Mist',
        emoji: '‚ò†Ô∏è',
        damage: 2.0,
        chakraCost: 25,
        effect: { type: 'poison', value: 5, duration: 3 },
        description: 'Toxic cloud attack'
    },
    paralyzing_touch: {
        name: 'Paralyzing Touch',
        emoji: '‚ö°',
        damage: 1.5,
        chakraCost: 22,
        effect: { type: 'paralyze', duration: 2 },
        description: 'Stun enemy temporarily'
    },
    blood_manipulation: {
        name: 'Blood Manipulation',
        emoji: 'ü©∏',
        damage: 2.9,
        chakraCost: 36,
        description: 'Control blood for attack'
    },
    bone_spear: {
        name: 'Bone Spear',
        emoji: 'ü¶¥',
        damage: 2.6,
        chakraCost: 30,
        description: 'Launch hardened bone'
    },
    gravity_crush: {
        name: 'Gravity Crush',
        emoji: 'üåë',
        damage: 3.4,
        chakraCost: 42,
        description: 'Crushing gravity force'
    },
    time_stop: {
        name: 'Time Stop',
        emoji: '‚è±Ô∏è',
        damage: 2.2,
        chakraCost: 40,
        effect: { type: 'stun', duration: 2 },
        description: 'Freeze time briefly'
    },
    energy_drain: {
        name: 'Energy Drain',
        emoji: 'üîã',
        damage: 1.8,
        chakraCost: 25,
        effect: { type: 'chakra_steal', value: 30 },
        description: 'Steal enemy chakra'
    },
    chaos_beam: {
        name: 'Chaos Beam',
        emoji: 'üåà',
        damage: 3.1,
        chakraCost: 38,
        description: 'Unpredictable energy blast'
    },

    // ULTIMATE JUTSU (6)
    divine_judgment: {
        name: 'Divine Judgment',
        emoji: '‚öñÔ∏è',
        damage: 4.3,
        chakraCost: 56,
        description: 'Holy punishment from above'
    },
    apocalypse: {
        name: 'Apocalypse',
        emoji: 'üíÄ',
        damage: 4.8,
        chakraCost: 65,
        description: 'End of days technique'
    },
    genesis: {
        name: 'Genesis',
        emoji: 'üåü',
        damage: 4.6,
        chakraCost: 62,
        description: 'Creation energy blast'
    },
    infinity: {
        name: 'Infinity',
        emoji: '‚ôæÔ∏è',
        damage: 4.5,
        chakraCost: 60,
        description: 'Limitless power attack'
    },
    final_flash: {
        name: 'Final Flash',
        emoji: '‚ú®',
        damage: 4.7,
        chakraCost: 64,
        description: 'Ultimate energy wave'
    },
    big_bang_attack: {
        name: 'Big Bang Attack',
        emoji: 'üí•',
        damage: 4.9,
        chakraCost: 68,
        description: 'Explosive universe power'
    }
},

            enemies: [
    // TIER 1: BEGINNER (Level 1-10) - Easy enemies
    { 
        name: 'Training Dummy', 
        emoji: 'üéØ', 
        level: 1, 
        hp: 50, 
        maxHp: 50, 
        attack: 8, 
        defense: 3, 
        speed: 5, 
        exp: 25, 
        gold: 30 
    },
    { 
        name: 'Wild Rat', 
        emoji: 'üê≠', 
        level: 1, 
        hp: 60, 
        maxHp: 60, 
        attack: 10, 
        defense: 2, 
        speed: 7, 
        exp: 30, 
        gold: 25 
    },
    { 
        name: 'Mushroom Sprite', 
        emoji: 'üçÑ', 
        level: 1, 
        hp: 45, 
        maxHp: 45, 
        attack: 9, 
        defense: 2, 
        speed: 6, 
        exp: 28, 
        gold: 35 
    },
    { 
        name: 'Rogue Ninja', 
        emoji: 'ü•∑', 
        level: 2, 
        hp: 80, 
        maxHp: 80, 
        attack: 12, 
        defense: 5, 
        speed: 8, 
        exp: 50, 
        gold: 75 
    },
    { 
        name: 'Goblin Scout', 
        emoji: 'üë∫', 
        level: 2, 
        hp: 70, 
        maxHp: 70, 
        attack: 11, 
        defense: 4, 
        speed: 9, 
        exp: 45, 
        gold: 60 
    },
    { 
        name: 'Slime Blob', 
        emoji: 'üü¢', 
        level: 2, 
        hp: 65, 
        maxHp: 65, 
        attack: 11, 
        defense: 3, 
        speed: 4, 
        exp: 35, 
        gold: 45 
    },
    { 
        name: 'Forest Spider', 
        emoji: 'üï∑Ô∏è', 
        level: 3, 
        hp: 90, 
        maxHp: 90, 
        attack: 14, 
        defense: 6, 
        speed: 12, 
        exp: 65, 
        gold: 85 
    },
    { 
        name: 'Bandit Leader', 
        emoji: 'üó°Ô∏è', 
        level: 3, 
        hp: 100, 
        maxHp: 100, 
        attack: 15, 
        defense: 7, 
        speed: 10, 
        exp: 75, 
        gold: 100 
    },
    { 
        name: 'Skeleton Warrior', 
        emoji: 'üíÄ', 
        level: 3, 
        hp: 85, 
        maxHp: 85, 
        attack: 13, 
        defense: 5, 
        speed: 8, 
        exp: 55, 
        gold: 70 
    },
    { 
        name: 'Cave Bat', 
        emoji: 'ü¶á', 
        level: 4, 
        hp: 85, 
        maxHp: 85, 
        attack: 16, 
        defense: 5, 
        speed: 15, 
        exp: 70, 
        gold: 90 
    },
    { 
        name: 'Orc Warrior', 
        emoji: 'üßå', 
        level: 4, 
        hp: 110, 
        maxHp: 110, 
        attack: 17, 
        defense: 9, 
        speed: 8, 
        exp: 85, 
        gold: 110 
    },
    { 
        name: 'Giant Bee', 
        emoji: 'üêù', 
        level: 4, 
        hp: 75, 
        maxHp: 75, 
        attack: 15, 
        defense: 4, 
        speed: 14, 
        exp: 65, 
        gold: 80 
    },
    { 
        name: 'Wild Beast', 
        emoji: 'üê∫', 
        level: 5, 
        hp: 120, 
        maxHp: 120, 
        attack: 18, 
        defense: 8, 
        speed: 12, 
        exp: 100, 
        gold: 125 
    },
    { 
        name: 'Stone Golem', 
        emoji: 'üóø', 
        level: 5, 
        hp: 140, 
        maxHp: 140, 
        attack: 16, 
        defense: 12, 
        speed: 6, 
        exp: 110, 
        gold: 140 
    },
    { 
        name: 'Rock Golem', 
        emoji: 'ü™®', 
        level: 5, 
        hp: 130, 
        maxHp: 130, 
        attack: 14, 
        defense: 11, 
        speed: 5, 
        exp: 95, 
        gold: 120 
    },
    { 
        name: 'Dark Imp', 
        emoji: 'üòà', 
        level: 6, 
        hp: 125, 
        maxHp: 125, 
        attack: 20, 
        defense: 8, 
        speed: 14, 
        exp: 120, 
        gold: 130 
    },
    { 
        name: 'Elite Guard', 
        emoji: '‚öîÔ∏è', 
        level: 6, 
        hp: 150, 
        maxHp: 150, 
        attack: 20, 
        defense: 10, 
        speed: 14, 
        exp: 125, 
        gold: 150 
    },
    { 
        name: 'Swamp Troll', 
        emoji: 'üßå', 
        level: 7, 
        hp: 155, 
        maxHp: 155, 
        attack: 21, 
        defense: 12, 
        speed: 9, 
        exp: 135, 
        gold: 160 
    },
    { 
        name: 'Iron Warrior', 
        emoji: 'üõ°Ô∏è', 
        level: 8, 
        hp: 175, 
        maxHp: 175, 
        attack: 23, 
        defense: 14, 
        speed: 11, 
        exp: 145, 
        gold: 180 
    },
    { 
        name: 'Flame Sprite', 
        emoji: 'üî•', 
        level: 9, 
        hp: 165, 
        maxHp: 165, 
        attack: 26, 
        defense: 9, 
        speed: 17, 
        exp: 155, 
        gold: 195 
    },
    { 
        name: 'Thunder Bird', 
        emoji: 'üå©Ô∏è', 
        level: 10, 
        hp: 185, 
        maxHp: 185, 
        attack: 27, 
        defense: 11, 
        speed: 19, 
        exp: 175, 
        gold: 215 
    },

    // TIER 2: MEDIUM (Level 7-15) - Medium difficulty
    { 
        name: 'Fire Salamander', 
        emoji: 'üî•', 
        level: 7, 
        hp: 160, 
        maxHp: 160, 
        attack: 22, 
        defense: 11, 
        speed: 13, 
        exp: 140, 
        gold: 165 
    },
    { 
        name: 'Shadow Assassin', 
        emoji: 'üí§', 
        level: 8, 
        hp: 180, 
        maxHp: 180, 
        attack: 25, 
        defense: 12, 
        speed: 16, 
        exp: 150, 
        gold: 200 
    },
    { 
        name: 'Ice Troll', 
        emoji: '‚ùÑÔ∏è', 
        level: 8, 
        hp: 200, 
        maxHp: 200, 
        attack: 24, 
        defense: 15, 
        speed: 10, 
        exp: 160, 
        gold: 190 
    },
    { 
        name: 'Lightning Hawk', 
        emoji: '‚ö°', 
        level: 9, 
        hp: 170, 
        maxHp: 170, 
        attack: 28, 
        defense: 10, 
        speed: 20, 
        exp: 170, 
        gold: 210 
    },
    { 
        name: 'Demon Warrior', 
        emoji: 'üëπ', 
        level: 10, 
        hp: 220, 
        maxHp: 220, 
        attack: 28, 
        defense: 15, 
        speed: 14, 
        exp: 200, 
        gold: 250 
    },
    { 
        name: 'Poison Viper', 
        emoji: 'üêç', 
        level: 10, 
        hp: 190, 
        maxHp: 190, 
        attack: 30, 
        defense: 12, 
        speed: 18, 
        exp: 180, 
        gold: 220 
    },
    { 
        name: 'Crystal Guardian', 
        emoji: 'üíé', 
        level: 11, 
        hp: 240, 
        maxHp: 240, 
        attack: 26, 
        defense: 18, 
        speed: 12, 
        exp: 220, 
        gold: 270 
    },
    { 
        name: 'Wind Elemental', 
        emoji: 'üå™Ô∏è', 
        level: 12, 
        hp: 210, 
        maxHp: 210, 
        attack: 32, 
        defense: 14, 
        speed: 22, 
        exp: 240, 
        gold: 280 
    },
    { 
        name: 'Earth Titan', 
        emoji: 'üèîÔ∏è', 
        level: 13, 
        hp: 280, 
        maxHp: 280, 
        attack: 30, 
        defense: 22, 
        speed: 8, 
        exp: 260, 
        gold: 320 
    },
    { 
        name: 'Void Hunter', 
        emoji: 'üåë', 
        level: 14, 
        hp: 250, 
        maxHp: 250, 
        attack: 35, 
        defense: 16, 
        speed: 19, 
        exp: 280, 
        gold: 340 
    },
    { 
        name: 'Ancient Dragon', 
        emoji: 'üê≤', 
        level: 15, 
        hp: 300, 
        maxHp: 300, 
        attack: 35, 
        defense: 20, 
        speed: 18, 
        exp: 300, 
        gold: 400 
    },

    // TIER 3: HARD (Level 16-25) - Hard enemies
    { 
        name: 'Infernal Beast', 
        emoji: 'üî•', 
        level: 16, 
        hp: 320, 
        maxHp: 320, 
        attack: 38, 
        defense: 22, 
        speed: 16, 
        exp: 320, 
        gold: 420 
    },
    { 
        name: 'Dark Sorcerer', 
        emoji: 'üßô', 
        level: 17, 
        hp: 350, 
        maxHp: 350, 
        attack: 40, 
        defense: 25, 
        speed: 20, 
        exp: 400, 
        gold: 500 
    },
    { 
        name: 'Nightmare Wraith', 
        emoji: 'üë§', 
        level: 18, 
        hp: 330, 
        maxHp: 330, 
        attack: 42, 
        defense: 20, 
        speed: 24, 
        exp: 380, 
        gold: 460 
    },
    { 
        name: 'Chaos Knight', 
        emoji: 'üõ°Ô∏è', 
        level: 19, 
        hp: 380, 
        maxHp: 380, 
        attack: 40, 
        defense: 28, 
        speed: 15, 
        exp: 420, 
        gold: 520 
    },
    { 
        name: 'Phoenix Lord', 
        emoji: 'üî•', 
        level: 20, 
        hp: 400, 
        maxHp: 400, 
        attack: 45, 
        defense: 25, 
        speed: 22, 
        exp: 450, 
        gold: 580 
    },
    { 
        name: 'Frost Lich', 
        emoji: 'üßä', 
        level: 21, 
        hp: 420, 
        maxHp: 420, 
        attack: 48, 
        defense: 30, 
        speed: 18, 
        exp: 480, 
        gold: 620 
    },
    { 
        name: 'Thunder God', 
        emoji: '‚õàÔ∏è', 
        level: 22, 
        hp: 450, 
        maxHp: 450, 
        attack: 52, 
        defense: 28, 
        speed: 25, 
        exp: 520, 
        gold: 680 
    },
    { 
        name: 'Blood Demon', 
        emoji: 'ü©∏', 
        level: 23, 
        hp: 480, 
        maxHp: 480, 
        attack: 50, 
        defense: 32, 
        speed: 20, 
        exp: 550, 
        gold: 720 
    },
    { 
        name: 'Void Dragon', 
        emoji: 'üêâ', 
        level: 24, 
        hp: 520, 
        maxHp: 520, 
        attack: 55, 
        defense: 35, 
        speed: 23, 
        exp: 600, 
        gold: 800 
    },
    { 
        name: 'Death Lord', 
        emoji: 'üíÄ', 
        level: 25, 
        hp: 550, 
        maxHp: 550, 
        attack: 58, 
        defense: 38, 
        speed: 21, 
        exp: 650, 
        gold: 850 
    },
    { 
        name: 'Cyber Phantom', 
        emoji: 'ü§ñ', 
        level: 25, 
        hp: 480, 
        maxHp: 480, 
        attack: 52, 
        defense: 30, 
        speed: 28, 
        exp: 580, 
        gold: 750 
    },

    // TIER 4: ARCANE (Level 26-40) - Arcane enemies
    { 
        name: 'Astral Guardian', 
        emoji: '‚ú®', 
        level: 26, 
        hp: 600, 
        maxHp: 600, 
        attack: 60, 
        defense: 40, 
        speed: 25, 
        exp: 700, 
        gold: 950 
    },
    { 
        name: 'Cosmic Horror', 
        emoji: 'üåå', 
        level: 28, 
        hp: 650, 
        maxHp: 650, 
        attack: 65, 
        defense: 42, 
        speed: 27, 
        exp: 800, 
        gold: 1100 
    },
    { 
        name: 'Ethereal Phantom', 
        emoji: 'üëª', 
        level: 30, 
        hp: 700, 
        maxHp: 700, 
        attack: 70, 
        defense: 35, 
        speed: 32, 
        exp: 900, 
        gold: 1250 
    },
    { 
        name: 'Temporal Warden', 
        emoji: '‚è∞', 
        level: 32, 
        hp: 750, 
        maxHp: 750, 
        attack: 72, 
        defense: 48, 
        speed: 28, 
        exp: 1000, 
        gold: 1400 
    },
    { 
        name: 'Reality Bender', 
        emoji: 'üåÄ', 
        level: 34, 
        hp: 800, 
        maxHp: 800, 
        attack: 78, 
        defense: 50, 
        speed: 30, 
        exp: 1150, 
        gold: 1600 
    },
    { 
        name: 'Void Sovereign', 
        emoji: '‚ö´', 
        level: 36, 
        hp: 850, 
        maxHp: 850, 
        attack: 82, 
        defense: 52, 
        speed: 33, 
        exp: 1300, 
        gold: 1800 
    },
    { 
        name: 'Chaos Incarnate', 
        emoji: 'üí•', 
        level: 38, 
        hp: 900, 
        maxHp: 900, 
        attack: 88, 
        defense: 55, 
        speed: 35, 
        exp: 1500, 
        gold: 2000 
    },
    { 
        name: 'Arcane Destroyer', 
        emoji: 'üîÆ', 
        level: 40, 
        hp: 1000, 
        maxHp: 1000, 
        attack: 95, 
        defense: 60, 
        speed: 38, 
        exp: 1750, 
        gold: 2500 
    },
    { 
        name: 'Neon Assassin', 
        emoji: 'üî™', 
        level: 35, 
        hp: 780, 
        maxHp: 780, 
        attack: 75, 
        defense: 45, 
        speed: 32, 
        exp: 1200, 
        gold: 1650 
    },

    // TIER 5: DIVINE (Level 41-60) - God-tier enemies
    { 
        name: 'Divine Seraph', 
        emoji: 'üòá', 
        level: 42, 
        hp: 1200, 
        maxHp: 1200, 
        attack: 100, 
        defense: 65, 
        speed: 40, 
        exp: 2000, 
        gold: 3000 
    },
    { 
        name: 'Fallen Angel', 
        emoji: 'üòà', 
        level: 44, 
        hp: 1350, 
        maxHp: 1350, 
        attack: 110, 
        defense: 70, 
        speed: 42, 
        exp: 2300, 
        gold: 3500 
    },
    { 
        name: 'Primordial Titan', 
        emoji: '‚õ∞Ô∏è', 
        level: 46, 
        hp: 1500, 
        maxHp: 1500, 
        attack: 115, 
        defense: 80, 
        speed: 35, 
        exp: 2600, 
        gold: 4000 
    },
    { 
        name: 'Celestial Dragon', 
        emoji: 'üåü', 
        level: 48, 
        hp: 1650, 
        maxHp: 1650, 
        attack: 125, 
        defense: 75, 
        speed: 45, 
        exp: 3000, 
        gold: 4500 
    },
    { 
        name: 'God of War', 
        emoji: '‚öîÔ∏è', 
        level: 50, 
        hp: 1800, 
        maxHp: 1800, 
        attack: 140, 
        defense: 85, 
        speed: 40, 
        exp: 3500, 
        gold: 5000 
    },
    { 
        name: 'World Eater', 
        emoji: 'üåç', 
        level: 52, 
        hp: 2000, 
        maxHp: 2000, 
        attack: 150, 
        defense: 90, 
        speed: 38, 
        exp: 4000, 
        gold: 6000 
    },
    { 
        name: 'Time Destroyer', 
        emoji: '‚åõ', 
        level: 54, 
        hp: 2200, 
        maxHp: 2200, 
        attack: 160, 
        defense: 95, 
        speed: 43, 
        exp: 4500, 
        gold: 7000 
    },
    { 
        name: 'Reality God', 
        emoji: 'üåå', 
        level: 56, 
        hp: 2500, 
        maxHp: 2500, 
        attack: 175, 
        defense: 100, 
        speed: 45, 
        exp: 5500, 
        gold: 8500 
    },
    { 
        name: 'Infinity Lord', 
        emoji: '‚ôæÔ∏è', 
        level: 58, 
        hp: 2800, 
        maxHp: 2800, 
        attack: 190, 
        defense: 110, 
        speed: 48, 
        exp: 6500, 
        gold: 10000 
    },
    { 
        name: 'Supreme Creator', 
        emoji: 'üí´', 
        level: 60, 
        hp: 3000, 
        maxHp: 3000, 
        attack: 200, 
        defense: 120, 
        speed: 50, 
        exp: 8000, 
        gold: 12000 
    },
    { 
        name: 'Mech Golem', 
        emoji: 'ü¶æ', 
        level: 45, 
        hp: 1400, 
        maxHp: 1400, 
        attack: 118, 
        defense: 78, 
        speed: 38, 
        exp: 2800, 
        gold: 4200 
    },
    { 
        name: 'Digital Wraith', 
        emoji: 'üíª', 
        level: 55, 
        hp: 2300, 
        maxHp: 2300, 
        attack: 165, 
        defense: 92, 
        speed: 46, 
        exp: 5000, 
        gold: 7500 
    },

    // TIER 6: TRANSCENDENT (Level 61-100) - Transcendent enemies
    { 
        name: 'Quantum Beast', 
        emoji: '‚öõÔ∏è', 
        level: 62, 
        hp: 3500, 
        maxHp: 3500, 
        attack: 220, 
        defense: 130, 
        speed: 55, 
        exp: 9000, 
        gold: 15000 
    },
    { 
        name: 'Dimensional Stalker', 
        emoji: 'üî∫', 
        level: 64, 
        hp: 4000, 
        maxHp: 4000, 
        attack: 240, 
        defense: 140, 
        speed: 60, 
        exp: 10000, 
        gold: 18000 
    },
    { 
        name: 'Void Leviathan', 
        emoji: 'üêô', 
        level: 66, 
        hp: 4500, 
        maxHp: 4500, 
        attack: 260, 
        defense: 150, 
        speed: 50, 
        exp: 12000, 
        gold: 20000 
    },
    { 
        name: 'Plasma Wraith', 
        emoji: '‚ö°', 
        level: 68, 
        hp: 5000, 
        maxHp: 5000, 
        attack: 280, 
        defense: 160, 
        speed: 65, 
        exp: 14000, 
        gold: 25000 
    },
    { 
        name: 'Celestial Behemoth', 
        emoji: 'üå†', 
        level: 70, 
        hp: 5500, 
        maxHp: 5500, 
        attack: 300, 
        defense: 180, 
        speed: 55, 
        exp: 16000, 
        gold: 30000 
    },
    { 
        name: 'Neural Overlord', 
        emoji: 'üß†', 
        level: 72, 
        hp: 6000, 
        maxHp: 6000, 
        attack: 320, 
        defense: 190, 
        speed: 58, 
        exp: 18000, 
        gold: 35000 
    },
    { 
        name: 'Omega Destroyer', 
        emoji: 'üí•', 
        level: 74, 
        hp: 6500, 
        maxHp: 6500, 
        attack: 340, 
        defense: 200, 
        speed: 62, 
        exp: 20000, 
        gold: 40000 
    },
    { 
        name: 'Singularity Core', 
        emoji: '‚ö´', 
        level: 76, 
        hp: 7000, 
        maxHp: 7000, 
        attack: 360, 
        defense: 220, 
        speed: 60, 
        exp: 22000, 
        gold: 45000 
    },
    { 
        name: 'Hyperdimensional Entity', 
        emoji: 'üîÆ', 
        level: 78, 
        hp: 7500, 
        maxHp: 7500, 
        attack: 380, 
        defense: 240, 
        speed: 65, 
        exp: 25000, 
        gold: 50000 
    },
    { 
        name: 'Universal Sovereign', 
        emoji: 'üëë', 
        level: 80, 
        hp: 8000, 
        maxHp: 8000, 
        attack: 400, 
        defense: 250, 
        speed: 70, 
        exp: 28000, 
        gold: 60000 
    },
    { 
        name: 'Infinity Slayer', 
        emoji: 'üó°Ô∏è', 
        level: 85, 
        hp: 9000, 
        maxHp: 9000, 
        attack: 450, 
        defense: 280, 
        speed: 75, 
        exp: 35000, 
        gold: 75000 
    },
    { 
        name: 'Cosmic Devourer', 
        emoji: 'üåå', 
        level: 90, 
        hp: 10000, 
        maxHp: 10000, 
        attack: 500, 
        defense: 300, 
        speed: 80, 
        exp: 45000, 
        gold: 90000 
    },
    { 
        name: 'Absolute Terror', 
        emoji: 'üò±', 
        level: 95, 
        hp: 12000, 
        maxHp: 12000, 
        attack: 550, 
        defense: 350, 
        speed: 85, 
        exp: 55000, 
        gold: 110000 
    },
    { 
        name: 'Transcendent God', 
        emoji: 'üëÅÔ∏è', 
        level: 100, 
        hp: 15000, 
        maxHp: 15000, 
        attack: 600, 
        defense: 400, 
        speed: 90, 
        exp: 70000, 
        gold: 150000 
    },
    { 
        name: 'Plasma Titan', 
        emoji: '‚ö°', 
        level: 65, 
        hp: 4200, 
        maxHp: 4200, 
        attack: 250, 
        defense: 145, 
        speed: 52, 
        exp: 11000, 
        gold: 22000 
    },
    { 
        name: 'Nano Swarm', 
        emoji: 'üêù', 
        level: 75, 
        hp: 6800, 
        maxHp: 6800, 
        attack: 350, 
        defense: 210, 
        speed: 68, 
        exp: 21000, 
        gold: 42000 
    },
    { 
        name: 'Holographic Beast', 
        emoji: 'üì±', 
        level: 85, 
        hp: 8500, 
        maxHp: 8500, 
        attack: 420, 
        defense: 260, 
        speed: 72, 
        exp: 32000, 
        gold: 68000 
    },

    // TIER 7: MYTHICAL (Level 101-200) - Mythical enemies
    { 
        name: 'Primordial Shadow', 
        emoji: 'üåö', 
        level: 105, 
        hp: 18000, 
        maxHp: 18000, 
        attack: 650, 
        defense: 450, 
        speed: 95, 
        exp: 85000, 
        gold: 200000 
    },
    { 
        name: 'Eternal Phoenix', 
        emoji: 'üî•', 
        level: 110, 
        hp: 20000, 
        maxHp: 20000, 
        attack: 700, 
        defense: 500, 
        speed: 100, 
        exp: 100000, 
        gold: 250000 
    },
    { 
        name: 'Void Emperor', 
        emoji: 'üë§', 
        level: 115, 
        hp: 25000, 
        maxHp: 25000, 
        attack: 750, 
        defense: 550, 
        speed: 105, 
        exp: 120000, 
        gold: 300000 
    },
    { 
        name: 'Reality Shatterer', 
        emoji: 'üíî', 
        level: 120, 
        hp: 30000, 
        maxHp: 30000, 
        attack: 800, 
        defense: 600, 
        speed: 110, 
        exp: 140000, 
        gold: 400000 
    },
    { 
        name: 'Time Weaver', 
        emoji: 'üï∞Ô∏è', 
        level: 125, 
        hp: 35000, 
        maxHp: 35000, 
        attack: 850, 
        defense: 650, 
        speed: 115, 
        exp: 160000, 
        gold: 500000 
    },
    { 
        name: 'Dimensional Tyrant', 
        emoji: 'üåÄ', 
        level: 130, 
        hp: 40000, 
        maxHp: 40000, 
        attack: 900, 
        defense: 700, 
        speed: 120, 
        exp: 180000, 
        gold: 600000 
    },
    { 
        name: 'Nexus Guardian', 
        emoji: 'üîó', 
        level: 135, 
        hp: 45000, 
        maxHp: 45000, 
        attack: 950, 
        defense: 750, 
        speed: 125, 
        exp: 220000, 
        gold: 750000 
    },
    { 
        name: 'Quantum Overlord', 
        emoji: '‚öõÔ∏è', 
        level: 140, 
        hp: 50000, 
        maxHp: 50000, 
        attack: 1000, 
        defense: 800, 
        speed: 130, 
        exp: 250000, 
        gold: 900000 
    },
    { 
        name: 'Multiverse Destroyer', 
        emoji: 'üåç', 
        level: 150, 
        hp: 60000, 
        maxHp: 60000, 
        attack: 1100, 
        defense: 900, 
        speed: 140, 
        exp: 300000, 
        gold: 1200000 
    },
    { 
        name: 'Cosmic Horror', 
        emoji: 'üëÅÔ∏è‚Äçüó®Ô∏è', 
        level: 160, 
        hp: 70000, 
        maxHp: 70000, 
        attack: 1200, 
        defense: 1000, 
        speed: 150, 
        exp: 400000, 
        gold: 1500000 
    },
    { 
        name: 'Infinite Nightmare', 
        emoji: 'üòà', 
        level: 170, 
        hp: 80000, 
        maxHp: 80000, 
        attack: 1300, 
        defense: 1100, 
        speed: 160, 
        exp: 500000, 
        gold: 2000000 
    },
    { 
        name: 'Universe Ender', 
        emoji: 'üíÄ', 
        level: 180, 
        hp: 100000, 
        maxHp: 100000, 
        attack: 1400, 
        defense: 1200, 
        speed: 170, 
        exp: 650000, 
        gold: 2500000 
    },
    { 
        name: 'Omnipotent Being', 
        emoji: '‚ú®', 
        level: 190, 
        hp: 120000, 
        maxHp: 120000, 
        attack: 1500, 
        defense: 1300, 
        speed: 180, 
        exp: 800000, 
        gold: 3000000 
    },
    { 
        name: 'Mythical Apex', 
        emoji: 'üèîÔ∏è', 
        level: 200, 
        hp: 150000, 
        maxHp: 150000, 
        attack: 1600, 
        defense: 1400, 
        speed: 200, 
        exp: 1000000, 
        gold: 4000000 
    },

    // TIER 8: LEGENDARY (Level 201-300) - Legendary enemies
    { 
        name: 'Ancient Leviathan', 
        emoji: 'üêã', 
        level: 210, 
        hp: 180000, 
        maxHp: 180000, 
        attack: 1700, 
        defense: 1500, 
        speed: 180, 
        exp: 1200000, 
        gold: 5000000 
    },
    { 
        name: 'Stellar Colossus', 
        emoji: '‚≠ê', 
        level: 220, 
        hp: 220000, 
        maxHp: 220000, 
        attack: 1800, 
        defense: 1600, 
        speed: 190, 
        exp: 1500000, 
        gold: 6000000 
    },
    { 
        name: 'Galactic Sovereign', 
        emoji: 'üåå', 
        level: 230, 
        hp: 270000, 
        maxHp: 270000, 
        attack: 1900, 
        defense: 1700, 
        speed: 200, 
        exp: 1800000, 
        gold: 7500000 
    },
    { 
        name: 'Primal Chaos', 
        emoji: 'üí•', 
        level: 240, 
        hp: 320000, 
        maxHp: 320000, 
        attack: 2000, 
        defense: 1800, 
        speed: 210, 
        exp: 2200000, 
        gold: 9000000 
    },
    { 
        name: 'Eternal Watcher', 
        emoji: 'üëÅÔ∏è', 
        level: 250, 
        hp: 380000, 
        maxHp: 380000, 
        attack: 2100, 
        defense: 1900, 
        speed: 220, 
        exp: 2600000, 
        gold: 11000000 
    },
    { 
        name: 'Infinity Incarnate', 
        emoji: '‚ôæÔ∏è', 
        level: 260, 
        hp: 450000, 
        maxHp: 450000, 
        attack: 2200, 
        defense: 2000, 
        speed: 230, 
        exp: 3000000, 
        gold: 13000000 
    },
    { 
        name: 'Dimensional Lord', 
        emoji: 'üî≤', 
        level: 270, 
        hp: 520000, 
        maxHp: 520000, 
        attack: 2300, 
        defense: 2100, 
        speed: 240, 
        exp: 3500000, 
        gold: 15000000 
    },
    { 
        name: 'Cosmic Harbinger', 
        emoji: '‚òÑÔ∏è', 
        level: 280, 
        hp: 600000, 
        maxHp: 600000, 
        attack: 2400, 
        defense: 2200, 
        speed: 250, 
        exp: 4000000, 
        gold: 18000000 
    },
    { 
        name: 'Ultimate Destroyer', 
        emoji: 'üíÄ', 
        level: 290, 
        hp: 700000, 
        maxHp: 700000, 
        attack: 2500, 
        defense: 2300, 
        speed: 260, 
        exp: 4500000, 
        gold: 20000000 
    },
    { 
        name: 'Legendary Avatar', 
        emoji: 'üë§', 
        level: 300, 
        hp: 800000, 
        maxHp: 800000, 
        attack: 2600, 
        defense: 2400, 
        speed: 280, 
        exp: 5000000, 
        gold: 25000000 
    },

    // TIER 9: ASCENDED (Level 301-500) - Ascended enemies
    { 
        name: 'Void Ascendant', 
        emoji: '‚ö´', 
        level: 320, 
        hp: 1000000, 
        maxHp: 1000000, 
        attack: 2800, 
        defense: 2600, 
        speed: 300, 
        exp: 6000000, 
        gold: 30000000 
    },
    { 
        name: 'Celestial Architect', 
        emoji: 'üèóÔ∏è', 
        level: 340, 
        hp: 1200000, 
        maxHp: 1200000, 
        attack: 3000, 
        defense: 2800, 
        speed: 320, 
        exp: 7000000, 
        gold: 35000000 
    },
    { 
        name: 'Reality Forge', 
        emoji: 'üî®', 
        level: 360, 
        hp: 1500000, 
        maxHp: 1500000, 
        attack: 3200, 
        defense: 3000, 
        speed: 340, 
        exp: 8500000, 
        gold: 40000000 
    },
    { 
        name: 'Time Sovereign', 
        emoji: '‚è≥', 
        level: 380, 
        hp: 1800000, 
        maxHp: 1800000, 
        attack: 3400, 
        defense: 3200, 
        speed: 360, 
        exp: 10000000, 
        gold: 50000000 
    },
    { 
        name: 'Multiverse King', 
        emoji: 'üëë', 
        level: 400, 
        hp: 2200000, 
        maxHp: 2200000, 
        attack: 3600, 
        defense: 3400, 
        speed: 380, 
        exp: 12000000, 
        gold: 60000000 
    },
    { 
        name: 'Quantum Emperor', 
        emoji: '‚öõÔ∏è', 
        level: 420, 
        hp: 2600000, 
        maxHp: 2600000, 
        attack: 3800, 
        defense: 3600, 
        speed: 400, 
        exp: 14000000, 
        gold: 75000000 
    },
    { 
        name: 'Dimensional God', 
        emoji: 'üåÄ', 
        level: 440, 
        hp: 3000000, 
        maxHp: 3000000, 
        attack: 4000, 
        defense: 3800, 
        speed: 420, 
        exp: 16000000, 
        gold: 90000000 
    },
    { 
        name: 'Infinity Lord', 
        emoji: '‚ôæÔ∏è', 
        level: 460, 
        hp: 3500000, 
        maxHp: 3500000, 
        attack: 4200, 
        defense: 4000, 
        speed: 440, 
        exp: 18000000, 
        gold: 110000000 
    },
    { 
        name: 'Cosmic Supreme', 
        emoji: '‚ú®', 
        level: 480, 
        hp: 4000000, 
        maxHp: 4000000, 
        attack: 4400, 
        defense: 4200, 
        speed: 460, 
        exp: 22000000, 
        gold: 130000000 
    },
    { 
        name: 'Ascended Origin', 
        emoji: 'üí´', 
        level: 500, 
        hp: 5000000, 
        maxHp: 5000000, 
        attack: 4600, 
        defense: 4400, 
        speed: 500, 
        exp: 25000000, 
        gold: 150000000 
    },

    // TIER 10: PRIMORDIAL (Level 501-1000) - Ultimate enemies
    { 
        name: 'Primordial Void', 
        emoji: '‚ö´', 
        level: 550, 
        hp: 6000000, 
        maxHp: 6000000, 
        attack: 5000, 
        defense: 4800, 
        speed: 520, 
        exp: 30000000, 
        gold: 200000000 
    },
    { 
        name: 'Genesis Entity', 
        emoji: 'üåç', 
        level: 600, 
        hp: 8000000, 
        maxHp: 8000000, 
        attack: 5500, 
        defense: 5200, 
        speed: 550, 
        exp: 40000000, 
        gold: 250000000 
    },
    { 
        name: 'Omega Singularity', 
        emoji: '‚ö´', 
        level: 650, 
        hp: 10000000, 
        maxHp: 10000000, 
        attack: 6000, 
        defense: 5600, 
        speed: 580, 
        exp: 50000000, 
        gold: 300000000 
    },
    { 
        name: 'Universal Creator', 
        emoji: 'üåå', 
        level: 700, 
        hp: 15000000, 
        maxHp: 15000000, 
        attack: 6500, 
        defense: 6000, 
        speed: 600, 
        exp: 65000000, 
        gold: 400000000 
    },
    { 
        name: 'Infinite Consciousness', 
        emoji: 'üß†', 
        level: 750, 
        hp: 20000000, 
        maxHp: 20000000, 
        attack: 7000, 
        defense: 6500, 
        speed: 650, 
        exp: 80000000, 
        gold: 500000000 
    },
    { 
        name: 'Reality Source', 
        emoji: 'üîÆ', 
        level: 800, 
        hp: 30000000, 
        maxHp: 30000000, 
        attack: 7500, 
        defense: 7000, 
        speed: 700, 
        exp: 100000000, 
        gold: 650000000 
    },
    { 
        name: 'Eternal Absolute', 
        emoji: 'üëÅÔ∏è', 
        level: 850, 
        hp: 40000000, 
        maxHp: 40000000, 
        attack: 8000, 
        defense: 7500, 
        speed: 750, 
        exp: 120000000, 
        gold: 800000000 
    },
    { 
        name: 'Primordial One', 
        emoji: '1Ô∏è‚É£', 
        level: 900, 
        hp: 60000000, 
        maxHp: 60000000, 
        attack: 8500, 
        defense: 8000, 
        speed: 800, 
        exp: 150000000, 
        gold: 1000000000 
    },
    { 
        name: 'Ultimate Truth', 
        emoji: 'üíé', 
        level: 950, 
        hp: 80000000, 
        maxHp: 80000000, 
        attack: 9000, 
        defense: 8500, 
        speed: 850, 
        exp: 200000000, 
        gold: 1500000000 
    },
    { 
        name: 'The Origin', 
        emoji: 'üåü', 
        level: 1000, 
        hp: 100000000, 
        maxHp: 100000000, 
        attack: 10000, 
        defense: 9000, 
        speed: 1000, 
        exp: 500000000, 
        gold: 2000000000 
    },

    // HALLOWEEN ENEMIES (Special Event)
   // HALLOWEEN THEMED ENEMIES (30 enemies)
{
    name: 'Haunted Pumpkin',
    emoji: 'üéÉ',
    level: 3,
    hp: 130,
    maxHp: 130,
    attack: 20,
    defense: 8,
    speed: 11,
    exp: 120,
    gold: 150,
    halloween: true
},
{
    name: 'Spectral Ghost',
    emoji: 'üëª',
    level: 5,
    hp: 160,
    maxHp: 160,
    attack: 28,
    defense: 10,
    speed: 18,
    exp: 180,
    gold: 220,
    halloween: true
},
{
    name: 'Skeleton Warrior',
    emoji: 'üíÄ',
    level: 4,
    hp: 140,
    maxHp: 140,
    attack: 22,
    defense: 12,
    speed: 13,
    exp: 150,
    gold: 180,
    halloween: true
},
{
    name: 'Vampire Lord',
    emoji: 'üßõ',
    level: 7,
    hp: 250,
    maxHp: 250,
    attack: 32,
    defense: 18,
    speed: 16,
    exp: 280,
    gold: 350,
    halloween: true
},
{
    name: 'Grim Reaper',
    emoji: '‚ò†Ô∏è',
    level: 9,
    hp: 320,
    maxHp: 320,
    attack: 38,
    defense: 22,
    speed: 19,
    exp: 450,
    gold: 550,
    halloween: true
},
{
    name: 'Halloween Demon',
    emoji: 'üé≠',
    level: 15,
    hp: 400,
    maxHp: 400,
    attack: 45,
    defense: 25,
    speed: 22,
    exp: 500,
    gold: 650,
    halloween: true
},
{
    name: 'Witch Queen',
    emoji: 'üßô‚Äç‚ôÄÔ∏è',
    level: 20,
    hp: 550,
    maxHp: 550,
    attack: 60,
    defense: 35,
    speed: 25,
    exp: 750,
    gold: 900,
    halloween: true
},
{
    name: 'Cursed Spirit',
    emoji: 'üëπ',
    level: 25,
    hp: 700,
    maxHp: 700,
    attack: 75,
    defense: 40,
    speed: 30,
    exp: 1000,
    gold: 1200,
    halloween: true
},
{
    name: 'Zombie Horde',
    emoji: 'üßü',
    level: 6,
    hp: 200,
    maxHp: 200,
    attack: 25,
    defense: 15,
    speed: 8,
    exp: 220,
    gold: 280,
    halloween: true
},
{
    name: 'Black Cat',
    emoji: 'üê±',
    level: 2,
    hp: 80,
    maxHp: 80,
    attack: 15,
    defense: 5,
    speed: 20,
    exp: 90,
    gold: 120,
    halloween: true
},
{
    name: 'Phantom Wraith',
    emoji: 'üå´Ô∏è',
    level: 8,
    hp: 280,
    maxHp: 280,
    attack: 35,
    defense: 16,
    speed: 22,
    exp: 350,
    gold: 420,
    halloween: true
},
{
    name: 'Headless Horseman',
    emoji: 'üê¥',
    level: 12,
    hp: 380,
    maxHp: 380,
    attack: 42,
    defense: 28,
    speed: 26,
    exp: 520,
    gold: 680,
    halloween: true
},
{
    name: 'Undead Knight',
    emoji: '‚ö∞Ô∏è',
    level: 10,
    hp: 350,
    maxHp: 350,
    attack: 40,
    defense: 30,
    speed: 15,
    exp: 480,
    gold: 600,
    halloween: true
},
{
    name: 'Werewolf Alpha',
    emoji: 'üê∫',
    level: 14,
    hp: 420,
    maxHp: 420,
    attack: 48,
    defense: 22,
    speed: 28,
    exp: 580,
    gold: 750,
    halloween: true
},
{
    name: 'Banshee',
    emoji: 'üò±',
    level: 16,
    hp: 380,
    maxHp: 380,
    attack: 52,
    defense: 20,
    speed: 32,
    exp: 620,
    gold: 800,
    halloween: true
},
{
    name: 'Mummy Pharaoh',
    emoji: 'üè∫',
    level: 18,
    hp: 500,
    maxHp: 500,
    attack: 50,
    defense: 40,
    speed: 12,
    exp: 680,
    gold: 850,
    halloween: true
},
{
    name: 'Dark Witch',
    emoji: 'üîÆ',
    level: 11,
    hp: 300,
    maxHp: 300,
    attack: 38,
    defense: 18,
    speed: 24,
    exp: 420,
    gold: 520,
    halloween: true
},
{
    name: 'Bone Dragon',
    emoji: 'ü¶¥',
    level: 22,
    hp: 650,
    maxHp: 650,
    attack: 68,
    defense: 45,
    speed: 20,
    exp: 850,
    gold: 1100,
    halloween: true
},
{
    name: 'Shadow Fiend',
    emoji: 'üë§',
    level: 13,
    hp: 360,
    maxHp: 360,
    attack: 44,
    defense: 25,
    speed: 27,
    exp: 540,
    gold: 700,
    halloween: true
},
{
    name: 'Poltergeist',
    emoji: 'üåÄ',
    level: 17,
    hp: 420,
    maxHp: 420,
    attack: 55,
    defense: 18,
    speed: 35,
    exp: 640,
    gold: 820,
    halloween: true
},
{
    name: 'Gargoyle Guardian',
    emoji: 'üóø',
    level: 19,
    hp: 580,
    maxHp: 580,
    attack: 48,
    defense: 50,
    speed: 14,
    exp: 720,
    gold: 900,
    halloween: true
},
{
    name: 'Nightmare Mare',
    emoji: 'üêé',
    level: 21,
    hp: 520,
    maxHp: 520,
    attack: 62,
    defense: 32,
    speed: 30,
    exp: 780,
    gold: 950,
    halloween: true
},
{
    name: 'Coffin Creeper',
    emoji: '‚ö±Ô∏è',
    level: 23,
    hp: 600,
    maxHp: 600,
    attack: 58,
    defense: 38,
    speed: 18,
    exp: 820,
    gold: 1000,
    halloween: true
},
{
    name: 'Possessed Doll',
    emoji: 'ü™Ü',
    level: 24,
    hp: 480,
    maxHp: 480,
    attack: 65,
    defense: 28,
    speed: 25,
    exp: 880,
    gold: 1080,
    halloween: true
},
{
    name: 'Grave Keeper',
    emoji: '‚õΩ',
    level: 26,
    hp: 720,
    maxHp: 720,
    attack: 72,
    defense: 42,
    speed: 22,
    exp: 950,
    gold: 1150,
    halloween: true
},
{
    name: 'Demon Imp',
    emoji: 'üòà',
    level: 27,
    hp: 650,
    maxHp: 650,
    attack: 78,
    defense: 35,
    speed: 35,
    exp: 1020,
    gold: 1280,
    halloween: true
},
{
    name: 'Cursed Scarecrow',
    emoji: 'üåæ',
    level: 28,
    hp: 750,
    maxHp: 750,
    attack: 70,
    defense: 45,
    speed: 20,
    exp: 1100,
    gold: 1400,
    halloween: true
},
{
    name: 'Bat Swarm Lord',
    emoji: 'ü¶á',
    level: 29,
    hp: 680,
    maxHp: 680,
    attack: 82,
    defense: 38,
    speed: 40,
    exp: 1180,
    gold: 1520,
    halloween: true
},
{
    name: 'Halloween King',
    emoji: 'üëë',
    level: 30,
    hp: 900,
    maxHp: 900,
    attack: 85,
    defense: 55,
    speed: 32,
    exp: 1350,
    gold: 1750,
    halloween: true
},
{
    name: 'Ancient Lich',
    emoji: 'üßô‚Äç‚ôÇÔ∏è',
    level: 35,
    hp: 1200,
    maxHp: 1200,
    attack: 105,
    defense: 65,
    speed: 28,
    exp: 1800,
    gold: 2200,
    halloween: true
}
],

            equipment: {
    // Weapons (existing + 30 new items)
    kunai: {
        name: 'Kunai',
        emoji: 'üó°Ô∏è',
        type: 'weapon',
        rarity: 'common',
        stats: { attack: 5 },
        price: 100
    },
    katana: {
        name: 'Katana',
        emoji: '‚öîÔ∏è',
        type: 'weapon',
        rarity: 'uncommon',
        stats: { attack: 12 },
        price: 250
    },
    legendary_blade: {
        name: 'Legendary Blade',
        emoji: 'üó°Ô∏è',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 30, speed: 5 },
        price: 1000
    },
    halloween_scythe: {
        name: 'Halloween Scythe',
        emoji: 'üéÉ',
        type: 'weapon',
        rarity: 'epic',
        stats: { attack: 25, maxChakra: 15 },
        price: 800,
        halloween: true
    },
    celestial_sword: {
        name: 'Celestial Sword',
        emoji: '‚ú®',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 40, speed: 10, maxChakra: 20 },
        milestone: true
    },
    divine_katana: {
        name: 'Divine Katana',
        emoji: 'üåü',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 50, speed: 15 },
        milestone: true
    },
    wooden_sword: {
        name: 'Wooden Sword',
        emoji: 'ü™µ',
        type: 'weapon',
        rarity: 'common',
        stats: { attack: 3 },
        price: 50
    },
    iron_dagger: {
        name: 'Iron Dagger',
        emoji: 'üî™',
        type: 'weapon',
        rarity: 'common',
        stats: { attack: 7, speed: 2 },
        price: 150
    },
    steel_sword: {
        name: 'Steel Sword',
        emoji: '‚öîÔ∏è',
        type: 'weapon',
        rarity: 'uncommon',
        stats: { attack: 15, speed: 3 },
        price: 300
    },
    chakra_blade: {
        name: 'Chakra Blade',
        emoji: 'üí†',
        type: 'weapon',
        rarity: 'uncommon',
        stats: { attack: 10, maxChakra: 10 },
        price: 280
    },
    thunder_spear: {
        name: 'Thunder Spear',
        emoji: '‚ö°',
        type: 'weapon',
        rarity: 'rare',
        stats: { attack: 18, speed: 5 },
        price: 450
    },
    flame_katana: {
        name: 'Flame Katana',
        emoji: 'üî•',
        type: 'weapon',
        rarity: 'rare',
        stats: { attack: 20, maxChakra: 8 },
        price: 500
    },
    ice_blade: {
        name: 'Ice Blade',
        emoji: '‚ùÑÔ∏è',
        type: 'weapon',
        rarity: 'rare',
        stats: { attack: 19, defense: 5 },
        price: 480
    },
    wind_scythe: {
        name: 'Wind Scythe',
        emoji: 'üå™Ô∏è',
        type: 'weapon',
        rarity: 'rare',
        stats: { attack: 17, speed: 8 },
        price: 520
    },
    demon_sword: {
        name: 'Demon Sword',
        emoji: 'üëπ',
        type: 'weapon',
        rarity: 'epic',
        stats: { attack: 28, maxChakra: 12 },
        price: 750
    },
    dragon_fang: {
        name: 'Dragon Fang',
        emoji: 'üêâ',
        type: 'weapon',
        rarity: 'epic',
        stats: { attack: 26, speed: 6, maxHp: 20 },
        price: 850
    },
    shadow_blade: {
        name: 'Shadow Blade',
        emoji: 'üåë',
        type: 'weapon',
        rarity: 'epic',
        stats: { attack: 24, speed: 10 },
        price: 700
    },
    crystal_rapier: {
        name: 'Crystal Rapier',
        emoji: 'üíé',
        type: 'weapon',
        rarity: 'epic',
        stats: { attack: 27, speed: 7, maxChakra: 10 },
        price: 820
    },
    samurai_blade: {
        name: 'Samurai Blade',
        emoji: '‚öîÔ∏è',
        type: 'weapon',
        rarity: 'rare',
        stats: { attack: 21, defense: 3 },
        price: 550
    },
    blood_reaper: {
        name: 'Blood Reaper',
        emoji: 'ü©∏',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 35, maxChakra: 18, maxHp: 30 },
        price: 1200
    },
    void_katana: {
        name: 'Void Katana',
        emoji: 'üåå',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 38, speed: 12, maxChakra: 25 },
        price: 1400
    },
    phoenix_blade: {
        name: 'Phoenix Blade',
        emoji: 'üî•',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 33, speed: 8, maxHp: 40 },
        price: 1150
    },
    serpent_sword: {
        name: 'Serpent Sword',
        emoji: 'üêç',
        type: 'weapon',
        rarity: 'uncommon',
        stats: { attack: 14, speed: 4 },
        price: 320
    },
    ninja_star: {
        name: 'Ninja Star',
        emoji: '‚≠ê',
        type: 'weapon',
        rarity: 'common',
        stats: { attack: 6, speed: 5 },
        price: 130
    },
    spirit_sword: {
        name: 'Spirit Sword',
        emoji: 'üëª',
        type: 'weapon',
        rarity: 'rare',
        stats: { attack: 22, maxChakra: 15 },
        price: 580
    },
    kusanagi_sword: {
        name: 'Kusanagi Sword',
        emoji: 'üêç',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 55, speed: 20, maxChakra: 35 },
        price: 8500
    },
    samehada: {
        name: 'Samehada',
        emoji: 'ü¶à',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 60, maxChakra: 50, maxHp: 40 },
        price: 12000
    },
    executioners_blade: {
        name: 'Executioner\'s Blade',
        emoji: '‚öîÔ∏è',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 70, defense: 15, maxHp: 60 },
        price: 14500
    },
    twin_demon_swords: {
        name: 'Twin Demon Swords',
        emoji: '‚ö°',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 65, speed: 25, maxChakra: 30 },
        price: 13000
    },
    seven_star_sword: {
        name: 'Seven Star Sword',
        emoji: '‚≠ê',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 58, maxChakra: 45, speed: 18 },
        price: 9500
    },
    so6p_staff: {
        name: 'Sage of Six Paths Staff',
        emoji: 'üåü',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 120, maxChakra: 100, maxHp: 80, speed: 30, defense: 25 },
        price: 55000
    },
    truth_seeking_orbs: {
        name: 'Truth-Seeking Orbs',
        emoji: '‚ö´',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 150, maxChakra: 120, speed: 40, defense: 30 },
        price: 60000
    },
    sword_of_nunoboko: {
        name: 'Sword of Nunoboko',
        emoji: 'üó°Ô∏è',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 140, maxChakra: 90, maxHp: 100, speed: 25, defense: 35 },
        price: 52000
    },
    ten_tails_chakra_arm: {
        name: 'Ten-Tails Chakra Arm',
        emoji: 'üëπ',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 135, maxHp: 120, maxChakra: 80, defense: 40 },
        price: 48000
    },
    otsutsuki_horn: {
        name: 'Otsutsuki Horn Blade',
        emoji: 'üëΩ',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 160, maxChakra: 140, speed: 35, maxHp: 90 },
        price: 58000
    },
    
    // NEW WEAPONS (30 items)
    infinity_edge: {
        name: 'Infinity Edge',
        emoji: '‚ôæÔ∏è',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 180, maxChakra: 160, speed: 50, maxHp: 120, defense: 40 },
        price: 75000
    },
    reality_breaker: {
        name: 'Reality Breaker',
        emoji: 'üí•',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 200, maxChakra: 180, speed: 45, defense: 50 },
        price: 85000
    },
    cosmic_destroyer: {
        name: 'Cosmic Destroyer',
        emoji: 'üå†',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 220, maxHp: 150, maxChakra: 200, speed: 60 },
        price: 95000
    },
    dimension_cutter: {
        name: 'Dimension Cutter',
        emoji: 'üåÄ',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 190, speed: 70, maxChakra: 170, defense: 35 },
        price: 80000
    },
    soul_harvester: {
        name: 'Soul Harvester',
        emoji: 'üíÄ',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 175, maxHp: 140, maxChakra: 150, defense: 45 },
        price: 72000
    },
    eternal_flame_sword: {
        name: 'Eternal Flame Sword',
        emoji: 'üî•',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 165, maxChakra: 130, speed: 40, maxHp: 110 },
        price: 68000
    },
    absolute_zero_blade: {
        name: 'Absolute Zero Blade',
        emoji: 'üßä',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 170, defense: 55, maxChakra: 140, speed: 35 },
        price: 70000
    },
    storm_lord_spear: {
        name: 'Storm Lord Spear',
        emoji: 'üå©Ô∏è',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 185, speed: 65, maxChakra: 165, maxHp: 100 },
        price: 78000
    },
    earth_shaker_hammer: {
        name: 'Earth Shaker Hammer',
        emoji: 'üî®',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 210, defense: 60, maxHp: 160, speed: -10 },
        price: 88000
    },
    light_bringer: {
        name: 'Light Bringer',
        emoji: '‚òÄÔ∏è',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 155, speed: 55, maxChakra: 120, maxHp: 90, defense: 30 },
        price: 65000
    },
    darkness_eater: {
        name: 'Darkness Eater',
        emoji: 'üï≥Ô∏è',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 195, maxChakra: 175, speed: 30, defense: 40 },
        price: 82000
    },
    god_slayer_blade: {
        name: 'God Slayer Blade',
        emoji: '‚ö°',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 250, maxChakra: 220, maxHp: 180, speed: 80 },
        price: 120000
    },
    chaos_ripper: {
        name: 'Chaos Ripper',
        emoji: 'üå™Ô∏è',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 205, speed: 75, maxChakra: 185, defense: 25 },
        price: 87000
    },
    time_slicer: {
        name: 'Time Slicer',
        emoji: '‚è∞',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 188, speed: 90, maxChakra: 155, maxHp: 110 },
        price: 79000
    },
    galaxy_edge: {
        name: 'Galaxy Edge',
        emoji: 'üåå',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 230, maxChakra: 210, maxHp: 170, speed: 50, defense: 55 },
        price: 110000
    },
    nightmare_scythe: {
        name: 'Nightmare Scythe',
        emoji: 'üåô',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 178, maxChakra: 145, speed: 45, maxHp: 130 },
        price: 74000
    },
    plasma_cannon: {
        name: 'Plasma Cannon',
        emoji: 'üî´',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 215, maxChakra: 190, speed: 25, defense: 20 },
        price: 90000
    },
    quantum_sword: {
        name: 'Quantum Sword',
        emoji: '‚öõÔ∏è',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 192, speed: 85, maxChakra: 160, maxHp: 105 },
        price: 81000
    },
    molecular_disruptor: {
        name: 'Molecular Disruptor',
        emoji: 'üß™',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 198, maxChakra: 180, speed: 40, defense: 35 },
        price: 83000
    },
    singularity_blade: {
        name: 'Singularity Blade',
        emoji: 'üåë',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 240, maxHp: 200, maxChakra: 200, speed: 20 },
        price: 115000
    },
    antimatter_edge: {
        name: 'Antimatter Edge',
        emoji: 'üí´',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 225, speed: 60, maxChakra: 195, defense: 45 },
        price: 105000
    },
    omni_destroyer: {
        name: 'Omni Destroyer',
        emoji: 'üí•',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 260, maxChakra: 240, maxHp: 220, speed: 70, defense: 60 },
        price: 150000
    },
    universe_render: {
        name: 'Universe Render',
        emoji: 'üåå',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 280, maxChakra: 250, speed: 90, defense: 70 },
        price: 180000
    },
    existence_ender: {
        name: 'Existence Ender',
        emoji: 'üíÄ',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 300, maxHp: 250, maxChakra: 280, speed: 100, defense: 80 },
        price: 200000
    },
    creation_sword: {
        name: 'Creation Sword',
        emoji: '‚ú®',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 275, maxChakra: 270, maxHp: 200, speed: 85, defense: 75 },
        price: 175000
    },
    apocalypse_bringer: {
        name: 'Apocalypse Bringer',
        emoji: 'üåã',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 290, maxChakra: 260, speed: 75, defense: 85 },
        price: 190000
    },
    genesis_blade: {
        name: 'Genesis Blade',
        emoji: 'üåü',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 320, maxHp: 300, maxChakra: 300, speed: 120, defense: 100 },
        price: 250000
    },
    infinity_crusher: {
        name: 'Infinity Crusher',
        emoji: 'üî•',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 350, maxChakra: 320, speed: 110, defense: 90 },
        price: 300000
    },
    eternal_destroyer: {
        name: 'Eternal Destroyer',
        emoji: '‚ö°',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 400, maxHp: 350, maxChakra: 350, speed: 150, defense: 120 },
        price: 500000
    },
    ultimate_weapon: {
        name: 'Ultimate Weapon',
        emoji: 'üëë',
        type: 'weapon',
        rarity: 'legendary',
        stats: { attack: 500, maxHp: 400, maxChakra: 400, speed: 200, defense: 150 },
        price: 1000000
    },

    // Armor (existing items)
    cloth_armor: {
        name: 'Cloth Armor',
        emoji: 'üëï',
        type: 'armor',
        rarity: 'common',
        stats: { defense: 5, maxHp: 20 },
        price: 120
    },
    ninja_vest: {
        name: 'Ninja Vest',
        emoji: 'ü¶∫',
        type: 'armor',
        rarity: 'uncommon',
        stats: { defense: 10, maxHp: 40 },
        price: 300
    },
    akatsuki_robe: {
        name: 'Akatsuki Robe',
        emoji: 'üß•',
        type: 'armor',
        rarity: 'epic',
        stats: { defense: 20, maxHp: 80, maxChakra: 20 },
        price: 800
    },
    ghost_cloak: {
        name: 'Ghost Cloak',
        emoji: 'üëª',
        type: 'armor',
        rarity: 'rare',
        stats: { defense: 15, maxHp: 60, speed: 5 },
        price: 600,
        halloween: true
    },
    sage_armor: {
        name: 'Sage Armor',
        emoji: 'üõ°Ô∏è',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 30, maxHp: 120, maxChakra: 30 },
        milestone: true
    },
    immortal_vest: {
        name: 'Immortal Vest',
        emoji: 'üíé',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 40, maxHp: 150 },
        milestone: true
    },
    leather_vest: {
        name: 'Leather Vest',
        emoji: 'ü¶¥',
        type: 'armor',
        rarity: 'common',
        stats: { defense: 3, maxHp: 15 },
        price: 80
    },
    padded_armor: {
        name: 'Padded Armor',
        emoji: 'üßµ',
        type: 'armor',
        rarity: 'common',
        stats: { defense: 7, maxHp: 25 },
        price: 150
    },
    iron_chestplate: {
        name: 'Iron Chestplate',
        emoji: '‚öôÔ∏è',
        type: 'armor',
        rarity: 'uncommon',
        stats: { defense: 12, maxHp: 50 },
        price: 350
    },
    steel_armor: {
        name: 'Steel Armor',
        emoji: 'üî©',
        type: 'armor',
        rarity: 'uncommon',
        stats: { defense: 14, maxHp: 55, speed: -2 },
        price: 380
    },
    shadow_robe: {
        name: 'Shadow Robe',
        emoji: 'üåë',
        type: 'armor',
        rarity: 'rare',
        stats: { defense: 16, maxHp: 65, speed: 3 },
        price: 620
    },
    flame_armor: {
        name: 'Flame Armor',
        emoji: 'üî•',
        type: 'armor',
        rarity: 'rare',
        stats: { defense: 17, maxHp: 70, attack: 5 },
        price: 680
    },
    thunder_vest: {
        name: 'Thunder Vest',
        emoji: '‚ö°',
        type: 'armor',
        rarity: 'rare',
        stats: { defense: 15, maxHp: 60, speed: 6 },
        price: 640
    },
    ice_armor: {
        name: 'Ice Armor',
        emoji: '‚ùÑÔ∏è',
        type: 'armor',
        rarity: 'rare',
        stats: { defense: 18, maxHp: 75, maxChakra: 10 },
        price: 700
    },
    samurai_armor: {
        name: 'Samurai Armor',
        emoji: 'üéå',
        type: 'armor',
        rarity: 'epic',
        stats: { defense: 22, maxHp: 90, attack: 8 },
        price: 850
    },
    dragon_scale: {
        name: 'Dragon Scale Armor',
        emoji: 'üêâ',
        type: 'armor',
        rarity: 'epic',
        stats: { defense: 24, maxHp: 100, maxChakra: 15 },
        price: 920
    },
    demon_armor: {
        name: 'Demon Armor',
        emoji: 'üëπ',
        type: 'armor',
        rarity: 'epic',
        stats: { defense: 23, maxHp: 95, attack: 10 },
        price: 880
    },
    crystal_plate: {
        name: 'Crystal Plate',
        emoji: 'üíé',
        type: 'armor',
        rarity: 'epic',
        stats: { defense: 21, maxHp: 85, maxChakra: 20 },
        price: 820
    },
    wind_cloak: {
        name: 'Wind Cloak',
        emoji: 'üå™Ô∏è',
        type: 'armor',
        rarity: 'rare',
        stats: { defense: 13, maxHp: 55, speed: 8 },
        price: 580
    },
    void_armor: {
        name: 'Void Armor',
        emoji: 'üåå',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 32, maxHp: 130, maxChakra: 35, speed: 5 },
        price: 1300
    },
    phoenix_robe: {
        name: 'Phoenix Robe',
        emoji: 'üî•',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 28, maxHp: 110, attack: 15 },
        price: 1100
    },
    celestial_armor: {
        name: 'Celestial Armor',
        emoji: '‚ú®',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 35, maxHp: 140, maxChakra: 40 },
        price: 1450
    },
    spirit_cloak: {
        name: 'Spirit Cloak',
        emoji: 'üëª',
        type: 'armor',
        rarity: 'uncommon',
        stats: { defense: 11, maxHp: 45, speed: 4 },
        price: 330
    },
    blood_armor: {
        name: 'Blood Armor',
        emoji: 'ü©∏',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 30, maxHp: 125, attack: 12 },
        price: 1250
    },
    ninja_gi: {
        name: 'Ninja Gi',
        emoji: 'ü•ã',
        type: 'armor',
        rarity: 'common',
        stats: { defense: 6, maxHp: 30, speed: 2 },
        price: 140
    },

    // NEW ARMOR (30 items)
    titan_shell: {
        name: 'Titan Shell',
        emoji: 'üõ°Ô∏è',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 80, maxHp: 300, maxChakra: 60, speed: -10 },
        price: 45000
    },
    cosmic_guardian: {
        name: 'Cosmic Guardian Armor',
        emoji: 'üåå',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 90, maxHp: 350, maxChakra: 80, attack: 20 },
        price: 55000
    },
    quantum_shield: {
        name: 'Quantum Shield Vest',
        emoji: '‚öõÔ∏è',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 85, maxHp: 320, speed: 15, maxChakra: 70 },
        price: 50000
    },
    dimensional_plate: {
        name: 'Dimensional Plate',
        emoji: 'üåÄ',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 95, maxHp: 380, maxChakra: 90, attack: 25 },
        price: 60000
    },
    infinity_guard: {
        name: 'Infinity Guard',
        emoji: '‚ôæÔ∏è',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 100, maxHp: 400, maxChakra: 100, speed: 20 },
        price: 65000
    },
    reality_warper: {
        name: 'Reality Warper Robe',
        emoji: 'üí´',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 88, maxHp: 340, maxChakra: 85, attack: 30 },
        price: 52000
    },
    soul_fortress: {
        name: 'Soul Fortress',
        emoji: 'üíÄ',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 92, maxHp: 360, maxChakra: 75, speed: 10 },
        price: 57000
    },
    eternal_aegis: {
        name: 'Eternal Aegis',
        emoji: 'üõ°Ô∏è',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 110, maxHp: 450, maxChakra: 110, attack: 35 },
        price: 75000
    },
    storm_barrier: {
        name: 'Storm Barrier Cloak',
        emoji: 'üå©Ô∏è',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 75, maxHp: 280, speed: 25, maxChakra: 65 },
        price: 42000
    },
    molten_core: {
        name: 'Molten Core Armor',
        emoji: 'üåã',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 98, maxHp: 390, attack: 40, maxChakra: 60 },
        price: 62000
    },
    frozen_citadel: {
        name: 'Frozen Citadel',
        emoji: 'üßä',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 105, maxHp: 420, maxChakra: 95, speed: 5 },
        price: 68000
    },
    light_barrier: {
        name: 'Light Barrier Vest',
        emoji: '‚òÄÔ∏è',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 78, maxHp: 290, speed: 30, maxChakra: 70 },
        price: 44000
    },
    shadow_fortress: {
        name: 'Shadow Fortress',
        emoji: 'üåë',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 87, maxHp: 330, maxChakra: 88, attack: 22 },
        price: 51000
    },
    god_emperor_armor: {
        name: 'God Emperor Armor',
        emoji: 'üëë',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 120, maxHp: 500, maxChakra: 120, attack: 50, speed: 40 },
        price: 85000
    },
    chaos_mantle: {
        name: 'Chaos Mantle',
        emoji: 'üå™Ô∏è',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 83, maxHp: 310, speed: 35, maxChakra: 80 },
        price: 48000
    },
    time_guardian: {
        name: 'Time Guardian Plate',
        emoji: '‚è∞',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 89, maxHp: 345, speed: 28, maxChakra: 92 },
        price: 54000
    },
    galaxy_defender: {
        name: 'Galaxy Defender',
        emoji: 'üåå',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 115, maxHp: 480, maxChakra: 115, attack: 45 },
        price: 80000
    },
    nightmare_shell: {
        name: 'Nightmare Shell',
        emoji: 'üåô',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 91, maxHp: 355, maxChakra: 85, attack: 28 },
        price: 56000
    },
    plasma_suit: {
        name: 'Plasma Containment Suit',
        emoji: 'üî´',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 86, maxHp: 325, speed: 22, maxChakra: 75 },
        price: 49000
    },
    molecular_barrier: {
        name: 'Molecular Barrier',
        emoji: 'üß™',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 94, maxHp: 370, maxChakra: 90, speed: 18 },
        price: 58000
    },
    singularity_shell: {
        name: 'Singularity Shell',
        emoji: 'üåë',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 125, maxHp: 520, maxChakra: 100, attack: 35 },
        price: 90000
    },
    antimatter_suit: {
        name: 'Antimatter Suit',
        emoji: 'üí´',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 108, maxHp: 440, speed: 25, maxChakra: 105 },
        price: 72000
    },
    omni_guard: {
        name: 'Omni Guard Armor',
        emoji: 'üí•',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 130, maxHp: 550, maxChakra: 130, attack: 60, speed: 50 },
        price: 100000
    },
    universe_shell: {
        name: 'Universe Shell',
        emoji: 'üåå',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 140, maxHp: 600, maxChakra: 140, speed: 45 },
        price: 120000
    },
    existence_barrier: {
        name: 'Existence Barrier',
        emoji: 'üíÄ',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 150, maxHp: 650, maxChakra: 150, attack: 80, speed: 60 },
        price: 150000
    },
    creation_mantle: {
        name: 'Creation Mantle',
        emoji: '‚ú®',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 145, maxHp: 620, maxChakra: 145, attack: 70, speed: 55 },
        price: 140000
    },
    apocalypse_guard: {
        name: 'Apocalypse Guard',
        emoji: 'üåã',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 155, maxHp: 680, maxChakra: 130, attack: 90 },
        price: 160000
    },
    genesis_armor: {
        name: 'Genesis Armor',
        emoji: 'üåü',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 180, maxHp: 750, maxChakra: 180, attack: 100, speed: 80 },
        price: 200000
    },
    infinity_shell: {
        name: 'Infinity Shell',
        emoji: 'üî•',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 200, maxHp: 800, maxChakra: 200, speed: 70 },
        price: 250000
    },
    ultimate_armor: {
        name: 'Ultimate Armor',
        emoji: 'üëë',
        type: 'armor',
        rarity: 'legendary',
        stats: { defense: 250, maxHp: 1000, maxChakra: 250, attack: 150, speed: 100 },
        price: 500000
    },

    // Accessories (existing items)
    headband: {
        name: 'Ninja Headband',
        emoji: 'üéÄ',
        type: 'accessory',
        rarity: 'common',
        stats: { speed: 3 },
        price: 80
    },
    sage_necklace: {
        name: 'Sage Necklace',
        emoji: 'üìø',
        type: 'accessory',
        rarity: 'rare',
        stats: { maxChakra: 30, attack: 5 },
        price: 400
    },
    sharingan_lens: {
        name: 'Sharingan Lens',
        emoji: 'üëÅÔ∏è',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 15, speed: 10, maxChakra: 20 },
        price: 1500
    },
    cursed_amulet: {
        name: 'Cursed Amulet',
        emoji: 'üíÄ',
        type: 'accessory',
        rarity: 'epic',
        stats: { attack: 12, maxChakra: 25, maxHp: 30 },
        price: 900,
        halloween: true
    },
    rinnegan_ring: {
        name: 'Rinnegan Ring',
        emoji: 'üíç',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 25, maxChakra: 50, speed: 15 },
        milestone: true
    },
    bijuu_seal: {
        name: 'Bijuu Seal',
        emoji: 'üîÆ',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 30, maxHp: 80, maxChakra: 40 },
        milestone: true
    },
    wooden_charm: {
        name: 'Wooden Charm',
        emoji: 'ü™µ',
        type: 'accessory',
        rarity: 'common',
        stats: { maxHp: 10 },
        price: 50
    },
    lucky_coin: {
        name: 'Lucky Coin',
        emoji: 'ü™ô',
        type: 'accessory',
        rarity: 'common',
        stats: { speed: 2, attack: 1 },
        price: 70
    },
    iron_ring: {
        name: 'Iron Ring',
        emoji: '‚≠ï',
        type: 'accessory',
        rarity: 'common',
        stats: { defense: 3, maxHp: 15 },
        price: 100
    },
    chakra_crystal: {
        name: 'Chakra Crystal',
        emoji: 'üí†',
        type: 'accessory',
        rarity: 'uncommon',
        stats: { maxChakra: 20 },
        price: 250
    },
    speed_boots: {
        name: 'Speed Boots',
        emoji: 'üëü',
        type: 'accessory',
        rarity: 'uncommon',
        stats: { speed: 6 },
        price: 280
    },
    power_gloves: {
        name: 'Power Gloves',
        emoji: 'üß§',
        type: 'accessory',
        rarity: 'uncommon',
        stats: { attack: 8 },
        price: 300
    },
    guardian_amulet: {
        name: 'Guardian Amulet',
        emoji: 'üõ°Ô∏è',
        type: 'accessory',
        rarity: 'uncommon',
        stats: { defense: 6, maxHp: 25 },
        price: 320
    },
    flame_pendant: {
        name: 'Flame Pendant',
        emoji: 'üî•',
        type: 'accessory',
        rarity: 'rare',
        stats: { attack: 10, maxChakra: 15 },
        price: 450
    },
    thunder_earring: {
        name: 'Thunder Earring',
        emoji: '‚ö°',
        type: 'accessory',
        rarity: 'rare',
        stats: { speed: 8, attack: 6 },
        price: 480
    },
    ice_bracelet: {
        name: 'Ice Bracelet',
        emoji: '‚ùÑÔ∏è',
        type: 'accessory',
        rarity: 'rare',
        stats: { defense: 8, maxChakra: 18 },
        price: 460
    },
    wind_anklet: {
        name: 'Wind Anklet',
        emoji: 'üå™Ô∏è',
        type: 'accessory',
        rarity: 'rare',
        stats: { speed: 10, maxHp: 20 },
        price: 500
    },
    dragon_tooth: {
        name: 'Dragon Tooth Necklace',
        emoji: 'üêâ',
        type: 'accessory',
        rarity: 'epic',
        stats: { attack: 15, maxHp: 40, defense: 5 },
        price: 820
    },
    demon_horn: {
        name: 'Demon Horn',
        emoji: 'üëπ',
        type: 'accessory',
        rarity: 'epic',
        stats: { attack: 18, maxChakra: 20 },
        price: 780
    },
    shadow_mask: {
        name: 'Shadow Mask',
        emoji: 'üåë',
        type: 'accessory',
        rarity: 'epic',
        stats: { speed: 12, attack: 10, maxChakra: 15 },
        price: 850
    },
    crystal_crown: {
        name: 'Crystal Crown',
        emoji: 'üëë',
        type: 'accessory',
        rarity: 'epic',
        stats: { maxChakra: 30, maxHp: 35, defense: 8 },
        price: 920
    },
    void_orb: {
        name: 'Void Orb',
        emoji: 'üåå',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 20, maxChakra: 35, speed: 12 },
        price: 1350
    },
    phoenix_feather: {
        name: 'Phoenix Feather',
        emoji: 'ü™∂',
        type: 'accessory',
        rarity: 'legendary',
        stats: { maxHp: 60, attack: 18, maxChakra: 25 },
        price: 1280
    },
    celestial_ring: {
        name: 'Celestial Ring',
        emoji: '‚ú®',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 22, maxChakra: 40, speed: 10, defense: 10 },
        price: 1600
    },
    blood_gem: {
        name: 'Blood Gem',
        emoji: 'ü©∏',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 28, maxHp: 50, maxChakra: 30 },
        price: 1550
    },

    // NEW ACCESSORIES (30 items)
    cosmic_pendant: {
        name: 'Cosmic Pendant',
        emoji: 'üåå',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 50, maxChakra: 80, speed: 30, maxHp: 100 },
        price: 35000
    },
    infinity_ring: {
        name: 'Infinity Ring',
        emoji: '‚ôæÔ∏è',
        type: 'accessory',
        rarity: 'legendary',
        stats: { maxChakra: 120, attack: 45, speed: 35, defense: 25 },
        price: 40000
    },
    quantum_necklace: {
        name: 'Quantum Necklace',
        emoji: '‚öõÔ∏è',
        type: 'accessory',
        rarity: 'legendary',
        stats: { speed: 50, attack: 40, maxChakra: 90 },
        price: 38000
    },
    dimensional_crown: {
        name: 'Dimensional Crown',
        emoji: 'üëë',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 60, maxHp: 120, maxChakra: 100, defense: 30 },
        price: 45000
    },
    reality_stone: {
        name: 'Reality Stone',
        emoji: 'üíé',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 70, maxChakra: 140, speed: 40 },
        price: 50000
    },
    soul_crystal: {
        name: 'Soul Crystal',
        emoji: 'üíÄ',
        type: 'accessory',
        rarity: 'legendary',
        stats: { maxHp: 150, attack: 55, maxChakra: 110 },
        price: 42000
    },
    eternal_crown: {
        name: 'Eternal Crown',
        emoji: 'üëë',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 80, maxChakra: 160, maxHp: 140, speed: 50 },
        price: 60000
    },
    storm_amulet: {
        name: 'Storm Lord Amulet',
        emoji: 'üå©Ô∏è',
        type: 'accessory',
        rarity: 'legendary',
        stats: { speed: 60, attack: 35, maxChakra: 70 },
        price: 32000
    },
    molten_ring: {
        name: 'Molten Core Ring',
        emoji: 'üåã',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 65, defense: 35, maxHp: 110 },
        price: 48000
    },
    frozen_heart: {
        name: 'Frozen Heart',
        emoji: 'üßä',
        type: 'accessory',
        rarity: 'legendary',
        stats: { defense: 40, maxChakra: 130, maxHp: 130 },
        price: 46000
    },
    light_halo: {
        name: 'Light Halo',
        emoji: '‚òÄÔ∏è',
        type: 'accessory',
        rarity: 'legendary',
        stats: { speed: 65, maxChakra: 85, attack: 30 },
        price: 34000
    },
    shadow_orb: {
        name: 'Shadow Orb',
        emoji: 'üåë',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 52, speed: 45, maxChakra: 95 },
        price: 41000
    },
    god_emperor_crown: {
        name: 'God Emperor Crown',
        emoji: 'üëë',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 100, maxChakra: 180, maxHp: 160, speed: 60, defense: 50 },
        price: 75000
    },
    chaos_medallion: {
        name: 'Chaos Medallion',
        emoji: 'üå™Ô∏è',
        type: 'accessory',
        rarity: 'legendary',
        stats: { speed: 70, attack: 48, maxChakra: 88 },
        price: 36000
    },
        time_watch: {
        name: 'Time Watch',
        emoji: '‚è∞',
        type: 'accessory',
        rarity: 'legendary',
        stats: { speed: 80, attack: 42, maxChakra: 92, defense: 20 },
        price: 39000
    },
    galaxy_orb: {
        name: 'Galaxy Orb',
        emoji: 'üåå',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 85, maxChakra: 150, maxHp: 145, speed: 55 },
        price: 65000
    },
    nightmare_eye: {
        name: 'Nightmare Eye',
        emoji: 'üåô',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 58, maxChakra: 105, speed: 48 },
        price: 43000
    },
    plasma_core: {
        name: 'Plasma Core',
        emoji: 'üî´',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 72, maxChakra: 125, defense: 28 },
        price: 52000
    },
    quantum_chip: {
        name: 'Quantum Chip',
        emoji: '‚öõÔ∏è',
        type: 'accessory',
        rarity: 'legendary',
        stats: { speed: 75, attack: 50, maxChakra: 100 },
        price: 47000
    },
    molecular_ring: {
        name: 'Molecular Ring',
        emoji: 'üß™',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 62, maxChakra: 115, speed: 42, defense: 22 },
        price: 44000
    },
    singularity_pendant: {
        name: 'Singularity Pendant',
        emoji: 'üåë',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 90, maxHp: 170, maxChakra: 135 },
        price: 70000
    },
    antimatter_crystal: {
        name: 'Antimatter Crystal',
        emoji: 'üí´',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 78, speed: 58, maxChakra: 145 },
        price: 58000
    },
    omni_stone: {
        name: 'Omni Stone',
        emoji: 'üí•',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 110, maxChakra: 200, maxHp: 180, speed: 70, defense: 60 },
        price: 90000
    },
    universe_heart: {
        name: 'Universe Heart',
        emoji: 'üåå',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 120, maxChakra: 220, speed: 75, defense: 55 },
        price: 110000
    },
    existence_gem: {
        name: 'Existence Gem',
        emoji: 'üíÄ',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 140, maxHp: 200, maxChakra: 250, speed: 85 },
        price: 140000
    },
    creation_amulet: {
        name: 'Creation Amulet',
        emoji: '‚ú®',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 130, maxChakra: 240, maxHp: 190, speed: 80, defense: 65 },
        price: 130000
    },
    apocalypse_ring: {
        name: 'Apocalypse Ring',
        emoji: 'üåã',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 150, maxChakra: 230, defense: 70, speed: 65 },
        price: 150000
    },
    genesis_crown: {
        name: 'Genesis Crown',
        emoji: 'üåü',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 180, maxHp: 250, maxChakra: 280, speed: 100, defense: 80 },
        price: 200000
    },
    infinity_heart: {
        name: 'Infinity Heart',
        emoji: 'üî•',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 200, maxChakra: 300, speed: 90, defense: 75 },
        price: 250000
    },
    ultimate_crown: {
        name: 'Ultimate Crown',
        emoji: 'üëë',
        type: 'accessory',
        rarity: 'legendary',
        stats: { attack: 250, maxHp: 300, maxChakra: 350, speed: 120, defense: 100 },
        price: 500000
    }
},

            potions: {
                health_potion: {
                    name: 'Health Potion',
                    emoji: '‚ù§Ô∏è',
                    effect: { type: 'heal', value: 50 },
                    price: 50,
                    description: 'Restores 50 HP'
                },
                mega_health_potion: {
                    name: 'Mega Health Potion',
                    emoji: 'üíñ',
                    effect: { type: 'heal', value: 100 },
                    price: 100,
                    description: 'Restores 100 HP'
                },
                chakra_potion: {
                    name: 'Chakra Potion',
                    emoji: 'üíô',
                    effect: { type: 'chakra', value: 40 },
                    price: 60,
                    description: 'Restores 40 Chakra'
                },
                elixir: {
                    name: 'Full Elixir',
                    emoji: '‚ú®',
                    effect: { type: 'full', value: 1 },
                    price: 200,
                    description: 'Fully restores HP and Chakra'
                }
            },

            skills: {
    // HP Boost (Level 1-30)
    hp_boost_1: {
        name: 'HP Boost I',
        emoji: '‚ù§Ô∏è',
        description: '+30 Max HP',
        cost: 2,
        effect: { maxHp: 30 },
        requires: null
    },
    hp_boost_2: {
        name: 'HP Boost II',
        emoji: 'ü©∏',
        description: '+50 Max HP',
        cost: 3,
        effect: { maxHp: 50 },
        requires: 'hp_boost_1'
    },
    hp_boost_3: {
        name: 'HP Boost III',
        emoji: 'üíó',
        description: '+70 Max HP',
        cost: 4,
        effect: { maxHp: 70 },
        requires: 'hp_boost_2'
    },
    hp_boost_4: {
        name: 'HP Boost IV',
        emoji: 'üíù',
        description: '+90 Max HP',
        cost: 5,
        effect: { maxHp: 90 },
        requires: 'hp_boost_3'
    },
    hp_boost_5: {
        name: 'HP Boost V',
        emoji: 'üíñ',
        description: '+110 Max HP',
        cost: 6,
        effect: { maxHp: 110 },
        requires: 'hp_boost_4'
    },
    hp_boost_6: {
        name: 'HP Boost VI',
        emoji: 'üíï',
        description: '+130 Max HP',
        cost: 7,
        effect: { maxHp: 130 },
        requires: 'hp_boost_5'
    },
    hp_boost_7: {
        name: 'HP Boost VII',
        emoji: '‚ô•Ô∏è',
        description: '+150 Max HP',
        cost: 8,
        effect: { maxHp: 150 },
        requires: 'hp_boost_6'
    },
    hp_boost_8: {
        name: 'HP Boost VIII',
        emoji: 'üíû',
        description: '+170 Max HP',
        cost: 9,
        effect: { maxHp: 170 },
        requires: 'hp_boost_7'
    },
    hp_boost_9: {
        name: 'HP Boost IX',
        emoji: 'üíì',
        description: '+190 Max HP',
        cost: 10,
        effect: { maxHp: 190 },
        requires: 'hp_boost_8'
    },
    hp_boost_10: {
        name: 'HP Boost X',
        emoji: '‚ù£Ô∏è',
        description: '+250 Max HP',
        cost: 12,
        effect: { maxHp: 250 },
        requires: 'hp_boost_9'
    },
    // HP Boost Level 11-30
    hp_boost_11: {
        name: 'HP Boost XI',
        emoji: 'üíØ',
        description: '+280 Max HP',
        cost: 14,
        effect: { maxHp: 280 },
        requires: 'hp_boost_10'
    },
    hp_boost_12: {
        name: 'HP Boost XII',
        emoji: 'üî¥',
        description: '+310 Max HP',
        cost: 16,
        effect: { maxHp: 310 },
        requires: 'hp_boost_11'
    },
    hp_boost_13: {
        name: 'HP Boost XIII',
        emoji: 'üÜò',
        description: '+340 Max HP',
        cost: 18,
        effect: { maxHp: 340 },
        requires: 'hp_boost_12'
    },
    hp_boost_14: {
        name: 'HP Boost XIV',
        emoji: 'üíò',
        description: '+370 Max HP',
        cost: 20,
        effect: { maxHp: 370 },
        requires: 'hp_boost_13'
    },
    hp_boost_15: {
        name: 'HP Boost XV',
        emoji: 'üíå',
        description: '+400 Max HP',
        cost: 22,
        effect: { maxHp: 400 },
        requires: 'hp_boost_14'
    },
    hp_boost_16: {
        name: 'HP Boost XVI',
        emoji: 'üíü',
        description: '+450 Max HP',
        cost: 25,
        effect: { maxHp: 450 },
        requires: 'hp_boost_15'
    },
    hp_boost_17: {
        name: 'HP Boost XVII',
        emoji: 'ü´∂',
        description: '+500 Max HP',
        cost: 28,
        effect: { maxHp: 500 },
        requires: 'hp_boost_16'
    },
    hp_boost_18: {
        name: 'HP Boost XVIII',
        emoji: 'ü©∑',
        description: '+550 Max HP',
        cost: 31,
        effect: { maxHp: 550 },
        requires: 'hp_boost_17'
    },
    hp_boost_19: {
        name: 'HP Boost XIX',
        emoji: 'üíã',
        description: '+600 Max HP',
        cost: 34,
        effect: { maxHp: 600 },
        requires: 'hp_boost_18'
    },
    hp_boost_20: {
        name: 'HP Boost XX',
        emoji: 'üëÑ',
        description: '+700 Max HP',
        cost: 38,
        effect: { maxHp: 700 },
        requires: 'hp_boost_19'
    },
    hp_boost_21: {
        name: 'HP Boost XXI',
        emoji: 'üß°',
        description: '+750 Max HP',
        cost: 42,
        effect: { maxHp: 750 },
        requires: 'hp_boost_20'
    },
    hp_boost_22: {
        name: 'HP Boost XXII',
        emoji: 'ü§ç',
        description: '+800 Max HP',
        cost: 46,
        effect: { maxHp: 800 },
        requires: 'hp_boost_21'
    },
    hp_boost_23: {
        name: 'HP Boost XXIII',
        emoji: 'üñ§',
        description: '+850 Max HP',
        cost: 50,
        effect: { maxHp: 850 },
        requires: 'hp_boost_22'
    },
    hp_boost_24: {
        name: 'HP Boost XXIV',
        emoji: 'üíö',
        description: '+900 Max HP',
        cost: 54,
        effect: { maxHp: 900 },
        requires: 'hp_boost_23'
    },
    hp_boost_25: {
        name: 'HP Boost XXV',
        emoji: 'üíõ',
        description: '+1000 Max HP',
        cost: 59,
        effect: { maxHp: 1000 },
        requires: 'hp_boost_24'
    },
    hp_boost_26: {
        name: 'HP Boost XXVI',
        emoji: 'üíú',
        description: '+1100 Max HP',
        cost: 64,
        effect: { maxHp: 1100 },
        requires: 'hp_boost_25'
    },
    hp_boost_27: {
        name: 'HP Boost XXVII',
        emoji: 'üîª',
        description: '+1200 Max HP',
        cost: 69,
        effect: { maxHp: 1200 },
        requires: 'hp_boost_26'
    },
    hp_boost_28: {
        name: 'HP Boost XXVIII',
        emoji: 'üî∫',
        description: '+1300 Max HP',
        cost: 74,
        effect: { maxHp: 1300 },
        requires: 'hp_boost_27'
    },
    hp_boost_29: {
        name: 'HP Boost XXIX',
        emoji: 'ü©π',
        description: '+1400 Max HP',
        cost: 79,
        effect: { maxHp: 1400 },
        requires: 'hp_boost_28'
    },
    hp_boost_30: {
        name: 'HP Boost XXX',
        emoji: 'üè•',
        description: '+1500 Max HP',
        cost: 85,
        effect: { maxHp: 1500 },
        requires: 'hp_boost_29'
    },

    // Chakra Boost (Level 1-30)
    chakra_boost_1: {
        name: 'Chakra Boost I',
        emoji: 'üíô',
        description: '+20 Max Chakra',
        cost: 2,
        effect: { maxChakra: 20 },
        requires: null
    },
    chakra_boost_2: {
        name: 'Chakra Boost II',
        emoji: 'üîµ',
        description: '+40 Max Chakra',
        cost: 3,
        effect: { maxChakra: 40 },
        requires: 'chakra_boost_1'
    },
    chakra_boost_3: {
        name: 'Chakra Boost III',
        emoji: 'üåÄ',
        description: '+60 Max Chakra',
        cost: 4,
        effect: { maxChakra: 60 },
        requires: 'chakra_boost_2'
    },
    chakra_boost_4: {
        name: 'Chakra Boost IV',
        emoji: 'üßø',
        description: '+80 Max Chakra',
        cost: 5,
        effect: { maxChakra: 80 },
        requires: 'chakra_boost_3'
    },
    chakra_boost_5: {
        name: 'Chakra Boost V',
        emoji: 'üí†',
        description: '+100 Max Chakra',
        cost: 6,
        effect: { maxChakra: 100 },
        requires: 'chakra_boost_4'
    },
    chakra_boost_6: {
        name: 'Chakra Boost VI',
        emoji: 'üîπ',
        description: '+120 Max Chakra',
        cost: 7,
        effect: { maxChakra: 120 },
        requires: 'chakra_boost_5'
    },
    chakra_boost_7: {
        name: 'Chakra Boost VII',
        emoji: 'üíé',
        description: '+140 Max Chakra',
        cost: 8,
        effect: { maxChakra: 140 },
        requires: 'chakra_boost_6'
    },
    chakra_boost_8: {
        name: 'Chakra Boost VIII',
        emoji: 'üî∑',
        description: '+160 Max Chakra',
        cost: 9,
        effect: { maxChakra: 160 },
        requires: 'chakra_boost_7'
    },
    chakra_boost_9: {
        name: 'Chakra Boost IX',
        emoji: 'üü¶',
        description: '+180 Max Chakra',
        cost: 10,
        effect: { maxChakra: 180 },
        requires: 'chakra_boost_8'
    },
    chakra_boost_10: {
        name: 'Chakra Boost X',
        emoji: 'üåä',
        description: '+250 Max Chakra',
        cost: 12,
        effect: { maxChakra: 250 },
        requires: 'chakra_boost_9'
    },
    // Chakra Boost Level 11-30
    chakra_boost_11: {
        name: 'Chakra Boost XI',
        emoji: 'üí´',
        description: '+280 Max Chakra',
        cost: 14,
        effect: { maxChakra: 280 },
        requires: 'chakra_boost_10'
    },
    chakra_boost_12: {
        name: 'Chakra Boost XII',
        emoji: 'üåê',
        description: '+310 Max Chakra',
        cost: 16,
        effect: { maxChakra: 310 },
        requires: 'chakra_boost_11'
    },
    chakra_boost_13: {
        name: 'Chakra Boost XIII',
        emoji: 'üîÆ',
        description: '+340 Max Chakra',
        cost: 18,
        effect: { maxChakra: 340 },
        requires: 'chakra_boost_12'
    },
    chakra_boost_14: {
        name: 'Chakra Boost XIV',
        emoji: 'ü™©',
        description: '+370 Max Chakra',
        cost: 20,
        effect: { maxChakra: 370 },
        requires: 'chakra_boost_13'
    },
    chakra_boost_15: {
        name: 'Chakra Boost XV',
        emoji: 'üíß',
        description: '+400 Max Chakra',
        cost: 22,
        effect: { maxChakra: 400 },
        requires: 'chakra_boost_14'
    },
    chakra_boost_16: {
        name: 'Chakra Boost XVI',
        emoji: 'üåå',
        description: '+450 Max Chakra',
        cost: 25,
        effect: { maxChakra: 450 },
        requires: 'chakra_boost_15'
    },
    chakra_boost_17: {
        name: 'Chakra Boost XVII',
        emoji: 'üî∑',
        description: '+500 Max Chakra',
        cost: 28,
        effect: { maxChakra: 500 },
        requires: 'chakra_boost_16'
    },
    chakra_boost_18: {
        name: 'Chakra Boost XVIII',
        emoji: 'üü¢',
        description: '+550 Max Chakra',
        cost: 31,
        effect: { maxChakra: 550 },
        requires: 'chakra_boost_17'
    },
    chakra_boost_19: {
        name: 'Chakra Boost XIX',
        emoji: 'üü£',
        description: '+600 Max Chakra',
        cost: 34,
        effect: { maxChakra: 600 },
        requires: 'chakra_boost_18'
    },
    chakra_boost_20: {
        name: 'Chakra Boost XX',
        emoji: 'üü°',
        description: '+700 Max Chakra',
        cost: 38,
        effect: { maxChakra: 700 },
        requires: 'chakra_boost_19'
    },
    chakra_boost_21: {
        name: 'Chakra Boost XXI',
        emoji: 'üü†',
        description: '+750 Max Chakra',
        cost: 42,
        effect: { maxChakra: 750 },
        requires: 'chakra_boost_20'
    },
    chakra_boost_22: {
        name: 'Chakra Boost XXII',
        emoji: '‚ö™',
        description: '+800 Max Chakra',
        cost: 46,
        effect: { maxChakra: 800 },
        requires: 'chakra_boost_21'
    },
    chakra_boost_23: {
        name: 'Chakra Boost XXIII',
        emoji: '‚ö´',
        description: '+850 Max Chakra',
        cost: 50,
        effect: { maxChakra: 850 },
        requires: 'chakra_boost_22'
    },
    chakra_boost_24: {
        name: 'Chakra Boost XXIV',
        emoji: 'üîò',
        description: '+900 Max Chakra',
        cost: 54,
        effect: { maxChakra: 900 },
        requires: 'chakra_boost_23'
    },
    chakra_boost_25: {
        name: 'Chakra Boost XXV',
        emoji: 'üíø',
        description: '+1000 Max Chakra',
        cost: 59,
        effect: { maxChakra: 1000 },
        requires: 'chakra_boost_24'
    },
    chakra_boost_26: {
        name: 'Chakra Boost XXVI',
        emoji: 'üìÄ',
        description: '+1100 Max Chakra',
        cost: 64,
        effect: { maxChakra: 1100 },
        requires: 'chakra_boost_25'
    },
    chakra_boost_27: {
        name: 'Chakra Boost XXVII',
        emoji: 'üé≠',
        description: '+1200 Max Chakra',
        cost: 69,
        effect: { maxChakra: 1200 },
        requires: 'chakra_boost_26'
    },
    chakra_boost_28: {
        name: 'Chakra Boost XXVIII',
        emoji: 'üåç',
        description: '+1300 Max Chakra',
        cost: 74,
        effect: { maxChakra: 1300 },
        requires: 'chakra_boost_27'
    },
    chakra_boost_29: {
        name: 'Chakra Boost XXIX',
        emoji: 'üåé',
        description: '+1400 Max Chakra',
        cost: 79,
        effect: { maxChakra: 1400 },
        requires: 'chakra_boost_28'
    },
    chakra_boost_30: {
        name: 'Chakra Boost XXX',
        emoji: 'üåè',
        description: '+1500 Max Chakra',
        cost: 85,
        effect: { maxChakra: 1500 },
        requires: 'chakra_boost_29'
    },

    // Attack Boost (Level 1-30)
    attack_boost_1: {
        name: 'Power Training I',
        emoji: 'üí™',
        description: '+5 Attack',
        cost: 2,
        effect: { attack: 5 },
        requires: null
    },
    attack_boost_2: {
        name: 'Power Training II',
        emoji: 'üëä',
        description: '+8 Attack',
        cost: 4,
        effect: { attack: 8 },
        requires: 'attack_boost_1'
    },
    attack_boost_3: {
        name: 'Power Training III',
        emoji: 'ü•ä',
        description: '+12 Attack',
        cost: 5,
        effect: { attack: 12 },
        requires: 'attack_boost_2'
    },
    attack_boost_4: {
        name: 'Power Training IV',
        emoji: '‚öîÔ∏è',
        description: '+16 Attack',
        cost: 6,
        effect: { attack: 16 },
        requires: 'attack_boost_3'
    },
    attack_boost_5: {
        name: 'Power Training V',
        emoji: 'üó°Ô∏è',
        description: '+20 Attack',
        cost: 7,
        effect: { attack: 20 },
        requires: 'attack_boost_4'
    },
    attack_boost_6: {
        name: 'Power Training VI',
        emoji: 'üí•',
        description: '+25 Attack',
        cost: 8,
        effect: { attack: 25 },
        requires: 'attack_boost_5'
    },
    attack_boost_7: {
        name: 'Power Training VII',
        emoji: 'üî•',
        description: '+30 Attack',
        cost: 9,
        effect: { attack: 30 },
        requires: 'attack_boost_6'
    },
    attack_boost_8: {
        name: 'Power Training VIII',
        emoji: 'üí¢',
        description: '+35 Attack',
        cost: 10,
        effect: { attack: 35 },
        requires: 'attack_boost_7'
    },
    attack_boost_9: {
        name: 'Power Training IX',
        emoji: 'üå™Ô∏è',
        description: '+40 Attack',
        cost: 11,
        effect: { attack: 40 },
        requires: 'attack_boost_8'
    },
    attack_boost_10: {
        name: 'Power Training X',
        emoji: '‚òÑÔ∏è',
        description: '+50 Attack',
        cost: 13,
        effect: { attack: 50 },
        requires: 'attack_boost_9'
    },
    // Attack Boost Level 11-30
    attack_boost_11: {
        name: 'Power Training XI',
        emoji: 'üåã',
        description: '+55 Attack',
        cost: 15,
        effect: { attack: 55 },
        requires: 'attack_boost_10'
    },
    attack_boost_12: {
        name: 'Power Training XII',
        emoji: '‚ö°',
        description: '+60 Attack',
        cost: 17,
        effect: { attack: 60 },
        requires: 'attack_boost_11'
    },
    attack_boost_13: {
        name: 'Power Training XIII',
        emoji: 'üéØ',
        description: '+65 Attack',
        cost: 19,
        effect: { attack: 65 },
        requires: 'attack_boost_12'
    },
    attack_boost_14: {
        name: 'Power Training XIV',
        emoji: 'üî±',
        description: '+70 Attack',
        cost: 21,
        effect: { attack: 70 },
        requires: 'attack_boost_13'
    },
    attack_boost_15: {
        name: 'Power Training XV',
        emoji: 'üèπ',
        description: '+80 Attack',
        cost: 24,
        effect: { attack: 80 },
        requires: 'attack_boost_14'
    },
    attack_boost_16: {
        name: 'Power Training XVI',
        emoji: 'ü™ì',
        description: '+85 Attack',
        cost: 27,
        effect: { attack: 85 },
        requires: 'attack_boost_15'
    },
    attack_boost_17: {
        name: 'Power Training XVII',
        emoji: 'üî™',
        description: '+90 Attack',
        cost: 30,
        effect: { attack: 90 },
        requires: 'attack_boost_16'
    },
    attack_boost_18: {
        name: 'Power Training XVIII',
        emoji: 'üóØÔ∏è',
        description: '+95 Attack',
        cost: 33,
        effect: { attack: 95 },
        requires: 'attack_boost_17'
    },
    attack_boost_19: {
        name: 'Power Training XIX',
        emoji: 'üí£',
        description: '+100 Attack',
        cost: 36,
        effect: { attack: 100 },
        requires: 'attack_boost_18'
    },
    attack_boost_20: {
        name: 'Power Training XX',
        emoji: 'üß®',
        description: '+110 Attack',
        cost: 40,
        effect: { attack: 110 },
        requires: 'attack_boost_19'
    },
    attack_boost_21: {
        name: 'Power Training XXI',
        emoji: 'üíÄ',
        description: '+120 Attack',
        cost: 44,
        effect: { attack: 120 },
        requires: 'attack_boost_20'
    },
    attack_boost_22: {
        name: 'Power Training XXII',
        emoji: '‚ö∞Ô∏è',
        description: '+130 Attack',
        cost: 48,
        effect: { attack: 130 },
        requires: 'attack_boost_21'
    },
    attack_boost_23: {
        name: 'Power Training XXIII',
        emoji: '‚ö±Ô∏è',
        description: '+140 Attack',
        cost: 52,
        effect: { attack: 140 },
        requires: 'attack_boost_22'
    },
    attack_boost_24: {
        name: 'Power Training XXIV',
        emoji: 'ü™¶',
        description: '+150 Attack',
        cost: 56,
        effect: { attack: 150 },
        requires: 'attack_boost_23'
    },
    attack_boost_25: {
        name: 'Power Training XXV',
        emoji: 'üè¥‚Äç‚ò†Ô∏è',
        description: '+170 Attack',
        cost: 61,
        effect: { attack: 170 },
        requires: 'attack_boost_24'
    },
    attack_boost_26: {
        name: 'Power Training XXVI',
        emoji: 'üñ§',
        description: '+190 Attack',
        cost: 66,
        effect: { attack: 190 },
        requires: 'attack_boost_25'
    },
    attack_boost_27: {
        name: 'Power Training XXVII',
        emoji: 'üëπ',
        description: '+210 Attack',
        cost: 71,
        effect: { attack: 210 },
        requires: 'attack_boost_26'
    },
    attack_boost_28: {
        name: 'Power Training XXVIII',
        emoji: 'üë∫',
        description: '+230 Attack',
        cost: 76,
        effect: { attack: 230 },
        requires: 'attack_boost_27'
    },
    attack_boost_29: {
        name: 'Power Training XXIX',
        emoji: 'ü§∫',
        description: '+250 Attack',
        cost: 81,
        effect: { attack: 250 },
        requires: 'attack_boost_28'
    },
    attack_boost_30: {
        name: 'Power Training XXX',
        emoji: 'üëë',
        description: '+300 Attack',
        cost: 87,
        effect: { attack: 300 },
        requires: 'attack_boost_29'
    },

    // Defense Boost (Level 1-20)
    defense_boost_1: {
        name: 'Defense Training I',
        emoji: 'üõ°Ô∏è',
        description: '+5 Defense',
        cost: 2,
        effect: { defense: 5 },
        requires: null
    },
    defense_boost_2: {
        name: 'Defense Training II',
        emoji: 'üõ†Ô∏è',
        description: '+10 Defense',
        cost: 4,
        effect: { defense: 10 },
        requires: 'defense_boost_1'
    },
    defense_boost_3: {
        name: 'Defense Training III',
        emoji: '‚öôÔ∏è',
        description: '+15 Defense',
        cost: 6,
        effect: { defense: 15 },
        requires: 'defense_boost_2'
    },
    defense_boost_4: {
        name: 'Defense Training IV',
        emoji: 'üî∞',
        description: '+20 Defense',
        cost: 8,
        effect: { defense: 20 },
        requires: 'defense_boost_3'
    },
    defense_boost_5: {
        name: 'Defense Training V',
        emoji: 'üè∞',
        description: '+30 Defense',
        cost: 10,
        effect: { defense: 30 },
        requires: 'defense_boost_4'
    },
    // Defense Boost Level 6-20
    defense_boost_6: {
        name: 'Defense Training VI',
        emoji: 'üèõÔ∏è',
        description: '+35 Defense',
        cost: 12,
        effect: { defense: 35 },
        requires: 'defense_boost_5'
    },
    defense_boost_7: {
        name: 'Defense Training VII',
        emoji: '‚õ™',
        description: '+40 Defense',
        cost: 14,
        effect: { defense: 40 },
        requires: 'defense_boost_6'
    },
    defense_boost_8: {
        name: 'Defense Training VIII',
        emoji: 'üèØ',
        description: '+45 Defense',
        cost: 16,
        effect: { defense: 45 },
        requires: 'defense_boost_7'
    },
    defense_boost_9: {
        name: 'Defense Training IX',
        emoji: 'üèüÔ∏è',
        description: '+50 Defense',
        cost: 18,
        effect: { defense: 50 },
        requires: 'defense_boost_8'
    },
    defense_boost_10: {
        name: 'Defense Training X',
        emoji: 'üïã',
        description: '+60 Defense',
        cost: 21,
        effect: { defense: 60 },
        requires: 'defense_boost_9'
    },
    defense_boost_11: {
        name: 'Defense Training XI',
        emoji: 'üóø',
        description: '+65 Defense',
        cost: 24,
        effect: { defense: 65 },
        requires: 'defense_boost_10'
    },
    defense_boost_12: {
        name: 'Defense Training XII',
        emoji: 'üèîÔ∏è',
        description: '+70 Defense',
        cost: 27,
        effect: { defense: 70 },
        requires: 'defense_boost_11'
    },
    defense_boost_13: {
        name: 'Defense Training XIII',
        emoji: '‚õ∞Ô∏è',
        description: '+75 Defense',
        cost: 30,
        effect: { defense: 75 },
        requires: 'defense_boost_12'
    },
    defense_boost_14: {
        name: 'Defense Training XIV',
        emoji: 'ü™®',
        description: '+80 Defense',
        cost: 33,
        effect: { defense: 80 },
        requires: 'defense_boost_13'
    },
    defense_boost_15: {
        name: 'Defense Training XV',
        emoji: '‚öíÔ∏è',
        description: '+90 Defense',
        cost: 37,
        effect: { defense: 90 },
        requires: 'defense_boost_14'
    },
    defense_boost_16: {
        name: 'Defense Training XVI',
        emoji: 'üî®',
        description: '+100 Defense',
        cost: 41,
        effect: { defense: 100 },
        requires: 'defense_boost_15'
    },
    defense_boost_17: {
        name: 'Defense Training XVII',
        emoji: '‚õèÔ∏è',
        description: '+110 Defense',
        cost: 45,
        effect: { defense: 110 },
        requires: 'defense_boost_16'
    },
    defense_boost_18: {
        name: 'Defense Training XVIII',
        emoji: 'üîß',
        description: '+120 Defense',
        cost: 49,
        effect: { defense: 120 },
        requires: 'defense_boost_17'
    },
    defense_boost_19: {
        name: 'Defense Training XIX',
        emoji: 'ü™õ',
        description: '+130 Defense',
        cost: 53,
        effect: { defense: 130 },
        requires: 'defense_boost_18'
    },
    defense_boost_20: {
        name: 'Defense Training XX',
        emoji: 'üî©',
        description: '+150 Defense',
        cost: 58,
        effect: { defense: 150 },
        requires: 'defense_boost_19'
    },

    // Speed Boost (Level 1-15)
    speed_boost_1: {
        name: 'Speed Training I',
        emoji: 'üí®',
        description: '+3 Speed',
        cost: 2,
        effect: { speed: 3 },
        requires: null
    },
    speed_boost_2: {
        name: 'Speed Training II',
        emoji: 'üå™Ô∏è',
        description: '+6 Speed',
        cost: 4,
        effect: { speed: 6 },
        requires: 'speed_boost_1'
    },
    speed_boost_3: {
        name: 'Speed Training III',
        emoji: 'üí´',
        description: '+9 Speed',
        cost: 6,
        effect: { speed: 9 },
        requires: 'speed_boost_2'
    },
    speed_boost_4: {
        name: 'Speed Training IV',
        emoji: '‚ö°',
        description: '+12 Speed',
        cost: 8,
        effect: { speed: 12 },
        requires: 'speed_boost_3'
    },
    speed_boost_5: {
        name: 'Speed Training V',
        emoji: 'üöÄ',
        description: '+18 Speed',
        cost: 10,
        effect: { speed: 18 },
        requires: 'speed_boost_4'
    },
    // Speed Boost Level 6-15
    speed_boost_6: {
        name: 'Speed Training VI',
        emoji: 'üèÉ‚Äç‚ôÇÔ∏è',
        description: '+21 Speed',
        cost: 12,
        effect: { speed: 21 },
        requires: 'speed_boost_5'
    },
    speed_boost_7: {
        name: 'Speed Training VII',
        emoji: 'üèÉ‚Äç‚ôÄÔ∏è',
        description: '+24 Speed',
        cost: 14,
        effect: { speed: 24 },
        requires: 'speed_boost_6'
    },
    speed_boost_8: {
        name: 'Speed Training VIII',
        emoji: 'ü§∏‚Äç‚ôÇÔ∏è',
        description: '+27 Speed',
        cost: 16,
        effect: { speed: 27 },
        requires: 'speed_boost_7'
    },
    speed_boost_9: {
        name: 'Speed Training IX',
        emoji: 'ü§∏‚Äç‚ôÄÔ∏è',
        description: '+30 Speed',
        cost: 18,
        effect: { speed: 30 },
        requires: 'speed_boost_8'
    },
    speed_boost_10: {
        name: 'Speed Training X',
        emoji: 'üèãÔ∏è‚Äç‚ôÇÔ∏è',
        description: '+35 Speed',
        cost: 21,
        effect: { speed: 35 },
        requires: 'speed_boost_9'
    },
    speed_boost_11: {
        name: 'Speed Training XI',
        emoji: 'üèãÔ∏è‚Äç‚ôÄÔ∏è',
        description: '+40 Speed',
        cost: 24,
        effect: { speed: 40 },
        requires: 'speed_boost_10'
    },
    speed_boost_12: {
        name: 'Speed Training XII',
        emoji: 'üö¥‚Äç‚ôÇÔ∏è',
        description: '+45 Speed',
        cost: 27,
        effect: { speed: 45 },
        requires: 'speed_boost_11'
    },
    speed_boost_13: {
        name: 'Speed Training XIII',
        emoji: 'üö¥‚Äç‚ôÄÔ∏è',
        description: '+50 Speed',
        cost: 30,
        effect: { speed: 50 },
        requires: 'speed_boost_12'
    },
    speed_boost_14: {
        name: 'Speed Training XIV',
        emoji: 'üèä‚Äç‚ôÇÔ∏è',
        description: '+55 Speed',
        cost: 33,
        effect: { speed: 55 },
        requires: 'speed_boost_13'
    },
    speed_boost_15: {
        name: 'Speed Training XV',
        emoji: 'üèä‚Äç‚ôÄÔ∏è',
        description: '+65 Speed',
        cost: 37,
        effect: { speed: 65 },
        requires: 'speed_boost_14'
    },

    // Special Skills
    jutsu_mastery: {
        name: 'Jutsu Mastery',
        emoji: '‚ú®',
        description: 'Unlock advanced jutsu',
        cost: 5,
        effect: { unlocksJutsu: true },
        requires: 'chakra_boost_1'
    },

    // Regeneration (Level 1-13)
    regeneration_1: {
        name: 'Regeneration I',
        emoji: 'üîÑ',
        description: 'Restore 5 HP each turn',
        cost: 4,
        effect: { regeneration: 5 },
        requires: 'hp_boost_1'
    },
    regeneration_2: {
        name: 'Regeneration II',
        emoji: '‚ôªÔ∏è',
        description: 'Restore 10 HP each turn',
        cost: 6,
        effect: { regeneration: 10 },
        requires: 'regeneration_1'
    },
    regeneration_3: {
        name: 'Regeneration III',
        emoji: 'üåø',
        description: 'Restore 15 HP each turn',
        cost: 8,
        effect: { regeneration: 15 },
        requires: 'regeneration_2'
    },
    regeneration_4: {
        name: 'Regeneration IV',
        emoji: 'üçÉ',
        description: 'Restore 20 HP each turn',
        cost: 10,
        effect: { regeneration: 20 },
        requires: 'regeneration_3'
    },
    regeneration_5: {
        name: 'Regeneration V',
        emoji: 'üå±',
        description: 'Restore 30 HP each turn',
        cost: 12,
        effect: { regeneration: 30 },
        requires: 'regeneration_4'
    },
    // Regeneration Level 6-13
    regeneration_6: {
        name: 'Regeneration VI',
        emoji: 'üå≥',
        description: 'Restore 35 HP each turn',
        cost: 14,
        effect: { regeneration: 35 },
        requires: 'regeneration_5'
    },
    regeneration_7: {
        name: 'Regeneration VII',
        emoji: 'üå≤',
        description: 'Restore 40 HP each turn',
        cost: 16,
        effect: { regeneration: 40 },
        requires: 'regeneration_6'
    },
    regeneration_8: {
        name: 'Regeneration VIII',
        emoji: 'üéã',
        description: 'Restore 45 HP each turn',
        cost: 18,
        effect: { regeneration: 45 },
        requires: 'regeneration_7'
    },
    regeneration_9: {
        name: 'Regeneration IX',
        emoji: 'üéç',
        description: 'Restore 50 HP each turn',
        cost: 20,
        effect: { regeneration: 50 },
        requires: 'regeneration_8'
    },
    regeneration_10: {
        name: 'Regeneration X',
        emoji: 'üå¥',
        description: 'Restore 60 HP each turn',
        cost: 23,
        effect: { regeneration: 60 },
        requires: 'regeneration_9'
    },
    regeneration_11: {
        name: 'Regeneration XI',
        emoji: 'üåæ',
        description: 'Restore 70 HP each turn',
        cost: 26,
        effect: { regeneration: 70 },
        requires: 'regeneration_10'
    },
    regeneration_12: {
        name: 'Regeneration XII',
        emoji: 'üå∫',
        description: 'Restore 80 HP each turn',
        cost: 29,
        effect: { regeneration: 80 },
        requires: 'regeneration_11'
    },
    regeneration_13: {
        name: 'Regeneration XIII',
        emoji: 'üå∏',
        description: 'Restore 100 HP each turn',
        cost: 33,
        effect: { regeneration: 100 },
        requires: 'regeneration_12'
    },

    // Critical Strike (Level 1-8)
    critical_strike_1: {
        name: 'Critical Strike I',
        emoji: '‚ö°',
        description: '15% chance for 2x damage',
        cost: 3,
        effect: { criticalChance: 15 },
        requires: 'attack_boost_1'
    },
    critical_strike_2: {
        name: 'Critical Strike II',
        emoji: 'üåü',
        description: '25% chance for 2.5x damage',
        cost: 6,
        effect: { criticalChance: 25, criticalMultiplier: 2.5 },
        requires: 'critical_strike_1'
    },
    critical_strike_3: {
        name: 'Critical Strike III',
        emoji: 'üí•',
        description: '35% chance for 3x damage',
        cost: 9,
        effect: { criticalChance: 35, criticalMultiplier: 3 },
        requires: 'critical_strike_2'
    },
    // Critical Strike Level 4-8
    critical_strike_4: {
        name: 'Critical Strike IV',
        emoji: 'üí¢',
        description: '40% chance for 3.2x damage',
        cost: 12,
        effect: { criticalChance: 40, criticalMultiplier: 3.2 },
        requires: 'critical_strike_3'
    },
    critical_strike_5: {
        name: 'Critical Strike V',
        emoji: 'üî•',
        description: '45% chance for 3.5x damage',
        cost: 15,
        effect: { criticalChance: 45, criticalMultiplier: 3.5 },
        requires: 'critical_strike_4'
    },
    critical_strike_6: {
        name: 'Critical Strike VI',
        emoji: '‚òÑÔ∏è',
        description: '50% chance for 3.8x damage',
        cost: 18,
        effect: { criticalChance: 50, criticalMultiplier: 3.8 },
        requires: 'critical_strike_5'
    },
    critical_strike_7: {
        name: 'Critical Strike VII',
        emoji: 'üíÄ',
        description: '55% chance for 4x damage',
        cost: 21,
        effect: { criticalChance: 55, criticalMultiplier: 4 },
        requires: 'critical_strike_6'
    },
    critical_strike_8: {
        name: 'Critical Strike VIII',
        emoji: 'üëë',
        description: '60% chance for 4.5x damage',
        cost: 25,
        effect: { criticalChance: 60, criticalMultiplier: 4.5 },
        requires: 'critical_strike_7'
    },

    elemental_mastery: {
        name: 'Elemental Mastery',
        emoji: 'üåü',
        description: '+50% elemental damage',
        cost: 6,
        effect: { elementalBonus: 0.5 },
        requires: 'jutsu_mastery'
    },

    // Elemental Mastery Level 2-4
    elemental_mastery_2: {
        name: 'Elemental Mastery II',
        emoji: 'üåà',
        description: '+75% elemental damage',
        cost: 10,
        effect: { elementalBonus: 0.75 },
        requires: 'elemental_mastery'
    },
    elemental_mastery_3: {
        name: 'Elemental Mastery III',
        emoji: 'üéÜ',
        description: '+100% elemental damage',
        cost: 15,
        effect: { elementalBonus: 1.0 },
        requires: 'elemental_mastery_2'
    },
    elemental_mastery_4: {
        name: 'Elemental Mastery IV',
        emoji: 'üéá',
        description: '+150% elemental damage',
        cost: 21,
        effect: { elementalBonus: 1.5 },
        requires: 'elemental_mastery_3'
    },

    // Halloween Skills
    dark_arts: {
        name: 'Dark Arts',
        emoji: 'üëª',
        description: 'Unlock Halloween jutsu',
        cost: 4,
        effect: { unlocksHalloweenJutsu: true },
        requires: 'jutsu_mastery',
        halloween: true
    },

    // Soul Harvester (Level 1-7)
    soul_harvester_1: {
        name: 'Soul Harvester I',
        emoji: 'üíÄ',
        description: '20% lifesteal on attacks',
        cost: 5,
        effect: { lifesteal: 0.2 },
        requires: 'dark_arts',
        halloween: true
    },
    soul_harvester_2: {
        name: 'Soul Harvester II',
        emoji: '‚ò†Ô∏è',
        description: '35% lifesteal on attacks',
        cost: 8,
        effect: { lifesteal: 0.35 },
        requires: 'soul_harvester_1',
        halloween: true
    },
    soul_harvester_3: {
        name: 'Soul Harvester III',
        emoji: 'üñ§',
        description: '50% lifesteal on attacks',
        cost: 11,
        effect: { lifesteal: 0.5 },
        requires: 'soul_harvester_2',
        halloween: true
    },
    // Soul Harvester Level 4-7
    soul_harvester_4: {
        name: 'Soul Harvester IV',
        emoji: '‚ö±Ô∏è',
        description: '60% lifesteal on attacks',
        cost: 15,
        effect: { lifesteal: 0.6 },
        requires: 'soul_harvester_3',
        halloween: true
    },
    soul_harvester_5: {
        name: 'Soul Harvester V',
        emoji: 'üï≥Ô∏è',
        description: '70% lifesteal on attacks',
        cost: 19,
        effect: { lifesteal: 0.7 },
        requires: 'soul_harvester_4',
        halloween: true
    },
    soul_harvester_6: {
        name: 'Soul Harvester VI',
        emoji: 'üëπ',
        description: '80% lifesteal on attacks',
        cost: 23,
        effect: { lifesteal: 0.8 },
        requires: 'soul_harvester_5',
        halloween: true
    },
    soul_harvester_7: {
        name: 'Soul Harvester VII',
        emoji: 'üòà',
        description: '100% lifesteal on attacks',
        cost: 28,
        effect: { lifesteal: 1.0 },
        requires: 'soul_harvester_6',
        halloween: true
    }
},

            quests: {
    first_victory: {
        name: 'First Victory',
        description: 'Win your first battle',
        emoji: '‚öîÔ∏è',
        progress: 0,
        target: 1,
        rewards: { exp: 100, gold: 200, item: 'kunai' },
        completed: false
    },
    defeat_5_enemies: {
        name: 'Ninja Hunter',
        description: 'Defeat 5 enemies',
        emoji: 'üéØ',
        progress: 0,
        target: 5,
        rewards: { exp: 250, gold: 400, item: 'ninja_vest' },
        completed: false
    },
    reach_level_5: {
        name: 'Rising Ninja',
        description: 'Reach level 5',
        emoji: '‚≠ê',
        progress: 0,
        target: 5,
        rewards: { exp: 500, gold: 600, skillPoints: 2 },
        completed: false
    },
    collect_1000_gold: {
        name: 'Wealthy Warrior',
        description: 'Collect 1000 gold',
        emoji: 'üí∞',
        progress: 0,
        target: 1000,
        rewards: { exp: 300, gold: 500, item: 'sage_necklace' },
        completed: false
    },
    use_10_jutsu: {
        name: 'Jutsu Master',
        description: 'Use jutsu 10 times',
        emoji: 'üåü',
        progress: 0,
        target: 10,
        rewards: { exp: 400, gold: 300, skillPoints: 3 },
        completed: false
    },
    defeat_boss: {
        name: 'Dragon Slayer',
        description: 'Defeat the Ancient Dragon',
        emoji: 'üê≤',
        progress: 0,
        target: 1,
        rewards: { exp: 1000, gold: 1500, item: 'legendary_blade' },
        completed: false
    },
    halloween_hunter: {
        name: 'Halloween Hunter',
        description: 'Defeat 10 Halloween enemies',
        emoji: 'üéÉ',
        progress: 0,
        target: 10,
        rewards: { exp: 800, gold: 1000, item: 'halloween_scythe' },
        completed: false,
        halloween: true
    },
    trick_or_treat: {
        name: 'Trick or Treat',
        description: 'Use Halloween jutsu 5 times',
        emoji: 'üëª',
        progress: 0,
        target: 5,
        rewards: { exp: 500, gold: 600, skillPoints: 3 },
        completed: false,
        halloween: true
    }
},

            milestones: {
                battles_10: {
                    battles: 10,
                    rewards: {
                        gold: 500,
                        exp: 300,
                        item: 'katana'
                    },
                    claimed: false
                },
                battles_25: {
                    battles: 25,
                    rewards: {
                        gold: 1000,
                        exp: 600,
                        skillPoints: 2,
                        jutsu: 'amaterasu'
                    },
                    claimed: false
                },
                battles_50: {
                    battles: 50,
                    rewards: {
                        gold: 2000,
                        exp: 1000,
                        item: 'akatsuki_robe',
                        jutsu: 'raikiri'
                    },
                    claimed: false
                },
                battles_75: {
                    battles: 75,
                    rewards: {
                        gold: 3000,
                        exp: 1500,
                        skillPoints: 3,
                        item: 'sharingan_lens'
                    },
                    claimed: false
                },
                battles_100: {
                    battles: 100,
                    rewards: {
                        gold: 5000,
                        exp: 2500,
                        item: 'celestial_sword',
                        jutsu: 'rasenshuriken'
                    },
                    claimed: false
                },
                battles_150: {
                    battles: 150,
                    rewards: {
                        gold: 7500,
                        exp: 3500,
                        skillPoints: 5,
                        item: 'sage_armor',
                        jutsu: 'inferno_style'
                    },
                    claimed: false
                },
                battles_300: {
                    battles: 300,
                    rewards: {
                        gold: 15000,
                        exp: 6000,
                        item: 'divine_katana',
                        item2: 'rinnegan_ring',
                        jutsu: 'perfect_susanoo'
                    },
                    claimed: false
                },
                battles_500: {
                    battles: 500,
                    rewards: {
                        gold: 25000,
                        exp: 10000,
                        skillPoints: 10,
                        item: 'immortal_vest',
                        item2: 'bijuu_seal',
                        jutsu: 'sage_mode'
                    },
                    claimed: false
                },
                battles_750: {
                    battles: 750,
                    rewards: {
                        gold: 50000,
                        exp: 20000,
                        skillPoints: 15,
                        allMilestoneGear: true
                    },
                    claimed: false
                }
            },

            events: {
                double_exp: {
                    name: 'Double EXP Weekend',
                    description: 'Get 2x experience from battles!',
                    emoji: '‚≠ê',
                    type: 'multiplier',
                    effect: { exp: 2 },
                    duration: '2 days',
                    active: false
                },
                rare_drops: {
                    name: 'Rare Drop Boost',
                    description: 'Increased chance for rare equipment by 20%!',
                    emoji: 'üíé',
                    type: 'drop_rate',
                    effect: { rareChance: 0.2 },
                    duration: '1 day',
                    active: false
                },
                gold_rush: {
                    name: 'Gold Rush',
                    description: '50% more gold from battles!',
                    emoji: 'üí∞',
                    type: 'multiplier',
                    effect: { gold: 1.5 },
                    duration: '3 days',
                    active: false
                },
                turkey_event: {
                    name: 'Turkey Event',
                    description: 'Turkey Event is live now!',
                    emoji: 'ü¶É',
                    duration: 'Permanent',
                    active: true
                },
                halloween_event: {
                    name: 'Halloween Spooktacular',
                    description: 'Special Halloween enemies and jutsu! Exclusive rewards available!',
                    emoji: 'üéÉ',
                    type: 'seasonal',
                    effect: { halloweenEnemies: true, halloweenJutsu: true },
                    duration: 'Permanent',
                    active: true
                },
                dragon_slayer: {
                    name: 'Dragon Slayer Event',
                    description: 'Dragon Slayer is live now!',
                    emoji: 'üêâ',
                    duration: 'Permanent',
                    active: true
                },
                demon_hunter: {
                    name: 'Demon Hunter Event',
                    description: 'Demon Hunter is live now, defeat the devil and become a true hunter!',
                    emoji: 'üëπ',
                    duration: 'Permanent',
                    active: true
                    },
                    fish_event: {
                    name: 'Fishing Event',
                    description: 'Fishing on Fisherman Lake!',
                    emoji: 'üé£',
                    duration: 'Afternoon - Midnight',
                    active: true
                    }
              }
        };

        // ===== GAME STATE =====
        
        let gameState = {
            currentScreen: 'mainScreen',
            player: null,
            enemy: null,
            selectedCharacter: null,
            battleInProgress: false,
            turn: 'player',
            gold: 0,
            currentBattleIndex: 0,
            totalBattles: 0,
            potions: {
                health_potion: 0,
                mega_health_potion: 0,
                chakra_potion: 0,
                elixir: 0
            },
            milestones: {},
            unlockedJutsus: []
        };

        // ===== UTILITY FUNCTIONS =====

        const Utils = {
            getElement: (id) => document.getElementById(id),
            
            showScreen: (screenId) => {
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });
    Utils.getElement(screenId).classList.add('active');
    gameState.currentScreen = screenId;

    const nav = Utils.getElement('bottomNav');
    if (['gameScreen', 'shopScreen', 'inventoryScreen', 'skillsScreen', 'milestonesScreen', 'questsScreen'].includes(screenId)) {
        nav.style.display = 'flex';
        Utils.updateNavigation(screenId);
    } else {
        nav.style.display = 'none';
    }

    // Update screen content
    if (screenId === 'shopScreen') Shop.updateDisplay();
    if (screenId === 'inventoryScreen') Inventory.updateDisplay();
    if (screenId === 'skillsScreen') Skills.updateDisplay();
    if (screenId === 'milestonesScreen') Milestones.updateDisplay(); // ‚Üê PENTING: Ini harus ada
    if (screenId === 'questsScreen') Quests.updateDisplay();
    if (screenId === 'eventsScreen') Events.updateDisplay();
},

            updateNavigation: (activeScreen) => {
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                const navMapping = {
                    'gameScreen': 'battleNavBtn',
                    'shopScreen': 'shopNavBtn',
                    'inventoryScreen': 'inventoryNavBtn',
                    'skillsScreen': 'skillsNavBtn',
                    'milestonesScreen': 'milestonesNavBtn',
                    'questsScreen': 'questsNavBtn'
                };

                const activeBtn = navMapping[activeScreen];
                if (activeBtn) {
                    Utils.getElement(activeBtn).classList.add('active');
                }
            },

            showModal: (modalId) => {
                Utils.getElement(modalId).classList.add('active');
            },

            hideModal: (modalId) => {
                Utils.getElement(modalId).classList.remove('active');
            },

            switchTab: (tabName, container) => {
                container.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                container.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                container.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                container.querySelector(`#${tabName}Tab`).classList.add('active');
            },

            getStatEmoji: (stat) => {
                const emojis = {
                    attack: '‚öîÔ∏è',
                    defense: 'üõ°Ô∏è',
                    speed: 'üí®',
                    maxHp: '‚ù§Ô∏è',
                    maxChakra: 'üíô'
                };
                return emojis[stat] || 'üìä';
            }
        };

        // ===== PLAYER MANAGEMENT =====

        const Player = {
            initialize: (character) => {
                gameState.player = {
                    name: character.name,
                    emoji: character.emoji,
                    element: character.element,
                    level: 1,
                    exp: 0,
                    expToNext: 100,
                    skillPoints: 0,
                    gold: 100,
                    inventory: ['kunai', 'cloth_armor'],
                    equipped: {
                        weapon: 'kunai',
                        armor: 'cloth_armor',
                        accessory: null
                    },
                    unlockedSkills: [],
                    statusEffects: [],
                    questProgress: JSON.parse(JSON.stringify(GameData.quests)),
                    stats: { ...character.baseStats }
                };
                gameState.potions = {
                    health_potion: 2,
                    mega_health_potion: 0,
                    chakra_potion: 1,
                    elixir: 0
                };
                gameState.totalBattles = 0;
                gameState.milestones = JSON.parse(JSON.stringify(GameData.milestones));
                gameState.unlockedJutsus = [];
                Player.updateStats();
            },

            updateStats: () => {
                if (!gameState.player) return;

                const char = gameState.selectedCharacter;
                let stats = { ...char.baseStats };

                // Apply equipment bonuses
                Object.values(gameState.player.equipped).forEach(itemId => {
                    if (itemId && GameData.equipment[itemId]) {
                        const item = GameData.equipment[itemId];
                        Object.entries(item.stats).forEach(([stat, value]) => {
                            stats[stat] = (stats[stat] || 0) + value;
                        });
                    }
                });

                // Apply skill bonuses
                gameState.player.unlockedSkills.forEach(skillId => {
                    const skill = GameData.skills[skillId];
                    if (skill && skill.effect) {
                        Object.entries(skill.effect).forEach(([stat, value]) => {
                            if (typeof value === 'number') {
                                stats[stat] = (stats[stat] || 0) + value;
                            }
                        });
                    }
                });

                const hpRatio = gameState.player.stats.hp / gameState.player.stats.maxHp;
                const chakraRatio = gameState.player.stats.chakra / gameState.player.stats.maxChakra;

                gameState.player.stats = stats;
                gameState.player.stats.hp = Math.min(gameState.player.stats.hp, Math.floor(stats.maxHp * hpRatio));
                gameState.player.stats.chakra = Math.min(gameState.player.stats.chakra, Math.floor(stats.maxChakra * chakraRatio));
            },

            usePotion: (potionId) => {
                if (gameState.potions[potionId] <= 0) {
                    Battle.addLog("‚ùå No potions left!");
                    return;
                }

                const potion = GameData.potions[potionId];
                gameState.potions[potionId]--;

                if (potion.effect.type === 'heal') {
                    gameState.player.stats.hp = Math.min(
                        gameState.player.stats.maxHp,
                        gameState.player.stats.hp + potion.effect.value
                    );
                    Battle.addLog(`üíö Used ${potion.name}! Restored ${potion.effect.value} HP!`);
                } else if (potion.effect.type === 'chakra') {
                    gameState.player.stats.chakra = Math.min(
                        gameState.player.stats.maxChakra,
                        gameState.player.stats.chakra + potion.effect.value
                    );
                    Battle.addLog(`üíô Used ${potion.name}! Restored ${potion.effect.value} Chakra!`);
                } else if (potion.effect.type === 'full') {
                    gameState.player.stats.hp = gameState.player.stats.maxHp;
                    gameState.player.stats.chakra = gameState.player.stats.maxChakra;
                    Battle.addLog(`‚ú® Used ${potion.name}! Fully restored!`);
                }

                Display.updateAll();
            }
        };

        // ===== MILESTONE SYSTEM =====

        const Milestones = {
            updateDisplay: () => {
                const container = Utils.getElement('milestonesList');
                const badge = Utils.getElement('milestoneCountBadge');
                
                if (!container || !badge) {
                    console.log('Milestone elements not found');
                    return;
                }
                
                // Ensure milestones exist
                if (!gameState.milestones || Object.keys(gameState.milestones).length === 0) {
                    gameState.milestones = JSON.parse(JSON.stringify(GameData.milestones));
                }
                
                badge.textContent = `${gameState.totalBattles || 0} Battles`;
                container.innerHTML = '';

                const sortedMilestones = Object.entries(gameState.milestones).sort((a, b) => 
                    a[1].battles - b[1].battles
                );

                if (sortedMilestones.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #888; padding: 40px;">No milestones available</div>';
                    return;
                }

                sortedMilestones.forEach(([milestoneId, milestone]) => {
            const card = document.createElement('div');
            const progress = Math.min(gameState.totalBattles, milestone.battles);
            const progressPercent = (progress / milestone.battles) * 100;
            const isUnlocked = gameState.totalBattles >= milestone.battles && !milestone.claimed;
            const isCompleted = milestone.claimed;

            card.className = `milestone-card ${isCompleted ? 'completed' : ''} ${isUnlocked ? 'unlocked' : ''}`;
            
            let rewardsHTML = '<div class="milestone-rewards">';
            if (milestone.rewards.gold) {
                rewardsHTML += `<div class="milestone-reward-item"><span style="font-size: 1.5em;">üí∞</span> <span>${milestone.rewards.gold} Gold</span></div>`;
            }
            if (milestone.rewards.exp) {
                rewardsHTML += `<div class="milestone-reward-item"><span style="font-size: 1.5em;">‚≠ê</span> <span>${milestone.rewards.exp} EXP</span></div>`;
            }
            if (milestone.rewards.skillPoints) {
                rewardsHTML += `<div class="milestone-reward-item"><span style="font-size: 1.5em;">üíé</span> <span>${milestone.rewards.skillPoints} Skill Points</span></div>`;
            }
            if (milestone.rewards.item) {
                const item = GameData.equipment[milestone.rewards.item];
                if (item) {
                    rewardsHTML += `<div class="milestone-reward-item"><span style="font-size: 1.5em;">${item.emoji}</span> <span>${item.name}</span></div>`;
                }
            }
            if (milestone.rewards.item2) {
                const item2 = GameData.equipment[milestone.rewards.item2];
                if (item2) {
                    rewardsHTML += `<div class="milestone-reward-item"><span style="font-size: 1.5em;">${item2.emoji}</span> <span>${item2.name}</span></div>`;
                }
            }
            if (milestone.rewards.jutsu) {
                const jutsu = GameData.jutsus[milestone.rewards.jutsu];
                if (jutsu) {
                    rewardsHTML += `<div class="milestone-reward-item"><span style="font-size: 1.5em;">${jutsu.emoji}</span> <span>${jutsu.name} Jutsu</span></div>`;
                }
            }
            if (milestone.rewards.allMilestoneGear) {
                rewardsHTML += `<div class="milestone-reward-item"><span style="font-size: 1.5em;">üåü</span> <span>All Milestone Gear!</span></div>`;
            }
            rewardsHTML += '</div>';

            card.innerHTML = `
                <div class="milestone-header">
                    <div class="milestone-title">
                        <span style="font-size: 1.5em;">üèÜ</span>
                        <span>${milestone.battles} Battles</span>
                    </div>
                    ${isCompleted ? '<span style="color: #2ecc71; font-size: 1.2em;">‚úÖ Claimed</span>' : 
                      isUnlocked ? '<span style="color: #f39c12; font-size: 1.2em;">üéÅ Ready!</span>' : ''}
                </div>
                
                <div class="milestone-progress">
                    <div class="milestone-progress-fill" style="width: ${progressPercent}%"></div>
                </div>
                <div style="text-align: center; margin: 10px 0; font-size: 0.9em; color: #bbb;">
                    ${progress} / ${milestone.battles} battles
                </div>

                <h4 style="margin: 15px 0 10px 0; color: var(--secondary-color);">Rewards:</h4>
                ${rewardsHTML}

                ${isUnlocked ? '<button class="claim-button">Claim Rewards</button>' : ''}
            `;

            if (isUnlocked) {
                card.querySelector('.claim-button').onclick = () => Milestones.claimReward(milestoneId);
            }

            container.appendChild(card);
        });
        
        console.log('Milestone rendered:', container.children.length, 'cards');
    },

    claimReward: (milestoneId) => {
        const milestone = gameState.milestones[milestoneId];
        if (!milestone || milestone.claimed || gameState.totalBattles < milestone.battles) return;

        let rewardText = '<div style="margin: 20px 0;">';
        
        if (milestone.rewards.gold) {
            gameState.player.gold += milestone.rewards.gold;
            gameState.gold = gameState.player.gold;
            rewardText += `<div style="margin: 10px 0; font-size: 1.1em;">üí∞ +${milestone.rewards.gold} Gold</div>`;
        }
        
        if (milestone.rewards.exp) {
            gameState.player.exp += milestone.rewards.exp;
            rewardText += `<div style="margin: 10px 0; font-size: 1.1em;">‚≠ê +${milestone.rewards.exp} EXP</div>`;
            
            while (gameState.player.exp >= gameState.player.expToNext) {
                gameState.player.exp -= gameState.player.expToNext;
                gameState.player.level++;
                gameState.player.expToNext = gameState.player.level * 100;
                gameState.player.skillPoints += 1;
                gameState.player.stats.hp = gameState.player.stats.maxHp;
                gameState.player.stats.chakra = gameState.player.stats.maxChakra;
                rewardText += `<div style="color: #2ecc71; margin: 10px 0;">üéä Level Up! Now level ${gameState.player.level}!</div>`;
            }
        }
        
        if (milestone.rewards.skillPoints) {
            gameState.player.skillPoints += milestone.rewards.skillPoints;
            rewardText += `<div style="margin: 10px 0; font-size: 1.1em;">üíé +${milestone.rewards.skillPoints} Skill Points</div>`;
        }
        
        if (milestone.rewards.item) {
            const item = GameData.equipment[milestone.rewards.item];
            gameState.player.inventory.push(milestone.rewards.item);
            rewardText += `<div style="margin: 10px 0; font-size: 1.1em;">${item.emoji} ${item.name}</div>`;
        }
        
        if (milestone.rewards.item2) {
            const item2 = GameData.equipment[milestone.rewards.item2];
            gameState.player.inventory.push(milestone.rewards.item2);
            rewardText += `<div style="margin: 10px 0; font-size: 1.1em;">${item2.emoji} ${item2.name}</div>`;
        }
        
        if (milestone.rewards.jutsu) {
            const jutsu = GameData.jutsus[milestone.rewards.jutsu];
            gameState.unlockedJutsus.push(milestone.rewards.jutsu);
            rewardText += `<div style="margin: 10px 0; font-size: 1.1em;">${jutsu.emoji} ${jutsu.name} Jutsu Unlocked!</div>`;
        }
        
        if (milestone.rewards.allMilestoneGear) {
            const milestoneGear = Object.entries(GameData.equipment).filter(([id, item]) => item.milestone);
            milestoneGear.forEach(([id, item]) => {
                if (!gameState.player.inventory.includes(id)) {
                    gameState.player.inventory.push(id);
                }
            });
            rewardText += `<div style="margin: 10px 0; font-size: 1.1em;">üåü All Milestone Equipment Unlocked!</div>`;
        }
        
        rewardText += '</div>';
        
        milestone.claimed = true;
        
        Utils.getElement('milestoneRewardText').innerHTML = rewardText;
        Utils.showModal('milestoneModal');
        
        Milestones.updateDisplay();
        Display.updateAll();
        Storage.save();
    },

    checkMilestone: () => {
        Object.entries(gameState.milestones).forEach(([milestoneId, milestone]) => {
            if (!milestone.claimed && gameState.totalBattles >= milestone.battles) {
                Battle.addLog(`üèÜ Milestone reached: ${milestone.battles} battles!`);
            }
        });
    }
};

        // ===== BATTLE SYSTEM =====

        const Battle = {
            start: () => {
                let enemyPool = [...GameData.enemies];
                
                // Filter Halloween enemies based on event
                if (GameData.events.halloween_event.active) {
                    // Mix regular and Halloween enemies
                    enemyPool = enemyPool.filter(e => !e.halloween || Math.random() > 0.5);
                } else {
                    // Remove Halloween enemies if event is not active
                    enemyPool = enemyPool.filter(e => !e.halloween);
                }

                if (gameState.currentBattleIndex >= enemyPool.length) {
                    gameState.currentBattleIndex = 0;
                }

                gameState.enemy = { ...enemyPool[Math.floor(Math.random() * enemyPool.length)] };
                gameState.battleInProgress = true;
                gameState.turn = 'player';

                Display.updateAll();
                Battle.setupActionButtons();
                Battle.addLog(`üéØ A ${gameState.enemy.name} appears!`);

                // Apply Halloween theme if fighting Halloween enemy
                if (gameState.enemy.halloween) {
                    document.body.classList.add('halloween-theme');
                } else {
                    document.body.classList.remove('halloween-theme');
                }
            },

            setupActionButtons: () => {
                const container = Utils.getElement('actionButtons');
                container.innerHTML = '';

                const availableJutsu = Battle.getAvailableJutsu();

                availableJutsu.forEach(jutsuId => {
                    const jutsu = GameData.jutsus[jutsuId];
                    const button = document.createElement('button');
                    button.className = 'action-btn';
                    
                    const canUse = gameState.player.stats.chakra >= jutsu.chakraCost;
                    if (!canUse) {
                        button.disabled = true;
                    }

                    button.onclick = () => Battle.useJutsu(jutsuId);

                    let costDisplay = '';
                    if (jutsu.chakraCost > 0) {
                        costDisplay = `<div class="btn-cost">${jutsu.chakraCost}</div>`;
                    }

                    button.innerHTML = `
                        ${costDisplay}
                        <div class="btn-icon">${jutsu.emoji}</div>
                        <div class="btn-name">${jutsu.name}</div>
                    `;

                    container.appendChild(button);
                });

                // Add potion buttons
                Object.keys(gameState.potions).forEach(potionId => {
                    if (gameState.potions[potionId] > 0) {
                        const potion = GameData.potions[potionId];
                        const button = document.createElement('button');
                        button.className = 'action-btn';
                        button.style.background = 'linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)';
                        
                        button.onclick = () => {
                            Player.usePotion(potionId);
                            Battle.setupActionButtons();
                        };

                        button.innerHTML = `
                            <div class="btn-cost">x${gameState.potions[potionId]}</div>
                            <div class="btn-icon">${potion.emoji}</div>
                            <div class="btn-name">${potion.name}</div>
                        `;

                        container.appendChild(button);
                    }
                });
            },

            getAvailableJutsu: () => {
    const basic = ['basic_attack', 'heal', 'chakra_boost', 'defend'];
    const element = gameState.player.element;
    const characterId = gameState.player.id;
    const level = gameState.player.level;
    
    let jutsuList = [...basic];

    // ========== ELEMENT-SPECIFIC JUTSU ==========
    
    // FIRE ELEMENT
    if (element === 'fire') {
        jutsuList.push('fireball');
        if (level >= 3) jutsuList.push('phoenix_flame');
        if (level >= 5) jutsuList.push('hinokami_kagura');
        if (level >= 7) jutsuList.push('magma_eruption');
        if (level >= 10) jutsuList.push('ap_shot');
        if (level >= 25) jutsuList.push('amaterasu');
    }
    
    // LIGHTNING ELEMENT
    else if (element === 'lightning') {
        jutsuList.push('lightning_blade');
        if (level >= 3) jutsuList.push('chidori');
        if (level >= 5) jutsuList.push('flying_raijin');
        if (level >= 7) jutsuList.push('lightning_storm');
        if (level >= 10) jutsuList.push('gravity_beam');
        if (level >= 20) jutsuList.push('raikiri');
        if (level >= 25) jutsuList.push('karma_seal');
    }
    
    // WIND ELEMENT
    else if (element === 'wind') {
        jutsuList.push('wind_blade');
        if (level >= 4) jutsuList.push('rasengan');
        if (level >= 6) jutsuList.push('shadow_clone');
        if (level >= 8) jutsuList.push('wind_spirit_dive');
        if (level >= 10) jutsuList.push('tornado');
        if (level >= 12) jutsuList.push('vanishing_rasengan');
        if (level >= 25) jutsuList.push('rasenshuriken');
        if (level >= 30) jutsuList.push('kamui');
    }
    
    // EARTH ELEMENT
    else if (element === 'earth') {
        jutsuList.push('earth_wall', 'earth_spear');
        if (level >= 5) jutsuList.push('sand_coffin');
        if (level >= 7) jutsuList.push('earthquake');
        if (level >= 10) jutsuList.push('meteor_strike');
    }
    
    // WATER ELEMENT
    else if (element === 'water') {
        jutsuList.push('water_wall');
        if (level >= 3) jutsuList.push('water_dragon');
        if (level >= 5) jutsuList.push('water_breathing');
        if (level >= 8) jutsuList.push('tsunami');
        if (level >= 10) jutsuList.push('ice_prison');
    }
    
    // ICE ELEMENT
    else if (element === 'ice') {
        jutsuList.push('ice_wall');
        if (level >= 3) jutsuList.push('ice_prison');
        if (level >= 5) jutsuList.push('blizzard');
        if (level >= 8) jutsuList.push('flashfreeze_heatwave');
    }
    
    // DARK ELEMENT
    else if (element === 'dark') {
        jutsuList.push('black_slash');
        if (level >= 3) jutsuList.push('void_blast');
        if (level >= 5) jutsuList.push('dark_cloaked_slash');
        if (level >= 7) jutsuList.push('black_meteorite');
        if (level >= 10) jutsuList.push('black_flash');
        if (level >= 12) jutsuList.push('gravity_crush');
        if (level >= 30) jutsuList.push('unlimited_void');
    }

    // ========== CHARACTER-SPECIFIC JUTSU ==========
    
    // NARUTO
    if (characterId === 'naruto') {
        if (level >= 5) jutsuList.push('shadow_clone');
        if (level >= 8) jutsuList.push('summoning_jutsu');
        if (level >= 10) jutsuList.push('sexy_jutsu');
    }
    
    // SASUKE
    else if (characterId === 'sasuke') {
        if (level >= 5) jutsuList.push('chidori');
        if (level >= 10) jutsuList.push('amaterasu');
    }
    
    // KAKASHI
    else if (characterId === 'kakashi') {
        if (level >= 5) jutsuList.push('raikiri');
        if (level >= 8) jutsuList.push('kamui');
        if (level >= 10) jutsuList.push('lightning_blade');
    }
    
    // MADARA
    else if (characterId === 'madara') {
        if (level >= 12) jutsuList.push('planetary_devastation');
    }
    
    // MINATO
    else if (characterId === 'minato') {
        if (level >= 5) jutsuList.push('flying_raijin');
        if (level >= 8) jutsuList.push('rasengan');
    }
    
    // ITACHI
    else if (characterId === 'itachi') {
        if (level >= 5) jutsuList.push('amaterasu');
        if (level >= 8) jutsuList.push('tsukuyomi');
    }
    
    // BORUTO
    else if (characterId === 'boruto') {
        if (level >= 5) jutsuList.push('vanishing_rasengan');
        if (level >= 8) jutsuList.push('karma_seal');
    }
    
    // KAWAKI
    else if (characterId === 'kawaki') {
        if (level >= 5) jutsuList.push('karma_seal');
        if (level >= 8) jutsuList.push('fireball');
    }
    
    // ASTA
    else if (characterId === 'asta') {
        if (level >= 3) jutsuList.push('black_slash');
        if (level >= 7) jutsuList.push('black_meteorite');
    }
    
    // YUNO
    else if (characterId === 'yuno') {
        if (level >= 3) jutsuList.push('wind_blade');
        if (level >= 7) jutsuList.push('wind_spirit_dive');
    }
    
    // YAMI
    else if (characterId === 'yami') {
        if (level >= 5) jutsuList.push('dark_cloaked_slash');
        if (level >= 10) jutsuList.push('void_blast');
    }
    
    // DEKU
    else if (characterId === 'deku') {
        if (level >= 5) jutsuList.push('delaware_smash');
        if (level >= 10) jutsuList.push('one_for_all_100');
    }
    
    // BAKUGO
    else if (characterId === 'bakugo') {
        if (level >= 5) jutsuList.push('ap_shot');
        if (level >= 8) jutsuList.push('magma_eruption');
    }
    
    // TODOROKI
    else if (characterId === 'todoroki') {
        if (level >= 5) jutsuList.push('ice_wall');
        if (level >= 10) jutsuList.push('flashfreeze_heatwave');
    }
    
    // ALL MIGHT
    else if (characterId === 'allmight') {
        if (level >= 8) jutsuList.push('one_for_all_100');
        if (level >= 12) jutsuList.push('divine_judgment');
    }
    
    // GODZILLA
    else if (characterId === 'godzilla') {
        if (level >= 5) jutsuList.push('atomic_breath');
        if (level >= 10) jutsuList.push('tail_whip');
    }
    
    // KING GHIDORAH
    else if (characterId === 'king_ghidorah') {
        if (level >= 5) jutsuList.push('gravity_beam');
        if (level >= 10) jutsuList.push('lightning_storm');
    }
    
    // MOTHRA
    else if (characterId === 'mothra') {
        if (level >= 5) jutsuList.push('god_rays');
        if (level >= 8) jutsuList.push('solar_flare');
    }
    
    // RODAN
    else if (characterId === 'rodan') {
        if (level >= 5) jutsuList.push('fireball');
        if (level >= 8) jutsuList.push('tornado');
    }
    
    // MECHAGODZILLA
    else if (characterId === 'mechagodzilla') {
        if (level >= 5) jutsuList.push('gravity_beam');
        if (level >= 10) jutsuList.push('chaos_beam');
    }
    
    // KONG
    else if (characterId === 'kong') {
        if (level >= 5) jutsuList.push('earthquake');
        if (level >= 8) jutsuList.push('meteor_strike');
    }
    
    // DESTOROYAH
    else if (characterId === 'destoroyah') {
        if (level >= 5) jutsuList.push('void_blast');
        if (level >= 10) jutsuList.push('apocalypse');
    }
    
    // BIOLLANTE
    else if (characterId === 'biollante') {
        if (level >= 5) jutsuList.push('poison_mist');
        if (level >= 8) jutsuList.push('blood_manipulation');
    }
    
    // TANJIRO
    else if (characterId === 'tanjiro') {
        if (level >= 5) jutsuList.push('water_breathing');
        if (level >= 10) jutsuList.push('hinokami_kagura');
    }
    
    // GIYU
    else if (characterId === 'giyu') {
        if (level >= 5) jutsuList.push('water_breathing');
        if (level >= 8) jutsuList.push('water_dragon');
    }
    
    // EREN
    else if (characterId === 'eren') {
        if (level >= 5) jutsuList.push('titan_transformation');
        if (level >= 10) jutsuList.push('earthquake');
    }
    
    // LEVI
    else if (characterId === 'levi') {
        if (level >= 5) jutsuList.push('thunder_spear');
        if (level >= 8) jutsuList.push('wind_blade');
    }
    
    // GOKU
    else if (characterId === 'goku') {
        if (level >= 5) jutsuList.push('kamehameha');
        if (level >= 10) jutsuList.push('solar_flare');
        if (level >= 15) jutsuList.push('genesis');
    }
    
    // VEGETA
    else if (characterId === 'vegeta') {
        if (level >= 5) jutsuList.push('galick_gun');
        if (level >= 10) jutsuList.push('final_flash');
        if (level >= 15) jutsuList.push('big_bang_attack');
    }
    
    // LUFFY
    else if (characterId === 'luffy') {
        if (level >= 5) jutsuList.push('gomu_gomu_gatling');
        if (level >= 10) jutsuList.push('power_up');
    }
    
    // ZORO
    else if (characterId === 'zoro') {
        if (level >= 5) jutsuList.push('oni_giri');
        if (level >= 10) jutsuList.push('tornado');
    }
    
    // YUJI
    else if (characterId === 'yuji') {
        if (level >= 5) jutsuList.push('black_flash');
        if (level >= 10) jutsuList.push('blood_manipulation');
    }
    
    // GOJO
    else if (characterId === 'gojo') {
        if (level >= 8) jutsuList.push('unlimited_void');
        if (level >= 12) jutsuList.push('infinity');
    }

    // ========== UNIVERSAL JUTSU (Available to all at certain levels) ==========
    
    if (level >= 8) {
        jutsuList.push('barrier_shield');
    }
    
    if (level >= 10) {
        jutsuList.push('speed_boost', 'power_up');
    }
    
    if (level >= 12) {
        jutsuList.push('regeneration', 'meditation');
    }
    
    if (level >= 15) {
        jutsuList.push('mirror_shield', 'energy_drain');
    }
    
    if (level >= 18) {
        jutsuList.push('time_stop', 'paralyzing_touch');
    }
    
    if (level >= 20) {
        jutsuList.push('poison_mist', 'bone_spear');
    }
    
    if (level >= 25) {
        jutsuList.push('solar_flare', 'chaos_beam');
    }
    
    // ULTIMATE JUTSU (Level-based)
    if (level >= 28) {
        jutsuList.push('eight_gates');
    }
    
    if (level >= 30) {
        jutsuList.push('divine_judgment');
    }
    
    if (level >= 32) {
        jutsuList.push('apocalypse');
    }
    
    if (level >= 35) {
        jutsuList.push('genesis', 'infinity');
    }
    
    if (level >= 40) {
        jutsuList.push('final_flash', 'big_bang_attack');
    }

    // ========== MILESTONE JUTSU (Unlock-based only) ==========
    
    if (gameState.unlockedJutsus.includes('inferno_style')) {
        jutsuList.push('inferno_style');
    }
    if (gameState.unlockedJutsus.includes('perfect_susanoo')) {
        jutsuList.push('perfect_susanoo');
    }
    if (gameState.unlockedJutsus.includes('sage_mode')) {
        jutsuList.push('sage_mode');
    }

    // ========== HALLOWEEN SPECIAL JUTSU ==========
    
    if (GameData.events.halloween_event.active && 
        gameState.player.unlockedSkills.includes('dark_arts')) {
        jutsuList.push('shadow_curse', 'pumpkin_bomb', 'soul_drain');
    }

    // Remove duplicates
    return [...new Set(jutsuList)];
},

            useJutsu: (jutsuId) => {
                if (!gameState.battleInProgress || gameState.turn !== 'player') return;

                const jutsu = GameData.jutsus[jutsuId];
                
                if (gameState.player.stats.chakra < jutsu.chakraCost) {
                    Battle.addLog("‚ùå Not enough chakra!");
                    return;
                }

                gameState.player.stats.chakra -= jutsu.chakraCost;

                if (jutsu.damage) {
                    if (jutsu.damage > 0) {
                        let damage = Battle.calculateDamage(jutsu.damage);
                        
                        // Critical strike
                        if (gameState.player.unlockedSkills.includes('critical_strike') && Math.random() < 0.15) {
                            damage *= 2;
                            Battle.addLog(`üí• Critical hit!`);
                            Battle.showJutsuAnimation(jutsu.emoji);
                        }

                        // Lifesteal
                        if (gameState.player.unlockedSkills.includes('soul_harvester') || jutsu.effect?.type === 'lifesteal') {
                            const lifesteal = Math.floor(damage * (jutsu.effect?.value || 0.2));
                            gameState.player.stats.hp = Math.min(
                                gameState.player.stats.maxHp,
                                gameState.player.stats.hp + lifesteal
                            );
                            Battle.addLog(`üíö Drained ${lifesteal} HP!`);
                        }

                        gameState.enemy.hp -= damage;
                        Battle.addLog(`‚öîÔ∏è ${gameState.player.name} uses ${jutsu.name}! Deals ${damage} damage.`);
                        Battle.showDamageNumber(damage, 'enemy');
                        
                        Quests.updateProgress('use_10_jutsu', 1);
                        if (jutsu.halloween) {
                            Quests.updateProgress('trick_or_treat', 1);
                        }s                        
                    } else {
                        const healAmount = Math.abs(jutsu.damage);
                        gameState.player.stats.hp = Math.min(
                            gameState.player.stats.maxHp, 
                            gameState.player.stats.hp + healAmount
                        );
                        Battle.addLog(`üíö ${gameState.player.name} heals for ${healAmount} HP!`);
                        Battle.showDamageNumber(healAmount, 'player', 'heal');
                    }
                } else if (jutsu.effect) {
                    Battle.applyJutsuEffect(jutsu.effect);
                    Battle.addLog(`‚ú® ${gameState.player.name} uses ${jutsu.name}!`);
                }

                if (gameState.enemy.hp <= 0) {
                    Battle.victory();
                    return;
                }

                gameState.turn = 'enemy';
                setTimeout(Battle.enemyTurn, 1000);
                
                Display.updateAll();
                Battle.setupActionButtons();
            },

            calculateDamage: (baseDamage) => {
                const playerAttack = gameState.player.stats.attack;
                const enemyDefense = gameState.enemy.defense;
                
                let damage = Math.floor(baseDamage * playerAttack * (Math.random() * 0.4 + 0.8));
                damage = Math.max(1, damage - enemyDefense);
                
                if (gameState.player.unlockedSkills.includes('elemental_mastery') && baseDamage > 1) {
                    damage = Math.floor(damage * 1.5);
                }
                
                return damage;
            },

            applyJutsuEffect: (effect) => {
                if (effect.type === 'chakra') {
                    gameState.player.stats.chakra = Math.min(
                        gameState.player.stats.maxChakra,
                        gameState.player.stats.chakra + effect.value
                    );
                } else if (effect.type === 'defense') {
                    Battle.addLog(`üõ°Ô∏è Defense increased!`);
                }
            },

            enemyTurn: () => {
                if (!gameState.battleInProgress || gameState.enemy.hp <= 0) return;

                const damage = Math.floor(gameState.enemy.attack * (Math.random() * 0.4 + 0.8));
                const actualDamage = Math.max(1, damage - gameState.player.stats.defense);
                
                gameState.player.stats.hp -= actualDamage;
                Battle.addLog(`üí• ${gameState.enemy.name} attacks for ${actualDamage} damage!`);
                Battle.showDamageNumber(actualDamage, 'player');

                if (gameState.player.unlockedSkills.includes('regeneration')) {
                    gameState.player.stats.hp = Math.min(
                        gameState.player.stats.maxHp,
                        gameState.player.stats.hp + 5
                    );
                    Battle.addLog(`üîÑ Regeneration heals 5 HP!`);
                }

                if (gameState.player.stats.hp <= 0) {
                    Battle.defeat();
                    return;
                }

                gameState.turn = 'player';
                Display.updateAll();
                Battle.setupActionButtons();
            },

            victory: () => {
                gameState.battleInProgress = false;
                gameState.totalBattles++;
                
                const expGained = gameState.enemy.exp;
                const goldGained = gameState.enemy.gold;
                
                const expMultiplier = GameData.events.double_exp.active ? 2 : 1;
                const goldMultiplier = GameData.events.gold_rush.active ? 1.5 : 1;
                
                const finalExp = Math.floor(expGained * expMultiplier);
                const finalGold = Math.floor(goldGained * goldMultiplier);
                
                gameState.player.exp += finalExp;
                gameState.player.gold += finalGold;
                gameState.gold = gameState.player.gold;

                let leveledUp = false;
                while (gameState.player.exp >= gameState.player.expToNext) {
                    leveledUp = true;
                    gameState.player.exp -= gameState.player.expToNext;
                    gameState.player.level++;
                    gameState.player.expToNext = gameState.player.level * 100;
                    
                    let skillPointsGained = 1;
                    if (GameData.events.skill_point_bonus?.active) {
                        skillPointsGained += 1;
                    }
                    gameState.player.skillPoints += skillPointsGained;
                    
                    gameState.player.stats.hp = gameState.player.stats.maxHp;
                    gameState.player.stats.chakra = gameState.player.stats.maxChakra;
                }

                let droppedItem = null;
                const dropChance = GameData.events.rare_drops.active ? 0.4 : 0.2;
                if (Math.random() < dropChance) {
                    const equipmentKeys = Object.keys(GameData.equipment);
                    const randomItem = equipmentKeys[Math.floor(Math.random() * equipmentKeys.length)];
                    droppedItem = randomItem;
                    gameState.player.inventory.push(randomItem);
                }

                Quests.updateProgress('first_victory', 1);
                Quests.updateProgress('defeat_5_enemies', 1);
                Quests.updateProgress('collect_1000_gold', finalGold);
                Quests.updateProgress('reach_level_5', gameState.player.level);
                
                if (gameState.enemy.name === 'Ancient Dragon') {
                    Quests.updateProgress('defeat_boss', 1);
                }

                if (gameState.enemy.halloween) {
                    Quests.updateProgress('halloween_hunter', 1);
                }

                // Check milestones
                Milestones.checkMilestone();

                let victoryText = `
                    <div style="margin: 20px 0;">
                        <div style="font-size: 1.2em; margin: 10px 0;">üéâ Defeated ${gameState.enemy.name}!</div>
                        <div style="color: #f39c12;">üí∞ +${finalGold} Gold</div>
                        <div style="color: #3498db;">‚≠ê +${finalExp} EXP</div>
                        ${leveledUp ? `<div style="color: #2ecc71;">üéä Level Up! Now level ${gameState.player.level}!</div>` : ''}
                        ${droppedItem ? `<div style="color: #9b59b6;">üéÅ Found: ${GameData.equipment[droppedItem].name}!</div>` : ''}
                    </div>
                `;

                Utils.getElement('victoryText').innerHTML = victoryText;
                Utils.showModal('victoryModal');
                
                Display.updateAll();
                Storage.save();
            },

            defeat: () => {
                gameState.battleInProgress = false;
                Battle.addLog("üíÄ You have been defeated...");
                
                setTimeout(() => {
                    Utils.showModal('defeatModal');
                }, 1000);
            },

            showDamageNumber: (damage, target, type = 'damage') => {
                const targetElement = target === 'player' ? 
                    Utils.getElement('playerSpriteArena') : 
                    Utils.getElement('enemySprite');
                
                const damageEl = document.createElement('div');
                damageEl.className = 'damage-indicator';
                damageEl.textContent = type === 'heal' ? `+${damage}` : `-${damage}`;
                damageEl.style.color = type === 'heal' ? '#2ecc71' : '#e74c3c';
                damageEl.style.left = '50%';
                damageEl.style.top = '50%';
                damageEl.style.transform = 'translate(-50%, -50%)';
                
                targetElement.style.position = 'relative';
                targetElement.appendChild(damageEl);
                
                targetElement.style.animation = 'shake 0.5s ease-in-out';
                
                setTimeout(() => {
                    damageEl.remove();
                    targetElement.style.animation = '';
                }, 1000);
            },

            showJutsuAnimation: (emoji) => {
                const arena = Utils.getElement('battleArena');
                const jutsuEl = document.createElement('div');
                jutsuEl.className = 'jutsu-animation';
                jutsuEl.textContent = emoji;
                jutsuEl.style.left = '50%';
                jutsuEl.style.top = '50%';
                jutsuEl.style.transform = 'translate(-50%, -50%)';
                
                arena.style.position = 'relative';
                arena.appendChild(jutsuEl);
                
                setTimeout(() => jutsuEl.remove(), 1000);
            },

            addLog: (message) => {
                const log = Utils.getElement('battleLog');
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.textContent = message;
                
                log.appendChild(entry);
                log.scrollTop = log.scrollHeight;
                
                while (log.children.length > 10) {
                    log.removeChild(log.firstChild);
                }
            }
        };

        // ===== SHOP SYSTEM =====

        const Shop = {
            updateDisplay: () => {
                Shop.updateWeapons();
                Shop.updateArmor();
                Shop.updateAccessories();
                Shop.updatePotions();
                Utils.getElement('shopGoldBadge').textContent = `üí∞ ${gameState.player.gold}`;
            },

            updateWeapons: () => {
                const container = Utils.getElement('weaponsList');
                container.innerHTML = '';
                Shop.renderItems(container, 'weapon');
            },

            updateArmor: () => {
                const container = Utils.getElement('armorList');
                container.innerHTML = '';
                Shop.renderItems(container, 'armor');
            },

            updateAccessories: () => {
                const container = Utils.getElement('accessoriesList');
                container.innerHTML = '';
                Shop.renderItems(container, 'accessory');
            },

            updatePotions: () => {
                const container = Utils.getElement('potionsList');
                container.innerHTML = '';

                Object.entries(GameData.potions).forEach(([potionId, potion]) => {
                    const item = document.createElement('div');
                    item.className = 'shop-item';
                    
                    const owned = gameState.potions[potionId] || 0;
                    const canBuy = gameState.player.gold >= potion.price;

                    item.innerHTML = `
                        <div style="font-size: 2em;">${potion.emoji}</div>
                        <div class="shop-item-info">
                            <h4>${potion.name}</h4>
                            <p style="font-size: 0.85em; color: #bbb; margin: 5px 0;">${potion.description}</p>
                            <div style="color: #4ecdc4; font-size: 0.85em;">Owned: ${owned}</div>
                        </div>
                        <div class="shop-item-price">üí∞ ${potion.price}</div>
                        <button class="buy-button" ${!canBuy ? 'disabled' : ''}>Buy</button>
                    `;

                    item.querySelector('.buy-button').onclick = () => {
                        if (gameState.player.gold >= potion.price) {
                            gameState.player.gold -= potion.price;
                            gameState.potions[potionId]++;
                            Battle.addLog(`‚úÖ Bought ${potion.name}!`);
                            Shop.updateDisplay();
                            Display.updateAll();
                            Storage.save();
                        }
                    };

                    container.appendChild(item);
                });
            },

            renderItems: (container, type) => {
                const items = Object.entries(GameData.equipment).filter(([id, item]) => item.type === type);

                items.forEach(([itemId, item]) => {
                    // Hide Halloween items if event is not active
                    if (item.halloween && !GameData.events.halloween_event.active) return;
                    // Hide milestone items from shop
                    if (item.milestone) return;

                    const shopItem = document.createElement('div');
                    shopItem.className = 'shop-item';
                    
                    const owned = gameState.player.inventory.includes(itemId);
                    const equipped = Object.values(gameState.player.equipped).includes(itemId);
                    const canBuy = gameState.player.gold >= item.price && !owned;

                    shopItem.innerHTML = `
                        <div style="font-size: 2em;">${item.emoji}</div>
                        <div class="shop-item-info">
                            <h4>${item.name}</h4>
                            <div style="color: #4ecdc4; font-size: 0.8em; margin: 5px 0;">${item.rarity}</div>
                            <div style="font-size: 0.85em; color: #bbb;">
                                ${Object.entries(item.stats).map(([stat, value]) => 
                                    `${Utils.getStatEmoji(stat)} +${value}`
                                ).join(' ')}
                            </div>
                            ${owned ? '<div style="color: #2ecc71; margin-top: 5px;">‚úÖ Owned</div>' : ''}
                            ${equipped ? '<div style="color: #f39c12; margin-top: 5px;">‚ö° Equipped</div>' : ''}
                        </div>
                        <div class="shop-item-price">üí∞ ${item.price}</div>
                        <button class="buy-button" ${!canBuy ? 'disabled' : ''}>
                            ${owned ? 'Owned' : 'Buy'}
                        </button>
                    `;

                    if (canBuy) {
                        shopItem.querySelector('.buy-button').onclick = () => {
                            if (gameState.player.gold >= item.price) {
                                gameState.player.gold -= item.price;
                                gameState.player.inventory.push(itemId);
                                Battle.addLog(`‚úÖ Bought ${item.name}!`);
                                Shop.updateDisplay();
                                Display.updateAll();
                                Storage.save();
                            }
                        };
                    }

                    container.appendChild(shopItem);
                });

                if (items.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">No items available</div>';
                }
            }
        };

        // ===== INVENTORY MANAGEMENT =====

        const Inventory = {
            updateDisplay: () => {
                Inventory.updateEquippedItems();
                Inventory.updateAvailableEquipment();
                Inventory.updateConsumables();
                Utils.getElement('goldBadge').textContent = `üí∞ ${gameState.player.gold}`;
            },

            updateEquippedItems: () => {
                const container = Utils.getElement('equippedItems');
                container.innerHTML = '';

                Object.entries(gameState.player.equipped).forEach(([slot, itemId]) => {
                    const card = document.createElement('div');
                    card.className = 'equipment-card equipped';
                    
                    if (itemId && GameData.equipment[itemId]) {
                        const item = GameData.equipment[itemId];
                        card.innerHTML = `
                            <div class="equipment-icon">${item.emoji}</div>
                            <h4>${item.name}</h4>
                            <div style="font-size: 0.8em; color: #f39c12; margin: 5px 0;">${slot.charAt(0).toUpperCase() + slot.slice(1)}</div>
                            <div class="equipment-stats">
                                ${Object.entries(item.stats).map(([stat, value]) => 
                                    `<div>${Utils.getStatEmoji(stat)} +${value}</div>`
                                ).join('')}
                            </div>
                        `;
                        card.onclick = () => Inventory.unequipItem(slot);
                    } else {
                        card.innerHTML = `
                            <div class="equipment-icon">‚ùå</div>
                            <h4>Empty</h4>
                            <div style="font-size: 0.8em; color: #666;">${slot.charAt(0).toUpperCase() + slot.slice(1)}</div>
                        `;
                    }

                    container.appendChild(card);
                });
            },

            updateAvailableEquipment: () => {
                const container = Utils.getElement('availableEquipment');
                container.innerHTML = '';

                const availableItems = gameState.player.inventory.filter(itemId => 
                    GameData.equipment[itemId] && !Object.values(gameState.player.equipped).includes(itemId)
                );

                availableItems.forEach(itemId => {
                    const item = GameData.equipment[itemId];
                    const card = document.createElement('div');
                    card.className = `equipment-card ${item.rarity}`;
                    
                    card.innerHTML = `
                        <div class="equipment-icon">${item.emoji}</div>
                        <h4>${item.name}</h4>
                        <div style="font-size: 0.8em; color: #4ecdc4; margin: 5px 0;">${item.rarity}</div>
                        <div class="equipment-stats">
                            ${Object.entries(item.stats).map(([stat, value]) => 
                                `<div>${Utils.getStatEmoji(stat)} +${value}</div>`
                            ).join('')}
                        </div>
                    `;

                    card.onclick = () => Inventory.equipItem(itemId);
                    container.appendChild(card);
                });

                if (availableItems.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">No equipment available</div>';
                }
            },

            updateConsumables: () => {
                const container = Utils.getElement('consumablesList');
                container.innerHTML = '';

                Object.entries(gameState.potions).forEach(([potionId, count]) => {
                    if (count > 0) {
                        const potion = GameData.potions[potionId];
                        const card = document.createElement('div');
                        card.className = 'equipment-card';
                        
                        card.innerHTML = `
                            <div class="equipment-icon">${potion.emoji}</div>
                            <h4>${potion.name}</h4>
                            <div style="margin: 10px 0; color: #4ecdc4;">x${count}</div>
                            <div style="font-size: 0.85em; color: #bbb;">${potion.description}</div>
                        `;

                        container.appendChild(card);
                    }
                });

                if (Object.values(gameState.potions).every(v => v === 0)) {
                    container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">No potions available</div>';
                }
            },

            equipItem: (itemId) => {
                const item = GameData.equipment[itemId];
                if (!item) return;

                const currentItem = gameState.player.equipped[item.type];
                if (currentItem) {
                    gameState.player.inventory.push(currentItem);
                }

                gameState.player.equipped[item.type] = itemId;
                
                const index = gameState.player.inventory.indexOf(itemId);
                if (index > -1) {
                    gameState.player.inventory.splice(index, 1);
                }

                Player.updateStats();
                Inventory.updateDisplay();
                Display.updateAll();
                Storage.save();
            }
        };

        // ===== SKILLS MANAGEMENT =====

        const Skills = {
            updateDisplay: () => {
                const container = Utils.getElement('skillTree');
                const badge = Utils.getElement('skillPointsBadge');
                
                badge.textContent = `Points: ${gameState.player.skillPoints}`;
                container.innerHTML = '';

                Object.entries(GameData.skills).forEach(([skillId, skill]) => {
                    // Hide Halloween skills if event is not active
                    if (skill.halloween && !GameData.events.halloween_event.active) return;

                    const card = document.createElement('div');
                    const isUnlocked = gameState.player.unlockedSkills.includes(skillId);
                    const canUnlock = !isUnlocked && 
                        gameState.player.skillPoints >= skill.cost &&
                        (!skill.requires || gameState.player.unlockedSkills.includes(skill.requires));

                    card.className = `skill-node ${isUnlocked ? 'unlocked' : canUnlock ? '' : 'locked'}`;
                    
                    card.innerHTML = `
                        <div class="skill-icon">${skill.emoji}</div>
                        <h4>${skill.name}</h4>
                        <p style="font-size: 0.85em; margin: 8px 0;">${skill.description}</p>
                        <div class="skill-cost">
                            ${isUnlocked ? '‚úÖ Unlocked' : `üíé ${skill.cost} Points`}
                        </div>
                        ${skill.requires ? `<div style="font-size: 0.7em; color: #666; margin-top: 5px;">Requires: ${GameData.skills[skill.requires]?.name}</div>` : ''}
                    `;

                    if (canUnlock) {
                        card.onclick = () => Skills.unlockSkill(skillId);
                    }

                    container.appendChild(card);
                });
            },

            unlockSkill: (skillId) => {
                const skill = GameData.skills[skillId];
                if (!skill || gameState.player.skillPoints < skill.cost) return;

                if (skill.requires && !gameState.player.unlockedSkills.includes(skill.requires)) {
                    return;
                }

                gameState.player.skillPoints -= skill.cost;
                gameState.player.unlockedSkills.push(skillId);

                Player.updateStats();
                Skills.updateDisplay();
                Display.updateAll();
                Storage.save();

                Battle.addLog(`‚≠ê Learned: ${skill.name}!`);
            }
        };

        // ===== QUESTS MANAGEMENT =====

        const Quests = {
            updateDisplay: () => {
                const container = Utils.getElement('questsList');
                const badge = Utils.getElement('questCountBadge');
                
                const completedCount = Object.values(gameState.player.questProgress).filter(q => q.completed).length;
                const totalCount = Object.keys(gameState.player.questProgress).length;
                badge.textContent = `${completedCount}/${totalCount}`;
                
                container.innerHTML = '';

                Object.entries(gameState.player.questProgress).forEach(([questId, quest]) => {
                    // Hide Halloween quests if event is not active
                    if (quest.halloween && !GameData.events.halloween_event.active) return;

                    const card = document.createElement('div');
                    card.className = `quest-card ${quest.completed ? 'completed' : ''}`;
                    
                    const progress = Math.min(quest.progress, quest.target);
                    const progressPercent = (progress / quest.target) * 100;
                    
                    card.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4>${quest.emoji} ${quest.name}</h4>
                            ${quest.completed ? '<span style="color: #2ecc71;">‚úÖ Completed</span>' : ''}
                        </div>
                        <p style="margin: 8px 0; font-size: 0.9em;">${quest.description}</p>
                        <div class="quest-progress">
                            <div class="quest-progress-fill" style="width: ${progressPercent}%"></div>
                        </div>
                        <div style="font-size: 0.85em; margin: 8px 0;">${progress}/${quest.target}</div>
                        <div class="quest-rewards">
                            ${quest.rewards.exp ? `‚≠ê ${quest.rewards.exp} EXP` : ''}
                            ${quest.rewards.gold ? `üí∞ ${quest.rewards.gold} Gold` : ''}
                            ${quest.rewards.skillPoints ? `üíé ${quest.rewards.skillPoints} Skill Points` : ''}
                            ${quest.rewards.item ? `üéÅ ${GameData.equipment[quest.rewards.item]?.name || quest.rewards.item}` : ''}
                        </div>
                    `;

                    container.appendChild(card);
                });
            },

            updateProgress: (questId, amount) => {
                if (!gameState.player.questProgress[questId]) return;
                
                const quest = gameState.player.questProgress[questId];
                if (quest.completed) return;
                
                if (questId === 'reach_level_5') {
                    quest.progress = amount;
                } else if (questId === 'collect_1000_gold') {
                    quest.progress = gameState.player.gold;
                } else {
                    quest.progress += amount;
                }
                
                if (quest.progress >= quest.target && !quest.completed) {
                    quest.completed = true;
                    
                    if (quest.rewards.exp) {
                        gameState.player.exp += quest.rewards.exp;
                    }
                    if (quest.rewards.gold) {
                        gameState.player.gold += quest.rewards.gold;
                        gameState.gold = gameState.player.gold;
                    }
                    if (quest.rewards.skillPoints) {
                        gameState.player.skillPoints += quest.rewards.skillPoints;
                    }
                    if (quest.rewards.item) {
                        gameState.player.inventory.push(quest.rewards.item);
                    }
                    
                    Battle.addLog(`üéâ Quest completed: ${quest.name}!`);
                }
            }
        };

        // ===== EVENTS MANAGEMENT =====

        const Events = {
            updateDisplay: () => {
                const container = Utils.getElement('eventsList');
                container.innerHTML = '';

                Object.entries(GameData.events).forEach(([eventId, event]) => {
                    if (!event.active) return;
                    
                    const banner = document.createElement('div');
                    banner.className = `event-banner ${event.emoji === 'üéÉ' ? 'halloween' : ''}`;
                    
                    banner.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>${event.emoji} ${event.name}</h3>
                            <span class="event-timer">‚è∞ ${event.duration}</span>
                        </div>
                        <p style="margin: 10px 0; font-size: 0.95em;">${event.description}</p>
                        <div style="font-size: 0.85em; opacity: 0.9;">
                            Effect: ${Events.getEffectText(event)}
                        </div>
                    `;

                    container.appendChild(banner);
                });

                if (container.children.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">No active events</div>';
                }
            },

            getEffectText: (event) => {
                if (event.type === 'multiplier') {
                    return Object.entries(event.effect).map(([key, value]) => 
                        `${key.toUpperCase()} x${value}`
                    ).join(', ');
                } else if (event.type === 'bonus') {
                    return Object.entries(event.effect).map(([key, value]) => 
                        `+${value} ${key}`
                    ).join(', ');
                } else if (event.type === 'seasonal') {
                    return 'Special seasonal content unlocked!';
                }
                return 'Special bonus active';
            }
        };

        // ===== DISPLAY MANAGEMENT =====

        const Display = {
            updateAll: () => {
                if (!gameState.player) return;

                Utils.getElement('playerNameHeader').textContent = gameState.player.name;
                Utils.getElement('playerLevel').textContent = gameState.player.level;
                Utils.getElement('goldAmount').textContent = gameState.player.gold;
                Utils.getElement('playerSprite').textContent = gameState.player.emoji;
                Utils.getElement('playerSpriteArena').textContent = gameState.player.emoji;
                Utils.getElement('playerNameBattle').textContent = gameState.player.name;

                const hpPercent = (gameState.player.stats.hp / gameState.player.stats.maxHp) * 100;
                Utils.getElement('playerHPBar').style.width = hpPercent + '%';
                Utils.getElement('playerHPText').textContent = `${gameState.player.stats.hp}/${gameState.player.stats.maxHp}`;

                const chakraPercent = (gameState.player.stats.chakra / gameState.player.stats.maxChakra) * 100;
                Utils.getElement('playerChakraBar').style.width = chakraPercent + '%';
                Utils.getElement('playerChakraText').textContent = `${gameState.player.stats.chakra}/${gameState.player.stats.maxChakra}`;

                const expPercent = (gameState.player.exp / gameState.player.expToNext) * 100;
                Utils.getElement('playerExpBar').style.width = expPercent + '%';
                Utils.getElement('playerExpText').textContent = `${gameState.player.exp}/${gameState.player.expToNext}`;

                if (gameState.enemy) {
                    Utils.getElement('enemySprite').textContent = gameState.enemy.emoji;
                    Utils.getElement('enemyName').textContent = `${gameState.enemy.name} (Lv.${gameState.enemy.level})`;
                    
                    const enemyHpPercent = (gameState.enemy.hp / gameState.enemy.maxHp) * 100;
                    Utils.getElement('enemyHPBar').style.width = enemyHpPercent + '%';
                    Utils.getElement('enemyHPText').textContent = `${gameState.enemy.hp}/${gameState.enemy.maxHp}`;
                }
            }
        };

        // ===== STORAGE MANAGEMENT =====

        const Storage = {
            save: () => {
                if (!gameState.player) return;
                
                const saveData = {
                    player: gameState.player,
                    currentBattleIndex: gameState.currentBattleIndex,
                    gold: gameState.gold,
                    selectedCharacter: gameState.selectedCharacter,
                    potions: gameState.potions,
                    totalBattles: gameState.totalBattles,
                    milestones: gameState.milestones,
                    unlockedJutsus: gameState.unlockedJutsus,
                    timestamp: Date.now()
                };

                try {
                    localStorage.setItem('ninjaLegacySave', JSON.stringify(saveData));
                } catch (e) {
                    console.log('Could not save game data');
                }
            },

            load: () => {
    try {
        const saveData = localStorage.getItem('ninjaLegacySave');
        if (saveData) {
            const data = JSON.parse(saveData);
            gameState.player = data.player;
            gameState.currentBattleIndex = data.currentBattleIndex || 0;
            gameState.gold = data.gold || 0;
            gameState.selectedCharacter = data.selectedCharacter;
            gameState.potions = data.potions || {
                health_potion: 0,
                mega_health_potion: 0,
                chakra_potion: 0,
                elixir: 0
            };
            gameState.totalBattles = data.totalBattles || 0;
            
            // PENTING: Pastikan milestones ter-load dengan benar
            if (data.milestones) {
                gameState.milestones = data.milestones;
            } else {
                gameState.milestones = JSON.parse(JSON.stringify(GameData.milestones));
            }
            
            gameState.unlockedJutsus = data.unlockedJutsus || [];
            return true;
        }
    } catch (e) {
        console.log('Could not load game data:', e);
    }
    return false;
}
        };

        // ===== CHARACTER SELECTION =====

        const CharacterSelection = {
            render: () => {
                const grid = Utils.getElement('characterGrid');
                grid.innerHTML = '';

                GameData.characters.forEach(char => {
                    const card = document.createElement('div');
                    card.className = 'character-card';
                    card.onclick = () => CharacterSelection.select(char.id, card);

                    card.innerHTML = `
                        <div class="character-avatar">${char.emoji}</div>
                        <h3>${char.name}</h3>
                        <p style="color: #4ecdc4; margin: 10px 0;">${char.element.charAt(0).toUpperCase() + char.element.slice(1)} Element</p>
                        <p style="font-size: 0.9em; color: #bbb; margin-bottom: 15px;">${char.description}</p>
                        <div class="character-stats">
                            <div>‚ù§Ô∏è HP: ${char.baseStats.maxHp}</div>
                            <div>üíô Chakra: ${char.baseStats.maxChakra}</div>
                            <div>‚öîÔ∏è Attack: ${char.baseStats.attack}</div>
                            <div>üõ°Ô∏è Defense: ${char.baseStats.defense}</div>
                            <div>üí® Speed: ${char.baseStats.speed}</div>
                        </div>
                    `;

                    grid.appendChild(card);
                });
            },

            select: (characterId, cardElement) => {
                document.querySelectorAll('.character-card').forEach(card => {
                    card.classList.remove('selected');
                });

                cardElement.classList.add('selected');
                gameState.selectedCharacter = GameData.characters.find(c => c.id === characterId);
            },

            confirm: () => {
                if (!gameState.selectedCharacter) {
                    alert('Please select a character first!');
                    return;
                }

                Player.initialize(gameState.selectedCharacter);
                gameState.gold = gameState.player.gold;
                gameState.currentBattleIndex = 0;
                gameState.battleInProgress = false;
                gameState.turn = 'player';

                Utils.showScreen('gameScreen');
                Battle.start();
            }
        };

        // ===== EVENT LISTENERS =====

        function setupEventListeners() {
            // Main menu buttons
            Utils.getElement('newGameBtn').addEventListener('click', () => {
                CharacterSelection.render();
                Utils.showScreen('characterScreen');
            });
            Utils.getElement('loadGameBtn').addEventListener('click', () => {
                if (Storage.load()) {
                    Utils.showScreen('gameScreen');
                    Battle.start();
                } else {
                    alert('No saved game found!');
                }
            });
            Utils.getElement('eventsBtn').addEventListener('click', () => Utils.showScreen('eventsScreen'));
            Utils.getElement('aboutBtn').addEventListener('click', () => Utils.showModal('aboutModal'));
            
            // Character selection
            Utils.getElement('startGameBtn').addEventListener('click', CharacterSelection.confirm);
            Utils.getElement('backToMainBtn').addEventListener('click', () => Utils.showScreen('mainScreen'));
            
            // Victory/Defeat modals
            Utils.getElement('nextBattleBtn').addEventListener('click', () => {
                Utils.hideModal('victoryModal');
                gameState.currentBattleIndex++;
                Battle.start();
            });
            Utils.getElement('retryBtn').addEventListener('click', () => {
                Utils.hideModal('defeatModal');
                gameState.player.stats.hp = Math.floor(gameState.player.stats.maxHp * 0.5);
                gameState.player.stats.chakra = gameState.player.stats.maxChakra;
                Battle.start();
            });
            Utils.getElement('mainMenuBtn').addEventListener('click', () => {
                Utils.hideModal('defeatModal');
                Utils.showScreen('mainScreen');
            });
            
            // Milestone modal
            Utils.getElement('closeMilestoneBtn').addEventListener('click', () => Utils.hideModal('milestoneModal'));
            
            // About modal
            Utils.getElement('closeAboutBtn').addEventListener('click', () => Utils.hideModal('aboutModal'));
            
            // Bottom navigation
            Utils.getElement('battleNavBtn').addEventListener('click', () => Utils.showScreen('gameScreen'));
            Utils.getElement('shopNavBtn').addEventListener('click', () => Utils.showScreen('shopScreen'));
            Utils.getElement('inventoryNavBtn').addEventListener('click', () => Utils.showScreen('inventoryScreen'));
            Utils.getElement('skillsNavBtn').addEventListener('click', () => Utils.showScreen('skillsScreen'));
            Utils.getElement('milestonesNavBtn').addEventListener('click', () => Utils.showScreen('milestonesScreen'));
            Utils.getElement('questsNavBtn').addEventListener('click', () => Utils.showScreen('questsScreen'));
            Utils.getElement('menuNavBtn').addEventListener('click', () => {
                const result = confirm('Return to main menu? (Progress will be saved)');
                if (result) {
                    Storage.save();
                    Utils.showScreen('mainScreen');
                    gameState.battleInProgress = false;
                }
            });
            
            // Tab system
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => Utils.switchTab(btn.dataset.tab, btn.parentNode.parentNode));
            });

            // Touch optimizations
            document.addEventListener('touchstart', function() {}, { passive: true });
            document.addEventListener('touchmove', function(e) {
                if (e.target.closest('.screen') && e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });
        }
        
        // ===== ARTIFACT INTEGRATION =====
const ArtifactIntegration = {
    applyBonuses: () => {
        if (!gameState.player || !window.ManhwaArtifacts) return;
        
        const bonuses = window.ManhwaArtifacts.getEquippedBonuses();
        
        // Simpan base stats jika belum ada
        if (!gameState.player.baseMaxHP) {
            gameState.player.baseMaxHP = gameState.player.stats.maxHp;
        }
        if (!gameState.player.baseMaxMP) {
            gameState.player.baseMaxMP = gameState.player.stats.maxChakra;
        }
        
        // Apply HP bonus
        const oldMaxHP = gameState.player.stats.maxHp;
        gameState.player.stats.maxHp = gameState.player.baseMaxHP + bonuses.hp;
        
        // Adjust current HP proportionally
        if (oldMaxHP > 0) {
            const hpRatio = gameState.player.stats.hp / oldMaxHP;
            gameState.player.stats.hp = Math.min(gameState.player.stats.maxHp, Math.floor(gameState.player.stats.maxHp * hpRatio));
        }
        
        // Apply MP bonus
        const oldMaxMP = gameState.player.stats.maxChakra;
        gameState.player.stats.maxChakra = gameState.player.baseMaxMP + bonuses.mp;
        
        // Adjust current MP proportionally
        if (oldMaxMP > 0) {
            const mpRatio = gameState.player.stats.chakra / oldMaxMP;
            gameState.player.stats.chakra = Math.min(gameState.player.stats.maxChakra, Math.floor(gameState.player.stats.maxChakra * mpRatio));
        }
        
        // Store bonuses for damage calculation
        if (!gameState.player.artifactBonuses) {
            gameState.player.artifactBonuses = {};
        }
        gameState.player.artifactBonuses = bonuses;
        
        console.log('Applied artifact bonuses:', bonuses);
        console.log('New maxHP:', gameState.player.stats.maxHp);
        console.log('New maxMP:', gameState.player.stats.maxChakra);
    },
    
    calculateDamageBonus: () => {
        if (!gameState.player || !gameState.player.artifactBonuses) return 0;
        return gameState.player.artifactBonuses.damage || 0;
    },
    
    calculateMPCostReduction: (baseCost) => {
        if (!gameState.player || !gameState.player.artifactBonuses) return baseCost;
        const reduction = gameState.player.artifactBonuses.mpReduction || 0;
        return Math.max(0, Math.floor(baseCost * (1 - reduction / 100)));
    },
    
    calculateExpBonus: (baseExp) => {
        if (!gameState.player || !gameState.player.artifactBonuses) return baseExp;
        const boost = gameState.player.artifactBonuses.expBoost || 0;
        return Math.floor(baseExp * (1 + boost / 100));
    },
    
    calculateGoldBonus: (baseGold) => {
        if (!gameState.player || !gameState.player.artifactBonuses) return baseGold;
        const boost = gameState.player.artifactBonuses.goldBoost || 0;
        return Math.floor(baseGold * (1 + boost / 100));
    }
};

// Update Player.updateStats untuk include artifact bonuses
const originalUpdateStats = Player.updateStats;
Player.updateStats = function() {
    originalUpdateStats.call(Player);
    // Apply artifact bonuses after normal stats update
    setTimeout(() => {
        ArtifactIntegration.applyBonuses();
    }, 100);
};

// Update Battle.calculateDamage untuk include artifact damage bonus
const originalCalculateDamage = Battle.calculateDamage;
Battle.calculateDamage = function(baseDamage) {
    let damage = originalCalculateDamage.call(Battle, baseDamage);
    // Add artifact damage bonus
    const artifactBonus = ArtifactIntegration.calculateDamageBonus();
    damage += artifactBonus;
    return Math.max(1, damage);
};

// Update Battle.useJutsu untuk apply MP cost reduction
const originalUseJutsu = Battle.useJutsu;
Battle.useJutsu = function(jutsuId) {
    if (!gameState.battleInProgress || gameState.turn !== 'player') return;

    const jutsu = GameData.jutsus[jutsuId];
    
    // Calculate reduced MP cost
    const originalCost = jutsu.chakraCost;
    const reducedCost = ArtifactIntegration.calculateMPCostReduction(originalCost);
    
    if (gameState.player.stats.chakra < reducedCost) {
        Battle.addLog("‚ùå Not enough chakra!");
        return;
    }

    // Temporarily modify jutsu cost
    const tempJutsu = {...jutsu, chakraCost: reducedCost};
    GameData.jutsus[jutsuId] = tempJutsu;
    
    // Call original function
    originalUseJutsu.call(Battle, jutsuId);
    
    // Restore original cost
    GameData.jutsus[jutsuId] = jutsu;
    
    // Show MP cost reduction if any
    if (reducedCost < originalCost) {
        Battle.addLog(`üíô MP cost reduced: ${originalCost} ‚Üí ${reducedCost}`);
    }
};

// Update Battle.victory untuk apply EXP and Gold bonuses
const originalVictory = Battle.victory;
Battle.victory = function() {
    gameState.battleInProgress = false;
    gameState.totalBattles++;
    
    const baseExp = gameState.enemy.exp;
    const baseGold = gameState.enemy.gold;
    
    // Apply event multipliers
    const expMultiplier = GameData.events.double_exp.active ? 2 : 1;
    const goldMultiplier = GameData.events.gold_rush.active ? 1.5 : 1;
    
    // Apply artifact bonuses
    let finalExp = Math.floor(baseExp * expMultiplier);
    finalExp = ArtifactIntegration.calculateExpBonus(finalExp);
    
    let finalGold = Math.floor(baseGold * goldMultiplier);
    finalGold = ArtifactIntegration.calculateGoldBonus(finalGold);
    
    gameState.player.exp += finalExp;
    gameState.player.gold += finalGold;
    gameState.gold = gameState.player.gold;

    let leveledUp = false;
    while (gameState.player.exp >= gameState.player.expToNext) {
        leveledUp = true;
        gameState.player.exp -= gameState.player.expToNext;
        gameState.player.level++;
        gameState.player.expToNext = gameState.player.level * 100;
        
        let skillPointsGained = 1;
        if (GameData.events.skill_point_bonus?.active) {
            skillPointsGained += 1;
        }
        gameState.player.skillPoints += skillPointsGained;
        
        gameState.player.stats.hp = gameState.player.stats.maxHp;
        gameState.player.stats.chakra = gameState.player.stats.maxChakra;
    }

    let droppedItem = null;
    const dropChance = GameData.events.rare_drops.active ? 0.4 : 0.2;
    if (Math.random() < dropChance) {
        const equipmentKeys = Object.keys(GameData.equipment);
        const randomItem = equipmentKeys[Math.floor(Math.random() * equipmentKeys.length)];
        droppedItem = randomItem;
        gameState.player.inventory.push(randomItem);
    }

    Quests.updateProgress('first_victory', 1);
    Quests.updateProgress('defeat_5_enemies', 1);
    Quests.updateProgress('collect_1000_gold', finalGold);
    Quests.updateProgress('reach_level_5', gameState.player.level);
    
    if (gameState.enemy.name === 'Ancient Dragon') {
        Quests.updateProgress('defeat_boss', 1);
    }

    if (gameState.enemy.halloween) {
        Quests.updateProgress('halloween_hunter', 1);
    }

    Milestones.checkMilestone();

    // Show artifact bonuses in victory message
    const expBonus = gameState.player.artifactBonuses?.expBoost || 0;
    const goldBonus = gameState.player.artifactBonuses?.goldBoost || 0;

    let victoryText = `
        <div style="margin: 20px 0;">
            <div style="font-size: 1.2em; margin: 10px 0;">üéâ Defeated ${gameState.enemy.name}!</div>
            <div style="color: #f39c12;">üí∞ +${finalGold} Gold ${goldBonus > 0 ? `(+${goldBonus}% artifact bonus)` : ''}</div>
            <div style="color: #3498db;">‚≠ê +${finalExp} EXP ${expBonus > 0 ? `(+${expBonus}% artifact bonus)` : ''}</div>
            <div style="color: #4ecdc4; margin-top: 10px;">üèÜ Total Battles: ${gameState.totalBattles}</div>
            ${leveledUp ? `<div style="color: #2ecc71;">üéä Level Up! Now level ${gameState.player.level}!</div>` : ''}
            ${droppedItem ? `<div style="color: #9b59b6;">üéÅ Found: ${GameData.equipment[droppedItem].name}!</div>` : ''}
        </div>
    `;

    Utils.getElement('victoryText').innerHTML = victoryText;
    Utils.showModal('victoryModal');
    
    Display.updateAll();
    Storage.save();
};

// Check for artifacts periodically and apply bonuses
setInterval(() => {
    if (gameState.player && window.ManhwaArtifacts) {
        ArtifactIntegration.applyBonuses();
        Display.updateAll();
    }
}, 2000);

// Apply bonuses when artifacts screen is closed
window.addEventListener('message', function(event) {
    if (event.data === 'artifactsUpdated') {
        setTimeout(() => {
            ArtifactIntegration.applyBonuses();
            Display.updateAll();
        }, 500);
    }
});

        // ===== INITIALIZATION =====

        function initGame() {
    try {
        console.log("üéÆ Starting game initialization...");
        
        // Check if required functions exist
        if (typeof setupEventListeners !== 'function') {
            console.error("‚ùå setupEventListeners is not defined!");
            return;
        }
        
        if (typeof Storage === 'undefined' || typeof Storage.load !== 'function') {
            console.error("‚ùå Storage.load is not defined!");
            return;
        }
        
        if (typeof Display === 'undefined' || typeof Display.updateAll !== 'function') {
            console.error("‚ùå Display.updateAll is not defined!");
            return;
        }

        console.log("‚úÖ Setting up event listeners...");
        setupEventListeners();
        
        console.log("‚úÖ Loading game data...");
        Storage.load();
        
        // Initialize artifact integration
        if (window.ManhwaArtifacts) {
            console.log('üó°Ô∏è Artifact system detected, applying bonuses...');
            setTimeout(() => {
                if (typeof ArtifactIntegration !== 'undefined' && typeof ArtifactIntegration.applyBonuses === 'function') {
                    ArtifactIntegration.applyBonuses();
                    Display.updateAll();
                } else {
                    console.warn("‚ö†Ô∏è ArtifactIntegration.applyBonuses is not available");
                }
            }, 1000);
        }
        
        console.log("‚úÖ Updating display...");
        Display.updateAll();
        
        console.log("üéâ Game initialized successfully!");
        
    } catch (error) {
        console.error("üí• Error during game initialization:", error);
        // Fallback - try to show main menu or error screen
        alert("Game failed to load. Please refresh the page.");
    }
}

// Auto-save every 30 seconds
setInterval(() => {
    if (gameState?.player && ['gameScreen', 'shopScreen', 'inventoryScreen', 'skillsScreen', 'milestonesScreen', 'questsScreen'].includes(gameState.currentScreen)) {
        Storage.save();
    }
}, 30000);

// Prevent zoom on double tap (iOS Safari)
let lastTouchEnd = 0;
document.addEventListener('touchend', function (event) {
    const now = (new Date()).getTime();
    if (now - lastTouchEnd <= 300) {
        event.preventDefault();
    }
    lastTouchEnd = now;
}, false);

// Handle visibility change for auto-save
document.addEventListener('visibilitychange', function() {
    if (document.hidden && gameState?.player) {
        Storage.save();
    }
});

// Initialize game when page loads
document.addEventListener('DOMContentLoaded', function() {
    console.log("üåê DOM Content Loaded, initializing game...");
    initGame();
});
    </script>
<script>
// Inisialisasi musik dengan error handling yang lebih baik
let bgMusic = null;
let musicToggle = null;
let musicStatus = null;
let isMusicPlaying = false;
let musicLoaded = false;

// Inisialisasi setelah DOM loaded
document.addEventListener('DOMContentLoaded', function() {
    bgMusic = document.getElementById('bgMusic');
    musicToggle = document.getElementById('musicToggle');
    musicStatus = document.getElementById('musicStatus');
    
    if (!bgMusic || !musicToggle) {
        console.log('Audio elements not found');
        return;
    }

    // Set volume musik
    bgMusic.volume = 1.0;
    
    // Event listeners untuk audio
    bgMusic.addEventListener('canplaythrough', function() {
        musicLoaded = true;
        console.log('Music loaded and ready to play');
        updateMusicButton();
    });
    
    bgMusic.addEventListener('loadeddata', function() {
        musicLoaded = true;
        console.log('Music data loaded');
    });
    
    bgMusic.addEventListener('error', function(e) {
        console.log('Error loading music:', e);
        console.log('Error code:', bgMusic.error ? bgMusic.error.code : 'unknown');
        console.log('Current src:', bgMusic.currentSrc);
        // Tetap tampilkan kontrol meski ada error
        updateMusicButton();
    });
    
    bgMusic.addEventListener('play', function() {
        isMusicPlaying = true;
        updateMusicButton();
        console.log('Music started playing');
    });
    
    bgMusic.addEventListener('pause', function() {
        isMusicPlaying = false;
        updateMusicButton();
        console.log('Music paused');
    });
    
    bgMusic.addEventListener('ended', function() {
        // Restart music when it ends (backup for loop)
        if (isMusicPlaying) {
            bgMusic.currentTime = 0;
            bgMusic.play();
        }
    });

    // Event listener untuk tombol musik
    musicToggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('Music button clicked');
        toggleMusic();
    });

    // Event listener untuk menu buttons
    setupGameButtons();
    
    console.log('Music system initialized');
    console.log('Audio src:', bgMusic.currentSrc || 'No source');
});

// Fungsi untuk memulai musik
function startMusic() {
    if (!bgMusic) {
        console.log('Music element not found');
        return;
    }
    
    console.log('Attempting to start music');
    console.log('Music ready state:', bgMusic.readyState);
    console.log('Music paused:', bgMusic.paused);
    
    // Reset audio jika perlu
    if (bgMusic.paused) {
        bgMusic.currentTime = 0;
    }
    
    const playPromise = bgMusic.play();
    
    if (playPromise !== undefined) {
        playPromise.then(() => {
            isMusicPlaying = true;
            updateMusicButton();
            console.log('Music started successfully');
        }).catch(error => {
            console.log('Error playing music:', error.name, error.message);
            isMusicPlaying = false;
            updateMusicButton();
            
            // Coba lagi setelah user interaction
            document.addEventListener('click', function tryAgain() {
                console.log('Retrying music play after user interaction');
                bgMusic.play().then(() => {
                    isMusicPlaying = true;
                    updateMusicButton();
                    console.log('Music started on retry');
                    document.removeEventListener('click', tryAgain);
                }).catch(err => {
                    console.log('Retry failed:', err);
                });
            }, { once: true });
        });
    }
}

// Fungsi untuk menghentikan musik
function stopMusic() {
    if (!bgMusic) return;
    
    bgMusic.pause();
    bgMusic.currentTime = 0;
    isMusicPlaying = false;
    updateMusicButton();
    console.log('Music stopped');
}

// Fungsi untuk toggle musik
function toggleMusic() {
    console.log('Toggle music, current state:', isMusicPlaying);
    console.log('Audio paused:', bgMusic ? bgMusic.paused : 'no audio');
    
    if (!bgMusic) {
        console.log('Music element not available');
        return;
    }
    
    if (isMusicPlaying && !bgMusic.paused) {
        bgMusic.pause();
        isMusicPlaying = false;
        console.log('Music paused by user');
    } else {
        startMusic();
    }
    updateMusicButton();
}

// Update tampilan tombol musik
function updateMusicButton() {
    if (!musicToggle || !musicStatus) return;
    
    if (isMusicPlaying && bgMusic && !bgMusic.paused) {
        musicToggle.textContent = 'üîä';
        musicStatus.textContent = 'ON';
        musicToggle.style.color = '#4ecdc4';
        musicStatus.style.color = '#4ecdc4';
    } else {
        musicToggle.textContent = 'üîá';
        musicStatus.textContent = 'OFF';
        musicToggle.style.color = '#ffffff';
        musicStatus.style.color = '#ffffff';
    }
}

// Setup event listeners untuk tombol game
function setupGameButtons() {
    // Tunggu sebentar untuk memastikan semua elemen sudah ter-render
    setTimeout(() => {
        // Cari semua tombol menu
        const allButtons = document.querySelectorAll('button, .menu-button, .action-btn');
        
        console.log('Found buttons:', allButtons.length);
        
        allButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                const buttonText = this.textContent.toLowerCase().trim();
                
                // Debug log
                console.log('Button clicked:', buttonText);
                
                // Deteksi tombol New Game, Load Game, atau Start
                if (buttonText.includes('new game') || 
                    buttonText.includes('load game') || 
                    buttonText.includes('start') ||
                    buttonText.includes('permainan baru') || 
                    buttonText.includes('muat permainan') ||
                    buttonText.includes('mulai') ||
                    buttonText.includes('play')) {
                    
                    console.log('Game start button detected, starting music...');
                    
                    // Delay untuk memastikan transisi UI selesai
                    setTimeout(() => {
                        startMusic();
                    }, 300);
                }
            });
        });
        
        // Juga listen untuk screen changes
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    const target = mutation.target;
                    if (target.classList && target.classList.contains('screen') && target.classList.contains('active')) {
                        console.log('Screen changed to:', target.id);
                        // Screen changed, try to start music if not playing
                        if (!isMusicPlaying && musicLoaded) {
                            console.log('Attempting to start music on screen change');
                            setTimeout(() => {
                                startMusic();
                            }, 500);
                        }
                    }
                }
            });
        });
        
        // Observe all screens
        const screens = document.querySelectorAll('.screen');
        console.log('Observing screens:', screens.length);
        screens.forEach(screen => {
            observer.observe(screen, { attributes: true, attributeFilter: ['class'] });
        });
    }, 500);
}

// Hentikan musik saat page unload
window.addEventListener('beforeunload', function() {
    console.log('Page unloading, stopping music');
    stopMusic();
});

// Handle visibility change
document.addEventListener('visibilitychange', function() {
    if (!bgMusic) return;
    
    if (document.hidden) {
        console.log('Page hidden, pausing music');
        if (isMusicPlaying) {
            bgMusic.pause();
        }
    } else {
        console.log('Page visible, resuming music');
        if (isMusicPlaying && bgMusic.paused) {
            bgMusic.play().catch(err => console.log('Resume failed:', err));
        }
    }
});

// Debug: Log status musik setiap 5 detik
setInterval(() => {
    if (bgMusic) {
        console.log('=== Music Status ===');
        console.log('Loaded:', musicLoaded);
        console.log('Playing:', isMusicPlaying);
        console.log('Paused:', bgMusic.paused);
        console.log('Current time:', bgMusic.currentTime);
        console.log('Duration:', bgMusic.duration);
        console.log('Ready state:', bgMusic.readyState);
        console.log('Network state:', bgMusic.networkState);
        console.log('Source:', bgMusic.currentSrc);
        console.log('===================');
    }
}, 5000);

console.log('Music script loaded');
</script>   
</body>
</html>